import{c as _,j as e,t as B,w as P,f as V,x as U,s as A,y as E,z as L,A as R,B as O,D as $,E as W,F as G,G as q,H as z,I as H}from"./index-DDMfrihc.js";import{R as m}from"./react-vendor-DTkXckhQ.js";import{listSections as J,listTopics as Q,createSection as K,updateSection as X,deleteSection as Y,updateTopic as S,moveTopic as Z,deleteTopic as ee,resetForum as te}from"./forumRemote-DZSWY5Uv.js";import"./icons-zK4tVMYI.js";function k(){try{const s=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),p=s?JSON.parse(s):null;return(p==null?void 0:p.userId)||"unknown"}catch{return"unknown"}}function me(){const[s,p]=m.useState("users"),[c,o]=m.useState(null);m.useEffect(()=>{(async()=>{try{o(await _())}catch{o(null)}})()},[]);const u=c==null?void 0:c.role,l=!!(c!=null&&c.owner),x=l||u==="developer"?["users","sections","topics","invites","maintenance"]:u==="admin"?["users","topics","invites"]:u==="moderator"?["users","invites"]:["topics"];return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:x.map(h=>e.jsx("button",{className:`btn ${s===h?"btn-primary":""}`,onClick:()=>p(h),children:h},h))}),s==="users"&&e.jsx(se,{meRole:u,meId:c==null?void 0:c.id,meOwner:l}),s==="sections"&&e.jsx(ae,{}),s==="topics"&&e.jsx(ne,{meRole:u}),s==="invites"&&e.jsx(ie,{meRole:u,meId:(c==null?void 0:c.id)||""}),s==="maintenance"&&e.jsx(ce,{})]})}function se({meRole:s,meId:p,meOwner:c}){const[o,u]=m.useState([]),l=m.useCallback(async()=>{try{u(await B())}catch(t){alert((t==null?void 0:t.message)||"Failed to load users")}},[]);m.useEffect(()=>{l()},[l]);const x=c||s==="developer",h=c||s==="developer"||s==="admin",v=c||s==="developer"||s==="admin"||s==="moderator",N=async(t,a)=>{if(x)try{await A(t,a),l()}catch(f){alert((f==null?void 0:f.message)||"Failed to set role")}},r=async t=>{if(!v)return;const a=parseInt(prompt("Mute minutes","60")||"60",10),f=new Date(Date.now()+Math.max(1,a)*6e4).toISOString();try{await G(t,f),await l()}catch(b){alert((b==null?void 0:b.message)||"Failed to mute")}},g=async t=>{if(v)try{await q(t),await l()}catch(a){alert((a==null?void 0:a.message)||"Failed to unmute")}},i=async t=>{if(!h)return;const a=parseInt(prompt("Ban days","7")||"7",10),f=new Date(Date.now()+Math.max(1,a)*864e5).toISOString();try{await z(t,f),await l()}catch(b){alert((b==null?void 0:b.message)||"Failed to ban")}},d=async t=>{if(h)try{await H(t),await l()}catch(a){alert((a==null?void 0:a.message)||"Failed to unban")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Remote accounts fetched from the Worker API. Use this panel to adjust roles and moderation privileges."}),e.jsxs("div",{className:"grid gap-2",children:[o.map(t=>{const a=Number(t.userNumber||0)===1,f=String(t.role||"user"),b=[];v&&!a&&(b.push(e.jsx("button",{className:"btn",onClick:()=>r(t.id),children:"Mute"},"mute")),b.push(e.jsx("button",{className:"btn",onClick:()=>g(t.id),children:"Unmute"},"unmute"))),h&&!a&&(b.push(e.jsx("button",{className:"btn",onClick:()=>i(t.id),children:"Ban"},"ban")),b.push(e.jsx("button",{className:"btn",onClick:()=>d(t.id),children:"Unban"},"unban")));const n=t.vipUntil?e.jsx("span",{className:"rounded-full bg-amber-500/10 px-2 py-0.5 text-[11px] uppercase tracking-wider text-amber-300",title:`VIP until ${new Date(t.vipUntil).toLocaleString()}`,children:"VIP"}):null,y=async()=>{try{const j=await E(t.id),w=((j==null?void 0:j.labels)||[]).join(", "),I=prompt("Custom labels (comma-separated, up to 7)",w||"");if(I===null)return;const D=I.split(",").map(T=>T.trim()).filter(Boolean).slice(0,7);await L(t.id,D),alert("Labels updated")}catch(j){alert((j==null?void 0:j.message)||"Failed to update labels")}},C=async()=>{const j=parseInt(prompt("VIP days","30")||"30",10);try{await R(t.id,isNaN(j)?30:Math.max(1,j)),await l()}catch(w){alert((w==null?void 0:w.message)||"Failed to set VIP")}},F=async()=>{try{await O(t.id),await l()}catch(j){alert((j==null?void 0:j.message)||"Failed to remove VIP")}},M=a?"OWNER":s==="developer"?t.invitedByName?`invited by: ${t.invitedByName}`:"":p&&t.invitedById&&t.invitedById===p?"invited by: you":"";return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",t.userNumber]}),e.jsx("div",{className:"font-semibold",children:t.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:c||s==="developer"?t.email:""}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-70",children:[M," ",n]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[x&&!a||a&&p===t.id?e.jsxs("select",{className:"input",value:t.role,onChange:j=>N(t.id,j.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}):e.jsx("span",{className:"rounded-full border px-2 py-1 text-xs uppercase tracking-wider",style:{borderColor:"var(--border)"},children:a?"OWNER":f}),e.jsx("button",{className:"btn",onClick:y,title:"Custom labels",children:"Labels"}),e.jsx("button",{className:"btn",onClick:C,title:"Give VIP",children:"Give VIP"}),t.vipUntil&&e.jsx("button",{className:"btn",onClick:F,title:"Remove VIP",children:"UnVIP"}),b.length?b:null]})]},t.id)}),!o.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No users yet."})]})]})}function ae(){const[s,p]=m.useState([]),[c,o]=m.useState(""),[u,l]=m.useState(""),x=m.useCallback(async()=>{try{p(await J())}catch(r){alert((r==null?void 0:r.message)||"Failed to load sections")}},[]);m.useEffect(()=>{x()},[x]);const h=async()=>{if(c.trim())try{await K({title:c.trim(),description:u.trim(),actorId:k()}),o(""),l(""),x()}catch(r){alert((r==null?void 0:r.message)||"Failed to create section")}},v=async(r,g,i)=>{try{await X(r,{[g]:i,actorId:k()}),x()}catch(d){alert((d==null?void 0:d.message)||"Failed to update section")}},N=async r=>{if(confirm("Delete this section?"))try{await Y(r),x()}catch(g){alert((g==null?void 0:g.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Create section"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:c,onChange:r=>o(r.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:u,onChange:r=>l(r.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:h,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Sections"}),e.jsxs("div",{className:"grid gap-2",children:[s.map(r=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[r.id.slice(0,8),":"]}),e.jsx("input",{className:"input",value:r.title,onChange:g=>v(r.id,"title",g.target.value)}),e.jsx("input",{className:"input",value:r.description||"",onChange:g=>v(r.id,"description",g.target.value)}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>N(r.id),children:"Delete"})})]},r.id)),!s.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No sections yet."})]})]})]})}function ne({meRole:s}){const[p,c]=m.useState([]),o=m.useCallback(async()=>{try{c(await Q())}catch(i){alert((i==null?void 0:i.message)||"Failed to load topics")}},[]);m.useEffect(()=>{o()},[o]);const u=s==="developer",l=s==="developer",x=s==="developer",h=s==="developer"||s==="admin",v=async(i,d)=>{if(u)try{await S(i,{pinned:d,actorId:k()}),o()}catch(t){alert((t==null?void 0:t.message)||"Failed to update topic")}},N=async(i,d)=>{if(l)try{await S(i,{locked:d,actorId:k()}),o()}catch(t){alert((t==null?void 0:t.message)||"Failed to update topic")}},r=async i=>{if(!x)return;const t=(prompt("Move to section ID","")||"").trim();if(t)try{await Z(i,t),o()}catch(a){alert((a==null?void 0:a.message)||"Failed to move topic")}},g=async i=>{if(h&&confirm("Delete this topic?"))try{await ee(i),o()}catch(d){alert((d==null?void 0:d.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Topics"}),e.jsxs("div",{className:"grid gap-2",children:[p.map(i=>{const d=[];return u&&d.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.pinned,onChange:t=>v(i.id,t.target.checked)}),"pinned"]},"pin")),l&&d.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.locked,onChange:t=>N(i.id,t.target.checked)}),"locked"]},"lock")),x&&d.push(e.jsx("button",{className:"btn",onClick:()=>r(i.id),children:"Move"},"move")),h&&d.push(e.jsx("button",{className:"btn",onClick:()=>g(i.id),children:"Delete"},"delete")),e.jsxs("div",{className:"grid grid-cols-1 items-start gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:i.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",i.id.slice(0,8),": section: ",i.sectionId.slice(0,8),":"]}),(i.pinned||i.locked)&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[10px] uppercase tracking-[0.2em] opacity-70",children:[i.pinned&&e.jsx("span",{children:"pinned"}),i.locked&&e.jsx("span",{children:"locked"})]})]}),d.length?e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:d}):null]},i.id)}),!p.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No topics yet."})]})]})}function ie({meRole:s,meId:p}){const[c,o]=m.useState([]),[u,l]=m.useState(5),[x,h]=m.useState(""),v=s==="developer",N=m.useCallback(async()=>{try{const n=await P(),y=v?n:n.filter(C=>(C.createdBy||"")===(p||""));o(y)}catch(n){alert((n==null?void 0:n.message)||"Failed")}},[v,p]);m.useEffect(()=>{N()},[N]);const r=Date.now(),g=s==="admin"?48*3600*1e3:s==="moderator"?72*3600*1e3:0,i=g?r-g:0,d=c.filter(n=>{const y=new Date(n.createdAt).getTime();return!isNaN(y)&&y>=i}),a=Math.max(0,(s==="admin"?2:s==="moderator"?1:1/0)-d.length),f=async()=>{try{const n=Math.max(1,Math.min(20,u)),y=isFinite(a)?Math.min(a,n):n;if(!v&&y<=0){alert("Invite quota reached. Try again later.");return}await $(y,x||void 0),h(""),N()}catch(n){alert((n==null?void 0:n.message)||"Failed to generate")}},b=async n=>{if(confirm("Delete this invite?"))try{await W(n),N()}catch(y){alert((y==null?void 0:y.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Invite codes"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:Math.min(20,isFinite(a)?Math.max(a,0):20),value:u,onChange:n=>l(parseInt(n.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:x,onChange:n=>h(n.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:f,disabled:!v&&a<=0,title:!v&&a<=0?"Quota reached":void 0,children:"Generate"})]}),!v&&e.jsxs("div",{className:"mb-4 text-xs opacity-70",children:[s==="admin"&&e.jsxs("span",{children:["Remaining in 48h window: ",e.jsx("b",{children:a})," of 2"]}),s==="moderator"&&e.jsxs("span",{children:["Remaining in 72h window: ",e.jsx("b",{children:a})," of 1"]})]}),e.jsxs("div",{className:"grid gap-2",children:[c.map(n=>{var y;return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:n.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(n.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs opacity-80",children:v?`by: ${n.createdByName||((y=n.createdBy)==null?void 0:y.slice(0,8))}`:"by: you"}),e.jsx("div",{className:"text-xs",children:n.note||""}),e.jsx("div",{className:"text-xs",children:n.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>b(n.code),children:"Delete"})})]},`${n.code}-${n.createdAt}`)}),!c.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No invite codes yet."})]})]})}function ce(){const[s,p]=m.useState("invite");m.useEffect(()=>{(async()=>{try{const o=await V();p((o==null?void 0:o.registrationMode)||"invite")}catch{}})()},[]);const c=()=>{confirm("Reset the forum on server (this deletes sections, topics, and posts)?")&&(async()=>{try{await te(),alert("Done. Forum data cleared on server."),location.reload()}catch(o){alert((o==null?void 0:o.message)||"Failed to reset")}})()};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Registration settings"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Registration:"}),e.jsxs("select",{className:"input",value:s,onChange:async o=>{const u=o.target.value;p(u);try{await U({registrationMode:u})}catch(l){alert((l==null?void 0:l.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"Invite only"}),e.jsx("option",{value:"open",children:"Open"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Maintenance"}),e.jsx("p",{className:"mb-3 text-sm opacity-70",children:"Reset the forum when you need a clean slate before inviting the community."}),e.jsx("button",{className:"btn btn-primary",onClick:c,children:"Reset forum (empty)"})]})}export{me as default};
