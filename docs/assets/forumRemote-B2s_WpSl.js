const y="https://notifications-worker.wizardiowhy.workers.dev/skyapi",u="forum:token",m="forum:session";function d(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function l(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function w(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function i(t,e={}){const s=l(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${y}${t}`,{...e,headers:r}),c=await n.text();let o={};try{o=c?JSON.parse(c):{}}catch{o={error:c||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function h(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:s,user:r}=await i("/register",{method:"POST",body:e});d(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function p(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:s,user:r}=await i("/login",{method:"POST",body:e});d(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function E(){if(!l())return null;try{const{user:e}=await i("/me");return e}catch{return w(),null}}async function T(){const{users:t}=await i("/users");return t}async function v(t,e){const{user:s}=await i(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return s}async function O(){const{invites:t}=await i("/invites");return t}async function I(t=5,e){const{invites:s}=await i("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return s}async function $(t){await i(`/invites/${encodeURIComponent(t)}`,{method:"DELETE"})}const S="https://notifications-worker.wizardiowhy.workers.dev/skyapi",f="forum:token";function g(){try{return localStorage.getItem(f)??sessionStorage.getItem(f)}catch{return null}}async function a(t,e={}){const s=g(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${S}${t}`,{...e,headers:r}),c=await n.text();let o={};try{o=c?JSON.parse(c):{}}catch{o={error:c||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function k(){const{sections:t}=await a("/sections");return t}async function b(t){const{section:e}=await a("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function N(t,e){const{section:s}=await a(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function J(t){await a(`/sections/${encodeURIComponent(t)}`,{method:"DELETE"})}async function A(t){const e="",{topics:s}=await a(`/topics${e}`);return s}async function C(t,e){const{topic:s}=await a(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function x(t,e){const{topic:s}=await a(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return s}async function P(t){await a(`/topics/${encodeURIComponent(t)}`,{method:"DELETE"})}async function L(t=8){const{posts:e}=await a(`/latest-posts?limit=${t}`);return e}export{L as a,p as b,w as c,T as d,A as e,O as f,E as g,b as h,J as i,C as j,P as k,k as l,x as m,I as n,$ as o,h as r,v as s,N as u};
