import{j as e}from"./index-N9yhZYnV.js";import{u as v,R as n,L as w}from"./react-vendor-DTkXckhQ.js";import{g as k}from"./authRemote-D9Q-aZvG.js";import{g as P,d as A,t as C,e as z,u as L,f as D}from"./forumRemote-BYvX5m8l.js";import{f,a as R}from"./time-Cv7kjYsp.js";import{ae as S,aj as h,L as T,ak as _,al as E,o as I}from"./icons-pv2MHu2Z.js";function F(){const{id:d=""}=v(),[r,g]=n.useState(null),[s,j]=n.useState(null),[m,i]=n.useState([]),[o,p]=n.useState(""),x=!!r&&(r.role==="developer"||r.role==="admin"||r.role==="moderator");n.useEffect(()=>{(async()=>{try{g(await k())}catch{}try{const t=await P(d);t&&j(t);const a=await A(d);i(Array.isArray(a)?a:[])}catch{}})()},[d]);async function u(){const t=o.trim();if(!(!t||!r||!s||s.locked))try{const a=await z({topicId:s.id,content:t});i(l=>[...l,a]),p("")}catch{}}async function b(t){if(x)try{const a=await L(t.id,{pinned:!t.pinned});i(l=>l.map(c=>c.id===t.id?a:c))}catch{}}async function N(t){try{await D(t.id),i(a=>a.filter(l=>l.id!==t.id))}catch{}}const y=n.useMemo(()=>m.slice().sort((t,a)=>Number(a.pinned)-Number(t.pinned)||new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime()),[m]);return e.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6 px-4 py-6",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("div",{className:"relative px-5 py-6",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top_left,rgba(99,102,241,0.22),transparent_65%)]"}),e.jsxs("div",{className:"relative flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-slate-300/80",children:[e.jsxs(w,{to:"/forum",className:"btn flex items-center gap-2",children:[e.jsx(S,{size:16})," Форум"]}),e.jsx("span",{className:"text-xs uppercase tracking-[0.28em] text-slate-400",children:"Тема"}),e.jsx("span",{className:"truncate text-sm font-semibold text-white",children:(s==null?void 0:s.title)||"..."}),e.jsxs("span",{className:"ml-auto text-xs uppercase tracking-[0.28em] text-slate-400",children:["Ответов ",(s==null?void 0:s.replyCount)??0," • Просмотров ",(s==null?void 0:s.viewCount)??0]})]}),e.jsx("h1",{className:"text-2xl font-bold text-white sm:text-3xl",children:(s==null?void 0:s.title)||"Обсуждение"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs uppercase tracking-[0.28em] text-slate-400",children:[(s==null?void 0:s.pinned)&&e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-amber-400/10 px-3 py-1 text-amber-200",children:[e.jsx(h,{size:14})," Закреплено"]}),s!=null&&s.locked?e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-rose-400/10 px-3 py-1 text-rose-200",children:[e.jsx(T,{size:14})," Закрыта"]}):e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-emerald-400/10 px-3 py-1 text-emerald-200",children:[e.jsx(_,{size:14})," Открыта для ответов"]}),(s==null?void 0:s.lastPostAt)&&e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-white/5 px-3 py-1 text-slate-200",children:["Последний ответ: ",f(s.lastPostAt)]})]})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"divide-y divide-white/5",children:y.map(t=>e.jsxs("div",{className:"grid gap-4 px-4 py-5 md:grid-cols-[160px_1fr] md:items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-slate-400",children:[e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-1 text-xs uppercase tracking-[0.28em] text-slate-300",children:t.authorId||"Участник"}),e.jsxs("div",{className:"text-[11px] uppercase tracking-[0.26em] text-slate-500",children:["Опубликовано ",R(t.createdAt)]}),t.editedAt&&e.jsxs("div",{className:"text-[11px] uppercase tracking-[0.26em] text-amber-300/80",children:["Изменено ",f(t.editedAt)]}),t.pinned&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-amber-200",children:[e.jsx(h,{size:12})," Закреплено"]})]}),e.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-white/10 bg-white/[0.04] p-4 text-sm",children:[e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-slate-100",children:t.content}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-xs text-slate-400",children:[e.jsxs("button",{className:"btn btn-sm flex items-center gap-2",onClick:async()=>{try{const a=await C(t.id);i(l=>l.map(c=>c.id===t.id?a:c))}catch{}},children:[e.jsx(E,{size:14})," ",(t.likes||[]).length]}),(x||(r==null?void 0:r.id)===t.authorId)&&e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx("button",{className:"btn btn-sm",onClick:()=>b(t),type:"button",children:t.pinned?"Открепить":"Закрепить"}),e.jsx("button",{className:"btn btn-sm",onClick:()=>N(t),type:"button",children:"Удалить"})]})]})]})]},t.id))}),!(s!=null&&s.locked)&&r?e.jsxs("div",{className:"border-t border-white/10 px-4 py-4",children:[e.jsx("label",{className:"mb-2 block text-xs uppercase tracking-[0.3em] text-slate-400",children:"Быстрый ответ"}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start",children:[e.jsx("textarea",{className:"input min-h-[120px] flex-1",placeholder:"Поделитесь своим мнением или предложением. Используйте Ctrl + Enter для отправки.",value:o,onChange:t=>p(t.target.value),onKeyDown:t=>{(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),u())}}),e.jsxs("button",{className:"btn btn-primary flex items-center gap-2",onClick:u,type:"button",children:[e.jsx(I,{size:16})," Отправить"]})]})]}):e.jsx("div",{className:"border-t border-white/10 px-4 py-4 text-xs uppercase tracking-[0.28em] text-rose-200",children:"Тема закрыта для новых сообщений."})]})]})})}export{F as default};
