import{j as s}from"./index-C5TXn_k8.js";import{b as C,R as l,L as j}from"./react-vendor-DTkXckhQ.js";import{listSections as W}from"./forumRemote-D5s3MT8n.js";import{aq as z,a4 as D,U as I,ap as M}from"./icons-CDjAZjRL.js";const P=["latest","hot","new","following","unanswered","unread","questions"],v="forum:default_feed";function h(t){return typeof t=="string"&&P.includes(t)}function R(){try{const t=localStorage.getItem(v);if(h(t))return t}catch{}return"latest"}function q(t){if(h(t))try{localStorage.setItem(v,t)}catch{}}const O="app:lang";function T(){try{const t=localStorage.getItem(O);if(t==="ru"||t==="en")return t}catch{}return"ru"}function o(t,a){return T()==="ru"?t:a}function K(){const t=C(),[a,p]=l.useState(null);l.useEffect(()=>{let e=!0;return(async()=>{try{const n=(await W()||[]).find(c=>String(c.title||"").toLowerCase()==="workshop");e&&p((n==null?void 0:n.id)||null)}catch{e&&p(null)}})(),()=>{e=!1}},[]);const b=t.pathname.includes("/forum/members"),g=a?t.pathname.startsWith(`/forum/section/${a}`):!1,F=!b&&!g,u=new URLSearchParams(t.search||"").get("feed"),x=l.useMemo(()=>{try{return R()}catch{return"latest"}},[]),m=l.useMemo(()=>h(u)?u:x,[u,x]),d=e=>{const{to:r,active:n,icon:c,children:w,disabled:$,title:y}=e;return $?s.jsxs("span",{className:`btn inline-flex items-center gap-2 ${n?"btn-primary":""} opacity-60 cursor-not-allowed`,title:y||"","aria-disabled":!0,children:[c," ",w]}):s.jsxs(j,{to:r,className:`btn inline-flex items-center gap-2 ${n?"btn-primary":""}`,title:y||"",children:[c," ",w]})},[S,f]=l.useState(!1);l.useEffect(()=>{const e=()=>f(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const k=[{key:"latest",label:o("Последнее","Latest")},{key:"hot",label:o("Горячее","Hot")},{key:"new",label:o("Новое","New")},{key:"following",label:o("Подписки","Following")},{key:"unanswered",label:o("Без ответа","Unanswered")},{key:"unread",label:o("Непрочитанное","Unread")}],L=e=>{var r;return e==="questions"?o("Вопросы","Questions"):((r=k.find(n=>n.key===e))==null?void 0:r.label)||o("Лента","Feed")},i=(e,r)=>{const n=new URLSearchParams(t.search);r?n.set("feed",r):n.delete("feed");const c=n.toString();return`${e}${c?`?${c}`:""}`},E=i("/forum",m),N=i("/forum/members",null),U=a?i(`/forum/section/${a}`,null):"#";return s.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[s.jsx(d,{to:E,active:F,icon:s.jsx(z,{size:16}),children:o("Форумы","Forums")}),s.jsx(d,{to:U,active:g,disabled:!a,icon:s.jsx(D,{size:16}),title:a?"":o("Раздел Workshop ещё не создан","Workshop section is not created yet"),children:o("Мастерская","Workshop")}),s.jsx(d,{to:N,active:b,icon:s.jsx(I,{size:16}),children:o("Участники","Members")}),s.jsxs("div",{className:"relative ml-auto",onClick:e=>e.stopPropagation(),"aria-label":o("Выбрать ленту","Choose feed"),children:[s.jsxs("button",{type:"button",className:"btn inline-flex items-center gap-2",onClick:()=>f(e=>!e),children:[s.jsx("span",{className:"truncate max-w-[10rem]",children:L(m)}),s.jsx(M,{size:16})]}),S&&s.jsx("div",{className:"absolute right-0 z-20 mt-2 min-w-40 rounded-xl border bg-background p-2 shadow-lg",children:k.map(e=>{const r=i("/forum",e.key),n=m===e.key;return s.jsx(j,{to:r,className:`block rounded-md px-3 py-2 text-sm hover:bg-muted ${n?"font-semibold":""}`,onClick:()=>{try{q(e.key)}catch{}f(!1)},children:e.label},String(e.key))})})]})]})}export{K as F,R as g,h as i,o as t};
