import{j as e}from"./index-N9yhZYnV.js";import{u as _,R as a,L as S}from"./react-vendor-DTkXckhQ.js";import{l as z,b as L,c as D}from"./forumRemote-BYvX5m8l.js";import{F as R}from"./ForumSubnav-D8h7rLLB.js";import{f as g,a as B}from"./time-Cv7kjYsp.js";import{ae as F,af as M,ag as $,a as q,M as E,L as W,C as I}from"./icons-pv2MHu2Z.js";function X(){var A;const{id:c=""}=_(),[s,j]=a.useState(null),[d,b]=a.useState([]),[N,v]=a.useState(""),[w,y]=a.useState(!1),[p,P]=a.useState(""),[m,k]=a.useState("latest"),h=a.useCallback(async()=>{try{const[t,r]=await Promise.all([z(),L(c)]);j(t.find(x=>x.id===c)||null),b(Array.isArray(r)?r:[])}catch{j(null),b([])}},[c]);a.useEffect(()=>{h()},[h]);const u=((s==null?void 0:s.title)||"").toLowerCase()==="workshop",T=async t=>{t.preventDefault();const r=N.trim();if(r){y(!0);try{await D({sectionId:c,title:r}),v(""),h()}catch(x){alert((x==null?void 0:x.message)||"Failed to create topic")}finally{y(!1)}}},f=a.useMemo(()=>{const t=Array.isArray(d)?[...d]:[],r=p.trim().toLowerCase();return(r?t.filter(l=>{var n,o;return(((o=(n=l.title)==null?void 0:n.toLowerCase)==null?void 0:o.call(n))??"").includes(r)}):t).sort((l,i)=>{const n=Number(i.pinned)-Number(l.pinned);if(n!==0)return n;if(m==="popular"){const C=(i.replyCount??0)-(l.replyCount??0);return C!==0?C:(i.viewCount??0)-(l.viewCount??0)}const o=new Date(l.lastPostAt||l.updatedAt||l.createdAt).getTime();return new Date(i.lastPostAt||i.updatedAt||i.createdAt).getTime()-o})},[d,p,m]);return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 620px at 18% -12%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1200px 760px at 92% 0%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-6xl space-y-8 px-4 py-6",children:[e.jsx(R,{}),e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("div",{className:"relative px-6 py-7",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top_left,rgba(14,165,233,0.18),transparent_60%)]"}),e.jsxs("div",{className:"relative flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-slate-300/80",children:[e.jsxs(S,{to:"/forum",className:"btn flex items-center gap-2",children:[e.jsx(F,{size:16})," Назад"]}),e.jsx("span",{className:"text-xs uppercase tracking-[0.28em] text-slate-400",children:"Раздел"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:(s==null?void 0:s.title)||"..."})]}),e.jsx("h1",{className:"text-3xl font-bold text-white sm:text-4xl",children:(s==null?void 0:s.title)||"Раздел"}),(s==null?void 0:s.description)&&e.jsx("p",{className:"max-w-3xl text-sm text-slate-300/80",children:s.description}),u&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-emerald-400/30 bg-emerald-400/10 px-3 py-2 text-sm text-emerald-200",children:[e.jsx(M,{size:16}),"Workshop: размещайте товары и предложения. Каждая тема — отдельный лот."]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"Темы"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold",children:(s==null?void 0:s.topicCount)??d.length})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"Сообщения"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold",children:(s==null?void 0:s.postCount)??0})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"Последний пост"}),e.jsx("div",{className:"mt-2 text-sm font-semibold text-slate-200",children:(A=d[0])!=null&&A.lastPostAt?g(d[0].lastPostAt):"—"})]})]})]})]})}),e.jsxs("form",{onSubmit:T,className:"card grid gap-3 px-5 py-5 sm:grid-cols-[minmax(0,1fr)_auto] sm:items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.28em] text-slate-400",children:"Новая тема"}),e.jsx("input",{className:"input mt-2",placeholder:u?"Название товара / лота":"Заголовок обсуждения",value:N,onChange:t=>v(t.target.value),disabled:w})]}),e.jsxs("button",{className:"btn btn-primary flex items-center gap-2 justify-center",disabled:w,children:[e.jsx($,{size:16})," ",u?"Добавить товар":"Создать тему"]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-white/10 px-5 py-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"Темы раздела"}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Всего обсуждений: ",f.length," • выберите интересующую тему, чтобы перейти к сообщениям."]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("label",{className:"relative",children:[e.jsx(q,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{className:"input w-[220px] pl-9",placeholder:"Поиск по темам",value:p,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"flex overflow-hidden rounded-xl border border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>k("latest"),className:`px-3 py-2 text-xs font-semibold uppercase tracking-[0.28em] transition ${m==="latest"?"bg-white/10 text-white":"text-slate-400"}`,children:"Новые"}),e.jsx("button",{type:"button",onClick:()=>k("popular"),className:`px-3 py-2 text-xs font-semibold uppercase tracking-[0.28em] transition ${m==="popular"?"bg-white/10 text-white":"text-slate-400"}`,children:"Популярные"})]})]})]}),e.jsxs("div",{className:"hidden border-b border-white/10 px-5 py-3 text-[11px] uppercase tracking-[0.28em] text-slate-400 md:grid md:grid-cols-[minmax(0,1fr)_120px_120px_220px]",children:[e.jsx("span",{children:"Тема"}),e.jsx("span",{className:"text-right",children:"Ответы"}),e.jsx("span",{className:"text-right",children:"Просмотры"}),e.jsx("span",{className:"text-right",children:"Последний ответ"})]}),f.length?f.map(t=>e.jsxs(S,{to:`/forum/topic/${t.id}`,className:"flex flex-col gap-3 border-b border-white/5 px-5 py-4 transition hover:bg-white/5 last:border-none md:grid md:grid-cols-[minmax(0,1fr)_120px_120px_220px] md:items-center",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm font-semibold text-white",children:[t.pinned&&e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-amber-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-amber-200",children:[e.jsx(E,{size:12})," Закреплено"]}),t.locked&&e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-rose-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-rose-200",children:[e.jsx(W,{size:12})," Закрыто"]}),e.jsx("span",{className:"text-base font-semibold leading-tight text-white",children:t.title})]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Обновлено ",g(t.lastPostAt||t.updatedAt||t.createdAt)," • Просмотров ",t.viewCount??0]})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-200 md:text-right",children:t.replyCount??0}),e.jsx("div",{className:"text-sm font-semibold text-slate-200 md:text-right",children:t.viewCount??0}),e.jsxs("div",{className:"text-left text-xs text-slate-400 md:text-right",children:[e.jsx("div",{className:"font-semibold text-slate-200",children:t.lastPostBy||"—"}),e.jsxs("div",{className:"flex items-center gap-1 md:justify-end",children:[e.jsx(I,{size:12})," ",g(t.lastPostAt||t.updatedAt||t.createdAt)]}),e.jsx("div",{className:"text-[11px] uppercase tracking-[0.26em] text-slate-500",children:B(t.lastPostAt||t.updatedAt||t.createdAt)})]})]},t.id)):e.jsx("div",{className:"px-5 py-6 text-sm text-slate-400",children:"Темы не найдены. Попробуйте изменить фильтр или создайте первую тему."})]})]})})}export{X as default};
