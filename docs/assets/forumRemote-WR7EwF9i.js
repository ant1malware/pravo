function l(){try{const e=new URL(window.location.href),n=e.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{e.searchParams.delete("api"),history.replaceState({},"",e.toString())}catch{}}const s=localStorage.getItem("forum:api_base");if(s)return s}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const S=l(),u="forum:token",m="forum:session";function d(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function y(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function w(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function r(t,e={}){const n=y(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${S}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function O(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:n,user:s}=await r("/register",{method:"POST",body:e});d(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function v(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:n,user:s}=await r("/login",{method:"POST",body:e});d(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function I(){if(!y())return null;try{const{user:e}=await r("/me");return e}catch{return w(),null}}async function T(){const{users:t}=await r("/users");return t}async function E(t,e){const{user:n}=await r(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return n}async function b(){const{invites:t}=await r("/invites");return t}async function $(t=5,e){const{invites:n}=await r("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return n}async function k(t,e){const n=JSON.stringify(e?{until:e}:{days:7}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/ban",{method:"POST",body:n});return s}async function N(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unban",{method:"POST"});return e}async function P(t,e){const n=JSON.stringify(e?{until:e}:{minutes:60}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/mute",{method:"POST",body:n});return s}async function J(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unmute",{method:"POST"});return e}async function C(t){await r(`/invites/${encodeURIComponent(t)}`,{method:"DELETE"})}async function A(){const{settings:t}=await r("/settings");return t}async function U(t){const{settings:e}=await r("/settings",{method:"PATCH",body:JSON.stringify(t)});return e}function g(){try{const e=new URL(window.location.href),n=e.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{e.searchParams.delete("api"),history.replaceState({},"",e.toString())}catch{}}const s=localStorage.getItem("forum:api_base");if(s)return s}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const h=g(),f="forum:token";function p(){try{return localStorage.getItem(f)??sessionStorage.getItem(f)}catch{return null}}async function i(t,e={}){const n=p(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${h}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function x(){const{sections:t}=await i("/sections");return t}async function R(t){const{section:e}=await i("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function L(t,e){const{section:n}=await i(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function _(t){await i(`/sections/${encodeURIComponent(t)}`,{method:"DELETE"})}async function B(t){const e="",{topics:n}=await i(`/topics${e}`);return n}async function D(t,e){const{topic:n}=await i(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function K(t,e){const{topic:n}=await i(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return n}async function z(t){await i(`/topics/${encodeURIComponent(t)}`,{method:"DELETE"})}async function H(t=8){const{posts:e}=await i(`/latest-posts?limit=${t}`);return e}export{H as a,v as b,w as c,T as d,B as e,b as f,I as g,A as h,J as i,k as j,N as k,x as l,P as m,R as n,L as o,_ as p,D as q,O as r,E as s,K as t,U as u,z as v,$ as w,C as x};
