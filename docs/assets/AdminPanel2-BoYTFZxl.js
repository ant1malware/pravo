import{j as e}from"./index-B2QAzUzR.js";import{R as r}from"./react-vendor-DTkXckhQ.js";import{b as h,c as g,r as b}from"./forumStore-K_YbTGrn.js";import{d as N,l as y,e as f,f as w,s as k,h as C,u as S,i as v,m as I,j as _}from"./forumRemote-CKuh-9l1.js";import"./icons-DET5c9ig.js";function p(){try{const n=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),l=n?JSON.parse(n):null;return(l==null?void 0:l.userId)||"unknown"}catch{return"unknown"}}function U(){const[n,l]=r.useState("users");return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:["users","sections","topics","invites","maintenance"].map(c=>e.jsx("button",{className:`btn ${n===c?"btn-primary":""}`,onClick:()=>l(c),children:c},c))}),n==="users"&&e.jsx(T,{}),n==="sections"&&e.jsx(F,{}),n==="topics"&&e.jsx(M,{}),n==="invites"&&e.jsx(R,{}),n==="maintenance"&&e.jsx(D,{})]})}function T(){const[n,l]=r.useState([]),c=r.useCallback(async()=>{try{l(await N())}catch(s){alert((s==null?void 0:s.message)||"Failed to load users")}},[]);r.useEffect(()=>{c()},[c]);const u=async(s,a)=>{try{await k(s,a),c()}catch(o){alert((o==null?void 0:o.message)||"Failed to set role")}},m=s=>{const a=parseInt(prompt("Mute minutes","60")||"60",10),o=new Date(Date.now()+Math.max(1,a)*6e4).toISOString();h(s,{until:o,reason:`Muted ${a}m`},p())},d=s=>h(s,null,p()),t=s=>{const a=parseInt(prompt("Ban days","7")||"7",10),o=new Date(Date.now()+Math.max(1,a)*864e5).toISOString();g(s,{until:o,reason:`Banned ${a}d`},p())},i=s=>g(s,null,p());return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Пользователи (через Worker API). Мут/бан локальны для чата."}),e.jsxs("div",{className:"grid gap-2",children:[n.map(s=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_1fr]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",s.userNumber]}),e.jsx("div",{className:"font-semibold",children:s.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:s.email}),e.jsxs("select",{className:"input",value:s.role,onChange:a=>u(s.id,a.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("button",{className:"btn",onClick:()=>m(s.id),children:"Mute"}),e.jsx("button",{className:"btn",onClick:()=>d(s.id),children:"Unmute"}),e.jsx("button",{className:"btn",onClick:()=>t(s.id),children:"Ban"}),e.jsx("button",{className:"btn",onClick:()=>i(s.id),children:"Unban"})]})]},s.id)),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function F(){const[n,l]=r.useState([]),[c,u]=r.useState(""),[m,d]=r.useState(""),t=r.useCallback(async()=>{try{const a=await y();l(a)}catch(a){alert((a==null?void 0:a.message)||"Failed to load sections")}},[]);r.useEffect(()=>{t()},[t]);const i=async()=>{if(c.trim())try{await C({title:c.trim(),description:m.trim(),actorId:p()}),u(""),d(""),t()}catch(a){alert((a==null?void 0:a.message)||"Failed to create section")}},s=async(a,o,j)=>{try{await S(a,{[o]:j,actorId:p()}),t()}catch(x){alert((x==null?void 0:x.message)||"Failed to update section")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Создать раздел"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:c,onChange:a=>u(a.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:m,onChange:a=>d(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Разделы"}),e.jsxs("div",{className:"grid gap-2",children:[n.map(a=>e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-2 rounded-xl border px-3 py-2",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[a.id.slice(0,8),"…"]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{className:"input",value:a.title,onChange:o=>s(a.id,"title",o.target.value)}),e.jsx("input",{className:"input",value:a.description||"",onChange:o=>s(a.id,"description",o.target.value)})]})]},a.id)),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})]})}function M(){const[n,l]=r.useState([]),c=r.useCallback(async()=>{try{const t=await f();l(t)}catch(t){alert((t==null?void 0:t.message)||"Failed to load topics")}},[]);r.useEffect(()=>{c()},[c]);const u=async(t,i)=>{try{await v(t,{pinned:i,actorId:p()}),c()}catch(s){alert((s==null?void 0:s.message)||"Failed to update topic")}},m=async(t,i)=>{try{await v(t,{locked:i,actorId:p()}),c()}catch(s){alert((s==null?void 0:s.message)||"Failed to update topic")}},d=async(t,i)=>{const s=i.trim();if(s)try{await I(t,s),c()}catch(a){alert((a==null?void 0:a.message)||"Failed to move topic")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Темы"}),e.jsxs("div",{className:"grid gap-2",children:[n.map(t=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto_auto_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",t.id.slice(0,8),"… • section: ",t.sectionId.slice(0,8),"…"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.pinned,onChange:i=>u(t.id,i.target.checked)}),"pinned"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.locked,onChange:i=>m(t.id,i.target.checked)}),"locked"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"to sectionId",onKeyDown:i=>{i.key==="Enter"&&(d(t.id,i.target.value),i.target.value="")}}),e.jsx("button",{className:"btn",onClick:i=>{const s=i.currentTarget.previousElementSibling;d(t.id,s.value),s.value=""},children:"Move"})]})]},t.id)),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function R(){const[n,l]=r.useState([]),[c,u]=r.useState(5),[m,d]=r.useState(""),t=r.useCallback(async()=>{try{l(await w())}catch(s){alert((s==null?void 0:s.message)||"Failed")}},[]);r.useEffect(()=>{t()},[t]);const i=async()=>{try{await _(Math.max(1,Math.min(20,c)),m||void 0),d(""),t()}catch(s){alert((s==null?void 0:s.message)||"Failed to generate")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Генерация инвайтов"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:20,value:c,onChange:s=>u(parseInt(s.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:m,onChange:s=>d(s.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Generate"})]}),e.jsxs("div",{className:"grid gap-2",children:[n.map(s=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:s.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(s.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs",children:s.note||""}),e.jsx("div",{className:"text-xs",children:s.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})})]},`${s.code}-${s.createdAt}`)),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function D(){const n=()=>{confirm("Очистить форум (пустой старт)?")&&(b(p()),alert("Ок. Форум очищен."),location.reload())};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Обслуживание"}),e.jsx("p",{className:"text-sm opacity-70 mb-3",children:"Очистить локальные разделы/темы/сообщения без демо-данных."}),e.jsx("button",{className:"btn btn-primary",onClick:n,children:"Reset forum (empty)"})]})}export{U as default};
