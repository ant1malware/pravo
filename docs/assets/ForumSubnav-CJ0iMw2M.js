import{j as s}from"./index-DxUtT_gh.js";import{b as U,R as i,L as w}from"./react-vendor-DTkXckhQ.js";import{listSections as C}from"./forumRemote-D5s3MT8n.js";import{aq as W,a4 as z,U as D,ap as I}from"./icons-CDjAZjRL.js";const M=["latest","hot","new","following","questions"],j="forum:default_feed";function p(t){return typeof t=="string"&&M.includes(t)}function P(){try{const t=localStorage.getItem(j);if(p(t))return t}catch{}return"latest"}function R(t){if(p(t))try{localStorage.setItem(j,t)}catch{}}const q="app:lang";function O(){try{const t=localStorage.getItem(q);if(t==="ru"||t==="en")return t}catch{}return"ru"}function o(t,a){return O()==="ru"?t:a}function H(){const t=U(),[a,h]=i.useState(null);i.useEffect(()=>{let e=!0;return(async()=>{try{const n=(await C()||[]).find(c=>String(c.title||"").toLowerCase()==="workshop");e&&h((n==null?void 0:n.id)||null)}catch{e&&h(null)}})(),()=>{e=!1}},[]);const b=t.pathname.includes("/forum/members"),g=a?t.pathname.startsWith(`/forum/section/${a}`):!1,F=!b&&!g,u=new URLSearchParams(t.search||"").get("feed"),x=i.useMemo(()=>{try{return P()}catch{return"latest"}},[]),m=i.useMemo(()=>p(u)?u:x,[u,x]),d=({to:e,active:r,icon:n,children:c,disabled:$,title:y})=>$?s.jsxs("span",{className:`btn inline-flex items-center gap-2 ${r?"btn-primary":""} opacity-60 cursor-not-allowed`,title:y||"","aria-disabled":!0,children:[n," ",c]}):s.jsxs(w,{to:e,className:`btn inline-flex items-center gap-2 ${r?"btn-primary":""}`,title:y||"",children:[n," ",c]}),[v,f]=i.useState(!1);i.useEffect(()=>{const e=()=>f(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const k=[{key:"latest",label:o("Свежие","Latest")},{key:"hot",label:o("Топ","Hot")},{key:"new",label:o("Новые","New")},{key:"following",label:o("Подписки","Following")}],S=e=>{var r;return e==="questions"?o("Вопросы","Questions"):((r=k.find(n=>n.key===e))==null?void 0:r.label)||o("Лента","Feed")},l=(e,r)=>{const n=new URLSearchParams(t.search);r?n.set("feed",r):n.delete("feed");const c=n.toString();return`${e}${c?`?${c}`:""}`},L=l("/forum",m),E=l("/forum/members",null),N=a?l(`/forum/section/${a}`,null):"#";return s.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[s.jsx(d,{to:L,active:F,icon:s.jsx(W,{size:16}),children:o("Форум","Forums")}),s.jsx(d,{to:N,active:g,disabled:!a,icon:s.jsx(z,{size:16}),title:a?"":o("Раздел Workshop ещё не создан","Workshop section is not created yet"),children:o("Мастерская","Workshop")}),s.jsx(d,{to:E,active:b,icon:s.jsx(D,{size:16}),children:o("Участники","Members")}),s.jsxs("div",{className:"relative ml-auto",onClick:e=>e.stopPropagation(),"aria-label":o("Выбрать ленту","Choose feed"),children:[s.jsxs("button",{type:"button",className:"btn inline-flex items-center gap-2",onClick:()=>f(e=>!e),children:[s.jsx("span",{className:"truncate max-w-[10rem]",children:S(m)}),s.jsx(I,{size:16})]}),v&&s.jsx("div",{className:"absolute right-0 z-20 mt-2 min-w-40 rounded-xl border bg-background p-2 shadow-lg",children:k.map(e=>{const r=l("/forum",e.key),n=m===e.key;return s.jsx(w,{to:r,className:`block rounded-md px-3 py-2 text-sm hover:bg-muted ${n?"font-semibold":""}`,onClick:()=>{try{R(e.key)}catch{}f(!1)},children:e.label},String(e.key))})})]})]})}export{H as F,P as g,p as i,o as t};
