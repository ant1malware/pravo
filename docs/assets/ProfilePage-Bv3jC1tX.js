import{b as ie,m as Se,n as ce,j as e,o as ze,p as Ae,q as $e}from"./index-CWCbRTYA.js";import{u as Ee,R as r}from"./react-vendor-DTkXckhQ.js";import{f as oe,g as de,u as Pe,a as Re}from"./forumStore-RFp4t1_K.js";import{a as me,i as De,u as Me,f as Fe,b as B,c as _e,r as Le,d as Te,e as Ie,g as Oe,t as Be}from"./socialStore-D4aUy79F.js";import{J as Ue,N as We,O as xe,V as He,W as Ye,Y as Xe,Z as ue,S as pe,_ as he,$ as Ve,a0 as ve,a1 as fe,M as qe,a2 as Ge}from"./icons-CDjAZjRL.js";const Y={developer:{label:"Разработчик",color:"#22d3ee",glow:"from-cyan-400/35"},admin:{label:"Администратор",color:"#e5e7eb",glow:"from-white/40"},moderator:{label:"Модератор",color:"#ef4444",glow:"from-rose-400/35"},vip:{label:"VIP",color:"#eab308",glow:"from-amber-400/35"},user:{label:"Участник",color:"#94a3b8",glow:"from-slate-300/30"},newbie:{label:"Новичок",color:"#22d3ee",glow:"from-cyan-400/35"}},be={owner:{label:"Owner",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:he},developer:{label:"Developer",grad:"from-emerald-400 via-lime-400 to-emerald-400",Icon:ue},admin:{label:"Admin",grad:"from-white via-slate-200 to-white",Icon:pe},moderator:{label:"Moderator",grad:"from-rose-400 via-red-400 to-rose-400",Icon:Ve},vip:{label:"Premium",grad:"from-amber-400 via-yellow-300 to-amber-400",Icon:he},user:{label:"User",grad:"from-slate-300 via-slate-400 to-slate-300",Icon:pe},newbie:{label:"Newbie",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ue}};function X(s){switch(s){case"developer":return"linear-gradient(90deg,#22c55e,#84cc16)";case"admin":return"linear-gradient(90deg,#ffffff,#d1d5db)";case"moderator":return"linear-gradient(90deg,#ef4444,#f43f5e)";case"vip":return"linear-gradient(90deg,#eab308,#facc15)";default:return null}}function Je(s){if(!s)return!1;if(!s.until)return!0;const t=new Date(s.until).getTime();return!Number.isNaN(t)&&t>Date.now()}function Ze(s){const t=s.lastActiveAt||$e(s.id);if(!t)return!1;const a=new Date(t).getTime();return!Number.isNaN(a)&&a>Date.now()-5*60*1e3}const R="rounded-3xl border border-white/10 bg-[#101321]/85 p-5 shadow-[0_40px_120px_-70px_rgba(15,23,42,0.9)] backdrop-blur",j="rounded-3xl border border-white/10 bg-white/[0.05] p-4 shadow-[0_30px_90px_-70px_rgba(15,23,42,0.85)] backdrop-blur";function Ke({role:s}){const t=be[s]??be.user,a=t.Icon;return e.jsxs("span",{className:"relative inline-flex",children:[e.jsx("span",{className:`absolute -inset-[2px] rounded-full blur-md bg-gradient-to-r ${t.grad} opacity-50`}),e.jsxs("span",{className:"relative inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3.5 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.22em] text-white",children:[e.jsx(a,{size:14,className:"opacity-90"}),t.label]})]})}function Qe({role:s}){var a;const t=X(s);return e.jsx("span",{title:((a=Y[s])==null?void 0:a.label)||s,className:"inline-block h-3.5 w-3.5 rounded-full border border-white/20 align-middle",style:t?{backgroundImage:t}:{backgroundColor:"#94a3b8"}})}function W({value:s,label:t}){return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-extrabold text-white",children:s}),e.jsx("div",{className:"mt-0.5 text-[11px] uppercase tracking-[0.28em] text-zinc-300/80",children:t})]})}function et({badges:s}){if(!(s!=null&&s.length))return null;const t={Founder:"from-rose-500/25 to-rose-400/10 text-rose-200",Early:"from-sky-500/25 to-sky-400/10 text-sky-200",Contributor:"from-emerald-500/25 to-emerald-400/10 text-emerald-200",VIP:"from-amber-500/25 to-amber-400/10 text-amber-200",Designer:"from-violet-500/25 to-violet-400/10 text-violet-200"};return e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:s.slice(0,3).map(a=>e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border border-white/10 bg-gradient-to-br ${t[a]||"from-white/20 to-white/5 text-zinc-200"} px-2.5 py-1 text-xs`,children:[e.jsx(ve,{size:14,className:"opacity-90"})," ",a]},a))})}function ge(s){const t=s.profile||{},a=s.stats||{},l=s.lastActiveAt||s.lastSeenAt||s.lastOnlineAt||null,n={bio:t.bio||"",signature:t.signature||"",links:t.links?{...t.links}:{},accentFrom:t.accentFrom||"#8b5cf6",accentTo:t.accentTo||"#0ea5e9",avatarData:t.avatarData||t.avatar||t.avatarUrl||void 0,bannerData:t.bannerData||t.banner||t.bannerUrl||void 0,badges:Array.isArray(t.badges)?t.badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0,...t.privacy||{}}};Array.isArray(t.labels)&&(n.labels=t.labels);const d={id:s.user.id,username:s.user.username,email:s.user.email,createdAt:s.user.createdAt,role:s.user.role,userNumber:s.user.userNumber,posts:typeof a.posts=="number"?a.posts:0,likes:typeof a.likes=="number"?a.likes:0,topics:typeof a.topics=="number"?a.topics:0,profile:n,bans:s.user.bannedUntil?{until:s.user.bannedUntil}:null,mutes:null};return typeof a.score=="number"&&(d.score=a.score),l&&(d.lastActiveAt=l),d}function bt(){var $,D,E,x,u,b;const{username:s=""}=Ee(),[t,a]=r.useState(null),[l,n]=r.useState(null),[d,m]=r.useState(!1),[p,o]=r.useState(!1),[g,v]=r.useState({}),[h,S]=r.useState("posts");if(r.useEffect(()=>{(async()=>{var f;try{const N=await ie();if(N){m(!0),n({id:N.id,username:N.username});try{const M=await Se(),U={};for(const _ of M)U[_.id]=_.username;v(U)}catch{}const P=await ce(s);if(P){a(ge(P)),o(!!((f=P.user)!=null&&f.owner));return}}}catch{}m(!1),a(oe(s)||null);const i=de();n(i?{id:i.id,username:i.username}:null)})()},[s]),r.useEffect(()=>{const i=async()=>{try{const N=await ie();if(N){n({id:N.id,username:N.username});return}}catch{}const f=de();n(f?{id:f.id,username:f.username}:null)};return window.addEventListener("forum:session",i),window.addEventListener("storage",i),()=>{window.removeEventListener("forum:session",i),window.removeEventListener("storage",i)}},[]),!t)return e.jsx("main",{className:"min-h-screen text-slate-200",style:{background:"linear-gradient(180deg,#04060d 0%,#090b16 100%)"},children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-16",children:e.jsx("div",{className:`${R} text-center text-sm text-zinc-300`,children:"Требуется вход для просмотра профилей."})})});const y=(l==null?void 0:l.id)===t.id,C=t.profile.accentFrom||"#22d3ee",A=t.profile.accentTo||"#8b5cf6",z=Je(t.bans),k=Ze(t);return e.jsx("main",{className:"min-h-screen text-slate-100",style:{background:"radial-gradient(1200px 700px at 12% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-8 space-y-6",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-[#101321]/85 shadow-[0_50px_140px_-80px_rgba(15,23,42,0.9)] backdrop-blur",children:[e.jsx("div",{className:"h-[220px] w-full",style:{background:t.profile.bannerData?`url(${t.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${C}, ${A})`}}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/15 via-transparent to-black/70"}),e.jsxs("div",{className:"relative -mt-16 flex flex-wrap items-end gap-5 px-6 pb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"rounded-full p-[3px]",style:{backgroundImage:X(t.role)||`linear-gradient(135deg,${C},${A})`},children:e.jsx("div",{className:"h-24 w-24 overflow-hidden rounded-full border-4 border-[#101321] shadow-[0_25px_70px_-35px_rgba(15,23,42,0.9)]",style:{background:t.profile.avatarData?`url(${t.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${C}, ${A})`}})}),e.jsx("span",{className:`absolute -right-1 bottom-2 h-4 w-4 rounded-full border-2 ${k?"border-emerald-900/60 bg-emerald-400":"border-zinc-900/70 bg-zinc-400/70"}`,title:k?"Online":"Offline",children:k&&e.jsx("span",{className:"absolute inset-0 -z-10 animate-ping rounded-full bg-emerald-400/50"})}),e.jsx("div",{className:`absolute -inset-1 -z-10 rounded-full bg-gradient-to-br ${(Y[t.role]||Y.user).glow} to-transparent blur-lg`})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h1",{className:`text-3xl font-extrabold tracking-tight ${z?"line-through text-black":"text-white"}`,style:z?void 0:(()=>{const i=X(t.role);return i?{backgroundImage:i,WebkitBackgroundClip:"text",backgroundClip:"text",WebkitTextFillColor:"transparent"}:void 0})(),children:t.username}),e.jsx(Qe,{role:t.role}),e.jsx("span",{className:`ml-1 rounded-full px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] ${k?"bg-emerald-500/15 text-emerald-200":"bg-white/10 text-zinc-300"}`,children:k?"Online":t.lastActiveAt?ze(t.lastActiveAt):"Offline"}),z&&e.jsx("span",{className:"rounded-full bg-black/50 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-zinc-200 ml-1",children:"Banned"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-8",children:[e.jsx(W,{value:t.posts,label:"messages"}),e.jsx(W,{value:t.likes,label:"reaction score"}),e.jsx(W,{value:t.topics,label:"topics"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-sm",children:[e.jsx("button",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",onClick:()=>alert("Points system coming soon ♥"),children:"Send points"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30 inline-flex items-center gap-2",children:["Find ",e.jsx(Ue,{size:14})]}),e.jsxs("div",{className:"absolute left-0 top-full hidden w-56 rounded-xl border border-white/10 bg-[#0b0f1b]/95 p-2 text-sm text-zinc-200 shadow-2xl backdrop-blur group-hover:block",children:[e.jsx("a",{className:"block rounded-lg px-2 py-1 hover:bg-white/10",href:`/forum/search?author=${encodeURIComponent(t.username)}`,children:"Все сообщения"}),e.jsx("a",{className:"block rounded-lg px-2 py-1 hover:bg-white/10",href:`/forum/search?starter=${encodeURIComponent(t.username)}`,children:"Темы пользователя"})]})]})]})]}),y?e.jsx(it,{user:t,onUpdated:async()=>{if(d){const i=await ce(s);i&&a(ge(i))}else a(oe(s)||null)},saveProfile:async i=>{d?await Ae(i):Pe(t.id,i)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx(tt,{session:l,user:t})})]}),e.jsx("div",{className:"px-6",children:e.jsx("div",{className:"mt-2 flex items-center gap-6 border-t border-white/10 pt-3 text-sm",children:[{k:"posts",label:"Profile posts"},{k:"activity",label:"Latest activity"},{k:"postings",label:"Postings"},{k:"about",label:"About"}].map(({k:i,label:f})=>e.jsx("button",{className:`pb-2 ${h===i?"border-b-2 border-cyan-400 text-white":"text-zinc-400 hover:text-zinc-200"}`,onClick:()=>S(i),children:f},i))})})]}),h==="about"&&e.jsxs("section",{className:"grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsxs("div",{className:R,children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"Роль"}),e.jsx(Ke,{role:t.role}),e.jsx("div",{className:"mt-5 mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"О себе"}),e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:t.profile.bio||"Пока нет описания."}),e.jsx("div",{className:"mt-3",children:e.jsx(et,{badges:t.profile.badges})})]}),e.jsxs("div",{className:R,children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"Ссылки"}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:[($=t.profile.links)!=null&&$.website?e.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",href:t.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(We,{size:14})," Сайт"]}):null,((D=t.profile.links)==null?void 0:D.discord)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(xe,{size:14})," ",t.profile.links.discord]}),((E=t.profile.links)==null?void 0:E.telegram)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(xe,{size:14})," ",t.profile.links.telegram]}),!((x=t.profile.links)!=null&&x.website)&&!((u=t.profile.links)!=null&&u.discord)&&!((b=t.profile.links)!=null&&b.telegram)&&e.jsx("span",{className:"opacity-70",children:"Ссылки ещё не добавлены."})]})]})]}),h!=="about"&&e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"Посты"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.posts})]}),e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"Темы"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.topics})]}),e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"Лайки"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.likes})]})]}),h==="posts"&&e.jsx(st,{user:t,session:l,memberMap:g}),h==="activity"&&e.jsx("div",{className:R,children:e.jsx("div",{className:"text-sm text-zinc-300/85",children:"Лента активности скоро будет тут (репосты, реакции, подписки)."})}),h==="postings"&&e.jsx("div",{className:R,children:e.jsx("div",{className:"text-sm text-zinc-300/85",children:"Список сообщений пользователя появится после подключения реального форума."})})]})})}function tt({session:s,user:t}){const[a,l]=r.useState(()=>t.id?me(t.id):[]),n=r.useMemo(()=>De((s==null?void 0:s.id)||null,t.id),[s==null?void 0:s.id,t.id,a.length]);return e.jsx("button",{className:`btn ${n?"":"btn-primary"}`,onClick:()=>{s!=null&&s.id&&(n?Me(s.id,t.id):Fe(s.id,t.id),l(me(t.id)))},children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:16})," Отписаться"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16})," Подписаться"]})})}function st({user:s,session:t,memberMap:a}){const[l,n]=r.useState(()=>B(s.id));return r.useEffect(()=>{const d=()=>n(B(s.id));return window.addEventListener("forum:social-change",d),()=>window.removeEventListener("forum:social-change",d)},[s.id]),e.jsxs("section",{className:"grid gap-3",children:[(t==null?void 0:t.id)&&e.jsx(at,{onPost:d=>{_e(s.id,t.id,d,{authorName:t.username}),n(B(s.id))}}),e.jsxs("div",{className:"grid gap-2",children:[l.length===0&&e.jsx("div",{className:`${R} text-sm text-zinc-300/80`,children:"Комментариев пока нет."}),nt(l).map(d=>e.jsx(je,{node:d,currentUserId:(t==null?void 0:t.id)||"",ownerId:s.id,memberMap:a,onReply:(m,p)=>{t!=null&&t.id&&(Te(s.id,t.id,m,p,t.username),n(B(s.id)))},onDelete:m=>{t!=null&&t.id&&(Le(s.id,m,t.id),n(B(s.id)))}},d.comment.id))]})]})}function at({onPost:s}){const[t,a]=r.useState("");return e.jsxs("div",{className:j,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qe,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Напишите комментарий...",value:t,onChange:l=>a(l.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const l=t.trim();l&&(s(l),a(""))},children:"Отправить"})})]})}function nt(s){const t={};s.forEach(n=>{t[n.id]={comment:n,replies:[]}});const a=[];s.forEach(n=>{const d=n.parentId||"";d&&t[d]?t[d].replies.push(t[n.id]):a.push(t[n.id])}),a.sort((n,d)=>n.comment.createdAt<d.comment.createdAt?1:-1);const l=n=>n.replies.sort((d,m)=>d.comment.createdAt>m.comment.createdAt?1:-1).forEach(l);return a.forEach(l),a}function je({node:s,currentUserId:t,ownerId:a,onReply:l,onDelete:n,memberMap:d}){const[m,p]=r.useState(!1),o=Re(s.comment.authorId),g=s.comment.authorName||(o==null?void 0:o.username)||(s.comment.authorId===a?"Владелец":s.comment.authorId===t?"Вы":"Участник"),v=(o==null?void 0:o.username)||s.comment.authorName;return e.jsx("div",{className:j,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-zinc-300/90",children:[v?e.jsx("a",{href:`/forum/profile/${v}`,className:"font-semibold text-white hover:underline",children:g}):e.jsx("span",{className:"font-semibold text-white",children:g}),e.jsxs("span",{className:"opacity-70",children:[" · ",new Date(s.comment.createdAt).toLocaleString("ru-RU")]})]}),(t===s.comment.authorId||t===a)&&e.jsx("button",{className:"btn",title:"Удалить",onClick:()=>n(s.comment.id),children:e.jsx(Ge,{size:14})})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:s.comment.content}),e.jsx(lt,{targetId:a,commentId:s.comment.id,currentUserId:t}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>p(h=>!h),children:"Ответить"})}),m&&e.jsx("div",{className:"mt-2",children:e.jsx(rt,{onSend:h=>{l(s.comment.id,h),p(!1)}})}),!!s.replies.length&&e.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:s.replies.map(h=>e.jsx(je,{node:h,currentUserId:t,ownerId:a,onReply:l,onDelete:n,memberMap:d},h.comment.id))})]})]})})}function rt({onSend:s}){const[t,a]=r.useState("");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"Ответ...",value:t,onChange:l=>a(l.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const l=t.trim();l&&(s(l),a(""))},children:"Отправить"})]})}function lt({targetId:s,commentId:t,currentUserId:a}){const[,l]=r.useReducer(p=>p+1,0),n=Ie(s)[t]||{counts:{like:0,smile:0,useful:0}},d=a?Oe(s,t,a):void 0,m=({r:p,label:o})=>{var g;return e.jsxs("button",{className:`btn text-xs ${d===p?"btn-primary":""}`,onClick:()=>{a&&(Be(s,t,a,p),l())},children:[o," ",(g=n.counts)!=null&&g[p]?e.jsx("span",{className:"opacity-80",children:n.counts[p]}):null]})};return e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx(m,{r:"like",label:"👍"}),e.jsx(m,{r:"smile",label:"😊"}),e.jsx(m,{r:"useful",label:"💡"})]})}function it({user:s,onUpdated:t,saveProfile:a}){const[l,n]=r.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>n(!0),children:[e.jsx(He,{size:16})," Настроить профиль"]}),l&&e.jsx(mt,{user:s,onClose:()=>n(!1),onSaved:()=>{t(),n(!1)},saveProfile:a})]})}const ct=["Founder","Early","Contributor","VIP","Designer"];function H(s,t,a){return Math.max(t,Math.min(a,s))}function ot(s){const[t,a]=r.useState(null);return r.useEffect(()=>{if(!s){a(null);return}const l=new Image;l.onload=()=>a(l),l.src=s},[s]),t}function dt({src:s,aspect:t,round:a=!1,title:l="Обрезать изображение",onCancel:n,onDone:d}){const m=a?360:900,p=Math.round(m/t),o=ot(s),[g,v]=r.useState(1),[h,S]=r.useState({x:0,y:0}),y=r.useRef(null);r.useEffect(()=>{if(!o)return;const u=Math.max(m/o.naturalWidth,p/o.naturalHeight)*1.05;v(u);const b=o.naturalWidth*u,i=o.naturalHeight*u;S({x:(m-b)/2,y:(p-i)/2})},[o]);const C=r.useCallback((x,u)=>{if(!o)return x;const b=o.naturalWidth*u,i=o.naturalHeight*u;return{x:H(x.x,m-b,0),y:H(x.y,p-i,0)}},[o,m,p]),A=x=>{const u="touches"in x?x.touches[0]:x;y.current={x:h.x,y:h.y,startX:u.clientX,startY:u.clientY}},z=x=>{if(!y.current)return;const u="touches"in x?x.touches[0]:x,b=u.clientX-y.current.startX,i=u.clientY-y.current.startY;S(f=>C({x:y.current.x+b,y:y.current.y+i},g))},k=()=>{y.current=null},$=x=>{if(!o)return;x.preventDefault();const u=Math.max(m/o.naturalWidth,p/o.naturalHeight),b=u*6,i=H(g*(x.deltaY>0?.94:1.06),u,b);v(i),S(f=>C(f,i))},D=()=>{if(!o)return;const x=a?800:1920,u=Math.round(x/t),b=x/m,i=document.createElement("canvas");i.width=x,i.height=u;const f=i.getContext("2d");if(a){f.save(),f.beginPath();const M=Math.min(x,u)/2;f.arc(x/2,u/2,M,0,Math.PI*2),f.clip()}const N=o.naturalWidth*g*b,P=o.naturalHeight*g*b;f.drawImage(o,h.x*b,h.y*b,N,P),a&&f.restore(),d(i.toDataURL("image/png",.95))},E=()=>{if(!o)return null;const x=Math.max(m/o.naturalWidth,p/o.naturalHeight),u=x*6;return e.jsx("input",{type:"range",min:x,max:u,step:x/50,value:g,onChange:b=>{const i=Number(b.target.value);v(i),S(f=>C(f,i))},className:"w-full"})};return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/70 px-4",children:e.jsxs("div",{className:"w-[min(96vw,1000px)] rounded-3xl border border-white/10 bg-[#0b0f1b]/95 p-5 shadow-2xl backdrop-blur",children:[e.jsx("div",{className:"mb-3 text-lg font-semibold text-white",children:l}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[auto_1fr]",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-white/10 bg-black/40 select-none touch-none",style:{width:m,height:p,cursor:"grab"},onMouseDown:A,onMouseMove:z,onMouseUp:k,onMouseLeave:k,onTouchStart:A,onTouchMove:z,onTouchEnd:k,onWheel:$,children:[o&&e.jsx("img",{src:s,alt:"crop",draggable:!1,style:{position:"absolute",left:0,top:0,transform:`translate(${h.x}px, ${h.y}px) scale(${g})`,transformOrigin:"top left",userSelect:"none",pointerEvents:"none"}}),a&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-[90%] aspect-square rounded-full ring-2 ring-white/40"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Зум / перетаскивание"}),E(),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:n,children:"Отмена"}),e.jsx("div",{className:"grow"}),e.jsx("button",{className:"btn btn-primary",onClick:D,children:"Готово"})]})]})]})]})})}function mt({user:s,onClose:t,onSaved:a,saveProfile:l}){var Z,K,Q,ee,te,se,ae,ne,re;const[n,d]=r.useState(s.profile.avatarData||""),[m,p]=r.useState(s.profile.bannerData||""),[o,g]=r.useState(s.profile.accentFrom||"#22d3ee"),[v,h]=r.useState(s.profile.accentTo||"#8b5cf6"),[S,y]=r.useState(s.profile.bio||""),[C,A]=r.useState(s.profile.signature||""),[z,k]=r.useState(((Z=s.profile.links)==null?void 0:Z.website)||""),[$,D]=r.useState(((K=s.profile.links)==null?void 0:K.discord)||""),[E,x]=r.useState(((Q=s.profile.links)==null?void 0:Q.telegram)||""),[u,b]=r.useState(s.profile.badges||[]),[i,f]=r.useState(((ee=s.profile.privacy)==null?void 0:ee.showEmail)??!1),[N,P]=r.useState(((te=s.profile.privacy)==null?void 0:te.showStats)??!0),[M,U]=r.useState(((se=s.profile.privacy)==null?void 0:se.showLinks)??!0),[_,Ne]=r.useState(((ae=s.profile.privacy)==null?void 0:ae.allowComments)??!0),[V,we]=r.useState(((ne=s.profile.privacy)==null?void 0:ne.showFollowers)??!0),[q,ye]=r.useState(((re=s.profile.privacy)==null?void 0:re.showSecondaryRole)!==!1),[G,L]=r.useState(null),[T,I]=r.useState(null),ke=c=>b(w=>w.includes(c)?w.filter(F=>F!==c):w.length>=3?w:[...w,c]),J=c=>w=>{var le;const F=(le=w.target.files)==null?void 0:le[0];if(!F)return;const O=new FileReader;O.onload=()=>{L(String(O.result||"")),I(c)},O.readAsDataURL(F)},Ce=async()=>{const c={website:z.trim(),discord:$.trim(),telegram:E.trim()},w=Object.fromEntries(Object.entries(c).filter(([,O])=>O)),F={...s.profile.privacy||{},showEmail:i,showStats:N,showLinks:M,allowComments:_,showFollowers:V,showSecondaryRole:q};await l({avatarData:n||void 0,bannerData:m||void 0,accentFrom:o,accentTo:v,bio:S.trim()||void 0,signature:C.trim()||void 0,links:Object.keys(w).length?w:void 0,badges:u,privacy:F}),a()};return e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-start justify-center bg-black/70 px-4 py-8 overflow-y-auto",children:[e.jsxs("div",{className:`${R} w-[min(820px,96vw)]`,style:{position:"relative"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Настройка профиля"}),e.jsx("button",{className:"btn",onClick:t,children:"Закрыть"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Аватар"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:n?`url(${n}) center/cover`:`linear-gradient(135deg, ${o}, ${v})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(fe,{size:16})," Загрузить",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:J("avatar")})]}),n&&e.jsx("button",{className:"btn",onClick:()=>d(""),children:"Удалить"}),n&&e.jsx("button",{className:"btn",onClick:()=>{L(n),I("avatar")},children:"Обрезать заново"})]})]})]}),e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Баннер"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:m?`url(${m}) center/cover`:`linear-gradient(135deg, ${o}, ${v})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(fe,{size:16})," Загрузить",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:J("banner")})]}),m&&e.jsx("button",{className:"btn",onClick:()=>p(""),children:"Удалить"}),m&&e.jsx("button",{className:"btn",onClick:()=>{L(m),I("banner")},children:"Обрезать заново"})]})]}),e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Градиент"}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"От"}),e.jsx("input",{type:"color",value:o,onChange:c=>g(c.target.value)})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"До"}),e.jsx("input",{type:"color",value:v,onChange:c=>h(c.target.value)})]})]})]}),e.jsxs("div",{className:j,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Бейджи (до 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:ct.map(c=>{const w=u.includes(c);return e.jsxs("button",{className:`btn flex items-center gap-2 ${w?"btn-primary":""}`,onClick:()=>ke(c),type:"button",children:[e.jsx(ve,{size:16})," ",c]},c)})})]}),e.jsxs("div",{className:`${j} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"О себе"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:S,onChange:c=>y(c.target.value),placeholder:"Расскажите о себе"})]}),e.jsxs("div",{className:`${j} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Подпись"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:C,onChange:c=>A(c.target.value),placeholder:"Текст под сообщениями"})]}),e.jsxs("div",{className:`${j} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Ссылки"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:z,onChange:c=>k(c.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:$,onChange:c=>D(c.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:E,onChange:c=>x(c.target.value)})]})]}),e.jsxs("div",{className:`${j} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Приватность"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:c=>f(c.target.checked)})," Показывать e-mail"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:c=>P(c.target.checked)})," Показывать статистику"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:c=>U(c.target.checked)})," Показывать ссылки"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:c=>we(c.target.checked)})," Показывать подписчиков"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:c=>Ne(c.target.checked)})," Разрешить комментарии"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:c=>ye(c.target.checked)})," Показывать вторую роль"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Отмена"}),e.jsx("button",{className:"btn btn-primary",onClick:Ce,children:"Сохранить"})]})]})]}),G&&T&&e.jsx(dt,{src:G,aspect:T==="avatar"?1:21/6,round:T==="avatar",title:T==="avatar"?"Обрезать аватар":"Обрезать баннер",onCancel:()=>{L(null),I(null)},onDone:c=>{T==="avatar"?d(c):p(c),L(null),I(null)}})]})}export{bt as default};
