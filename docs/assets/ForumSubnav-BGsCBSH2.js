import{j as s}from"./index-DI_xm1-9.js";import{b as E,R as i,L as x}from"./react-vendor-DTkXckhQ.js";import{listSections as U}from"./forumRemote-D5s3MT8n.js";import{ax as C,ac as z,U as I,aw as R}from"./icons-GyIOUIPt.js";const k="forum:default_feed";function W(){try{const t=localStorage.getItem(k);if(t==="hot"||t==="new"||t==="questions")return t}catch{}return"hot"}function D(t){try{localStorage.setItem(k,t)}catch{}}const M="app:lang";function P(){try{const t=localStorage.getItem(M);if(t==="ru"||t==="en")return t}catch{}return"ru"}function r(t,a){return P()==="ru"?t:a}function H(){const t=E(),[a,f]=i.useState(null);i.useEffect(()=>{let e=!0;return(async()=>{try{const n=(await U()||[]).find(c=>String(c.title||"").toLowerCase()==="workshop");e&&f((n==null?void 0:n.id)||null)}catch{e&&f(null)}})(),()=>{e=!1}},[]);const h=t.pathname.includes("/forum/members"),p=a?t.pathname.startsWith(`/forum/section/${a}`):!1,w=!h&&!p,v=new URLSearchParams(t.search||"").get("feed"),y=W(),m=v||y,u=({to:e,active:o,icon:n,children:c,disabled:$,title:g})=>$?s.jsxs("span",{className:`btn inline-flex items-center gap-2 ${o?"btn-primary":""} opacity-60 cursor-not-allowed`,title:g||"","aria-disabled":!0,children:[n," ",c]}):s.jsxs(x,{to:e,className:`btn inline-flex items-center gap-2 ${o?"btn-primary":""}`,title:g||"",children:[n," ",c]}),[j,d]=i.useState(!1);i.useEffect(()=>{const e=()=>d(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const b=[{key:"latest",label:r("feed.latest","Latest")},{key:"hot",label:r("feed.hot","Hot")},{key:"new",label:r("feed.new","New")},{key:"following",label:r("feed.following","Following")}],F=e=>{var o;return((o=b.find(n=>n.key===e))==null?void 0:o.label)||r("feed.default","Feed")},l=(e,o)=>{const n=new URLSearchParams(t.search);o?n.set("feed",o):n.delete("feed");const c=n.toString();return`${e}${c?`?${c}`:""}`},S=l("/forum",m),L=l("/forum/members",null),N=a?l(`/forum/section/${a}`,null):"#";return s.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[s.jsx(u,{to:S,active:w,icon:s.jsx(C,{size:16}),children:r("nav.forums","Forums")}),s.jsx(u,{to:N,active:p,disabled:!a,icon:s.jsx(z,{size:16}),title:a?"":r("nav.workshopMissing","Workshop section is not created yet"),children:r("nav.workshop","Workshop")}),s.jsx(u,{to:L,active:h,icon:s.jsx(I,{size:16}),children:r("nav.members","Members")}),s.jsxs("div",{className:"relative ml-auto",onClick:e=>e.stopPropagation(),"aria-label":r("feed.chooser","Choose feed"),children:[s.jsxs("button",{type:"button",className:"btn inline-flex items-center gap-2",onClick:()=>d(e=>!e),children:[s.jsx("span",{className:"truncate max-w-[10rem]",children:F(m)}),s.jsx(R,{size:16})]}),j&&s.jsx("div",{className:"absolute right-0 z-20 mt-2 min-w-40 rounded-xl border bg-background p-2 shadow-lg",children:b.map(e=>{const o=l("/forum",e.key),n=m===e.key;return s.jsx(x,{to:o,className:`block rounded-md px-3 py-2 text-sm hover:bg-muted ${n?"font-semibold":""}`,onClick:()=>{try{D(e.key)}catch{}d(!1)},children:e.label},String(e.key))})})]})]})}export{H as F,W as g,r as t};
