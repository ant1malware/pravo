import{b as z,j as e}from"./index-BT0Wx6_3.js";import{u as E,e as I,R as i,L as g}from"./react-vendor-DTkXckhQ.js";import{listSections as D,listTopics as M,createTopic as K}from"./forumRemote-D5s3MT8n.js";import{F as O,t as j}from"./ForumSubnav-CAzoZAvW.js";import{M as U}from"./MarkdownEditor-DII5fw7t.js";import{F as _}from"./FavStar-BQbyWHiU.js";import{a1 as q,a2 as G,a3 as H}from"./icons-vKdVo13Z.js";import"./purify.es-DnfDK_hS.js";function ae(){const{id:c=""}=E(),F=I(),[r,v]=i.useState(null),[m,w]=i.useState([]),[N,y]=i.useState(""),[p,S]=i.useState(""),[k,C]=i.useState(!1),[n,o]=i.useState("all"),[d,$]=i.useState("all"),[u,x]=i.useState(20),[T,L]=i.useState(!1),h=i.useCallback(async()=>{try{if(!await z()){try{F("/forum",{replace:!0})}catch{}return}const[a,l]=await Promise.all([D(),M(c)]);v(a.find(b=>b.id===c)||null),w(Array.isArray(l)?l:[])}catch{v(null),w([])}},[c]);i.useEffect(()=>{h()},[h]);const s=((r==null?void 0:r.title)||"").toLowerCase()==="workshop",R=i.useMemo(()=>{const t=new Set;for(const a of m){const l=String(a.title||"").match(/\[(.+?)\]/g)||[];for(const b of l){const A=b.replace(/[\[\]]/g,"");["wip","review","done"].includes(A.toLowerCase())||t.add(A)}}return Array.from(t).sort((a,l)=>a.localeCompare(l))},[m]),B=async t=>{t.preventDefault();const a=N.trim();if(a){if(s&&!p.trim()){alert("Добавьте описание проекта перед публикацией.");return}C(!0);try{await K({sectionId:c,title:a,content:s?p:void 0}),y(""),S(""),h()}catch(l){alert((l==null?void 0:l.message)||"Failed to create topic")}finally{C(!1)}}};function f(t){const a=(t||"").toLowerCase();return a.startsWith("[wip]")?"wip":a.startsWith("[review]")?"review":a.startsWith("[done]")?"done":"none"}const W=m.filter(t=>n==="all"?!0:f(t.title)===n).filter(t=>d==="all"?!0:new RegExp(`\\[${d.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}\\]`,"i").test(String(t.title||""))),P=W.slice(0,u);return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 620px at 18% -12%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1200px 760px at 92% 0%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6",children:[e.jsx(O,{}),e.jsxs("nav",{className:"mb-3 text-sm opacity-80",children:[e.jsx(g,{to:"/forum",className:"hover:underline",children:j("Форум","Forum")}),e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{children:(r==null?void 0:r.title)||"..."})]}),e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsxs(g,{to:"/forum",className:"btn flex items-center gap-2",children:[e.jsx(q,{size:16})," Back"]}),e.jsx("div",{className:"text-sm opacity-70",children:"Section"}),e.jsx("div",{className:"font-semibold",children:(r==null?void 0:r.title)||"..."})]}),s&&e.jsxs("div",{className:"card mb-4 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 font-semibold",children:[e.jsx(G,{size:16})," Workshop: рекомендации"]}),e.jsx("div",{className:"text-sm opacity-70",children:"Добавляйте префиксы статуса в заголовок: [WIP], [Review], [Done]. Пишите краткое описание, технологический стек и прогресс — будет проще ревьюить."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("button",{className:`tab ${n==="all"?"tab-active":""}`,onClick:()=>o("all"),children:"All"}),e.jsx("button",{className:`tab ${n==="wip"?"tab-active":""}`,onClick:()=>o("wip"),children:"[WIP]"}),e.jsx("button",{className:`tab ${n==="review"?"tab-active":""}`,onClick:()=>o("review"),children:"[Review]"}),e.jsx("button",{className:`tab ${n==="done"?"tab-active":""}`,onClick:()=>o("done"),children:"[Done]"})]})]}),s&&!T&&e.jsx("div",{className:"mb-3 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>L(!0),children:"Создать проект"})}),(!s||T)&&e.jsxs("form",{onSubmit:B,className:"card mb-4 grid gap-2 p-4",children:[e.jsx("input",{className:"input",placeholder:s?"[WIP] Короткий заголовок проекта":"Topic title",value:N,onChange:t=>y(t.target.value),disabled:k}),s&&e.jsx(U,{value:p,onChange:S,placeholder:"Описание проекта...",projectTemplate:!0,draftKey:r?`forum:draft:new:${r.id}`:void 0}),e.jsxs("button",{className:"btn btn-primary flex items-center gap-2",disabled:k,children:[e.jsx(H,{size:16})," ",s?"Создать проект":"Создать тему"]})]}),e.jsxs("div",{className:s?"grid gap-4 md:grid-cols-2 lg:grid-cols-3":"grid gap-3",children:[!s&&e.jsxs("div",{className:"card flex flex-wrap items-center gap-2 p-2 text-xs",children:[e.jsxs("span",{className:"opacity-70",children:[j("Теги","Tags"),":"]}),e.jsx("button",{className:`tab ${d==="all"?"tab-active":""}`,onClick:()=>{$("all"),x(20)},children:"All"}),R.map(t=>e.jsx("button",{className:`tab ${d===t?"tab-active":""}`,onClick:()=>{$(t),x(20)},children:`[${t}]`},t))]}),P.map(t=>e.jsxs(g,{to:`/forum/topic/${t.id}`,className:`card p-4 ${s?"grid grid-cols-[1fr_auto] items-center":""}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-semibold truncate",children:[s&&f(t.title)!=="none"&&e.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:`[${f(t.title).toUpperCase()}]`}),t.title]}),e.jsxs("div",{className:"mt-1 text-xs opacity-70",children:["replies: ",t.replyCount," • views: ",t.viewCount]})]}),s&&e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-emerald-300/80",children:"Проект"}),e.jsx(_,{kind:"topic",id:t.id,title:t.title,url:`/forum/topic/${t.id}`,size:"sm"})]},t.id)),!P.length&&e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"No topics yet."}),W.length>u&&e.jsx("button",{className:"btn",onClick:()=>x(u+20),children:j("Показать ещё","Show more")})]})]})})}export{ae as default};
