const f="https://notifications-worker.wizardiowhy.workers.dev/skyapi",i="forum:token",c="forum:session";function m(e,t=!0){(t?localStorage:sessionStorage).setItem(i,e)}function l(){return localStorage.getItem(i)??sessionStorage.getItem(i)}function w(){try{localStorage.removeItem(i),sessionStorage.removeItem(i),localStorage.removeItem(c),sessionStorage.removeItem(c)}finally{window.dispatchEvent(new Event("forum:session"))}}async function r(e,t={}){const s=l(),o={"Content-Type":"application/json",...t.headers||{}};s&&(o.Authorization=`Bearer ${s}`);const n=await fetch(`${f}${e}`,{...t,headers:o}),u=await n.text();let a={};try{a=u?JSON.parse(u):{}}catch{a={error:u||n.statusText}}if(!n.ok)throw new Error((a==null?void 0:a.error)||`${n.status} ${n.statusText}`);return a}async function S(e){const t=JSON.stringify({username:e.username,email:e.email,password:e.password||"1234",inviteCode:e.inviteCode||""}),{token:s,user:o}=await r("/register",{method:"POST",body:t});m(s,e.remember!==!1);const n={userId:o.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),o}async function d(e){const t=JSON.stringify({usernameOrEmail:e.usernameOrEmail,password:e.password||"1234"}),{token:s,user:o}=await r("/login",{method:"POST",body:t});m(s,e.remember!==!1);const n={userId:o.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),o}async function g(){if(!l())return null;try{const{user:t}=await r("/me");return t}catch{return w(),null}}async function y(){const{users:e}=await r("/users");return e}async function v(e,t){const{user:s}=await r(`/users/${e}/role`,{method:"PATCH",body:JSON.stringify({role:t})});return s}async function h(){const{invites:e}=await r("/invites");return e}async function I(e=5,t){const{invites:s}=await r("/invites",{method:"POST",body:JSON.stringify({count:e,note:t})});return s}export{d as a,h as b,w as c,I as d,g,y as l,S as r,v as s};
