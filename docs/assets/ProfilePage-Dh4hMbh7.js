import{j as e}from"./index-DbIXfL-X.js";import{u as he,R as n}from"./react-vendor-DTkXckhQ.js";import{g as se,e as te,f as ae,a as ie,u as fe,h as ge,j as le}from"./authRemote-C6S6-qmZ.js";import{a0 as je,a1 as ve,a2 as Ne,a3 as re,a4 as be,a5 as we,M as ke,a6 as ne,a7 as ye}from"./icons-CG-tEzXH.js";const ce="forum:follows";function R(){try{return JSON.parse(localStorage.getItem(ce)||"[]")}catch{return[]}}function oe(t){try{localStorage.setItem(ce,JSON.stringify(t))}catch{}}function _(t){return R().filter(s=>s.targetId===t).map(s=>s.followerId)}function Se(t,s){return t?R().some(r=>r.followerId===t&&r.targetId===s):!1}function Ce(t,s){if(t===s)return;const r=R();r.some(a=>a.followerId===t&&a.targetId===s)||(r.push({followerId:t,targetId:s,createdAt:new Date().toISOString()}),oe(r))}function ze(t,s){const r=R().filter(a=>!(a.followerId===t&&a.targetId===s));oe(r)}function de(t){return`forum:profile_comments:${t}`}function W(t){try{return JSON.parse(localStorage.getItem(de(t))||"[]")}catch{return[]}}function me(t,s){try{localStorage.setItem(de(t),JSON.stringify(s))}catch{}}function O(t){return W(t).sort((s,r)=>s.createdAt<r.createdAt?1:-1)}function Fe(t,s,r){const a=r.trim(),c={id:crypto.randomUUID(),targetId:t,authorId:s,content:a,createdAt:new Date().toISOString()},m=W(t);return m.unshift(c),me(t,m),c}function Ae(t,s,r){const c=W(t).filter(m=>!(m.id===s&&(m.authorId===r||t===r)));me(t,c)}const Le={developer:{label:"Developer",color:"#22d3ee"},admin:{label:"Admin",color:"#ef4444"},moderator:{label:"Moderator",color:"#8b5cf6"},vip:{label:"VIP",color:"#eab308"},user:{label:"User",color:"#94a3b8"},newbie:{label:"Newbie",color:"#22d3ee"}},De=["Founder","Early","Contributor","VIP","Designer"];function Pe({role:t}){const s=Le[t]||{label:t,color:"#94a3b8"};return e.jsx("span",{className:"rounded-full border border-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.26em]",style:{color:s.color},children:s.label})}function J({value:t,label:s}){return e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-extrabold text-white",children:t}),e.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:s})]})}function C({title:t,children:s}){return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.28em] text-zinc-400/70",children:t}),s]})}function Re(){var L,v,D,N,P,b,E,w,$,k,T,y,B,S;const{username:t=""}=he(),[s,r]=n.useState(null),[a,c]=n.useState(null),[m,p]=n.useState(!1);if(n.useEffect(()=>{(async()=>{try{const o=await se();if(o){p(!0),c({id:o.id,username:o.username});const d=await te(t);if(d){const U={id:d.user.id,username:d.user.username,email:d.user.email,createdAt:d.user.createdAt,role:d.user.role,userNumber:d.user.userNumber,posts:0,likes:0,topics:0,profile:d.profile||{bio:"",signature:"",links:{},accentFrom:"#8b5cf6",accentTo:"#0ea5e9",badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0}},bans:null,mutes:null};r(U);return}}}catch{}p(!1),r(ae(t)||null);const i=ie();c(i?{id:i.id,username:i.username}:null)})()},[t]),n.useEffect(()=>{const i=async()=>{try{const d=await se();if(d){c({id:d.id,username:d.username});return}}catch{}const o=ie();c(o?{id:o.id,username:o.username}:null)};return window.addEventListener("forum:session",i),window.addEventListener("storage",i),()=>{window.removeEventListener("forum:session",i),window.removeEventListener("storage",i)}},[]),!s)return e.jsx("main",{className:"min-h-screen bg-slate-950 text-slate-200",children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-12",children:e.jsx("div",{className:"card p-6 text-center text-sm text-zinc-300",children:"Profile not found."})})});const z=(a==null?void 0:a.id)===s.id,[x,F]=n.useState(()=>_(s.id)),[h,g]=n.useState(()=>O(s.id)),f=n.useMemo(()=>Se((a==null?void 0:a.id)||null,s.id),[a==null?void 0:a.id,s.id,x.length]);n.useEffect(()=>{F(_(s.id)),g(O(s.id))},[s.id]);const A=s.profile.accentFrom||"#22d3ee",j=s.profile.accentTo||"#8b5cf6";return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 20% -10%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1100px 760px at 95% 8%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{style:{height:180,background:s.profile.bannerData?`url(${s.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${A}, ${j})`}}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 px-4 pb-4 -mt-16",children:[e.jsx("div",{className:"h-24 w-24 rounded-full ring-4 ring-[rgba(13,19,33,0.85)]",style:{background:s.profile.avatarData?`url(${s.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${A}, ${j})`}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-white",children:s.username}),e.jsx(Pe,{role:s.role}),e.jsxs("span",{className:"text-xs text-zinc-400/80",children:["#",s.userNumber]})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:["Joined ",new Date(s.createdAt).toLocaleDateString()]})]}),z?e.jsx(Ee,{user:s,onUpdated:async()=>{if(m){const i=await te(t);i&&r({id:i.user.id,username:i.user.username,email:i.user.email,createdAt:i.user.createdAt,role:i.user.role,userNumber:i.user.userNumber,posts:0,likes:0,topics:0,profile:i.profile,bans:null,mutes:null})}else r(ae(t)||null)},saveProfile:async i=>{m?await fe(i):ge(s.id,i)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:`btn ${f?"":"btn-primary"}`,onClick:()=>{a!=null&&a.id&&(f?ze(a.id,s.id):Ce(a.id,s.id),F(_(s.id)))},children:f?e.jsxs(e.Fragment,{children:[e.jsx(je,{size:16})," Unfollow"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:16})," Follow"]})})})]})]}),((v=(L=s.profile)==null?void 0:L.privacy)==null?void 0:v.showStats)!==!1&&e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[e.jsx(J,{value:s.posts,label:"Posts"}),e.jsx(J,{value:s.topics,label:"Topics"}),e.jsx(J,{value:s.likes,label:"Likes"})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsx(C,{title:"About",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:s.profile.bio||"No bio yet."})}),((N=(D=s.profile)==null?void 0:D.privacy)==null?void 0:N.showLinks)!==!1&&e.jsx(C,{title:"Links",children:e.jsxs("div",{className:"grid gap-2 text-sm text-zinc-200/80",children:[(P=s.profile.links)!=null&&P.website?e.jsxs("a",{className:"flex items-center gap-2 text-sky-300 hover:text-sky-200",href:s.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(Ne,{size:14}),s.profile.links.website]}):null,(b=s.profile.links)!=null&&b.discord?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:14})," Discord: ",s.profile.links.discord]}):null,(E=s.profile.links)!=null&&E.telegram?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:14})," Telegram: ",s.profile.links.telegram]}):null,!((w=s.profile.links)!=null&&w.website)&&!(($=s.profile.links)!=null&&$.discord)&&!((k=s.profile.links)!=null&&k.telegram)&&e.jsx("span",{children:"No links added."})]})})]}),e.jsx(C,{title:"Signature",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:s.profile.signature||"No signature."})}),((y=(T=s.profile)==null?void 0:T.privacy)==null?void 0:y.showFollowers)!==!1&&e.jsx(C,{title:`Followers (${x.length})`,children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/80",children:x.length===0?e.jsx("span",{children:"No followers yet."}):x.slice(0,14).map(i=>{const o=le(i);return e.jsx("span",{className:"rounded-full bg-white/5 px-3 py-1",children:(o==null?void 0:o.username)||"User"},i)})})}),((S=(B=s.profile)==null?void 0:B.privacy)==null?void 0:S.allowComments)!==!1&&e.jsx(C,{title:"Profile comments",children:e.jsxs("div",{className:"grid gap-3",children:[(a==null?void 0:a.id)&&a.id!==s.id&&e.jsx(Te,{onPost:i=>{a!=null&&a.id&&(Fe(s.id,a.id,i),g(O(s.id)))}}),e.jsxs("div",{className:"grid gap-2",children:[h.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"No comments yet."}),h.map(i=>{var o;return e.jsxs("div",{className:"card p-3 text-sm text-zinc-200/90 flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-zinc-400/80",children:[((o=le(i.authorId))==null?void 0:o.username)||"User"," Â· ",new Date(i.createdAt).toLocaleString()]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:i.content})]}),((a==null?void 0:a.id)===i.authorId||(a==null?void 0:a.id)===s.id)&&e.jsx("button",{className:"btn",title:"Delete",onClick:()=>{Ae(s.id,i.id,a.id),g(O(s.id))},children:e.jsx(be,{size:16})})]},i.id)})]})]})})]})})}function Ee({user:t,onUpdated:s,saveProfile:r}){const[a,c]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>c(!0),children:[e.jsx(we,{size:16})," Settings"]}),a&&e.jsx($e,{user:t,onClose:()=>c(!1),onSaved:()=>{s(),c(!1)},saveProfile:r})]})}function $e({user:t,onClose:s,onSaved:r,saveProfile:a}){var K,V,Y,q,H,Q,X,Z;const[c,m]=n.useState(t.profile.avatarData||""),[p,z]=n.useState(t.profile.bannerData||""),[x,F]=n.useState(t.profile.accentFrom||"#22d3ee"),[h,g]=n.useState(t.profile.accentTo||"#8b5cf6"),[f,A]=n.useState(t.profile.bio||""),[j,L]=n.useState(t.profile.signature||""),[v,D]=n.useState(((K=t.profile.links)==null?void 0:K.website)||""),[N,P]=n.useState(((V=t.profile.links)==null?void 0:V.discord)||""),[b,E]=n.useState(((Y=t.profile.links)==null?void 0:Y.telegram)||""),[w,$]=n.useState(t.profile.badges||[]),[k,T]=n.useState(((q=t.profile.privacy)==null?void 0:q.showEmail)??!1),[y,B]=n.useState(((H=t.profile.privacy)==null?void 0:H.showStats)??!0),[S,i]=n.useState(((Q=t.profile.privacy)==null?void 0:Q.showLinks)??!0),[o,d]=n.useState(((X=t.profile.privacy)==null?void 0:X.allowComments)??!0),[U,xe]=n.useState(((Z=t.profile.privacy)==null?void 0:Z.showFollowers)??!0),ue=l=>{$(u=>u.includes(l)?u.filter(I=>I!==l):u.length>=3?u:[...u,l])},G=l=>u=>{var ee;const I=(ee=u.target.files)==null?void 0:ee[0];if(!I)return;const M=new FileReader;M.onload=()=>l(String(M.result||"")),M.readAsDataURL(I)},pe=async()=>{await a({avatarData:c||void 0,bannerData:p||void 0,accentFrom:x,accentTo:h,bio:f.trim()||void 0,signature:j.trim()||void 0,links:{website:v.trim()||void 0,discord:N.trim()||void 0,telegram:b.trim()||void 0},badges:w,privacy:{showEmail:k,showStats:y,showLinks:S,allowComments:o,showFollowers:U}}),r()};return e.jsx("div",{className:"fixed inset-0 z-[120] grid place-items-center bg-black/70 px-4 py-6",children:e.jsxs("div",{className:"card w-[min(780px,96vw)] max-h-[90vh] overflow-y-auto p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Customize profile"}),e.jsx("button",{className:"btn",onClick:s,children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Avatar"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:c?`url(${c}) center/cover`:`linear-gradient(135deg, ${x}, ${h})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(ne,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:G(m)})]}),c&&e.jsx("button",{className:"btn",onClick:()=>m(""),children:"Remove"})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Banner"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:p?`url(${p}) center/cover`:`linear-gradient(135deg, ${x}, ${h})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(ne,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:G(z)})]}),p&&e.jsx("button",{className:"btn",onClick:()=>z(""),children:"Remove"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Accent"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"From"}),e.jsx("input",{type:"color",value:x,onChange:l=>F(l.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"To"}),e.jsx("input",{type:"color",value:h,onChange:l=>g(l.target.value)})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Badges (max 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:De.map(l=>{const u=w.includes(l);return e.jsxs("button",{className:`btn flex items-center gap-2 ${u?"btn-primary":""}`,onClick:()=>ue(l),type:"button",children:[e.jsx(ye,{size:16})," ",l]},l)})})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Bio"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:f,onChange:l=>A(l.target.value),placeholder:"Tell the community a bit about yourself"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Signature"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:j,onChange:l=>L(l.target.value),placeholder:"Signature displayed under your posts"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Links"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:v,onChange:l=>D(l.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:N,onChange:l=>P(l.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:b,onChange:l=>E(l.target.value)})]})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Privacy"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:l=>T(l.target.checked)})," Show email"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:l=>B(l.target.checked)})," Show stats (posts, topics, likes)"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:l=>i(l.target.checked)})," Show links"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:l=>xe(l.target.checked)})," Show followers"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:l=>d(l.target.checked)})," Allow comments on profile"]})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:s,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:pe,children:"Save changes"})]})]})})}function Te({onPost:t}){const[s,r]=n.useState("");return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ke,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Write a comment...",value:s,onChange:a=>r(a.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=s.trim();a&&(t(a),r(""))},children:"Post comment"})})]})}export{Re as default};
