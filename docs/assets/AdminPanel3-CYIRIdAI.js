import{j as e}from"./index-DbIXfL-X.js";import{R as m}from"./react-vendor-DTkXckhQ.js";import{g as C,m as S,n as I,o as F,p as M,s as D,q as T,t as _,v as B,w as A,x as E,y as U,z as P}from"./authRemote-C6S6-qmZ.js";import{l as R,b as $,d as O,u as L,e as W,f as w,m as q,g as z}from"./forumRemote-Dzz5sNcO.js";import"./icons-CG-tEzXH.js";function j(){try{const s=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),p=s?JSON.parse(s):null;return(p==null?void 0:p.userId)||"unknown"}catch{return"unknown"}}function te(){const[s,p]=m.useState("users"),[l,d]=m.useState(null);m.useEffect(()=>{(async()=>{try{d(await C())}catch{d(null)}})()},[]);const o=l==null?void 0:l.role,x=o==="developer"?["users","sections","topics","invites","maintenance"]:o==="admin"?["users","topics","invites"]:o==="moderator"?["users","invites"]:["topics"];return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:x.map(u=>e.jsx("button",{className:`btn ${s===u?"btn-primary":""}`,onClick:()=>p(u),children:u},u))}),s==="users"&&e.jsx(G,{meRole:o,meId:l==null?void 0:l.id}),s==="sections"&&e.jsx(J,{}),s==="topics"&&e.jsx(Q,{meRole:o}),s==="invites"&&e.jsx(H,{meRole:o,meId:(l==null?void 0:l.id)||""}),s==="maintenance"&&e.jsx(K,{})]})}function G({meRole:s,meId:p}){const[l,d]=m.useState([]),o=m.useCallback(async()=>{try{d(await S())}catch(t){alert((t==null?void 0:t.message)||"Failed to load users")}},[]);m.useEffect(()=>{o()},[o]);const x=s==="developer",u=s==="developer"||s==="admin",y=s==="developer"||s==="admin"||s==="moderator",v=async(t,n)=>{if(x)try{await D(t,n),o()}catch(r){alert((r==null?void 0:r.message)||"Failed to set role")}},f=async t=>{if(!y)return;const n=parseInt(prompt("Mute minutes","60")||"60",10),r=new Date(Date.now()+Math.max(1,n)*6e4).toISOString();try{await A(t,r),await o()}catch(b){alert((b==null?void 0:b.message)||"Failed to mute")}},c=async t=>{if(y)try{await E(t),await o()}catch(n){alert((n==null?void 0:n.message)||"Failed to unmute")}},h=async t=>{if(!u)return;const n=parseInt(prompt("Ban days","7")||"7",10),r=new Date(Date.now()+Math.max(1,n)*864e5).toISOString();try{await U(t,r),await o()}catch(b){alert((b==null?void 0:b.message)||"Failed to ban")}},a=async t=>{if(u)try{await P(t),await o()}catch(n){alert((n==null?void 0:n.message)||"Failed to unban")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Remote accounts fetched from the Worker API. Use this panel to adjust roles and moderation privileges."}),e.jsxs("div",{className:"grid gap-2",children:[l.map(t=>{const n=String(t.role||"user"),r=[];y&&(r.push(e.jsx("button",{className:"btn",onClick:()=>f(t.id),children:"Mute"},"mute")),r.push(e.jsx("button",{className:"btn",onClick:()=>c(t.id),children:"Unmute"},"unmute"))),u&&(r.push(e.jsx("button",{className:"btn",onClick:()=>h(t.id),children:"Ban"},"ban")),r.push(e.jsx("button",{className:"btn",onClick:()=>a(t.id),children:"Unban"},"unban")));const b=s==="developer"?t.invitedByName?`invited by: ${t.invitedByName}`:"":p&&t.invitedById&&t.invitedById===p?"invited by: you":"";return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",t.userNumber]}),e.jsx("div",{className:"font-semibold",children:t.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:t.email}),e.jsx("div",{className:"text-xs opacity-70",children:b}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[x?e.jsxs("select",{className:"input",value:t.role,onChange:N=>v(t.id,N.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}):e.jsx("span",{className:"rounded-full border px-2 py-1 text-xs uppercase tracking-wider",style:{borderColor:"var(--border)"},children:n}),r.length?r:null]})]},t.id)}),!l.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No users yet."})]})]})}function J(){const[s,p]=m.useState([]),[l,d]=m.useState(""),[o,x]=m.useState(""),u=m.useCallback(async()=>{try{p(await R())}catch(c){alert((c==null?void 0:c.message)||"Failed to load sections")}},[]);m.useEffect(()=>{u()},[u]);const y=async()=>{if(l.trim())try{await O({title:l.trim(),description:o.trim(),actorId:j()}),d(""),x(""),u()}catch(c){alert((c==null?void 0:c.message)||"Failed to create section")}},v=async(c,h,a)=>{try{await L(c,{[h]:a,actorId:j()}),u()}catch(t){alert((t==null?void 0:t.message)||"Failed to update section")}},f=async c=>{if(confirm("Delete this section?"))try{await W(c),u()}catch(h){alert((h==null?void 0:h.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Create section"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:l,onChange:c=>d(c.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:o,onChange:c=>x(c.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Sections"}),e.jsxs("div",{className:"grid gap-2",children:[s.map(c=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[c.id.slice(0,8),":"]}),e.jsx("input",{className:"input",value:c.title,onChange:h=>v(c.id,"title",h.target.value)}),e.jsx("input",{className:"input",value:c.description||"",onChange:h=>v(c.id,"description",h.target.value)}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>f(c.id),children:"Delete"})})]},c.id)),!s.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No sections yet."})]})]})]})}function Q({meRole:s}){const[p,l]=m.useState([]),d=m.useCallback(async()=>{try{l(await $())}catch(a){alert((a==null?void 0:a.message)||"Failed to load topics")}},[]);m.useEffect(()=>{d()},[d]);const o=s==="developer",x=s==="developer",u=s==="developer",y=s==="developer"||s==="admin",v=async(a,t)=>{if(o)try{await w(a,{pinned:t,actorId:j()}),d()}catch(n){alert((n==null?void 0:n.message)||"Failed to update topic")}},f=async(a,t)=>{if(x)try{await w(a,{locked:t,actorId:j()}),d()}catch(n){alert((n==null?void 0:n.message)||"Failed to update topic")}},c=async a=>{if(!u)return;const n=(prompt("Move to section ID","")||"").trim();if(n)try{await q(a,n),d()}catch(r){alert((r==null?void 0:r.message)||"Failed to move topic")}},h=async a=>{if(y&&confirm("Delete this topic?"))try{await z(a),d()}catch(t){alert((t==null?void 0:t.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Topics"}),e.jsxs("div",{className:"grid gap-2",children:[p.map(a=>{const t=[];return o&&t.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!a.pinned,onChange:n=>v(a.id,n.target.checked)}),"pinned"]},"pin")),x&&t.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!a.locked,onChange:n=>f(a.id,n.target.checked)}),"locked"]},"lock")),u&&t.push(e.jsx("button",{className:"btn",onClick:()=>c(a.id),children:"Move"},"move")),y&&t.push(e.jsx("button",{className:"btn",onClick:()=>h(a.id),children:"Delete"},"delete")),e.jsxs("div",{className:"grid grid-cols-1 items-start gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",a.id.slice(0,8),": section: ",a.sectionId.slice(0,8),":"]}),(a.pinned||a.locked)&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[10px] uppercase tracking-[0.2em] opacity-70",children:[a.pinned&&e.jsx("span",{children:"pinned"}),a.locked&&e.jsx("span",{children:"locked"})]})]}),t.length?e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:t}):null]},a.id)}),!p.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No topics yet."})]})]})}function H({meRole:s,meId:p}){const[l,d]=m.useState([]),[o,x]=m.useState(5),[u,y]=m.useState(""),v=s==="developer",f=m.useCallback(async()=>{try{const i=await I(),g=v?i:i.filter(k=>(k.createdBy||"")===(p||""));d(g)}catch(i){alert((i==null?void 0:i.message)||"Failed")}},[v,p]);m.useEffect(()=>{f()},[f]);const c=Date.now(),h=s==="admin"?48*3600*1e3:s==="moderator"?72*3600*1e3:0,a=h?c-h:0,t=l.filter(i=>{const g=new Date(i.createdAt).getTime();return!isNaN(g)&&g>=a}),r=Math.max(0,(s==="admin"?2:s==="moderator"?1:1/0)-t.length),b=async()=>{try{const i=Math.max(1,Math.min(20,o)),g=isFinite(r)?Math.min(r,i):i;if(!v&&g<=0){alert("Invite quota reached. Try again later.");return}await T(g,u||void 0),y(""),f()}catch(i){alert((i==null?void 0:i.message)||"Failed to generate")}},N=async i=>{if(confirm("Delete this invite?"))try{await _(i),f()}catch(g){alert((g==null?void 0:g.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Invite codes"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:Math.min(20,isFinite(r)?Math.max(r,0):20),value:o,onChange:i=>x(parseInt(i.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:u,onChange:i=>y(i.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:b,disabled:!v&&r<=0,title:!v&&r<=0?"Quota reached":void 0,children:"Generate"})]}),!v&&e.jsxs("div",{className:"mb-4 text-xs opacity-70",children:[s==="admin"&&e.jsxs("span",{children:["Remaining in 48h window: ",e.jsx("b",{children:r})," of 2"]}),s==="moderator"&&e.jsxs("span",{children:["Remaining in 72h window: ",e.jsx("b",{children:r})," of 1"]})]}),e.jsxs("div",{className:"grid gap-2",children:[l.map(i=>{var g;return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:i.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(i.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs opacity-80",children:v?`by: ${i.createdByName||((g=i.createdBy)==null?void 0:g.slice(0,8))}`:"by: you"}),e.jsx("div",{className:"text-xs",children:i.note||""}),e.jsx("div",{className:"text-xs",children:i.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>N(i.code),children:"Delete"})})]},`${i.code}-${i.createdAt}`)}),!l.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No invite codes yet."})]})]})}function K(){const[s,p]=m.useState("invite");m.useEffect(()=>{(async()=>{try{const d=await F();p((d==null?void 0:d.registrationMode)||"invite")}catch{}})()},[]);const l=()=>{confirm("Reset the forum (keep it empty)?")&&(B(j()),alert("Done. Forum was cleared."),location.reload())};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Registration settings"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Registration:"}),e.jsxs("select",{className:"input",value:s,onChange:async d=>{const o=d.target.value;p(o);try{await M({registrationMode:o})}catch(x){alert((x==null?void 0:x.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"Invite only"}),e.jsx("option",{value:"open",children:"Open"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Maintenance"}),e.jsx("p",{className:"mb-3 text-sm opacity-70",children:"Reset the forum when you need a clean slate before inviting the community."}),e.jsx("button",{className:"btn btn-primary",onClick:l,children:"Reset forum (empty)"})]})}export{te as default};
