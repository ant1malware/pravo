import{b as Q,e as $,j as u}from"./index-CAkmMo7n.js";import{R as a,L as h}from"./react-vendor-DTkXckhQ.js";import{listSections as O,listTopics as q,listPosts as E,deletePost as V,createTopic as G,createPost as H,updateTopic as v,updatePost as J}from"./forumRemote-D5s3MT8n.js";import{M as C}from"./MarkdownEditor-CxemOoec.js";import{R as K}from"./ReactionBar-CP1BdFnD.js";import{a5 as W,a6 as k,a7 as X,a8 as Y,L as Z}from"./icons-wEjUy8Cq.js";import"./purify.es-DnfDK_hS.js";function ae(){const[n,A]=a.useState(null),[o,S]=a.useState(null),[d,r]=a.useState([]),[f,B]=a.useState(null),[m,c]=a.useState({}),[x,j]=a.useState(""),[b,g]=a.useState(""),[p,y]=a.useState(null),F=e=>/\[\s*solved\s*\]/i.test(String(e||"")),[l,D]=a.useState({});a.useEffect(()=>{(async()=>{try{const e=await Q();A(e)}catch{}try{const t=(await O()).find(s=>(s.title||"").toLowerCase()==="questions"||(s.title||"").toLowerCase()==="\u0432\u043E\u043F\u0440\u043E\u0441\u044B");if(S(t||null),t){const s=await q(t.id);r(s)}}catch{}try{const e=await $(),t={};for(const s of e)t[s.id]=s.username;D(t)}catch{}})()},[]);async function P(e){if(B(f===e.id?null:e.id),!m[e.id])try{const t=await E(e.id);c(s=>({...s,[e.id]:t}))}catch{}}const w=n&&(n.role==="admin"||n.role==="moderator"||n.role==="developer");async function L(){if(!(!n||!o))try{const e=b+(p?`

![attachment](${p})`:""),t=await G({sectionId:o.id,title:x.trim(),content:e});r([t,...d]),j(""),g(""),y(null)}catch{}}function z(e){var i;const t=(i=e.target.files)==null?void 0:i[0];if(!t)return;const s=new FileReader;s.onload=()=>y(String(s.result||"")),s.readAsDataURL(t)}async function R(e,t){if(n&&t.trim())try{const s=await H({topicId:e,content:t.trim()});c(i=>({...i,[e]:[...i[e]||[],s]}))}catch{}}async function T(e){try{const t=await v(e.id,{locked:!e.locked});r(s=>s.map(i=>i.id===e.id?t:i))}catch{}}async function M(e){try{const t=await v(e.id,{pinned:!e.pinned});r(s=>s.map(i=>i.id===e.id?t:i))}catch{}}async function I(e,t){try{const s=await J(t.id,{pinned:!t.pinned});c(i=>({...i,[e]:(i[e]||[]).map(N=>N.id===t.id?s:N)}))}catch{}}function U(e){var s;return(m[e]||[]).some(i=>!!i.pinned)||F((s=d.find(i=>i.id===e))==null?void 0:s.title)}return u.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:u.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[u.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[u.jsx("h1",{className:"text-2xl font-extrabold",children:"\u0412\u043E\u043F\u0440\u043E\u0441\u044B"}),u.jsx(h,{to:"/forum",className:"btn",children:"\u041D\u0430\u0437\u0430\u0434"})]}),!o&&u.jsxs("div",{className:"card p-4 text-sm text-zinc-300",children:["\u0420\u0430\u0437\u0434\u0435\u043B ","<Questions>"," \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u0435\u043A\u0446\u0438\u044E ","<Questions>"," (\u0438\u043B\u0438 ","<\u0412\u043E\u043F\u0440\u043E\u0441\u044B>",") \u0438 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435."]}),n&&o&&u.jsxs("div",{className:"card p-4 mb-6",children:[u.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80 mb-2",children:"\u041D\u043E\u0432\u0430\u044F \u0442\u0435\u043C\u0430"}),u.jsx("input",{className:"input mb-2",placeholder:"\u041A\u043E\u0440\u043E\u0442\u043A\u0438\u0439 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",value:x,onChange:e=>j(e.target.value)}),u.jsx(C,{value:b,onChange:g,placeholder:"\u041E\u043F\u0438\u0448\u0438\u0442\u0435 \u0432\u043E\u043F\u0440\u043E\u0441 \u043F\u043E\u0434\u0440\u043E\u0431\u043D\u0435\u0435..."}),u.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[u.jsxs("label",{className:"btn inline-flex items-center gap-2",children:[u.jsx(W,{size:16})," \u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435",u.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:z})]}),p&&u.jsx("span",{className:"text-xs opacity-80",children:"\u0412\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E"}),u.jsx("button",{className:"btn btn-primary ml-auto",onClick:L,disabled:!x.trim(),children:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C"})]})]}),u.jsx("div",{className:"grid gap-3",children:d.map(e=>u.jsxs("div",{className:"card p-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("button",{className:"text-left font-semibold hover:underline",onClick:()=>P(e),children:[U(e.id)&&u.jsxs("span",{className:"mr-2 inline-flex items-center gap-1 rounded bg-emerald-500/15 px-2 py-0.5 text-xs text-emerald-300",children:[u.jsx(k,{size:14})," Solved"]}),e.title]}),u.jsx("div",{className:"ml-3 text-xs text-zinc-400/80",children:u.jsx(h,{className:"hover:underline",to:`/forum/profile/${l[e.authorId]||""}`,children:l[e.authorId]||"user"})}),w&&u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"btn",onClick:()=>M(e),title:e.pinned?"\u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C":"\u0417\u0430\u043A\u0440\u0435\u043F\u0438\u0442\u044C",children:u.jsx(X,{size:16})}),u.jsx("button",{className:"btn",onClick:()=>T(e),title:e.locked?"\u041E\u0442\u043A\u0440\u044B\u0442\u044C":"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",children:e.locked?u.jsx(Y,{size:16}):u.jsx(Z,{size:16})})]})]}),u.jsxs("div",{className:"mt-1 text-xs opacity-70",children:["Replies ",e.replyCount," \u2022 Views ",e.viewCount," \u2022 Updated ",new Date(e.updatedAt).toLocaleString()]}),f===e.id&&u.jsxs("div",{className:"mt-3 grid gap-3",children:[(m[e.id]||[]).slice().sort((t,s)=>(s.pinned?1:0)-(t.pinned?1:0)||new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime()).map(t=>u.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[t.pinned&&u.jsxs("span",{className:"mr-2 inline-flex items-center gap-1 rounded bg-emerald-500/15 px-2 py-0.5 text-xs text-emerald-300",children:[u.jsx(k,{size:14})," Best answer"]}),u.jsx("div",{className:"mb-1 text-xs text-zinc-400/80",children:u.jsx(h,{className:"hover:underline",to:`/forum/profile/${l[t.authorId]||""}`,children:l[t.authorId]||"user"})}),u.jsx("div",{className:"prose prose-invert max-w-none whitespace-pre-wrap",children:t.content}),u.jsx(K,{postId:t.id,currentUserId:n==null?void 0:n.id,onPostUpdated:async()=>{try{const s=await E(e.id);c(i=>({...i,[e.id]:s}))}catch{}}}),(w||n&&n.id===e.authorId)&&u.jsxs("div",{className:"mt-2 text-right",children:[u.jsx("button",{className:"btn text-xs",onClick:()=>I(e.id,t),style:{marginRight:8},children:t.pinned?"Unmark best answer":"Mark best answer"}),u.jsx("button",{className:"btn text-xs",onClick:async()=>{try{await V(t.id),c(s=>({...s,[e.id]:(s[e.id]||[]).filter(i=>i.id!==t.id)}))}catch{}},children:"Delete"})]})]},t.id)),!e.locked&&n&&u.jsx(C,{value:"",onChange:()=>{},onSubmit:t=>R(e.id,t),placeholder:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C...",submitLabel:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"}),e.locked&&u.jsx("div",{className:"text-xs opacity-70",children:"\u0422\u0435\u043C\u0430 \u0437\u0430\u043A\u0440\u044B\u0442\u0430."})]})]},e.id))})]})})}export{ae as default};
