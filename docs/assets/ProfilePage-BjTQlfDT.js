import{j as e}from"./index-BZZXN0EI.js";import{u as Ue,R as d}from"./react-vendor-DTkXckhQ.js";import{f as ge,g as we,u as Je,a as Ee}from"./forumStore-Cd2RV079.js";import{g as be,l as We,b as ve,u as de,s as Ge}from"./authRemote-D08Z_Jso.js";import{B as Ve,c as Ye}from"./Badge-CDN1o4i6.js";import{a0 as Ke,a1 as Xe,a2 as qe,a3 as je,a4 as ye,S as Ne,a5 as ke,a6 as He,a7 as $e,a8 as Qe,M as Ze,a9 as et,aa as Se}from"./icons-GyIOUIPt.js";const W="forum:",xe=`${W}follows`,ze=`${W}profile_comments:`,tt=`${W}social-change`,ae=new Map,st={getItem:s=>ae.has(s)?ae.get(s):null,setItem:(s,t)=>void ae.set(s,t),removeItem:s=>void ae.delete(s)},j=(()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}return st})(),Pe=typeof window<"u";function oe(){return new Date().toISOString()}function pe(s,t){try{return s?JSON.parse(s):t}catch{return t}}function _e(){try{const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():null;if(s)return s}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const t=Math.random()*16|0;return(s==="x"?t:t&3|8).toString(16)})}function N(s){if(Pe)try{window.dispatchEvent(new CustomEvent(tt,{detail:s}))}catch{}}Pe&&window.addEventListener("storage",s=>{s.key&&(s.key.startsWith(ze)||s.key===xe)&&N({key:s.key,type:"storage"})});function le(){return pe(j.getItem(xe),[])}function Fe(s){const t=new Set,n=[];for(const a of s){const r=`${a.followerId}=>${a.targetId}`;a.followerId!==a.targetId&&(t.has(r)||(t.add(r),n.push(a)))}try{j.setItem(xe,JSON.stringify(n))}catch{}N({scope:"follows"})}function at(){try{const t=new URL(window.location.href),n=t.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{t.searchParams.delete("api"),history.replaceState({},"",t.toString())}catch{}}const a=localStorage.getItem("forum:api_base");if(a)return a}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const Le=at();function Ie(){try{return localStorage.getItem("forum:token")??sessionStorage.getItem("forum:token")}catch{return null}}async function C(s,t={}){const n=Ie(),a={"Content-Type":"application/json",...t.headers||{}};n&&(a.Authorization=`Bearer ${n}`);const r=await fetch(`${Le}${s}`,{...t,headers:a}),i=await r.text();let c={};try{c=i?JSON.parse(i):{}}catch{c={error:i||r.statusText}}if(!r.ok)throw new Error((c==null?void 0:c.error)||`${r.status} ${r.statusText}`);return c}function y(){return!!Le&&!!Ie()}function ne(s){if(y())try{const t=window.__socialRemoteFollowersCache||(window.__socialRemoteFollowersCache=new Map),n=t.get(s);if(n)return n;C(`/social/followers/${encodeURIComponent(s)}`).then(a=>{try{t.set(s,Array.isArray(a.followers)?a.followers:[]),N({scope:"follows",targetId:s})}catch{}})}catch{}return le().filter(t=>t.targetId===s).map(t=>t.followerId)}function nt(s,t){if(!s)return!1;if(y())try{const n=window.__socialRemoteFollowingCache||(window.__socialRemoteFollowingCache=new Map),a=n.get(s);if(a)return a.includes(t);C(`/social/following/${encodeURIComponent(s)}`).then(r=>{try{n.set(s,Array.isArray(r.following)?r.following:[]),N({scope:"follows",followerId:s})}catch{}})}catch{}return le().some(n=>n.followerId===s&&n.targetId===t)}function rt(s,t){if(!s||!t||s===t)return;if(y())try{C("/social/follow",{method:"POST",body:JSON.stringify({targetId:t})})}catch{}const n=le();n.some(a=>a.followerId===s&&a.targetId===t)||(n.push({followerId:s,targetId:t,createdAt:oe()}),Fe(n))}function it(s,t){if(y())try{C("/social/unfollow",{method:"POST",body:JSON.stringify({targetId:t})})}catch{}const n=le().filter(a=>!(a.followerId===s&&a.targetId===t));Fe(n)}function Te(s){return`${ze}${s}`}function ue(s){return s.map(t=>({id:t.id??_e(),targetId:t.targetId,authorId:t.authorId,authorName:t.authorName,content:typeof t.content=="string"?t.content:"",createdAt:t.createdAt??oe(),parentId:t.parentId??null,updatedAt:t.updatedAt??null,edited:!!t.edited,deleted:!!t.deleted,deletedAt:t.deletedAt??null,deletedById:t.deletedById??null}))}function re(s){if(y())try{const a=window.__socialRemoteCommentsCache||(window.__socialRemoteCommentsCache=new Map),r=a.get(s);if(r)return r;C(`/profiles/${encodeURIComponent(s)}/comments`).then(i=>{try{const c=ue(Array.isArray(i.comments)?i.comments:[]);a.set(s,c),N({scope:"comments",targetId:s})}catch{}})}catch{}const t=j.getItem(Te(s)),n=pe(t,[]);return ue(n)}function De(s,t){try{j.setItem(Te(s),JSON.stringify(t))}catch{}N({scope:"comments",targetId:s})}const ot=1e4;function lt(s,t){const n=`${W}last_post:${s}:${t}`,a=Number(j.getItem(n)||"0"),r=Date.now()-a>=ot;if(r)try{j.setItem(n,String(Date.now()))}catch{}return r}const Ce=2e3;function E(s,t){const n=re(s),r=!1?n:n.filter(m=>!m.deleted);r.sort((m,p)=>m.createdAt<p.createdAt?1:-1);const i=Math.max(0,0);return r.slice(i,void 0)}function Oe(s,t,n,a){const r=(n??"").trim();if(!r)throw new Error("Comment is empty");if(r.length>Ce)throw new Error(`Comment too long (${r.length} > ${Ce})`);if(!y()&&!lt(s,t))throw new Error("You are posting too fast. Please wait a bit.");if(y())try{C(`/profiles/${encodeURIComponent(s)}/comments`,{method:"POST",body:JSON.stringify({content:r,parentId:(a==null?void 0:a.parentId)||null})}).then(m=>{try{const p=window.__socialRemoteCommentsCache;if(p){const b=p.get(s)||[],g=ue(Array.isArray(m.comment)?m.comment:[m.comment]);p.set(s,[...g,...b]),N({scope:"comments",targetId:s})}}catch{}}).catch(()=>{})}catch{}if(a!=null&&a.parentId&&!re(s).find(p=>p.id===a.parentId))throw new Error("Parent comment not found");const i={id:_e(),targetId:s,authorId:t,authorName:a==null?void 0:a.authorName,content:r,createdAt:oe(),parentId:(a==null?void 0:a.parentId)??null,updatedAt:null,edited:!1,deleted:!1,deletedAt:null,deletedById:null},c=re(s);return c.unshift(i),De(s,c),i}function ct(s,t,n,a,r){return Oe(s,t,a,{authorName:r,parentId:n})}function dt(s,t,n){if(y())try{C(`/profiles/${encodeURIComponent(s)}/comments/${encodeURIComponent(t)}`,{method:"DELETE"})}catch{}const a=re(s),r=a.findIndex(c=>c.id===t);if(r<0)return;const i=a[r];(i.authorId===n||s===n)&&(i.deleted||(a[r]={...i,content:"",deleted:!0,deletedAt:oe(),deletedById:n},De(s,a)))}function Be(s){return`${W}comment_reactions:${s}`}function fe(s){return pe(j.getItem(Be(s)),{})}function mt(s,t){try{j.setItem(Be(s),JSON.stringify(t))}catch{}N({scope:"reactions",targetId:s})}function ut(s){return fe(s)}function xt(s,t,n){var a,r;return(r=(a=fe(s)[t])==null?void 0:a.byUser)==null?void 0:r[n]}function pt(s,t,n,a){const r=fe(s),i=r[t]||{counts:{like:0,smile:0,useful:0},byUser:{}},c=i.byUser[n];return c===a?(i.byUser[n]=void 0,i.counts[a]=Math.max(0,(i.counts[a]||0)-1)):(c&&(i.counts[c]=Math.max(0,(i.counts[c]||0)-1)),i.byUser[n]=a,i.counts[a]=(i.counts[a]||0)+1),r[t]=i,mt(s,r),i}const Ae={developer:{label:"Developer",color:"#22d3ee",glow:"from-cyan-400/35"},admin:{label:"Admin",color:"#ef4444",glow:"from-rose-400/35"},moderator:{label:"Moderator",color:"#8b5cf6",glow:"from-violet-400/35"},vip:{label:"VIP",color:"#eab308",glow:"from-amber-400/35"},user:{label:"User",color:"#94a3b8",glow:"from-slate-300/30"},newbie:{label:"Newbie",color:"#22d3ee",glow:"from-cyan-400/35"}},ie={owner:{label:"Owner",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:ke},developer:{label:"Developer",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ye},admin:{label:"Admin",grad:"from-rose-400 via-amber-400 to-rose-400",Icon:Ne},moderator:{label:"Moderator",grad:"from-violet-400 via-sky-400 to-violet-400",Icon:He},vip:{label:"VIP",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:ke},user:{label:"User",grad:"from-slate-300 via-slate-400 to-slate-300",Icon:Ne},newbie:{label:"Newbie",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ye}};function me({value:s,label:t}){return e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-extrabold text-white",children:s}),e.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:t})]})}function J({title:s,children:t,right:n}){return e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/70",children:s}),n]}),t]})}function Re({role:s}){const t=ie[s]??ie.user,n=t.Icon;return e.jsxs("span",{className:"relative inline-flex",children:[e.jsx("span",{className:`absolute -inset-[2px] rounded-full blur-md bg-gradient-to-r ${t.grad} opacity-50`}),e.jsxs("span",{className:"relative inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3.5 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.22em] text-white shadow-[0_0_0_1px_rgba(255,255,255,0.06)_inset]",children:[e.jsx(n,{size:14,className:"opacity-90"}),t.label]})]})}function ft({role:s}){const t=ie[s]??ie.user;return e.jsx("span",{className:"rounded-full border border-white/15 bg-black/50 px-2 py-0.5 text-[10px] font-bold uppercase tracking-[0.18em] text-white backdrop-blur",style:{boxShadow:"0 0 16px rgba(255,255,255,0.08), inset 0 0 0 1px rgba(255,255,255,0.05)"},children:t.label})}const ht={Founder:"from-rose-500/25 to-rose-400/10 text-rose-200",Early:"from-sky-500/25 to-sky-400/10 text-sky-200",Contributor:"from-emerald-500/25 to-emerald-400/10 text-emerald-200",VIP:"from-amber-500/25 to-amber-400/10 text-amber-200",Designer:"from-violet-500/25 to-violet-400/10 text-violet-200"};function gt({badges:s}){return!s||s.length===0?null:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:s.slice(0,3).map(t=>{const n=ht[t]||"from-white/20 to-white/5 text-zinc-200";return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border border-white/10 bg-gradient-to-br ${n} px-2.5 py-1 text-xs`,title:`Badge: ${t}`,children:[e.jsx($e,{size:14,className:"opacity-90"})," ",t]},t)})})}function zt(){var K,P,X,_,q,F,H,L,Q,I,Z,T,ee,te,D,se,O,B,M,U;const{username:s=""}=Ue(),[t,n]=d.useState(null),[a,r]=d.useState(null),[i,c]=d.useState(!1),[m,p]=d.useState(!1),[b,g]=d.useState({});d.useEffect(()=>{(async()=>{var u;try{const f=await be();if(f){c(!0),r({id:f.id,username:f.username});try{const l=await We(),w={};for(const S of l)w[S.id]=S.username;g(w)}catch{}const x=await ve(s);if(x){const l={id:x.user.id,username:x.user.username,email:x.user.email,createdAt:x.user.createdAt,role:x.user.role,userNumber:x.user.userNumber,posts:0,likes:0,topics:0,profile:x.profile||{bio:"",signature:"",links:{},accentFrom:"#8b5cf6",accentTo:"#0ea5e9",badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0}},bans:null,mutes:null};n(l);try{p(!!((u=x.user)!=null&&u.owner))}catch{}return}}}catch{}c(!1),n(ge(s)||null);const o=we();r(o?{id:o.id,username:o.username}:null)})()},[s]),d.useEffect(()=>{const o=async()=>{try{const f=await be();if(f){r({id:f.id,username:f.username});return}}catch{}const u=we();r(u?{id:u.id,username:u.username}:null)};return window.addEventListener("forum:session",o),window.addEventListener("storage",o),()=>{window.removeEventListener("forum:session",o),window.removeEventListener("storage",o)}},[]);const h=(t==null?void 0:t.id)||"",[k,A]=d.useState(()=>h?ne(h):[]),[$,v]=d.useState(()=>h?E(h):[]),R=d.useMemo(()=>nt((a==null?void 0:a.id)||null,h),[a==null?void 0:a.id,h,k.length]);if(d.useEffect(()=>{if(!h){A([]),v([]);return}A(ne(h)),v(E(h))},[h]),d.useEffect(()=>{const o=()=>{h&&(A(ne(h)),v(E(h)))};return window.addEventListener("forum:social-change",o),()=>window.removeEventListener("forum:social-change",o)},[h]),!t)return e.jsx("main",{className:"min-h-screen bg-slate-950 text-slate-200",children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-12",children:e.jsx("div",{className:"card p-6 text-center text-sm text-zinc-300",children:"Profile not found."})})});const G=(a==null?void 0:a.id)===t.id,z=t.profile.accentFrom||"#22d3ee",V=t.profile.accentTo||"#8b5cf6",Y=Ae[t.role]||Ae.user;return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 20% -10%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1100px 760px at 95% 8%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-[200px] w-full",style:{background:t.profile.bannerData?`url(${t.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${z}, ${V})`}}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/15 via-transparent to-black/50"}),e.jsx("div",{className:"pointer-events-none absolute inset-0",children:e.jsx("div",{className:"absolute right-8 top-6 h-24 w-24 rounded-full bg-gradient-to-br from-white/15 to-transparent blur-2xl"})})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 px-4 pb-5 -mt-16",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-full ring-4 ring-[rgba(13,19,33,0.85)] shadow-2xl",style:{background:t.profile.avatarData?`url(${t.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${z}, ${V})`}}),e.jsx("div",{className:`absolute -inset-1 -z-10 rounded-full bg-gradient-to-br ${Y.glow} to-transparent blur-lg`}),e.jsx("div",{className:"absolute -bottom-2 left-1",children:e.jsx(ft,{role:t.role})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-white",children:t.username}),e.jsxs("span",{className:"text-xs text-zinc-400/80",children:["#",t.userNumber]}),e.jsx(Ve,{points:t.score??Ye({posts:t.posts,likes:t.likes,topics:t.topics})})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[m&&e.jsx(Re,{role:"owner"}),((P=(K=t.profile)==null?void 0:K.privacy)==null?void 0:P.showSecondaryRole)!==!1&&e.jsx(Re,{role:t.role})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-xs text-zinc-400/90",children:[e.jsxs("span",{children:["Joined ",new Date(t.createdAt).toLocaleDateString()]}),(X=t.profile.privacy)!=null&&X.showEmail&&t.email?e.jsx("span",{className:"rounded-full bg-white/[0.04] px-2 py-1",children:t.email}):null]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(gt,{badges:t.profile.badges}),Array.isArray((_=t.profile)==null?void 0:_.labels)&&t.profile.labels.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.profile.labels.slice(0,7).map((o,u)=>e.jsx("span",{className:"rounded-full border border-white/10 bg-white/5 px-2.5 py-1 text-xs",children:o},u))})]})]}),G?e.jsx(wt,{user:t,onUpdated:async()=>{if(i){const o=await ve(s);o&&n({id:o.user.id,username:o.user.username,email:o.user.email,createdAt:o.user.createdAt,role:o.user.role,userNumber:o.user.userNumber,posts:0,likes:0,topics:0,profile:o.profile,bans:null,mutes:null})}else n(ge(s)||null)},saveProfile:async o=>{i?await de(o):Je(t.id,o)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:`btn ${R?"":"btn-primary"}`,onClick:()=>{a!=null&&a.id&&(R?it(a.id,t.id):rt(a.id,t.id),A(ne(t.id)))},children:R?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:16})," Unfollow"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16})," Follow"]})})})]})]}),i&&G&&m&&e.jsxs("div",{className:"card mt-4 p-4",children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Secondary Role"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"input",value:((F=(q=t.profile)==null?void 0:q.privacy)==null?void 0:F.showSecondaryRole)===!1?"none":t.role,onChange:async o=>{var f;const u=o.target.value;try{const x=((f=t.profile)==null?void 0:f.privacy)||{showEmail:!1,showStats:!0};u==="none"?(await de({privacy:{...x,showSecondaryRole:!1}}),n({...t,profile:{...t.profile,privacy:{...x,showSecondaryRole:!1}}})):(await Ge(t.id,u),await de({privacy:{...x,showSecondaryRole:!0}}),n({...t,role:u,profile:{...t.profile,privacy:{...x,showSecondaryRole:!0}}}))}catch(x){alert((x==null?void 0:x.message)||"Failed to change role")}},children:[e.jsx("option",{value:"none",children:"none"}),e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Owner is permanent; this is your secondary role."})]})]}),((L=(H=t.profile)==null?void 0:H.privacy)==null?void 0:L.showStats)!==!1&&e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(me,{value:t.posts,label:"Posts"})}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(me,{value:t.topics,label:"Topics"})}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(me,{value:t.likes,label:"Likes"})})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsx(J,{title:"About",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:t.profile.bio||"No bio yet."})}),((I=(Q=t.profile)==null?void 0:Q.privacy)==null?void 0:I.showLinks)!==!1&&e.jsx(J,{title:"Links",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:[((Z=t.profile.links)==null?void 0:Z.website)&&e.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/[0.04] px-3 py-1 hover:bg-white/[0.08]",href:t.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(qe,{size:14})," Website"]}),((T=t.profile.links)==null?void 0:T.discord)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/[0.04] px-3 py-1",children:[e.jsx(je,{size:14})," ",t.profile.links.discord]}),((ee=t.profile.links)==null?void 0:ee.telegram)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/[0.04] px-3 py-1",children:[e.jsx(je,{size:14})," ",t.profile.links.telegram]}),!((te=t.profile.links)!=null&&te.website)&&!((D=t.profile.links)!=null&&D.discord)&&!((se=t.profile.links)!=null&&se.telegram)&&e.jsx("span",{className:"opacity-70",children:"No links added."})]})})]}),e.jsx(J,{title:"Signature",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:t.profile.signature||"No signature."})}),((B=(O=t.profile)==null?void 0:O.privacy)==null?void 0:B.showFollowers)!==!1&&e.jsx(J,{title:`Followers (${k.length})`,children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:k.length===0?e.jsx("span",{className:"opacity-70",children:"No followers yet."}):k.slice(0,18).map(o=>{const u=Ee(o),f=(u==null?void 0:u.username)||b[o];return e.jsx("span",{className:"rounded-full border border-white/10 bg-white/[0.04] px-3 py-1",children:f?e.jsx("a",{href:`/forum/profile/${f}`,className:"hover:underline",children:f}):"User"},o)})})}),((U=(M=t.profile)==null?void 0:M.privacy)==null?void 0:U.allowComments)!==!1&&e.jsx(J,{title:"Profile comments",children:e.jsxs("div",{className:"grid gap-3",children:[(a==null?void 0:a.id)&&e.jsx(jt,{onPost:o=>{a!=null&&a.id&&(Oe(t.id,a.id,o,{authorName:a.username}),v(E(t.id)))}}),e.jsxs("div",{className:"grid gap-2",children:[$.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"No comments yet."}),yt($).map(o=>e.jsx(Me,{node:o,currentUserId:(a==null?void 0:a.id)||"",ownerId:t.id,onReply:(u,f)=>{a!=null&&a.id&&(ct(t.id,a.id,u,f,a.username),v(E(t.id)))},onDelete:u=>{a!=null&&a.id&&(dt(t.id,u,a.id),v(E(t.id)))}},o.comment.id))]})]})})]})})}function wt({user:s,onUpdated:t,saveProfile:n}){const[a,r]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>r(!0),children:[e.jsx(Qe,{size:16})," Settings"]}),a&&e.jsx(vt,{user:s,onClose:()=>r(!1),onSaved:()=>{t(),r(!1)},saveProfile:n})]})}const bt=["Founder","Early","Contributor","VIP","Designer"];function vt({user:s,onClose:t,onSaved:n,saveProfile:a}){var O,B,M,U,o,u,f,x;const[r,i]=d.useState(s.profile.avatarData||""),[c,m]=d.useState(s.profile.bannerData||""),[p,b]=d.useState(s.profile.accentFrom||"#22d3ee"),[g,h]=d.useState(s.profile.accentTo||"#8b5cf6"),[k,A]=d.useState(s.profile.bio||""),[$,v]=d.useState(s.profile.signature||""),[R,G]=d.useState(((O=s.profile.links)==null?void 0:O.website)||""),[z,V]=d.useState(((B=s.profile.links)==null?void 0:B.discord)||""),[Y,K]=d.useState(((M=s.profile.links)==null?void 0:M.telegram)||""),[P,X]=d.useState(s.profile.badges||[]),[_,q]=d.useState(((U=s.profile.privacy)==null?void 0:U.showEmail)??!1),[F,H]=d.useState(((o=s.profile.privacy)==null?void 0:o.showStats)??!0),[L,Q]=d.useState(((u=s.profile.privacy)==null?void 0:u.showLinks)??!0),[I,Z]=d.useState(((f=s.profile.privacy)==null?void 0:f.allowComments)??!0),[T,ee]=d.useState(((x=s.profile.privacy)==null?void 0:x.showFollowers)??!0),te=l=>{X(w=>w.includes(l)?w.filter(S=>S!==l):w.length>=3?w:[...w,l])},D=l=>w=>{var he;const S=(he=w.target.files)==null?void 0:he[0];if(!S)return;const ce=new FileReader;ce.onload=()=>l(String(ce.result||"")),ce.readAsDataURL(S)},se=async()=>{await a({avatarData:r||void 0,bannerData:c||void 0,accentFrom:p,accentTo:g,bio:k.trim()||void 0,signature:$.trim()||void 0,links:{website:R.trim()||void 0,discord:z.trim()||void 0,telegram:Y.trim()||void 0},badges:P,privacy:{showEmail:_,showStats:F,showLinks:L,allowComments:I,showFollowers:T}}),n()};return e.jsx("div",{className:"fixed inset-0 z-[120] grid place-items-center bg-black/70 px-4 py-6",children:e.jsxs("div",{className:"card w-[min(780px,96vw)] max-h-[90vh] overflow-y-auto p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Customize profile"}),e.jsx("button",{className:"btn",onClick:t,children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Avatar"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:r?`url(${r}) center/cover`:`linear-gradient(135deg, ${p}, ${g})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(Se,{size:16})," Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:D(i)})]}),r&&e.jsx("button",{className:"btn",onClick:()=>i(""),children:"Remove"})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Banner"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:c?`url(${c}) center/cover`:`linear-gradient(135deg, ${p}, ${g})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(Se,{size:16})," Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:D(m)})]}),c&&e.jsx("button",{className:"btn",onClick:()=>m(""),children:"Remove"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Accent"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"From"}),e.jsx("input",{type:"color",value:p,onChange:l=>b(l.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"To"}),e.jsx("input",{type:"color",value:g,onChange:l=>h(l.target.value)})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Badges (max 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:bt.map(l=>{const w=P.includes(l);return e.jsxs("button",{className:`btn flex items-center gap-2 ${w?"btn-primary":""}`,onClick:()=>te(l),type:"button",title:w?"Click to remove":"Click to add",children:[e.jsx($e,{size:16})," ",l]},l)})})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Bio"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:k,onChange:l=>A(l.target.value),placeholder:"Tell the community a bit about yourself"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Signature"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:$,onChange:l=>v(l.target.value),placeholder:"Signature displayed under your posts"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Links"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:R,onChange:l=>G(l.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:z,onChange:l=>V(l.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:Y,onChange:l=>K(l.target.value)})]})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Privacy"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:l=>q(l.target.checked)})," Show email"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:l=>H(l.target.checked)})," Show stats"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:l=>Q(l.target.checked)})," Show links"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:l=>ee(l.target.checked)})," Show followers"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:l=>Z(l.target.checked)})," Allow comments"]})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:se,children:"Save changes"})]})]})})}function jt({onPost:s}){const[t,n]=d.useState("");return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ze,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Write a comment...",value:t,onChange:a=>n(a.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=t.trim();a&&(s(a),n(""))},children:"Post comment"})})]})}function yt(s){const t={};s.forEach(r=>{t[r.id]={comment:r,replies:[]}});const n=[];s.forEach(r=>{const i=r.parentId||"";i&&t[i]?t[i].replies.push(t[r.id]):n.push(t[r.id])}),n.sort((r,i)=>r.comment.createdAt<i.comment.createdAt?1:-1);const a=r=>r.replies.sort((i,c)=>i.comment.createdAt>c.comment.createdAt?1:-1).forEach(a);return n.forEach(a),n}function Me({node:s,currentUserId:t,ownerId:n,onReply:a,onDelete:r}){const[i,c]=d.useState(!1),m=Ee(s.comment.authorId),p=s.comment.authorName||(m==null?void 0:m.username)||(s.comment.authorId===n?"Owner":s.comment.authorId===t?"You":"User"),b=(m==null?void 0:m.username)||s.comment.authorName;return e.jsx("div",{className:"rounded-xl border border-white/5 bg-white/3 p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-zinc-300/90",children:[b?e.jsx("a",{href:`/forum/profile/${b}`,className:"font-semibold text-white hover:underline",children:p}):e.jsx("span",{className:"font-semibold text-white",children:p}),e.jsxs("span",{className:"opacity-70",children:[" В· ",new Date(s.comment.createdAt).toLocaleString()]})]}),(t===s.comment.authorId||t===n)&&e.jsx("button",{className:"btn",title:"Delete",onClick:()=>r(s.comment.id),children:e.jsx(et,{size:14})})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:s.comment.content}),e.jsx(kt,{targetId:n,commentId:s.comment.id,currentUserId:t}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>c(g=>!g),children:"Reply"})}),i&&e.jsx("div",{className:"mt-2",children:e.jsx(Nt,{onSend:g=>{a(s.comment.id,g),c(!1)}})}),s.replies.length>0&&e.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:s.replies.map(g=>e.jsx(Me,{node:g,currentUserId:t,ownerId:n,onReply:a,onDelete:r},g.comment.id))})]})]})})}function Nt({onSend:s}){const[t,n]=d.useState("");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"Write a reply...",value:t,onChange:a=>n(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=t.trim();a&&(s(a),n(""))},children:"Send"})]})}function kt({targetId:s,commentId:t,currentUserId:n}){const[,a]=d.useReducer(m=>m+1,0),r=ut(s)[t]||{counts:{like:0,smile:0,useful:0}},i=n?xt(s,t,n):void 0,c=({r:m,label:p})=>{var b;return e.jsxs("button",{className:`btn text-xs ${i===m?"btn-primary":""}`,onClick:()=>{n&&(pt(s,t,n,m),a())},children:[p," ",(b=r.counts)!=null&&b[m]?e.jsx("span",{className:"opacity-80",children:r.counts[m]}):null]})};return e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx(c,{r:"like",label:"рџ‘Ќ"}),e.jsx(c,{r:"smile",label:"рџЉ"}),e.jsx(c,{r:"useful",label:"вњ…"})]})}export{zt as default};
