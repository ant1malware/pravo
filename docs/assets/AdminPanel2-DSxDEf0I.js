import{j as e}from"./index-DTcNca15.js";import{R as l}from"./react-vendor-DTkXckhQ.js";import{r as b}from"./forumStore-BzuuLjfA.js";import{g as f,d as N,l as w,e as k,f as C,h as S,u as I,s as F,i as M,j as D,k as _,m as y,n as T,o as R,p as A,q as B,t as E,v as U,w as O,x as $}from"./forumRemote-CGBiGn5K.js";import"./icons-DET5c9ig.js";function j(){try{const n=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),m=n?JSON.parse(n):null;return(m==null?void 0:m.userId)||"unknown"}catch{return"unknown"}}function V(){const[n,m]=l.useState("users"),[p,r]=l.useState(null);l.useEffect(()=>{(async()=>{try{r(await f())}catch{r(null)}})()},[]);const d=p==null?void 0:p.role,u=d==="developer"?["users","sections","topics","invites","maintenance"]:d==="admin"?["users","topics"]:d==="moderator"?["users"]:["topics"];return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:u.map(o=>e.jsx("button",{className:`btn ${n===o?"btn-primary":""}`,onClick:()=>m(o),children:o},o))}),n==="users"&&e.jsx(L,{meRole:d}),n==="sections"&&e.jsx(P,{}),n==="topics"&&e.jsx(q,{meRole:d}),n==="invites"&&e.jsx(G,{}),n==="maintenance"&&e.jsx(J,{})]})}function L({meRole:n}){const[m,p]=l.useState([]),r=l.useCallback(async()=>{try{p(await N())}catch(t){alert((t==null?void 0:t.message)||"Failed to load users")}},[]);l.useEffect(()=>{r()},[r]);const d=n==="developer",u=n==="developer"||n==="admin",o=n==="developer"||n==="admin"||n==="moderator",v=async(t,s)=>{if(d)try{await F(t,s),r()}catch(c){alert((c==null?void 0:c.message)||"Failed to set role")}},g=async t=>{if(!o)return;const s=parseInt(prompt("Mute minutes","60")||"60",10),c=new Date(Date.now()+Math.max(1,s)*6e4).toISOString();try{await E(t,c),await r()}catch(h){alert((h==null?void 0:h.message)||"Failed to mute")}},i=async t=>{if(o)try{await U(t),await r()}catch(s){alert((s==null?void 0:s.message)||"Failed to unmute")}},a=async t=>{if(!u)return;const s=parseInt(prompt("Ban days","7")||"7",10),c=new Date(Date.now()+Math.max(1,s)*864e5).toISOString();try{await O(t,c),await r()}catch(h){alert((h==null?void 0:h.message)||"Failed to ban")}},x=async t=>{if(u)try{await $(t),await r()}catch(s){alert((s==null?void 0:s.message)||"Failed to unban")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Remote accounts fetched from the Worker API. Use this panel to adjust roles and moderation privileges."}),e.jsxs("div",{className:"grid gap-2",children:[m.map(t=>{const s=String(t.role||"user"),c=[];return o&&(c.push(e.jsx("button",{className:"btn",onClick:()=>g(t.id),children:"Mute"},"mute")),c.push(e.jsx("button",{className:"btn",onClick:()=>i(t.id),children:"Unmute"},"unmute"))),u&&(c.push(e.jsx("button",{className:"btn",onClick:()=>a(t.id),children:"Ban"},"ban")),c.push(e.jsx("button",{className:"btn",onClick:()=>x(t.id),children:"Unban"},"unban"))),e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",t.userNumber]}),e.jsx("div",{className:"font-semibold",children:t.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:t.email}),e.jsx("div",{className:"text-xs opacity-70",children:t.invitedByName?`invited by: ${t.invitedByName}`:""}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[d?e.jsxs("select",{className:"input",value:t.role,onChange:h=>v(t.id,h.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}):e.jsx("span",{className:"rounded-full border px-2 py-1 text-xs uppercase tracking-wider",style:{borderColor:"var(--border)"},children:s}),c.length?c:null]})]},t.id)}),!m.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No users yet."})]})]})}function P(){const[n,m]=l.useState([]),[p,r]=l.useState(""),[d,u]=l.useState(""),o=l.useCallback(async()=>{try{m(await w())}catch(a){alert((a==null?void 0:a.message)||"Failed to load sections")}},[]);l.useEffect(()=>{o()},[o]);const v=async()=>{if(p.trim())try{await M({title:p.trim(),description:d.trim(),actorId:j()}),r(""),u(""),o()}catch(a){alert((a==null?void 0:a.message)||"Failed to create section")}},g=async(a,x,t)=>{try{await D(a,{[x]:t,actorId:j()}),o()}catch(s){alert((s==null?void 0:s.message)||"Failed to update section")}},i=async a=>{if(confirm("Delete this section?"))try{await _(a),o()}catch(x){alert((x==null?void 0:x.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Create section"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:p,onChange:a=>r(a.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:d,onChange:a=>u(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:v,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Sections"}),e.jsxs("div",{className:"grid gap-2",children:[n.map(a=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[a.id.slice(0,8),"�"]}),e.jsx("input",{className:"input",value:a.title,onChange:x=>g(a.id,"title",x.target.value)}),e.jsx("input",{className:"input",value:a.description||"",onChange:x=>g(a.id,"description",x.target.value)}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>i(a.id),children:"Delete"})})]},a.id)),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No sections yet."})]})]})]})}function q({meRole:n}){const[m,p]=l.useState([]),r=l.useCallback(async()=>{try{p(await k())}catch(t){alert((t==null?void 0:t.message)||"Failed to load topics")}},[]);l.useEffect(()=>{r()},[r]);const d=n==="developer",u=n==="developer",o=n==="developer",v=n==="developer"||n==="admin",g=async(t,s)=>{if(d)try{await y(t,{pinned:s,actorId:j()}),r()}catch(c){alert((c==null?void 0:c.message)||"Failed to update topic")}},i=async(t,s)=>{if(u)try{await y(t,{locked:s,actorId:j()}),r()}catch(c){alert((c==null?void 0:c.message)||"Failed to update topic")}},a=async t=>{if(!o)return;const c=(prompt("Move to section ID","")||"").trim();if(c)try{await T(t,c),r()}catch(h){alert((h==null?void 0:h.message)||"Failed to move topic")}},x=async t=>{if(v&&confirm("Delete this topic?"))try{await R(t),r()}catch(s){alert((s==null?void 0:s.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Topics"}),e.jsxs("div",{className:"grid gap-2",children:[m.map(t=>{const s=[];return d&&s.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.pinned,onChange:c=>g(t.id,c.target.checked)}),"pinned"]},"pin")),u&&s.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.locked,onChange:c=>i(t.id,c.target.checked)}),"locked"]},"lock")),o&&s.push(e.jsx("button",{className:"btn",onClick:()=>a(t.id),children:"Move"},"move")),v&&s.push(e.jsx("button",{className:"btn",onClick:()=>x(t.id),children:"Delete"},"delete")),e.jsxs("div",{className:"grid grid-cols-1 items-start gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",t.id.slice(0,8),"� section: ",t.sectionId.slice(0,8),"�"]}),(t.pinned||t.locked)&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[10px] uppercase tracking-[0.2em] opacity-70",children:[t.pinned&&e.jsx("span",{children:"pinned"}),t.locked&&e.jsx("span",{children:"locked"})]})]}),s.length?e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:s}):null]},t.id)}),!m.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No topics yet."})]})]})}function G(){const[n,m]=l.useState([]),[p,r]=l.useState(5),[d,u]=l.useState(""),o=l.useCallback(async()=>{try{m(await C())}catch(i){alert((i==null?void 0:i.message)||"Failed")}},[]);l.useEffect(()=>{o()},[o]);const v=async()=>{try{await A(Math.max(1,Math.min(20,p)),d||void 0),u(""),o()}catch(i){alert((i==null?void 0:i.message)||"Failed to generate")}},g=async i=>{if(confirm("Delete this invite?"))try{await B(i),o()}catch(a){alert((a==null?void 0:a.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Invite codes"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:20,value:p,onChange:i=>r(parseInt(i.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:d,onChange:i=>u(i.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:v,children:"Generate"})]}),e.jsxs("div",{className:"grid gap-2",children:[n.map(i=>{var a;return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:i.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(i.createdAt).toLocaleString()]}),e.jsxs("div",{className:"text-xs opacity-80",children:["by: ",i.createdByName||((a=i.createdBy)==null?void 0:a.slice(0,8))]}),e.jsx("div",{className:"text-xs",children:i.note||""}),e.jsx("div",{className:"text-xs",children:i.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>g(i.code),children:"Delete"})})]},`${i.code}-${i.createdAt}`)}),!n.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No invite codes yet."})]})]})}function J(){const[n,m]=l.useState("invite");l.useEffect(()=>{(async()=>{try{const r=await S();m((r==null?void 0:r.registrationMode)||"invite")}catch{}})()},[]);const p=()=>{confirm("Reset the forum (keep it empty)?")&&(b(j()),alert("Done. Forum was cleared."),location.reload())};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Registration settings"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Registration:"}),e.jsxs("select",{className:"input",value:n,onChange:async r=>{const d=r.target.value;m(d);try{await I({registrationMode:d})}catch(u){alert((u==null?void 0:u.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"Invite only"}),e.jsx("option",{value:"open",children:"Open"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Maintenance"}),e.jsx("p",{className:"mb-3 text-sm opacity-70",children:"Reset the forum when you need a clean slate before inviting the community."}),e.jsx("button",{className:"btn btn-primary",onClick:p,children:"Reset forum (empty)"})]})}export{V as default};
