import{j as e}from"./index-BEQq80bb.js";import{u as he,R as n}from"./react-vendor-DTkXckhQ.js";import{g as te,e as ae,f as le,a as ie,u as fe,h as ge,j as re}from"./authRemote-BuUPoimz.js";import{a0 as je,a1 as ve,a2 as Ne,a3 as ne,a4 as be,a5 as we,M as ke,a6 as ce,a7 as ye}from"./icons-CG-tEzXH.js";const oe="forum:follows";function O(){try{return JSON.parse(localStorage.getItem(oe)||"[]")}catch{return[]}}function de(t){try{localStorage.setItem(oe,JSON.stringify(t))}catch{}}function J(t){return O().filter(s=>s.targetId===t).map(s=>s.followerId)}function Se(t,s){return t?O().some(r=>r.followerId===t&&r.targetId===s):!1}function Ce(t,s){if(t===s)return;const r=O();r.some(a=>a.followerId===t&&a.targetId===s)||(r.push({followerId:t,targetId:s,createdAt:new Date().toISOString()}),de(r))}function ze(t,s){const r=O().filter(a=>!(a.followerId===t&&a.targetId===s));de(r)}function me(t){return`forum:profile_comments:${t}`}function G(t){try{return JSON.parse(localStorage.getItem(me(t))||"[]")}catch{return[]}}function xe(t,s){try{localStorage.setItem(me(t),JSON.stringify(s))}catch{}}function U(t){return G(t).sort((s,r)=>s.createdAt<r.createdAt?1:-1)}function Fe(t,s,r){const a=r.trim(),c={id:crypto.randomUUID(),targetId:t,authorId:s,content:a,createdAt:new Date().toISOString()},x=G(t);return x.unshift(c),xe(t,x),c}function Ae(t,s,r){const c=G(t).filter(x=>!(x.id===s&&(x.authorId===r||t===r)));xe(t,c)}const Le={developer:{label:"Developer",color:"#22d3ee"},admin:{label:"Admin",color:"#ef4444"},moderator:{label:"Moderator",color:"#8b5cf6"},vip:{label:"VIP",color:"#eab308"},user:{label:"User",color:"#94a3b8"},newbie:{label:"Newbie",color:"#22d3ee"}},De=["Founder","Early","Contributor","VIP","Designer"];function Pe({role:t}){const s=Le[t]||{label:t,color:"#94a3b8"};return e.jsx("span",{className:"rounded-full border border-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.26em]",style:{color:s.color},children:s.label})}function W({value:t,label:s}){return e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-extrabold text-white",children:t}),e.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:s})]})}function F({title:t,children:s}){return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.28em] text-zinc-400/70",children:t}),s]})}function Re(){var b,L,w,D,k,P,y,E,S,$,C,T,z,B;const{username:t=""}=he(),[s,r]=n.useState(null),[a,c]=n.useState(null),[x,h]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const o=await te();if(o){h(!0),c({id:o.id,username:o.username});const d=await ae(t);if(d){const M={id:d.user.id,username:d.user.username,email:d.user.email,createdAt:d.user.createdAt,role:d.user.role,userNumber:d.user.userNumber,posts:0,likes:0,topics:0,profile:d.profile||{bio:"",signature:"",links:{},accentFrom:"#8b5cf6",accentTo:"#0ea5e9",badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0}},bans:null,mutes:null};r(M);return}}}catch{}h(!1),r(le(t)||null);const l=ie();c(l?{id:l.id,username:l.username}:null)})()},[t]),n.useEffect(()=>{const l=async()=>{try{const d=await te();if(d){c({id:d.id,username:d.username});return}}catch{}const o=ie();c(o?{id:o.id,username:o.username}:null)};return window.addEventListener("forum:session",l),window.addEventListener("storage",l),()=>{window.removeEventListener("forum:session",l),window.removeEventListener("storage",l)}},[]);const m=(s==null?void 0:s.id)||"",[u,v]=n.useState(()=>m?J(m):[]),[f,g]=n.useState(()=>m?U(m):[]),j=n.useMemo(()=>Se((a==null?void 0:a.id)||null,m),[a==null?void 0:a.id,m,u.length]);if(n.useEffect(()=>{if(!m){v([]),g([]);return}v(J(m)),g(U(m))},[m]),!s)return e.jsx("main",{className:"min-h-screen bg-slate-950 text-slate-200",children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-12",children:e.jsx("div",{className:"card p-6 text-center text-sm text-zinc-300",children:"Profile not found."})})});const R=(a==null?void 0:a.id)===s.id,N=s.profile.accentFrom||"#22d3ee",A=s.profile.accentTo||"#8b5cf6";return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 20% -10%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1100px 760px at 95% 8%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{style:{height:180,background:s.profile.bannerData?`url(${s.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${N}, ${A})`}}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 px-4 pb-4 -mt-16",children:[e.jsx("div",{className:"h-24 w-24 rounded-full ring-4 ring-[rgba(13,19,33,0.85)]",style:{background:s.profile.avatarData?`url(${s.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${N}, ${A})`}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-white",children:s.username}),e.jsx(Pe,{role:s.role}),e.jsxs("span",{className:"text-xs text-zinc-400/80",children:["#",s.userNumber]})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:["Joined ",new Date(s.createdAt).toLocaleDateString()]})]}),R?e.jsx(Ee,{user:s,onUpdated:async()=>{if(x){const l=await ae(t);l&&r({id:l.user.id,username:l.user.username,email:l.user.email,createdAt:l.user.createdAt,role:l.user.role,userNumber:l.user.userNumber,posts:0,likes:0,topics:0,profile:l.profile,bans:null,mutes:null})}else r(le(t)||null)},saveProfile:async l=>{x?await fe(l):ge(s.id,l)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:`btn ${j?"":"btn-primary"}`,onClick:()=>{a!=null&&a.id&&(j?ze(a.id,s.id):Ce(a.id,s.id),v(J(s.id)))},children:j?e.jsxs(e.Fragment,{children:[e.jsx(je,{size:16})," Unfollow"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:16})," Follow"]})})})]})]}),((L=(b=s.profile)==null?void 0:b.privacy)==null?void 0:L.showStats)!==!1&&e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[e.jsx(W,{value:s.posts,label:"Posts"}),e.jsx(W,{value:s.topics,label:"Topics"}),e.jsx(W,{value:s.likes,label:"Likes"})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsx(F,{title:"About",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:s.profile.bio||"No bio yet."})}),((D=(w=s.profile)==null?void 0:w.privacy)==null?void 0:D.showLinks)!==!1&&e.jsx(F,{title:"Links",children:e.jsxs("div",{className:"grid gap-2 text-sm text-zinc-200/80",children:[(k=s.profile.links)!=null&&k.website?e.jsxs("a",{className:"flex items-center gap-2 text-sky-300 hover:text-sky-200",href:s.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(Ne,{size:14}),s.profile.links.website]}):null,(P=s.profile.links)!=null&&P.discord?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:14})," Discord: ",s.profile.links.discord]}):null,(y=s.profile.links)!=null&&y.telegram?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:14})," Telegram: ",s.profile.links.telegram]}):null,!((E=s.profile.links)!=null&&E.website)&&!((S=s.profile.links)!=null&&S.discord)&&!(($=s.profile.links)!=null&&$.telegram)&&e.jsx("span",{children:"No links added."})]})})]}),e.jsx(F,{title:"Signature",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:s.profile.signature||"No signature."})}),((T=(C=s.profile)==null?void 0:C.privacy)==null?void 0:T.showFollowers)!==!1&&e.jsx(F,{title:`Followers (${u.length})`,children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/80",children:u.length===0?e.jsx("span",{children:"No followers yet."}):u.slice(0,14).map(l=>{const o=re(l);return e.jsx("span",{className:"rounded-full bg-white/5 px-3 py-1",children:(o==null?void 0:o.username)||"User"},l)})})}),((B=(z=s.profile)==null?void 0:z.privacy)==null?void 0:B.allowComments)!==!1&&e.jsx(F,{title:"Profile comments",children:e.jsxs("div",{className:"grid gap-3",children:[(a==null?void 0:a.id)&&a.id!==s.id&&e.jsx(Te,{onPost:l=>{a!=null&&a.id&&(Fe(s.id,a.id,l),g(U(s.id)))}}),e.jsxs("div",{className:"grid gap-2",children:[f.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"No comments yet."}),f.map(l=>{var o;return e.jsxs("div",{className:"card p-3 text-sm text-zinc-200/90 flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-zinc-400/80",children:[((o=re(l.authorId))==null?void 0:o.username)||"User"," Â· ",new Date(l.createdAt).toLocaleString()]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:l.content})]}),((a==null?void 0:a.id)===l.authorId||(a==null?void 0:a.id)===s.id)&&e.jsx("button",{className:"btn",title:"Delete",onClick:()=>{Ae(s.id,l.id,a.id),g(U(s.id))},children:e.jsx(be,{size:16})})]},l.id)})]})]})})]})})}function Ee({user:t,onUpdated:s,saveProfile:r}){const[a,c]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>c(!0),children:[e.jsx(we,{size:16})," Settings"]}),a&&e.jsx($e,{user:t,onClose:()=>c(!1),onSaved:()=>{s(),c(!1)},saveProfile:r})]})}function $e({user:t,onClose:s,onSaved:r,saveProfile:a}){var V,Y,q,H,Q,X,Z,ee;const[c,x]=n.useState(t.profile.avatarData||""),[h,m]=n.useState(t.profile.bannerData||""),[u,v]=n.useState(t.profile.accentFrom||"#22d3ee"),[f,g]=n.useState(t.profile.accentTo||"#8b5cf6"),[j,R]=n.useState(t.profile.bio||""),[N,A]=n.useState(t.profile.signature||""),[b,L]=n.useState(((V=t.profile.links)==null?void 0:V.website)||""),[w,D]=n.useState(((Y=t.profile.links)==null?void 0:Y.discord)||""),[k,P]=n.useState(((q=t.profile.links)==null?void 0:q.telegram)||""),[y,E]=n.useState(t.profile.badges||[]),[S,$]=n.useState(((H=t.profile.privacy)==null?void 0:H.showEmail)??!1),[C,T]=n.useState(((Q=t.profile.privacy)==null?void 0:Q.showStats)??!0),[z,B]=n.useState(((X=t.profile.privacy)==null?void 0:X.showLinks)??!0),[l,o]=n.useState(((Z=t.profile.privacy)==null?void 0:Z.allowComments)??!0),[d,M]=n.useState(((ee=t.profile.privacy)==null?void 0:ee.showFollowers)??!0),ue=i=>{E(p=>p.includes(i)?p.filter(I=>I!==i):p.length>=3?p:[...p,i])},K=i=>p=>{var se;const I=(se=p.target.files)==null?void 0:se[0];if(!I)return;const _=new FileReader;_.onload=()=>i(String(_.result||"")),_.readAsDataURL(I)},pe=async()=>{await a({avatarData:c||void 0,bannerData:h||void 0,accentFrom:u,accentTo:f,bio:j.trim()||void 0,signature:N.trim()||void 0,links:{website:b.trim()||void 0,discord:w.trim()||void 0,telegram:k.trim()||void 0},badges:y,privacy:{showEmail:S,showStats:C,showLinks:z,allowComments:l,showFollowers:d}}),r()};return e.jsx("div",{className:"fixed inset-0 z-[120] grid place-items-center bg-black/70 px-4 py-6",children:e.jsxs("div",{className:"card w-[min(780px,96vw)] max-h-[90vh] overflow-y-auto p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Customize profile"}),e.jsx("button",{className:"btn",onClick:s,children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Avatar"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:c?`url(${c}) center/cover`:`linear-gradient(135deg, ${u}, ${f})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(ce,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:K(x)})]}),c&&e.jsx("button",{className:"btn",onClick:()=>x(""),children:"Remove"})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Banner"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:h?`url(${h}) center/cover`:`linear-gradient(135deg, ${u}, ${f})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(ce,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:K(m)})]}),h&&e.jsx("button",{className:"btn",onClick:()=>m(""),children:"Remove"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Accent"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"From"}),e.jsx("input",{type:"color",value:u,onChange:i=>v(i.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"To"}),e.jsx("input",{type:"color",value:f,onChange:i=>g(i.target.value)})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Badges (max 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:De.map(i=>{const p=y.includes(i);return e.jsxs("button",{className:`btn flex items-center gap-2 ${p?"btn-primary":""}`,onClick:()=>ue(i),type:"button",children:[e.jsx(ye,{size:16})," ",i]},i)})})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Bio"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:j,onChange:i=>R(i.target.value),placeholder:"Tell the community a bit about yourself"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Signature"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:N,onChange:i=>A(i.target.value),placeholder:"Signature displayed under your posts"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Links"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:b,onChange:i=>L(i.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:w,onChange:i=>D(i.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:k,onChange:i=>P(i.target.value)})]})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Privacy"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:i=>$(i.target.checked)})," Show email"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:i=>T(i.target.checked)})," Show stats (posts, topics, likes)"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:i=>B(i.target.checked)})," Show links"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:i=>M(i.target.checked)})," Show followers"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:i=>o(i.target.checked)})," Allow comments on profile"]})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:s,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:pe,children:"Save changes"})]})]})})}function Te({onPost:t}){const[s,r]=n.useState("");return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ke,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Write a comment...",value:s,onChange:a=>r(a.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=s.trim();a&&(t(a),r(""))},children:"Post comment"})})]})}export{Re as default};
