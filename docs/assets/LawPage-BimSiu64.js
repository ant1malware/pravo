import{l as k,j as t,C as z}from"./index-XtYTn164.js";import{u as L,b as y,r as m,L as j}from"./react-vendor-DTkXckhQ.js";import{i as A,F as E,t as S}from"./FavStar-DKcbBq2-.js";import{d as C,p as F}from"./purify.es-DnfDK_hS.js";import{A as T,B as I,x as M,a as q}from"./icons-6J_ozvLF.js";function H(u){const l=new DOMParser().parseFromString(u,"text/html");try{const c="/pravo/";l.querySelectorAll("img").forEach(r=>{const n=(r.getAttribute("src")||"").trim();if(/^(?:\/)?img\//.test(n)){const a=n.replace(/^\/+/,"");r.setAttribute("src",`${c}${a}`)}})}catch{}const e=Array.from(l.querySelectorAll("h2, h3, h4")),o=[],f=c=>c.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").trim().replace(/\s+/g,"-").slice(0,80),g=c=>{const r=c.trim(),n=r.match(/^\s*(ст\.?|статья)\s*(\d+(?:\.\d+)*)/i);if(n)return`статья-${n[2].replace(/\./g,"-")}`;const a=r.match(/^\s*(глава|раздел)\s*(\d+(?:\.\d+)*)/i);return a?`${a[1].toLowerCase()}-${a[2].replace(/\./g,"-")}`:f(r)};return e.forEach((c,r)=>{const n=c.textContent||"",a=g(n)||`h-${r+1}`;c.id=a;const b=c.tagName==="H2"?2:c.tagName==="H3"?3:4;o.push({id:a,text:n,level:b});const x=l.createElement("button");x.className="anchor-fav",x.setAttribute("data-id",a),x.setAttribute("data-title",n),x.setAttribute("title","Добавить раздел в избранное"),c.appendChild(x)}),{html:l.body.innerHTML,toc:o}}function v(u){return(u||"").toLowerCase().replace(/[«»"'\s]+/g," ").trim()}function R(u,l){let e=u.replace(/\r\n?/g,`
`);return e=e.replace(/^\s*#\s+(.+)\s*\n/,(o,f)=>v(f)===v(l)?"":o),e=e.replace(/^(?![#>])\s*(Глава\s+\d+[^\n]*)$/gim,"## $1"),e=e.replace(/^(?![#>])\s*(Раздел\s+\d+[^\n]*)$/gim,"## $1"),e=e.replace(/^(?![#>])\s*((?:Статья|Ст\.?|Ст)\s+\d+(?:\.\d+)?[^\n]*)$/gim,"### $1"),e=e.replace(/^(#{2,6})([^\s#])/gm,"$1 $2"),e=e.replace(/^\s*(\d+)\)\s+/gm,"$1. "),e}function V(){const{slug:u}=L(),l=y(),e=k.find(s=>s.slug===u),[o,f]=m.useState(""),[g,c]=m.useState([]),[r,n]=m.useState(""),a=m.useRef(null);if(m.useEffect(()=>{if(!e)return;const s=R(e.content,e.title),i=C.parse(s,{gfm:!0,breaks:!0}),p=F.sanitize(i,{USE_PROFILES:{html:!0}}),{html:d,toc:h}=H(p);f(d),c(h)},[u]),m.useEffect(()=>{const i=new URLSearchParams(l.search).get("q")||"";i&&n(i)},[l.search]),m.useEffect(()=>{const s=a.current;if(!s)return;s.querySelectorAll(".anchor-fav").forEach(p=>{const d=p.getAttribute("data-id")||"",h=`${(e==null?void 0:e.slug)||""}#${d}`;A("lawsec",h)&&p.classList.add("active")});function i(p){const d=p.target;if(d&&d.classList.contains("anchor-fav")){p.preventDefault();const h=d.getAttribute("data-id")||"",N=d.getAttribute("data-title")||"";if(!e)return;const w=`${e.slug}#${h}`,$=`${l.pathname}#${h}`;S("lawsec",w,{title:`${e.title} — ${N}`,url:$})?d.classList.add("active"):d.classList.remove("active")}}return s.addEventListener("click",i),()=>s.removeEventListener("click",i)},[a,o,e==null?void 0:e.slug]),!e)return t.jsxs("div",{className:"p-4",children:["Закон не найден. ",t.jsx(j,{to:"/",className:"text-blue-600 underline",children:"На главную"})]});const b=m.useMemo(()=>{if(!r.trim()||!o)return o;const s=new RegExp(`(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return o.replace(s,"<mark>$1</mark>")},[r,o]);m.useEffect(()=>{if(!r.trim())return;const s=a.current;if(!s)return;const i=s.querySelector("mark");if(i)try{i.scrollIntoView({behavior:"smooth",block:"center"})}catch{i.scrollIntoView()}},[b,r]);const x=s=>s===2?"pl-0":s===3?"pl-3":"pl-6";return t.jsxs("div",{className:"min-h-screen text-zinc-900 dark:text-zinc-100",children:[t.jsx("header",{className:"sticky top-0 z-20 border-b border-zinc-200 bg-white/80 backdrop-blur dark:border-zinc-800 dark:bg-zinc-900/70",children:t.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between gap-3 px-4 py-3",children:[t.jsxs(j,{to:"/",className:"flex items-center gap-1 text-sm hover:underline",children:[t.jsx(T,{className:"h-4 w-4"})," Назад"]}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{className:"h-5 w-5"}),t.jsx("h1",{className:"text-lg font-bold leading-tight",children:e.title})]}),t.jsx(z,{})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{kind:"law",id:e.slug,title:e.title,url:`/laws/${e.slug}`}),t.jsx("div",{className:"text-xs text-zinc-500",children:e.updated?`Обновлено: ${e.updated}`:""})]})]})}),t.jsxs("main",{className:"mx-auto grid max-w-6xl grid-cols-1 gap-5 px-4 py-5 md:grid-cols-[260px,1fr]",children:[t.jsx("aside",{className:"hidden md:block",children:t.jsxs("div",{className:"sticky top-16 rounded-2xl border border-zinc-200 bg-white/70 p-3 text-sm dark:border-zinc-800 dark:bg-zinc-900/50",children:[t.jsxs("div",{className:"mb-2 flex items-center gap-2 font-semibold",children:[t.jsx(M,{className:"h-4 w-4"})," Содержание"]}),g.length?t.jsx("ul",{className:"space-y-1",children:g.map(s=>t.jsx("li",{className:x(s.level),children:t.jsx("a",{className:"underline decoration-dotted hover:no-underline",href:`#${s.id}`,children:s.text})},s.id))}):t.jsx("div",{className:"text-xs text-zinc-500",children:"Добавьте заголовки (##/###) в Markdown, чтобы появилось оглавление."})]})}),t.jsxs("section",{children:[t.jsxs("nav",{className:"mb-3 text-xs text-zinc-500",children:[t.jsx(j,{to:"/",className:"underline decoration-dotted hover:no-underline",children:"Главная"}),t.jsx("span",{className:"mx-1",children:"/"}),t.jsx("span",{children:"Законы"}),t.jsx("span",{className:"mx-1",children:"/"}),t.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:e.title})]}),t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx(q,{className:"h-4 w-4 text-zinc-500"}),t.jsx("input",{className:"w-full rounded-xl border px-3 py-1.5 text-sm focus:outline-none focus:ring",placeholder:"Подсветить совпадения в тексте",value:r,onChange:s=>n(s.target.value)})]}),t.jsx("div",{className:"reading",children:t.jsx("div",{className:"law prose prose-zinc max-w-none rounded-2xl border border-zinc-200 bg-white p-4 list-inside dark:prose-invert dark:border-zinc-800 dark:bg-zinc-900",ref:a,dangerouslySetInnerHTML:{__html:b}})})]})]})]})}export{V as default};
