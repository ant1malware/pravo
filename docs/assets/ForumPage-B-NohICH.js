import{j as e}from"./index-N9yhZYnV.js";import{R as s,L as _}from"./react-vendor-DTkXckhQ.js";import{g as xe,c as Ke,a as Pe,r as Ue}from"./authRemote-D9Q-aZvG.js";import{l as Fe,a as Be,b as Je}from"./forumRemote-BYvX5m8l.js";import{F as He}from"./ForumSubnav-D8h7rLLB.js";import{f as Ce}from"./time-Cv7kjYsp.js";import{$ as We,a0 as Ye,U as qe,S as Le,a as Ve,a1 as Xe,C as Ge,L as Ze,a2 as Qe}from"./icons-pv2MHu2Z.js";const ce=800,Ee=["–°–∫–∞–π-–°—Ç—Ä–∞–∂","–ü—Ä–∞–≤–æ-–°–∞–º—É—Ä–∞–π","–ü—É–ª—å—Å-–†–µ–π–¥–µ—Ä","–ö–∏–±–µ—Ä-–ú–µ–¥–∏–∫","–ù–µ–æ–Ω-–¢–∞–∫—Ç–∏–∫","–ê—Å—Ç—Ä–∞–ª-–û—Ñ–∏—Ü–µ—Ä","–§–∞–Ω—Ç–æ–º-–õ–µ—á–∞—â–∏–π","–®–∏—Ñ—Ä-–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä","–ö–≤–∞–Ω—Ç-–ë–æ–µ—Ü","–ü–∏–∫—Å–µ–ª—å-–í–æ–ª–∫","–¢—É–º–∞–Ω-–ö–æ–º–∞–Ω–¥–æ—Ä","–ò—Å–∫—Ä–∞-–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å","–ù—É–ª—å-–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–ü–æ–ª—è—Ä–Ω—ã–π –ü–∏–ª–æ—Ç","–ì–æ—Ä–æ–¥—Å–∫–æ–π –•–∏—Ä—É—Ä–≥","–°—ã–≤–æ—Ä–æ—Ç–∫–∞-Vibe","–°—Ç–µ—Ä–∏–ª—å–Ω—ã–π –ù–∏–Ω–¥–∑—è","–°–∫–∞–ª—å–ø–µ–ª—å-–û–±–ª–∞–∫–æ","–†–µ–Ω—Ç–≥–µ–Ω-–ü–∞–Ω–∫","–í–∞—Ç–∫–∞-Supreme"];function Q(){const n=Ee[Math.floor(Math.random()*Ee.length)],i=Math.floor(Math.random()*900+100);return`${n} ${i}`}function et(n){try{return typeof n=="string"?JSON.parse(n):n instanceof ArrayBuffer?JSON.parse(new TextDecoder().decode(n)):(typeof Blob<"u"&&n instanceof Blob,null)}catch{return null}}function Me(n){return new Date(n).toLocaleTimeString(void 0,{hour12:!1})}function tt(n){return n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function rt(n){if(!n)return null;const i=n.trim();return i?`@${tt(i).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Ae(n,i){if(!i)return!1;try{return new RegExp(i,"iu").test(n)}catch{return!1}}function ze(n,i){if(!i)return n;try{const b=new RegExp(i,"giu"),u=[];let h=0,x=0,k;for(;(k=b.exec(n))!==null;)k.index>h&&u.push(e.jsx(s.Fragment,{children:n.slice(h,k.index)},`text-${x++}`)),u.push(e.jsx("span",{className:"rc-ping",children:k[0]},`mention-${x++}`)),h=b.lastIndex;return h<n.length&&u.push(e.jsx(s.Fragment,{children:n.slice(h)},`text-${x++}`)),u.length?u:n}catch{return n}}const ie=["üòÄ","üòÅ","üòÇ","ü§£","üòÖ","üòé","üòç","üòò","üòá","ü§ù","üëå","üëç","üî•","üíØ","‚ú®","‚ö°","üéØ","üöÄ","üõ°Ô∏è","üèÜ","üí¨","üìù","üìå","üì£","üóÇÔ∏è","üß†","üìà","üïí","üõ†Ô∏è","üîí","‚úÖ","‚ùó","‚ö†Ô∏è","‚ùì","üéâ","ü•≥","üôå","ü§ò","ü§ñ","üëÄ","üí°","üß≠","üì¶","üõéÔ∏è","üì°","üõ∞Ô∏è","üß™","üìï","üß∑","ü™™","üß∞","üß±","üõ∞","üóÉÔ∏è"],st=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function at(n){try{const i=new URL(n);return i.protocol=i.protocol==="wss:"?"https:":i.protocol==="ws:"?"http:":i.protocol,i.pathname="/",i.search="",i.hash="",i.toString().replace(/\/+$/,"")}catch{return""}}function nt(n){const i=`@e${n}`;return{NAME_KEY:`chat:nick${i}`,NAME_LOCK:`chat:nick:lock${i}`}}function ct({room:n="global",className:i,variant:b="classic",onRosterChange:u,resolveRole:h}){const x="wss://notifications-worker.wizardiowhy.workers.dev/chat",k=s.useMemo(()=>at(x),[x]),[T,M]=s.useState(1),[p,Y]=s.useState(!1),v=s.useMemo(()=>nt(T),[T]),[z,$]=s.useState(!1),[L,C]=s.useState(0),[c,o]=s.useState([]),[y,m]=s.useState(!1),[f,I]=s.useState(!1),[R,D]=s.useState(""),[O,K]=s.useState([]),P=s.useRef(null),ee=s.useRef(null),N=s.useRef(null),q=s.useRef(null),te=s.useRef(null),[X,re]=s.useState(!1),se=s.useRef({}),[A,V]=s.useState(null),[U,G]=s.useState(!0),[ue,F]=s.useState(Q()),me=s.useRef({epochReady:p,needNick:U,nick:A}),fe=s.useRef(v),H=s.useRef(null),he=s.useMemo(()=>f?"Admin":A??"",[f,A]),B=s.useMemo(()=>he.trim(),[he]),Z=s.useMemo(()=>rt(B||null),[B]),ge=s.useCallback(t=>{const a=h==null?void 0:h(t);return a||(t.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[h]),be=s.useCallback(t=>{const a=t.trim();if(!a)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let r=0;for(let E=0;E<a.length;E+=1)r=(r+a.charCodeAt(E)*17)%360;const l=r,j=(r+42)%360;return{background:`linear-gradient(135deg, hsla(${l},80%,56%,0.85), hsla(${j},78%,48%,0.85))`,color:"#fdfcff"}},[]);s.useEffect(()=>{if(p)try{const t=localStorage.getItem(v.NAME_KEY),a=localStorage.getItem(v.NAME_LOCK)==="1";t&&a?(V(t),G(!1),F(t)):t&&!a?(V(t),F(t),G(!0)):(V(null),F(Q()),G(!0))}catch{V(null),F(Q()),G(!0)}},[p,v.NAME_KEY,v.NAME_LOCK]),s.useEffect(()=>{me.current={epochReady:p,needNick:U,nick:A}},[p,U,A]),s.useEffect(()=>{p&&(async()=>{let t=null;try{const a=await xe();a!=null&&a.username&&(t=a.username)}catch{}if(!t)try{const a=localStorage.getItem("forum:session")||sessionStorage.getItem("forum:session"),r=a?JSON.parse(a):null;r!=null&&r.username&&(t=r.username)}catch{}if(t){V(t),F(t),G(!1);try{localStorage.setItem(v.NAME_KEY,t),localStorage.setItem(v.NAME_LOCK,"1")}catch{}const a=P.current;if(a&&a.readyState===WebSocket.OPEN&&H.current!==t)try{a.send(JSON.stringify({type:"hello",name:t})),H.current=t}catch{}}})()},[p,v.NAME_KEY,v.NAME_LOCK]),s.useEffect(()=>{fe.current=v},[v]),s.useEffect(()=>{f||m(!1)},[f]),s.useEffect(()=>{typeof u=="function"&&u(c,L)},[u,c,L]),s.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=f;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:f}}))}catch{}}},[f]),s.useEffect(()=>{z||(m(!1),o([]))},[z]),s.useEffect(()=>{if(!y)return;const t=r=>{const l=N.current;l&&!l.contains(r.target)&&m(!1)},a=r=>{r.key==="Escape"&&m(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",a),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",a)}},[y]),s.useEffect(()=>{if(!X)return;const t=r=>{const l=q.current;l&&!l.contains(r.target)&&re(!1)},a=r=>{r.key==="Escape"&&re(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",a),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",a)}},[X]),s.useEffect(()=>{U&&(H.current=null)},[U]),s.useEffect(()=>{let t=!1,a=null;const r=Date.now(),l=j=>{if(t)return;M(j);const E=Date.now()-r,d=Math.max(0,Math.min(900,520-E)),g=()=>{t||Y(!0)};d<=0?g():a=setTimeout(g,d)};return k?((async()=>{try{const j=await fetch(`${k}/nick-epoch`,{credentials:"include"}),E=j.ok?await j.json().catch(()=>({})):{},S=Number(E.epoch)||1;l(S)}catch{l(1)}})(),()=>{t=!0,a&&clearTimeout(a)}):(l(1),()=>{t=!0,a&&clearTimeout(a)})},[k]),s.useEffect(()=>{const t=ee.current;t&&(t.scrollTop=t.scrollHeight)},[O.length]),s.useEffect(()=>{let t=!1,a=0,r=null;const l=()=>{if(t)return;$(!1);const j=new URL(x);j.searchParams.set("room",n),r=new WebSocket(j),P.current=r,r.addEventListener("open",()=>{$(!0),se.current={},a=0,C(0);const{epochReady:S,needNick:d,nick:g}=me.current;if(S&&g&&!d)try{r.send(JSON.stringify({type:"hello",name:g})),H.current=g}catch{}}),r.addEventListener("message",async S=>{try{let d=et(S.data);if(!d&&typeof Blob<"u"&&S.data instanceof Blob&&(d=JSON.parse(await S.data.text())),!d)return;if(d.type==="history")K(d.messages);else if(d.type==="message"){const g=d.cid;if(g&&se.current[g]){const w=se.current[g];delete se.current[g],K(W=>{const le=W.filter(de=>de.id!==w);return le.some(de=>de.id===d.message.id)?le:[...le,d.message]})}else K(w=>w.some(W=>W.id===d.message.id)?w:[...w,d.message])}else if(d.type==="delete")K(g=>g.filter(w=>w.id!==d.id));else if(d.type==="edit")K(g=>g.map(w=>w.id===d.id?{...w,text:d.text}:w));else if(d.type==="system"){if(d.text==="admin-ok"?I(!0):d.text==="hello-ok"&&!d.name&&I(!1),d.text==="presence"){const g=Number(d.count);if(C(Number.isFinite(g)&&g>0?Math.round(g):0),Array.isArray(d.names)){const w=d.names.map(W=>typeof W=="string"?W.trim():"").filter(W=>W.length>0);o(w)}else o([])}if(d.name&&(d.text==="hello-ok"||d.text==="admin-ok")){V(d.name),F(d.name),H.current=d.name;try{const{NAME_KEY:g,NAME_LOCK:w}=fe.current;localStorage.setItem(g,d.name),localStorage.setItem(w,"1")}catch{}G(!1)}}}catch{}});const E=()=>{t||($(!1),C(0),o([]),m(!1),a=Math.min(a+1,6),setTimeout(l,400*a))};r.addEventListener("close",E),r.addEventListener("error",()=>r==null?void 0:r.close())};return l(),()=>{t=!0;try{r==null||r.close()}catch{}P.current=null,H.current=null}},[x,n]),s.useEffect(()=>{const t=P.current;if(!(!t||t.readyState!==WebSocket.OPEN)&&!(!p||U||!A)&&H.current!==A)try{t.send(JSON.stringify({type:"hello",name:A})),H.current=A}catch{}},[p,U,A]);function Re(){const a=((ue||"").trim().slice(0,80)||Q()).replace(/[^\p{L}\p{N}_ -]+/gu,"");V(a),F(a);try{localStorage.setItem(v.NAME_KEY,a)}catch{}const r=P.current;if(r&&r.readyState===WebSocket.OPEN)try{r.send(JSON.stringify({type:"hello",name:a})),H.current=a}catch{}}const[ae,ve]=s.useState(null);s.useEffect(()=>{(async()=>{try{ve(await xe())}catch{ve(null)}})()},[]);const je=s.useMemo(()=>{const t=ae!=null&&ae.mutedUntil?Date.parse(ae.mutedUntil):0;return!!t&&t>Date.now()},[ae]);function oe(){const a=R.replace(/\r/g,"").trim(),r=P.current;if(!p||!A||U||!a||!r||r.readyState!==WebSocket.OPEN||je)return;const l=`${Date.now()}_${Math.random().toString(36).slice(2)}`,j=`loc_${l}`;se.current[l]=j,K(E=>[...E,{id:j,author:f?"Admin":A,text:a,ts:Date.now()}]),r.send(JSON.stringify({type:"message",text:a.slice(0,ce),cid:l})),D(""),ne()}const J=p&&z&&!!A&&!U&&!je,Oe=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),oe())};s.useEffect(()=>{J||re(!1)},[J]);function ye(t){const a=`@${t} `;D(l=>l?l.replace(/\s+$/," ")+a:a);const r=te.current;setTimeout(()=>{try{if(r){r.focus();const l=r.value.length;r.selectionStart=r.selectionEnd=l}}catch{}},0)}const Ne=()=>{J&&re(t=>!t)},ne=s.useCallback(()=>{if(b!=="forum")return;const t=te.current;if(!t||t.tagName!=="TEXTAREA")return;const a=t;a.style.height="auto";const r=Math.min(a.scrollHeight,220);a.style.height=`${r}px`},[b]);s.useEffect(()=>{ne()},[R,ne]);const we=t=>{D(r=>`${r}${t}`),re(!1);const a=()=>{const r=te.current;if(r){const l=r.value.length;r.focus();try{r.setSelectionRange(l,l)}catch{}ne()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(a):setTimeout(a,0)},ke=t=>{const a=P.current;!f||!a||a.readyState!==WebSocket.OPEN||a.send(JSON.stringify({type:"delete",id:t}))},Se=(t,a)=>{var j;const r=P.current;if(!f||!r||r.readyState!==WebSocket.OPEN)return;const l=(j=prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",a))==null?void 0:j.trim();l&&r.send(JSON.stringify({type:"edit",id:t,text:l.slice(0,ce)}))},_e=t=>t==="Admin"?"rc-admin":t===A?"rc-me":"rc-other",Te=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!p,children:[e.jsxs("div",{ref:N,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"rc-head-meta",children:[f?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${y?" open":""}`,onClick:()=>m(t=>!t),"aria-expanded":y,"aria-controls":"rc-presence-panel","aria-label":"–ö—Ç–æ —Å–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏",children:[e.jsx("span",{className:`rc-presence-dot ${z?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[z?Math.max(L,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${z?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[z?Math.max(L,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}),f&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),f&&y&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"–°–ø–∏—Å–æ–∫ –∫—Ç–æ –≤ —Å–µ—Ç–∏",children:[e.jsx("div",{className:"rc-presence-title",children:"–°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏"}),c.length?e.jsx("ul",{children:c.map(t=>e.jsxs("li",{className:t===B?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:t}),t===B&&e.jsx("span",{className:"rc-presence-you",children:"–≤—ã"})]},t))}):e.jsx("div",{className:"rc-presence-empty",children:"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("div",{ref:ee,className:"rc-list",children:p?O.length===0?e.jsx("div",{className:"rc-empty",children:"‚Ä¶"}):e.jsx("ul",{children:O.map(t=>{const a=B?t.author.trim()===B:!1,r=!!(Z&&B&&!a&&Ae(t.text,Z)),l=r?ze(t.text,Z):t.text;return e.jsxs("li",{className:r?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",Me(t.ts),"]"]}),e.jsx(_,{to:`/forum/profile/${encodeURIComponent(t.author)}`,className:_e(t.author),children:t.author}),e.jsx("button",{className:"rc-ax",type:"button",onClick:()=>ye(t.author),title:`@${t.author}`,children:"@"}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:l}),f&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>Se(t.id,t.text),children:"–†–µ–¥."}),e.jsx("button",{className:"rc-ax",onClick:()=>ke(t.id),children:"–£–¥–∞–ª."})]})]},t.id)})}):e.jsx("div",{className:"rc-empty",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"})}),e.jsxs("form",{ref:q,className:"rc-form",onSubmit:t=>{t.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${X?" open":""}`,onClick:Ne,disabled:!J,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üòä"}),e.jsx("input",{ref:te,className:"rc-input",placeholder:"–Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",value:R,onChange:t=>D(t.target.value),maxLength:ce,disabled:!J}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!J,children:"‚ñ∂"}),X&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ie.length?e.jsx("div",{className:"rc-emoji-grid",children:ie.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>we(t),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]})]}),De=()=>{const t=c,a=z?Math.max(L,t.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!p,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"–û–Ω–ª–∞–π–Ω"}),p?e.jsx("div",{className:"fc-roster-list",children:t.length?t.map(r=>{const l=ge(r),j=r.trim(),E=j?j.slice(0,2).toUpperCase():"??",S=be(r);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:S,children:E}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:r}),e.jsx("div",{className:"fc-roster-role",style:l?{color:l.textColor??"#ede9fe"}:void 0,children:l?l.label:"–£—á–∞—Å—Ç–Ω–∏–∫"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},r)}):e.jsx("div",{className:"fc-roster-empty",children:"–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((r,l)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},l))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${z?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:a}),e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]})]}),p?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:ee,className:"forum-chat-list",children:O.length===0?e.jsx("div",{className:"fc-empty",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç"}):O.map(r=>{const l=B?r.author.trim()===B:!1,j=!!(Z&&B&&!l&&Ae(r.text,Z)),E=j?ze(r.text,Z):r.text,S=ge(r.author),d=r.author.trim(),g=d?d.slice(0,2).toUpperCase():"??",w=be(r.author);return e.jsxs("div",{className:`fc-item${l?" self":""}${j?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:w,children:g}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[e.jsx(_,{to:`/forum/profile/${encodeURIComponent(r.author)}`,children:r.author}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ye(r.author),title:`@${r.author}`,children:"@"}),S&&e.jsx("span",{className:"fc-role",style:{background:`${S.color}33`,color:S.textColor??"#ede9fe",borderColor:`${S.color}55`},children:S.label})]}),e.jsx("span",{className:"fc-time",children:Me(r.ts)})]}),e.jsx("div",{className:"fc-bubble",children:E}),f&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>Se(r.id,r.text),children:"–†–µ–¥."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ke(r.id),children:"–£–¥–∞–ª."})]})]})]},r.id)})}),e.jsxs("form",{ref:q,className:"forum-chat-form",onSubmit:r=>{r.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –¥–µ–º–æ."),disabled:!J,"aria-label":"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",children:"üìé"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:r=>{te.current=r,r&&ne()},value:R,onChange:r=>D(r.target.value),onKeyDown:Oe,placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",disabled:!J,maxLength:ce}),X&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ie.length?e.jsx("div",{className:"rc-emoji-grid",children:ie.map(r=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>we(r),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${r}`,children:r},r))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${X?" open":""}`,onClick:Ne,disabled:!J,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üôÇ"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!J,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:i??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:st}}),b==="forum"?De():Te(),p&&U&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫"}),e.jsx("div",{className:"nick-warn",children:"–ù–∏–∫ –∑–∞–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –°–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –Ω–µ–ª—å–∑—è."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:ue,onChange:t=>F(t.target.value),maxLength:80,placeholder:"–í–∞—à –Ω–∏–∫‚Ä¶",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>F(Q()),children:"üé≤"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:Re,children:"–û–∫"})]}),e.jsx("div",{children:Array.from({length:5}).map((t,a)=>e.jsx("span",{className:"nick-pill",onClick:()=>F(Q()),children:"üé≤ –°–ª—É—á–∞–π–Ω—ã–π"},a))})]})})]})}const pe={};function it({onToken:n,className:i}){const b=(pe==null?void 0:pe.VITE_RECAPTCHA_SITE_KEY)||"",[u,h]=s.useState(!1),[x,k]=s.useState(null);s.useEffect(()=>{if(!b){const Y=1+Math.floor(Math.random()*9),v=1+Math.floor(Math.random()*9);k({a:Y,b:v,answer:""}),h(!0);return}const M="recaptcha-v3";if(document.getElementById(M)){h(!0);return}const p=document.createElement("script");p.id=M,p.src=`https://www.google.com/recaptcha/api.js?render=${encodeURIComponent(b)}`,p.async=!0,p.defer=!0,p.onload=()=>h(!0),p.onerror=()=>{h(!0)},document.head.appendChild(p)},[b]);async function T(){try{const M=window.grecaptcha;if(!M||!b)return n(null);const p=await M.execute(b,{action:"submit"});n(p||null)}catch{n(null)}}if(!u)return e.jsx("div",{className:i||""});if(x){const M=String(Number(x.answer))===String(x.a+x.b);return e.jsx("div",{className:i||"",children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{children:"–ê–Ω—Ç–∏—Å–ø–∞–º:"}),e.jsxs("span",{className:"rounded bg-white/10 px-2 py-1",children:[x.a," + ",x.b," ="]}),e.jsx("input",{className:"input w-16",value:x.answer||"",onChange:p=>k({...x,answer:p.target.value})}),e.jsx("button",{type:"button",className:"btn",onClick:()=>n(M?"math_ok":null),children:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"})]})})}return e.jsx("div",{className:i||"",children:e.jsx("button",{type:"button",className:"btn",onClick:T,children:"–ü—Ä–æ–≤–µ—Ä–∫–∞ reCAPTCHA"})})}const Ie="forum:email_verify:";function $e(n){const i=String(Math.floor(1e5+Math.random()*9e5)),b={code:i,issuedAt:Date.now()};try{localStorage.setItem(Ie+n.toLowerCase(),JSON.stringify(b))}catch{}return i}function ot(n,i,b=15*60*1e3){try{const u=localStorage.getItem(Ie+n.toLowerCase());if(!u)return!1;const h=JSON.parse(u);if(Date.now()-(h.issuedAt||0)>b)return!1;const x=String(h.code)===String(i).trim();if(x)try{localStorage.setItem("forum:email_verified:"+n.toLowerCase(),"1")}catch{}return x}catch{return!1}}function lt({role:n}){const i={developer:{color:"#22d3ee",text:"Developer"},admin:{color:"#ef4444",text:"Admin"},moderator:{color:"#8b5cf6",text:"Moderator"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"User"},newbie:{color:"#22d3ee",text:"Newbie"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:i[n].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:i[n].text})}function dt({onDone:n}){const[i,b]=s.useState("login"),[u,h]=s.useState(""),[x,k]=s.useState(""),[T,M]=s.useState(""),[p,Y]=s.useState(""),[v,z]=s.useState(!0),[$,L]=s.useState(null),[C,c]=s.useState(!1),[o,y]=s.useState(null),[m,f]=s.useState(""),[I,R]=s.useState(!1),[D,O]=s.useState(""),K=/^[A-Za-z0-9_]{3,16}$/,P=!0,ee=async N=>{N.preventDefault(),L(null),c(!0);try{if(i==="login")await Pe({usernameOrEmail:u.trim()||x.trim(),password:T,remember:v,otp:m.trim()||void 0,captchaToken:o}),n();else{if(!K.test(u.trim()))throw new Error("Username: 3-16 chars (A-Z a-z 0-9 _)");await Ue({username:u.trim(),email:x.trim(),password:T||void 0,inviteCode:P?p.trim():"",remember:v,captchaToken:o});try{$e(x.trim())}catch{}R("email")}}catch(q){L((q==null?void 0:q.message)||"–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫")}finally{c(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[90] grid place-items-center bg-black/70 p-4",children:e.jsxs("form",{onSubmit:ee,className:"w-[min(560px,92vw)] card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:18}),e.jsx("b",{children:i==="login"?"–í—Ö–æ–¥":"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"})]}),!I&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsx("input",{className:"input",placeholder:i==="login"?"–õ–æ–≥–∏–Ω –∏–ª–∏ e-mail":"–õ–æ–≥–∏–Ω (–ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/_ )",value:u,onChange:N=>h(N.target.value),disabled:C,required:!0}),i==="signup"&&e.jsx("input",{className:"input",placeholder:"E-mail",value:x,onChange:N=>k(N.target.value),disabled:C,required:!0}),i==="signup"&&P&&e.jsx("input",{className:"input",placeholder:"Invite code",value:p,onChange:N=>Y(N.target.value),disabled:C,required:!0}),e.jsx("input",{className:"input",type:"password",placeholder:"–ü–∞—Ä–æ–ª—å",value:T,onChange:N=>M(N.target.value),disabled:C,required:!0}),i==="login"&&e.jsx("input",{className:"input",placeholder:"2FA –∫–æ–¥ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)",value:m,onChange:N=>f(N.target.value),disabled:C}),e.jsx(it,{onToken:y}),$&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:$}),e.jsx("div",{className:"flex items-center gap-2 text-xs opacity-80",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:N=>z(N.target.checked),disabled:C}),"–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:C,children:i==="login"?"–í–æ–π—Ç–∏":"–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>b(i==="login"?"signup":"login"),disabled:C,children:i==="login"?"–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è":"–£–∂–µ –µ—Å—Ç—å? –í–æ–π—Ç–∏"})]})]}),I==="email"&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsxs("div",{className:"text-sm text-zinc-300",children:["–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ ",x,". –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∏–∂–µ."]}),e.jsx("input",{className:"input",placeholder:"–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è",value:D,onChange:N=>O(N.target.value)}),!!$&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:$}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{ot(x,D)?(R(!1),n()):L("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥")},children:"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>{$e(x)},children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –µ—â—ë —Ä–∞–∑"})]})]})]})})}function pt({me:n,onLogout:i}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.7)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl flex-wrap items-center gap-3 px-4 py-3",children:[e.jsxs(_,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(Le,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"Forum // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ"})]})]}),(n.role==="admin"||n.role==="developer"||n.role==="moderator")&&e.jsx(_,{to:"/forum/admin",className:"btn ml-2",children:"–ü–∞–Ω–µ–ª—å"}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-3",children:[e.jsxs(_,{to:`/forum/profile/${n.username}`,className:"flex items-center gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-2 shadow-sm transition hover:border-[color:var(--accent)]/60",children:[e.jsx("div",{className:"hidden text-right text-xs uppercase tracking-[0.24em] text-[color:var(--text-2)] sm:block",children:"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{role:n.role}),e.jsx("div",{className:"text-sm font-semibold",children:n.username})]}),e.jsxs("div",{className:"hidden border-l pl-2 text-xs opacity-70 sm:block",children:["#",n.userNumber]})]}),e.jsxs("button",{className:"btn flex items-center gap-2",onClick:i,type:"button",children:[e.jsx(Qe,{size:16})," –í—ã–π—Ç–∏"]})]})]})})}function vt(){const[,n]=s.useReducer(c=>c+1,0),[i,b]=s.useState(void 0),[u,h]=s.useState([]),[x,k]=s.useState([]),[T,M]=s.useState([]),[p,Y]=s.useState("");s.useEffect(()=>{let c=!0;const o=async()=>{try{const m=await xe();c&&b(m)}catch{c&&b(null)}};o();const y=()=>o();return window.addEventListener("forum:session",y),window.addEventListener("storage",y),()=>{c=!1,window.removeEventListener("forum:session",y),window.removeEventListener("storage",y)}},[]),s.useEffect(()=>{if(!i)return;let c=!0;return(async()=>{try{const[o,y,m]=await Promise.all([Fe(),Be(12),Je()]);c&&(h(Array.isArray(o)?o:[]),M(Array.isArray(y)?y:[]),k(Array.isArray(m)?m:[]))}catch{c&&(h([]),M([]),k([]))}})(),()=>{c=!1}},[i]);const v=s.useMemo(()=>{const c=new Map;for(const o of x||[])o!=null&&o.id&&c.set(o.id,o);return c},[x]),z=s.useMemo(()=>{const c=new Map;for(const o of x||[]){if(!(o!=null&&o.sectionId))continue;const y=o.lastPostAt||o.updatedAt||o.createdAt||null,m=c.get(o.sectionId),f=y?new Date(y).getTime():0,I=m!=null&&m.when?new Date(m.when).getTime():0;(!m||f>=I)&&c.set(o.sectionId,{topicId:o.id,topicTitle:o.title,when:y,by:o.lastPostBy||o.authorId||null,replies:o.replyCount??0})}return c},[x]),$=s.useMemo(()=>(u||[]).reduce((c,o)=>(c.sections+=1,c.topics+=o.topicCount??0,c.posts+=o.postCount??0,c),{sections:0,topics:0,posts:0}),[u]),L=s.useMemo(()=>{const c=p.trim().toLowerCase(),o=Array.isArray(u)?[...u]:[];return(c?o.filter(m=>{var R,D,O,K;const f=((D=(R=m.title)==null?void 0:R.toLowerCase)==null?void 0:D.call(R))??"",I=((K=(O=m.description)==null?void 0:O.toLowerCase)==null?void 0:K.call(O))??"";return f.includes(c)||I.includes(c)}):o).sort((m,f)=>{const I=(m.order??0)-(f.order??0);return I!==0?I:m.title.localeCompare(f.title)})},[u,p]),C=s.useMemo(()=>(T||[]).map(c=>({post:c,topic:c!=null&&c.topicId&&v.get(c.topicId)||null})),[T,v]);return i===void 0?e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}}):i?e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[e.jsx(pt,{me:i,onLogout:()=>{Ke(),n()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl space-y-8 px-4 py-6",children:[e.jsx(He,{}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[1.65fr_1fr]",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("div",{className:"relative overflow-hidden rounded-[18px] bg-gradient-to-br from-white/10 via-white/5 to-transparent",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,rgba(14,165,233,0.25),transparent_55%)]"}),e.jsxs("div",{className:"relative flex flex-col gap-4 px-6 py-8",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å"}),e.jsx("h1",{className:"text-3xl font-black leading-tight sm:text-4xl",children:"–§–æ—Ä—É–º –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞"}),e.jsx("p",{className:"max-w-2xl text-sm text-slate-300/80",children:"–û–±—Å—É–∂–¥–∞–π—Ç–µ —Ä–µ—Ñ–æ—Ä–º—ã, –¥–µ–ª–∏—Ç–µ—Å—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞–º–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ —Å–æ—é–∑–Ω–∏–∫–æ–≤. –†–∞–∑–¥–µ–ª—ã –Ω–∏–∂–µ –ø–æ–º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ –Ω—É–∂–Ω–æ–π —Ç–µ–º–µ."}),e.jsxs("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[e.jsxs(_,{to:`/forum/profile/${i.username}`,className:"btn btn-primary flex items-center justify-center gap-2",children:[e.jsx(We,{size:16})," –ú–æ–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è"]}),e.jsxs(_,{to:"/forum/questions",className:"btn flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã"]}),e.jsxs(_,{to:"/forum/members",className:"btn flex items-center justify-center gap-2",children:[e.jsx(qe,{size:16})," –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ñ–æ—Ä—É–º–∞"]}),e.jsxs(_,{to:"/settings",className:"btn flex items-center justify-center gap-2",children:[e.jsx(Le,{size:16})," –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è"]})]})]})]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–ü–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ä—É–º—É"}),e.jsxs("label",{className:"relative mt-3 block",children:[e.jsx(Ve,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{value:p,onChange:c=>Y(c.target.value),className:"input w-full pl-10",placeholder:"–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏–ª–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"})]}),e.jsx("div",{className:"mt-3 text-xs text-slate-400",children:"–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º —Ä–∞–∑–¥–µ–ª–æ–≤."})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞"}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"–†–∞–∑–¥–µ–ª—ã"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold",children:$.sections})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"–¢–µ–º—ã"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold",children:$.topics})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-center",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-slate-400",children:"–°–æ–æ–±—â–µ–Ω–∏—è"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold",children:$.posts})]})]})]})]})]}),e.jsxs("section",{id:"forum-sections",className:"card overflow-hidden",children:[e.jsxs("header",{className:"flex flex-col gap-2 border-b border-white/10 px-5 py-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–†–∞–∑–¥–µ–ª—ã"}),e.jsx("div",{className:"text-sm text-slate-300/80",children:"–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º ‚Äî –≤—ã–±–∏—Ä–∞–π—Ç–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ–º–∞–º."})]}),e.jsxs("div",{className:"hidden text-[11px] uppercase tracking-[0.28em] text-slate-400 md:flex md:gap-12",children:[e.jsx("span",{children:"–¢–µ–º—ã"}),e.jsx("span",{children:"–°–æ–æ–±—â–µ–Ω–∏—è"}),e.jsx("span",{children:"–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"})]})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[L.map(c=>{const o=z.get(c.id);return e.jsxs("div",{className:"flex flex-col gap-3 px-5 py-4 transition hover:bg-white/5 md:flex-row md:items-center",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs(_,{to:`/forum/section/${c.id}`,className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 hidden rounded-full bg-cyan-400/20 p-1 text-cyan-300 md:block",children:e.jsx(Xe,{size:16})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-lg font-semibold leading-tight",children:c.title}),c.description&&e.jsx("div",{className:"mt-1 text-sm text-slate-300/80 line-clamp-2",children:c.description})]})]})}),e.jsxs("div",{className:"grid gap-2 text-sm text-slate-300/90 md:grid-cols-[100px_120px_minmax(0,220px)] md:items-center md:text-right",children:[e.jsxs("div",{className:"md:justify-self-end",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.26em] text-slate-500",children:"–¢–µ–º—ã"}),e.jsx("div",{className:"font-semibold",children:c.topicCount??0})]}),e.jsxs("div",{className:"md:justify-self-end",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.26em] text-slate-500",children:"–°–æ–æ–±—â–µ–Ω–∏—è"}),e.jsx("div",{className:"font-semibold",children:c.postCount??0})]}),e.jsx("div",{className:"md:justify-self-end",children:o?e.jsxs("div",{className:"text-left text-xs leading-relaxed text-slate-400 md:text-right",children:[e.jsx("div",{className:"font-semibold text-slate-200",children:e.jsx(_,{to:`/forum/topic/${o.topicId}`,className:"hover:underline",children:o.topicTitle})}),e.jsx("div",{children:o.by?`–æ—Ç ${o.by}`:"–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫"}),e.jsxs("div",{className:"flex items-center gap-1 text-[11px] uppercase tracking-[0.3em] text-slate-500 md:justify-end",children:[e.jsx(Ge,{size:12})," ",Ce(o.when)]})]}):e.jsx("div",{className:"text-xs text-slate-500",children:"–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"})})]})]},c.id)}),!L.length&&e.jsx("div",{className:"px-5 py-6 text-sm text-slate-400",children:"–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å."})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[1.4fr_.9fr]",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"border-b border-white/10 px-5 py-3 text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è"}),e.jsx("div",{className:"divide-y divide-white/5",children:C.length?C.map(({post:c,topic:o})=>e.jsxs(_,{to:o?`/forum/topic/${o.id}`:"/forum",className:"flex flex-col gap-2 px-5 py-4 transition hover:bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.28em] text-cyan-300",children:[e.jsxs("span",{children:["#",c.id.slice(0,6)]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:Ce(c.createdAt)})]}),e.jsx("div",{className:"text-sm font-semibold leading-snug text-slate-100",children:(o==null?void 0:o.title)??"–û–±—Å—É–∂–¥–µ–Ω–∏–µ"}),c.content&&e.jsx("div",{className:"line-clamp-2 text-sm text-slate-400",children:c.content})]},c.id)):e.jsx("div",{className:"px-5 py-6 text-sm text-slate-400",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç ‚Äî –±—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –Ω–∞—á–Ω–µ—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏–µ."})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"border-b border-white/10 px-5 py-3 text-[11px] uppercase tracking-[0.32em] text-[color:var(--text-2)]",children:"–õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"}),e.jsx("div",{className:"p-5 text-sm text-slate-300/80",children:"–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å: –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö —Ä–∞–∑–¥–µ–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –≤—ã—à–µ, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(ct,{})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{onDone:()=>n()}),e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}})]})}export{vt as default};
