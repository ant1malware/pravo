function l(){try{const t=new URL(window.location.href),n=t.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{t.searchParams.delete("api"),history.replaceState({},"",t.toString())}catch{}}const o=localStorage.getItem("forum:api_base");if(o)return o}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const d=l(),i="forum:token",c="forum:session";function m(e,t=!0){(t?localStorage:sessionStorage).setItem(i,e)}function f(){return localStorage.getItem(i)??sessionStorage.getItem(i)}function y(){try{localStorage.removeItem(i),sessionStorage.removeItem(i),localStorage.removeItem(c),sessionStorage.removeItem(c)}finally{window.dispatchEvent(new Event("forum:session"))}}async function s(e,t={}){const n=f(),o={"Content-Type":"application/json",...t.headers||{}};n&&(o.Authorization=`Bearer ${n}`);const r=await fetch(`${d}${e}`,{...t,headers:o}),u=await r.text();let a={};try{a=u?JSON.parse(u):{}}catch{a={error:u||r.statusText}}if(!r.ok)throw new Error((a==null?void 0:a.error)||`${r.status} ${r.statusText}`);return a}async function S(e){const t=JSON.stringify({username:e.username,email:e.email,password:e.password||"1234",inviteCode:e.inviteCode||"",captchaToken:e.captchaToken||void 0}),{token:n,user:o}=await s("/register",{method:"POST",body:t});m(n,e.remember!==!1);const r={userId:o.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(r)),window.dispatchEvent(new Event("forum:session")),o}async function g(e){const t=JSON.stringify({usernameOrEmail:e.usernameOrEmail,password:e.password||"1234",otp:e.otp||void 0,captchaToken:e.captchaToken||void 0}),{token:n,user:o}=await s("/login",{method:"POST",body:t});m(n,e.remember!==!1);const r={userId:o.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(r)),window.dispatchEvent(new Event("forum:session")),o}async function w(){if(!f())return null;try{const{user:t}=await s("/me");return t}catch{return y(),null}}async function p(){const{users:e}=await s("/users");return e}async function h(e,t){const{user:n}=await s(`/users/${e}/role`,{method:"PATCH",body:JSON.stringify({role:t})});return n}async function v(){const{invites:e}=await s("/invites");return e}async function b(e=5,t){const{invites:n}=await s("/invites",{method:"POST",body:JSON.stringify({count:e,note:t})});return n}async function I(e,t){const n=JSON.stringify(t?{until:t}:{days:7}),{user:o}=await s("/users/"+encodeURIComponent(e)+"/ban",{method:"POST",body:n});return o}async function O(e){const{user:t}=await s("/users/"+encodeURIComponent(e)+"/unban",{method:"POST"});return t}async function T(e,t){const n=JSON.stringify(t?{until:t}:{minutes:60}),{user:o}=await s("/users/"+encodeURIComponent(e)+"/mute",{method:"POST",body:n});return o}async function P(e){const{user:t}=await s("/users/"+encodeURIComponent(e)+"/unmute",{method:"POST"});return t}async function C(e){await s(`/invites/${encodeURIComponent(e)}`,{method:"DELETE"})}async function k(){const{settings:e}=await s("/settings");return e}async function E(e){const{settings:t}=await s("/settings",{method:"PATCH",body:JSON.stringify(e)});return t}async function N(e){try{const t=await s(`/profiles/by-username/${encodeURIComponent(e)}`);return{user:t.user,profile:t.profile||null,stats:t.stats||null}}catch{return null}}async function U(e){const{profile:t}=await s("/profiles/me",{method:"PATCH",body:JSON.stringify(e)});return t}async function J(e){try{const{profile:t}=await s(`/profiles/${encodeURIComponent(e)}`);return t}catch{return null}}async function A(e,t){const n={labels:Array.isArray(t)?t:[]},{profile:o}=await s(`/profiles/${encodeURIComponent(e)}/labels`,{method:"PATCH",body:JSON.stringify(n)});return o}async function R(e,t=30){const{user:n}=await s(`/users/${encodeURIComponent(e)}/vip`,{method:"POST",body:JSON.stringify({days:t})});return n}async function $(e){const{user:t}=await s(`/users/${encodeURIComponent(e)}/unvip`,{method:"POST"});return t}async function x(){const{members:e}=await s("/members");return e}export{g as a,N as b,y as c,p as d,v as e,k as f,w as g,E as h,J as i,A as j,R as k,x as l,$ as m,b as n,C as o,T as p,P as q,S as r,h as s,I as t,U as u,O as v};
