import{j as n}from"./index-SvquseAp.js";import{R as j}from"./react-vendor-DTkXckhQ.js";import{toggleLikePost as w}from"./forumRemote-D5s3MT8n.js";import{a9 as x,aa as p,ab as R,ac as v,ad as N}from"./icons-wEjUy8Cq.js";const S="forum:",h=t=>`${S}post_reactions:${t}`,i=new Map,d={getItem:t=>i.has(t)?i.get(t):null,setItem:(t,e)=>void i.set(t,e),removeItem:t=>void i.delete(t)},g=(()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}return d})();function k(t,e){try{return t?JSON.parse(t):e}catch{return e}}function l(t){const e={counts:{like:0,smile:0,heart:0,laugh:0,rocket:0,eyes:0},byUser:{}};return k(g.getItem(h(t)),e)}function E(t,e){try{g.setItem(h(t),JSON.stringify(e))}catch{}try{window.dispatchEvent(new CustomEvent("forum:post-reactions",{detail:{postId:t}}))}catch{}}function M(t){return l(t)}function C(t,e){return l(t).byUser[e]}function F(t,e,o){const s=l(t),a=s.byUser[e];return a===o?(s.byUser[e]=void 0,s.counts[o]=Math.max(0,(s.counts[o]||0)-1)):(a&&(s.counts[a]=Math.max(0,(s.counts[a]||0)-1)),s.byUser[e]=o,s.counts[o]=(s.counts[o]||0)+1),E(t,s),s}function J({postId:t,currentUserId:e,onPostUpdated:o}){const[,s]=j.useReducer(c=>c+1,0),a=e?C(t,e):void 0,u=M(t),b=!e,r=({r:c,label:m,Icon:f})=>{var y;return n.jsxs("button",{className:`btn text-xs ${a===c?"btn-primary":""}`,onClick:()=>{e&&(F(t,e,c),s())},title:m,"aria-pressed":a===c,disabled:b,children:[f?n.jsx(f,{size:14}):m,(y=u.counts)!=null&&y[c]?n.jsx("span",{className:"opacity-80",children:u.counts[c]}):null]})};return n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsx("button",{className:"btn text-xs",onClick:async()=>{try{await w(t),o==null||o()}catch{}},title:"Like",children:n.jsx(x,{size:14})}),n.jsx(r,{r:"smile",label:":)",Icon:p}),n.jsx(r,{r:"heart",label:"\u2764",Icon:x}),n.jsx(r,{r:"laugh",label:"\u{1F604}",Icon:R}),n.jsx(r,{r:"rocket",label:"\u{1F680}",Icon:v}),n.jsx(r,{r:"eyes",label:"\u{1F440}",Icon:N})]})}export{J as R};
