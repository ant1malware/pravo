import{c as oe,m as ke,n as de,j as e,o as Se,p as Ce,q as ie,s as ze}from"./index-GmA9HvdW.js";import{u as Ae,R as n}from"./react-vendor-DTkXckhQ.js";import{f as me,g as xe,u as Re,a as we}from"./forumStore-7eEJflxB.js";import{a as ae,b as C,i as Ee,u as $e,f as _e,c as Pe,r as Fe,d as Le,e as De,g as Te,t as Be}from"./socialStore-D4aUy79F.js";import{B as Ie,c as Oe}from"./Badge-DPX5GxXj.js";import{$ as Me,a0 as Ue,a1 as Ge,a2 as pe,a3 as ue,S as he,a4 as fe,a5 as Ve,a6 as Ne,a7 as qe,M as Je,a8 as We,a9 as be}from"./icons-ByfTEOcz.js";const ge={developer:{label:"Разработчик",color:"#22d3ee",glow:"from-cyan-400/35"},admin:{label:"Администратор",color:"#ef4444",glow:"from-rose-400/35"},moderator:{label:"Модератор",color:"#8b5cf6",glow:"from-violet-400/35"},vip:{label:"VIP",color:"#eab308",glow:"from-amber-400/35"},user:{label:"Участник",color:"#94a3b8",glow:"from-slate-300/30"},newbie:{label:"Новичок",color:"#22d3ee",glow:"from-cyan-400/35"}};function ne({value:t,label:s}){return e.jsxs("div",{className:`${w} text-center`,children:[e.jsx("div",{className:"text-3xl font-extrabold text-white",children:t}),e.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-300/80",children:s})]})}function U({title:t,children:s,right:r}){return e.jsxs("div",{className:re,children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:t}),r]}),s]})}function ve({role:t}){const s=le[t]??le.user,r=s.Icon;return e.jsxs("span",{className:"relative inline-flex",children:[e.jsx("span",{className:`absolute -inset-[2px] rounded-full blur-md bg-gradient-to-r ${s.grad} opacity-50`}),e.jsxs("span",{className:"relative inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3.5 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.22em] text-white shadow-[0_0_0_1px_rgba(255,255,255,0.06)_inset]",children:[e.jsx(r,{size:14,className:"opacity-90"}),s.label]})]})}function Xe({role:t}){const s=le[t]??le.user;return e.jsx("span",{className:"rounded-full border border-white/15 bg-black/50 px-2 py-0.5 text-[10px] font-bold uppercase tracking-[0.18em] text-white backdrop-blur",style:{boxShadow:"0 0 16px rgba(255,255,255,0.08), inset 0 0 0 1px rgba(255,255,255,0.05)"},children:s.label})}const Ye={Founder:"from-rose-500/25 to-rose-400/10 text-rose-200",Early:"from-sky-500/25 to-sky-400/10 text-sky-200",Contributor:"from-emerald-500/25 to-emerald-400/10 text-emerald-200",VIP:"from-amber-500/25 to-amber-400/10 text-amber-200",Designer:"from-violet-500/25 to-violet-400/10 text-violet-200"},re="rounded-3xl border border-white/10 bg-[#101321]/85 p-5 shadow-[0_40px_120px_-70px_rgba(15,23,42,0.9)] backdrop-blur",w="rounded-3xl border border-white/10 bg-white/[0.05] p-4 shadow-[0_30px_90px_-70px_rgba(15,23,42,0.85)] backdrop-blur",He=new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",year:"numeric"}),le={owner:{label:"Owner",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:fe},developer:{label:"Developer",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ue},admin:{label:"Admin",grad:"from-rose-400 via-amber-400 to-rose-400",Icon:he},moderator:{label:"Moderator",grad:"from-violet-400 via-sky-400 to-violet-400",Icon:Ve},vip:{label:"Premium",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:fe},user:{label:"User",grad:"from-slate-300 via-slate-400 to-slate-300",Icon:he},newbie:{label:"Newbie",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ue}};function je(t){const s=t.profile||{},r=t.stats||{},a=typeof r.posts=="number"?r.posts:0,c=typeof r.likes=="number"?r.likes:0,m=typeof r.topics=="number"?r.topics:0,x=t.lastActiveAt||t.lastSeenAt||t.lastOnlineAt||null,d=s.accentFrom||"#8b5cf6",b=s.accentTo||"#0ea5e9",v=s.avatarData||s.avatar||s.avatarUrl||void 0,h=s.bannerData||s.banner||s.bannerUrl||void 0,p={bio:s.bio||"",signature:s.signature||"",links:s.links?{...s.links}:{},accentFrom:d,accentTo:b,avatarData:v,bannerData:h,badges:Array.isArray(s.badges)?s.badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0,...s.privacy||{}}};Array.isArray(s.labels)&&(p.labels=s.labels);const j={id:t.user.id,username:t.user.username,email:t.user.email,createdAt:t.user.createdAt,role:t.user.role,userNumber:t.user.userNumber,posts:a,likes:c,topics:m,profile:p,bans:null,mutes:null};return typeof r.score=="number"&&(j.score=r.score),x&&(j.lastActiveAt=x),j}function Ke({badges:t}){return!t||t.length===0?null:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.slice(0,3).map(s=>{const r=Ye[s]||"from-white/20 to-white/5 text-zinc-200";return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border border-white/10 bg-gradient-to-br ${r} px-2.5 py-1 text-xs`,title:`Badge: ${s}`,children:[e.jsx(Ne,{size:14,className:"opacity-90"})," ",s]},s)})})}function ms(){var J,R,W,E,X,$,Y,_,H,P,K,F,Q,L,Z,ee,D,se,T,B;const{username:t=""}=Ae(),[s,r]=n.useState(null),[a,c]=n.useState(null),[m,x]=n.useState(!1),[d,b]=n.useState(!1),[v,h]=n.useState({});n.useEffect(()=>{(async()=>{var o;try{const u=await oe();if(u){x(!0),c({id:u.id,username:u.username});try{const te=await ke(),I={};for(const O of te)I[O.id]=O.username;h(I)}catch{}const f=await de(t);if(f){r(je(f));try{b(!!((o=f.user)!=null&&o.owner))}catch{}return}}}catch{}x(!1),r(me(t)||null);const i=xe();c(i?{id:i.id,username:i.username}:null)})()},[t]),n.useEffect(()=>{const i=async()=>{try{const u=await oe();if(u){c({id:u.id,username:u.username});return}}catch{}const o=xe();c(o?{id:o.id,username:o.username}:null)};return window.addEventListener("forum:session",i),window.addEventListener("storage",i),()=>{window.removeEventListener("forum:session",i),window.removeEventListener("storage",i)}},[]);const p=(s==null?void 0:s.id)||"",[j,y]=n.useState(()=>p?ae(p):[]),[z,N]=n.useState(()=>p?C(p):[]),k=n.useMemo(()=>Ee((a==null?void 0:a.id)||null,p),[a==null?void 0:a.id,p,j.length]);if(n.useEffect(()=>{if(!p){y([]),N([]);return}y(ae(p)),N(C(p))},[p]),n.useEffect(()=>{const i=()=>{p&&(y(ae(p)),N(C(p)))};return window.addEventListener("forum:social-change",i),()=>window.removeEventListener("forum:social-change",i)},[p]),!s)return e.jsx("main",{className:"min-h-screen text-slate-200",style:{background:"radial-gradient(1100px 680px at 15% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-16",children:e.jsx("div",{className:`${re} text-center text-sm text-zinc-300`,children:"Профиль не найден."})})});const G=(a==null?void 0:a.id)===s.id,A=s.profile.accentFrom||"#22d3ee",V=s.profile.accentTo||"#8b5cf6",q=ge[s.role]||ge.user;return e.jsx("main",{className:"min-h-screen text-slate-100",style:{background:"radial-gradient(1200px 700px at 12% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-8 space-y-6",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-[#101321]/85 shadow-[0_50px_140px_-80px_rgba(15,23,42,0.9)] backdrop-blur",children:[e.jsx("div",{className:"h-[220px] w-full",style:{background:s.profile.bannerData?`url(${s.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${A}, ${V})`}}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/15 via-transparent to-black/70"}),e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-white/10 to-transparent mix-blend-overlay"}),e.jsxs("div",{className:"relative -mt-16 flex flex-wrap items-end gap-5 px-6 pb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 overflow-hidden rounded-full border-4 border-[#101321] shadow-[0_25px_70px_-35px_rgba(15,23,42,0.9)]",style:{background:s.profile.avatarData?`url(${s.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${A}, ${V})`}}),e.jsx("div",{className:`absolute -inset-1 -z-10 rounded-full bg-gradient-to-br ${q.glow} to-transparent blur-lg`}),e.jsx("div",{className:"absolute -bottom-2 left-1",children:e.jsx(Xe,{role:s.role})})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-white",children:s.username}),e.jsxs("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.28em] text-zinc-200/80",children:["#",s.userNumber]}),e.jsx(Ie,{points:s.score??Oe({posts:s.posts,likes:s.likes,topics:s.topics})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d&&e.jsx(ve,{role:"owner"}),((R=(J=s.profile)==null?void 0:J.privacy)==null?void 0:R.showSecondaryRole)!==!1&&e.jsx(ve,{role:s.role})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-zinc-300/90",children:[e.jsxs("span",{children:["Joined: ",He.format(new Date(s.createdAt))]}),(W=s.profile.privacy)!=null&&W.showEmail&&s.email?e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-1",children:s.email}):null]}),(()=>{const i=s.lastActiveAt||Se(s.id);return i?e.jsxs("div",{className:"text-xs text-zinc-300/90",children:["Last seen: ",Ce(i)]}):null})(),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ke,{badges:s.profile.badges}),Array.isArray((E=s.profile)==null?void 0:E.labels)&&s.profile.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.profile.labels.slice(0,7).map((i,o)=>e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2.5 py-1 text-xs text-white/85",children:i},o))})]})]}),G?e.jsx(Qe,{user:s,onUpdated:async()=>{if(m){const i=await de(t);i&&r(je(i))}else r(me(t)||null)},saveProfile:async i=>{m?await ie(i):Re(s.id,i)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:`btn ${k?"":"btn-primary"}`,onClick:()=>{a!=null&&a.id&&(k?$e(a.id,s.id):_e(a.id,s.id),y(ae(s.id)))},children:k?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:16})," Отписаться"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{size:16})," Подписаться"]})})})]})]}),m&&G&&d&&e.jsxs("div",{className:re,children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"Вторая роль"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{className:"input",value:(($=(X=s.profile)==null?void 0:X.privacy)==null?void 0:$.showSecondaryRole)===!1?"none":s.role,onChange:async i=>{var u;const o=i.target.value;try{const f=((u=s.profile)==null?void 0:u.privacy)||{showEmail:!1,showStats:!0};o==="none"?(await ie({privacy:{...f,showSecondaryRole:!1}}),r({...s,profile:{...s.profile,privacy:{...f,showSecondaryRole:!1}}})):(await ze(s.id,o),await ie({privacy:{...f,showSecondaryRole:!0}}),r({...s,role:o,profile:{...s.profile,privacy:{...f,showSecondaryRole:!0}}}))}catch(f){alert((f==null?void 0:f.message)||"Не удалось изменить роль")}},children:[e.jsx("option",{value:"none",children:"Не показывать"}),e.jsx("option",{value:"developer",children:"Разработчик"}),e.jsx("option",{value:"admin",children:"Администратор"}),e.jsx("option",{value:"moderator",children:"Модератор"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"user",children:"Участник"}),e.jsx("option",{value:"newbie",children:"Новичок"})]}),e.jsx("div",{className:"text-xs text-zinc-300/80",children:"Роль владельца постоянна; здесь можно выбрать отображаемую."})]})]}),((_=(Y=s.profile)==null?void 0:Y.privacy)==null?void 0:_.showStats)!==!1&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(ne,{value:s.posts,label:"Посты"}),e.jsx(ne,{value:s.topics,label:"Темы"}),e.jsx(ne,{value:s.likes,label:"Лайки"})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsx(U,{title:"О себе",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:s.profile.bio||"Пока нет описания."})}),((P=(H=s.profile)==null?void 0:H.privacy)==null?void 0:P.showLinks)!==!1&&e.jsx(U,{title:"Ссылки",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:[((K=s.profile.links)==null?void 0:K.website)&&e.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",href:s.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(Ge,{size:14})," Сайт"]}),((F=s.profile.links)==null?void 0:F.discord)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(pe,{size:14})," ",s.profile.links.discord]}),((Q=s.profile.links)==null?void 0:Q.telegram)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(pe,{size:14})," ",s.profile.links.telegram]}),!((L=s.profile.links)!=null&&L.website)&&!((Z=s.profile.links)!=null&&Z.discord)&&!((ee=s.profile.links)!=null&&ee.telegram)&&e.jsx("span",{className:"opacity-70",children:"Ссылки ещё не добавлены."})]})})]}),e.jsx(U,{title:"Подпись",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:s.profile.signature||"Подпись не заполнена."})}),((se=(D=s.profile)==null?void 0:D.privacy)==null?void 0:se.showFollowers)!==!1&&e.jsx(U,{title:`Подписчики (${j.length})`,children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:j.length===0?e.jsx("span",{className:"opacity-70",children:"Подписчиков пока нет."}):j.slice(0,18).map(i=>{const o=we(i),u=(o==null?void 0:o.username)||v[i];return e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1",children:u?e.jsx("a",{href:`/forum/profile/${u}`,className:"hover:underline",children:u}):"Участник"},i)})})}),((B=(T=s.profile)==null?void 0:T.privacy)==null?void 0:B.allowComments)!==!1&&e.jsx(U,{title:"Комментарии профиля",children:e.jsxs("div",{className:"grid gap-3",children:[(a==null?void 0:a.id)&&e.jsx(ss,{onPost:i=>{a!=null&&a.id&&(Pe(s.id,a.id,i,{authorName:a.username}),N(C(s.id)))}}),e.jsxs("div",{className:"grid gap-2",children:[z.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"Комментариев пока нет."}),ts(z).map(i=>e.jsx(ye,{node:i,currentUserId:(a==null?void 0:a.id)||"",ownerId:s.id,onReply:(o,u)=>{a!=null&&a.id&&(Le(s.id,a.id,o,u,a.username),N(C(s.id)))},onDelete:o=>{a!=null&&a.id&&(Fe(s.id,o,a.id),N(C(s.id)))}},i.comment.id))]})]})})]})})}function Qe({user:t,onUpdated:s,saveProfile:r}){const[a,c]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>c(!0),children:[e.jsx(qe,{size:16})," Настроить профиль"]}),a&&e.jsx(es,{user:t,onClose:()=>c(!1),onSaved:()=>{s(),c(!1)},saveProfile:r})]})}const Ze=["Founder","Early","Contributor","VIP","Designer"];function es({user:t,onClose:s,onSaved:r,saveProfile:a}){var T,B,i,o,u,f,te,I,O;const[c,m]=n.useState(t.profile.avatarData||""),[x,d]=n.useState(t.profile.bannerData||""),[b,v]=n.useState(t.profile.accentFrom||"#22d3ee"),[h,p]=n.useState(t.profile.accentTo||"#8b5cf6"),[j,y]=n.useState(t.profile.bio||""),[z,N]=n.useState(t.profile.signature||""),[k,G]=n.useState(((T=t.profile.links)==null?void 0:T.website)||""),[A,V]=n.useState(((B=t.profile.links)==null?void 0:B.discord)||""),[q,J]=n.useState(((i=t.profile.links)==null?void 0:i.telegram)||""),[R,W]=n.useState(t.profile.badges||[]),[E,X]=n.useState(((o=t.profile.privacy)==null?void 0:o.showEmail)??!1),[$,Y]=n.useState(((u=t.profile.privacy)==null?void 0:u.showStats)??!0),[_,H]=n.useState(((f=t.profile.privacy)==null?void 0:f.showLinks)??!0),[P,K]=n.useState(((te=t.profile.privacy)==null?void 0:te.allowComments)??!0),[F,Q]=n.useState(((I=t.profile.privacy)==null?void 0:I.showFollowers)??!0),[L,Z]=n.useState(((O=t.profile.privacy)==null?void 0:O.showSecondaryRole)!==!1),ee=l=>{W(g=>g.includes(l)?g.filter(S=>S!==l):g.length>=3?g:[...g,l])},D=l=>g=>{var ce;const S=(ce=g.target.files)==null?void 0:ce[0];if(!S)return;const M=new FileReader;M.onload=()=>l(String(M.result||"")),M.readAsDataURL(S)},se=async()=>{const l={website:k.trim(),discord:A.trim(),telegram:q.trim()},g=Object.fromEntries(Object.entries(l).filter(([,M])=>M)),S={...t.profile.privacy||{},showEmail:E,showStats:$,showLinks:_,allowComments:P,showFollowers:F,showSecondaryRole:L};await a({avatarData:c||void 0,bannerData:x||void 0,accentFrom:b,accentTo:h,bio:j.trim()||void 0,signature:z.trim()||void 0,links:Object.keys(g).length?g:void 0,badges:R,privacy:S}),r()};return e.jsx("div",{className:"fixed inset-0 z-[120] flex items-start justify-center bg-black/70 px-4 py-8 overflow-y-auto",children:e.jsxs("div",{className:`${re} w-[min(820px,96vw)]`,style:{position:"relative"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Настройка профиля"}),e.jsx("button",{className:"btn",onClick:s,children:"Закрыть"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:w,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Аватар"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:c?`url(${c}) center/cover`:`linear-gradient(135deg, ${b}, ${h})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(be,{size:16})," Загрузить",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:D(m)})]}),c&&e.jsx("button",{className:"btn",onClick:()=>m(""),children:"Удалить"})]})]})]}),e.jsxs("div",{className:w,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Баннер"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:x?`url(${x}) center/cover`:`linear-gradient(135deg, ${b}, ${h})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(be,{size:16})," Загрузить",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:D(d)})]}),x&&e.jsx("button",{className:"btn",onClick:()=>d(""),children:"Удалить"})]})]}),e.jsxs("div",{className:w,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Градиент"}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"От"}),e.jsx("input",{type:"color",value:b,onChange:l=>v(l.target.value)})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"До"}),e.jsx("input",{type:"color",value:h,onChange:l=>p(l.target.value)})]})]})]}),e.jsxs("div",{className:w,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Бейджи (до 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ze.map(l=>{const g=R.includes(l);return e.jsxs("button",{className:`btn flex items-center gap-2 ${g?"btn-primary":""}`,onClick:()=>ee(l),type:"button",title:g?"Нажмите, чтобы убрать":"Нажмите, чтобы добавить",children:[e.jsx(Ne,{size:16})," ",l]},l)})})]}),e.jsxs("div",{className:`${w} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"О себе"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:j,onChange:l=>y(l.target.value),placeholder:"Расскажите сообществу немного о себе"})]}),e.jsxs("div",{className:`${w} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Подпись"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:z,onChange:l=>N(l.target.value),placeholder:"Текст, который появится под вашими сообщениями"})]}),e.jsxs("div",{className:`${w} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Ссылки"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:k,onChange:l=>G(l.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:A,onChange:l=>V(l.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:q,onChange:l=>J(l.target.value)})]})]}),e.jsxs("div",{className:`${w} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Приватность"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:l=>X(l.target.checked)})," Показывать e-mail"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:l=>Y(l.target.checked)})," Показывать статистику"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:l=>H(l.target.checked)})," Показывать ссылки"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:l=>Z(l.target.checked)})," Показывать вторую роль"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:l=>Q(l.target.checked)})," Показывать подписчиков"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:l=>K(l.target.checked)})," Разрешить комментарии"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:s,children:"Отмена"}),e.jsx("button",{className:"btn btn-primary",onClick:se,children:"Сохранить"})]})]})]})})}function ss({onPost:t}){const[s,r]=n.useState("");return e.jsxs("div",{className:w,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Je,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Напишите комментарий...",value:s,onChange:a=>r(a.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=s.trim();a&&(t(a),r(""))},children:"Отправить"})})]})}function ts(t){const s={};t.forEach(c=>{s[c.id]={comment:c,replies:[]}});const r=[];t.forEach(c=>{const m=c.parentId||"";m&&s[m]?s[m].replies.push(s[c.id]):r.push(s[c.id])}),r.sort((c,m)=>c.comment.createdAt<m.comment.createdAt?1:-1);const a=c=>c.replies.sort((m,x)=>m.comment.createdAt>x.comment.createdAt?1:-1).forEach(a);return r.forEach(a),r}function ye({node:t,currentUserId:s,ownerId:r,onReply:a,onDelete:c}){const[m,x]=n.useState(!1),d=we(t.comment.authorId),b=t.comment.authorName||(d==null?void 0:d.username)||(t.comment.authorId===r?"Владелец":t.comment.authorId===s?"Вы":"Участник"),v=(d==null?void 0:d.username)||t.comment.authorName;return e.jsx("div",{className:w,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-zinc-300/90",children:[v?e.jsx("a",{href:`/forum/profile/${v}`,className:"font-semibold text-white hover:underline",children:b}):e.jsx("span",{className:"font-semibold text-white",children:b}),e.jsxs("span",{className:"opacity-70",children:[" · ",new Date(t.comment.createdAt).toLocaleString("ru-RU")]})]}),(s===t.comment.authorId||s===r)&&e.jsx("button",{className:"btn",title:"Удалить",onClick:()=>c(t.comment.id),children:e.jsx(We,{size:14})})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:t.comment.content}),e.jsx(rs,{targetId:r,commentId:t.comment.id,currentUserId:s}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>x(h=>!h),children:"Ответить"})}),m&&e.jsx("div",{className:"mt-2",children:e.jsx(as,{onSend:h=>{a(t.comment.id,h),x(!1)}})}),t.replies.length>0&&e.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:t.replies.map(h=>e.jsx(ye,{node:h,currentUserId:s,ownerId:r,onReply:a,onDelete:c},h.comment.id))})]})]})})}function as({onSend:t}){const[s,r]=n.useState("");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"Ответ...",value:s,onChange:a=>r(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=s.trim();a&&(t(a),r(""))},children:"Отправить"})]})}function rs({targetId:t,commentId:s,currentUserId:r}){const[,a]=n.useReducer(d=>d+1,0),c=De(t)[s]||{counts:{like:0,smile:0,useful:0}},m=r?Te(t,s,r):void 0,x=({r:d,label:b})=>{var v;return e.jsxs("button",{className:`btn text-xs ${m===d?"btn-primary":""}`,onClick:()=>{r&&(Be(t,s,r,d),a())},children:[b," ",(v=c.counts)!=null&&v[d]?e.jsx("span",{className:"opacity-80",children:c.counts[d]}):null]})};return e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx(x,{r:"like",label:"👍"}),e.jsx(x,{r:"smile",label:"😊"}),e.jsx(x,{r:"useful",label:"💡"})]})}export{ms as default};
