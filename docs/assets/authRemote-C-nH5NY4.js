function d(){try{const t=new URL(window.location.href),s=t.searchParams.get("api");if(s){localStorage.setItem("forum:api_base",s);try{t.searchParams.delete("api"),history.replaceState({},"",t.toString())}catch{}}const n=localStorage.getItem("forum:api_base");if(n)return n}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const S=d(),i="forum:token",c="forum:session";function m(e,t=!0){(t?localStorage:sessionStorage).setItem(i,e)}function f(){return localStorage.getItem(i)??sessionStorage.getItem(i)}function g(){try{localStorage.removeItem(i),sessionStorage.removeItem(i),localStorage.removeItem(c),sessionStorage.removeItem(c)}finally{window.dispatchEvent(new Event("forum:session"))}}async function o(e,t={}){const s=f(),n={"Content-Type":"application/json",...t.headers||{}};s&&(n.Authorization=`Bearer ${s}`);const r=await fetch(`${S}${e}`,{...t,headers:n}),u=await r.text();let a={};try{a=u?JSON.parse(u):{}}catch{a={error:u||r.statusText}}if(!r.ok)throw new Error((a==null?void 0:a.error)||`${r.status} ${r.statusText}`);return a}async function y(e){const t=JSON.stringify({username:e.username,email:e.email,password:e.password||"1234",inviteCode:e.inviteCode||""}),{token:s,user:n}=await o("/register",{method:"POST",body:t});m(s,e.remember!==!1);const r={userId:n.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(r)),window.dispatchEvent(new Event("forum:session")),n}async function l(e){const t=JSON.stringify({usernameOrEmail:e.usernameOrEmail,password:e.password||"1234"}),{token:s,user:n}=await o("/login",{method:"POST",body:t});m(s,e.remember!==!1);const r={userId:n.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(c,JSON.stringify(r)),window.dispatchEvent(new Event("forum:session")),n}async function w(){if(!f())return null;try{const{user:t}=await o("/me");return t}catch{return g(),null}}async function h(){const{users:e}=await o("/users");return e}async function v(e,t){const{user:s}=await o(`/users/${e}/role`,{method:"PATCH",body:JSON.stringify({role:t})});return s}async function O(){const{invites:e}=await o("/invites");return e}async function I(e=5,t){const{invites:s}=await o("/invites",{method:"POST",body:JSON.stringify({count:e,note:t})});return s}async function b(e,t){const s=JSON.stringify(t?{until:t}:{days:7}),{user:n}=await o("/users/"+encodeURIComponent(e)+"/ban",{method:"POST",body:s});return n}async function p(e){const{user:t}=await o("/users/"+encodeURIComponent(e)+"/unban",{method:"POST"});return t}async function E(e,t){const s=JSON.stringify(t?{until:t}:{minutes:60}),{user:n}=await o("/users/"+encodeURIComponent(e)+"/mute",{method:"POST",body:s});return n}async function T(e){const{user:t}=await o("/users/"+encodeURIComponent(e)+"/unmute",{method:"POST"});return t}async function N(e){await o(`/invites/${encodeURIComponent(e)}`,{method:"DELETE"})}async function k(){const{settings:e}=await o("/settings");return e}async function J(e){const{settings:t}=await o("/settings",{method:"PATCH",body:JSON.stringify(e)});return t}export{l as a,O as b,g as c,k as d,I as e,N as f,w as g,T as h,b as i,p as j,h as l,E as m,y as r,v as s,J as u};
