import{j as e}from"./index-Cy752Q7-.js";import{u as ge,R as c}from"./react-vendor-DTkXckhQ.js";import{g as se,e as ae,f as re,a as ne,u as je,h as ve,j as ce}from"./authRemote-D11BmuEn.js";import{a0 as be,a1 as Ne,a2 as we,a3 as ie,a4 as ke,M as ye,a5 as Se,a6 as le,a7 as Ce}from"./icons-BazunPJY.js";const oe="forum:follows";function O(){try{return JSON.parse(localStorage.getItem(oe)||"[]")}catch{return[]}}function de(s){try{localStorage.setItem(oe,JSON.stringify(s))}catch{}}function J(s){return O().filter(t=>t.targetId===s).map(t=>t.followerId)}function ze(s,t){return s?O().some(r=>r.followerId===s&&r.targetId===t):!1}function Ae(s,t){if(s===t)return;const r=O();r.some(a=>a.followerId===s&&a.targetId===t)||(r.push({followerId:s,targetId:t,createdAt:new Date().toISOString()}),de(r))}function Fe(s,t){const r=O().filter(a=>!(a.followerId===s&&a.targetId===t));de(r)}function me(s){return`forum:profile_comments:${s}`}function Y(s){try{return JSON.parse(localStorage.getItem(me(s))||"[]")}catch{return[]}}function xe(s,t){try{localStorage.setItem(me(s),JSON.stringify(t))}catch{}}function A(s){return Y(s).sort((r,a)=>r.createdAt<a.createdAt?1:-1)}function ue(s,t,r,a){const i=r.trim(),o={id:crypto.randomUUID(),targetId:s,authorId:t,authorName:a==null?void 0:a.authorName,content:i,createdAt:new Date().toISOString(),parentId:(a==null?void 0:a.parentId)||null},u=Y(s);return u.unshift(o),xe(s,u),o}function Ee(s,t,r){const i=Y(s).filter(o=>!(o.id===t&&(o.authorId===r||s===r)));xe(s,i)}function Le(s,t,r,a,i){return ue(s,t,a,{authorName:i,parentId:r})}const De={developer:{label:"Developer",color:"#22d3ee"},admin:{label:"Admin",color:"#ef4444"},moderator:{label:"Moderator",color:"#8b5cf6"},vip:{label:"VIP",color:"#eab308"},user:{label:"User",color:"#94a3b8"},newbie:{label:"Newbie",color:"#22d3ee"}},Pe=["Founder","Early","Contributor","VIP","Designer"];function Ie({role:s}){const t=De[s]||{label:s,color:"#94a3b8"};return e.jsx("span",{className:"rounded-full border border-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.26em]",style:{color:t.color},children:t.label})}function W({value:s,label:t}){return e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-extrabold text-white",children:s}),e.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:t})]})}function F({title:s,children:t}){return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.28em] text-zinc-400/70",children:s}),t]})}function We(){var N,L,w,D,k,P,y,I,S,$,C,R,z,T;const{username:s=""}=ge(),[t,r]=c.useState(null),[a,i]=c.useState(null),[o,u]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const m=await se();if(m){u(!0),i({id:m.id,username:m.username});const x=await ae(s);if(x){const M={id:x.user.id,username:x.user.username,email:x.user.email,createdAt:x.user.createdAt,role:x.user.role,userNumber:x.user.userNumber,posts:0,likes:0,topics:0,profile:x.profile||{bio:"",signature:"",links:{},accentFrom:"#8b5cf6",accentTo:"#0ea5e9",badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0}},bans:null,mutes:null};r(M);return}}}catch{}u(!1),r(re(s)||null);const l=ne();i(l?{id:l.id,username:l.username}:null)})()},[s]),c.useEffect(()=>{const l=async()=>{try{const x=await se();if(x){i({id:x.id,username:x.username});return}}catch{}const m=ne();i(m?{id:m.id,username:m.username}:null)};return window.addEventListener("forum:session",l),window.addEventListener("storage",l),()=>{window.removeEventListener("forum:session",l),window.removeEventListener("storage",l)}},[]);const d=(t==null?void 0:t.id)||"",[p,h]=c.useState(()=>d?J(d):[]),[g,j]=c.useState(()=>d?A(d):[]),v=c.useMemo(()=>ze((a==null?void 0:a.id)||null,d),[a==null?void 0:a.id,d,p.length]);if(c.useEffect(()=>{if(!d){h([]),j([]);return}h(J(d)),j(A(d))},[d]),!t)return e.jsx("main",{className:"min-h-screen bg-slate-950 text-slate-200",children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-12",children:e.jsx("div",{className:"card p-6 text-center text-sm text-zinc-300",children:"Profile not found."})})});const U=(a==null?void 0:a.id)===t.id,b=t.profile.accentFrom||"#22d3ee",E=t.profile.accentTo||"#8b5cf6";return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 20% -10%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1100px 760px at 95% 8%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-[180px] w-full",style:{background:t.profile.bannerData?`url(${t.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${b}, ${E})`}}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/40"})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 px-4 pb-4 -mt-16",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-full ring-4 ring-[rgba(13,19,33,0.85)] shadow-lg",style:{background:t.profile.avatarData?`url(${t.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${b}, ${E})`}}),e.jsx("div",{className:"absolute -inset-0.5 -z-10 rounded-full bg-gradient-to-br from-white/20 to-transparent blur-md"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-white",children:t.username}),e.jsx(Ie,{role:t.role}),e.jsxs("span",{className:"text-xs text-zinc-400/80",children:["#",t.userNumber]})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:["Joined ",new Date(t.createdAt).toLocaleDateString()]})]}),U?e.jsx($e,{user:t,onUpdated:async()=>{if(o){const l=await ae(s);l&&r({id:l.user.id,username:l.user.username,email:l.user.email,createdAt:l.user.createdAt,role:l.user.role,userNumber:l.user.userNumber,posts:0,likes:0,topics:0,profile:l.profile,bans:null,mutes:null})}else r(re(s)||null)},saveProfile:async l=>{o?await je(l):ve(t.id,l)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:`btn ${v?"":"btn-primary"}`,onClick:()=>{a!=null&&a.id&&(v?Fe(a.id,t.id):Ae(a.id,t.id),h(J(t.id)))},children:v?e.jsxs(e.Fragment,{children:[e.jsx(be,{size:16})," Unfollow"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:16})," Follow"]})})})]})]}),((L=(N=t.profile)==null?void 0:N.privacy)==null?void 0:L.showStats)!==!1&&e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(W,{value:t.posts,label:"Posts"})}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(W,{value:t.topics,label:"Topics"})}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4 text-center",children:e.jsx(W,{value:t.likes,label:"Likes"})})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsx(F,{title:"About",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:t.profile.bio||"No bio yet."})}),((D=(w=t.profile)==null?void 0:w.privacy)==null?void 0:D.showLinks)!==!1&&e.jsx(F,{title:"Links",children:e.jsxs("div",{className:"grid gap-2 text-sm text-zinc-200/80",children:[(k=t.profile.links)!=null&&k.website?e.jsxs("a",{className:"flex items-center gap-2 text-sky-300 hover:text-sky-200",href:t.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(we,{size:14}),t.profile.links.website]}):null,(P=t.profile.links)!=null&&P.discord?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:14})," Discord: ",t.profile.links.discord]}):null,(y=t.profile.links)!=null&&y.telegram?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:14})," Telegram: ",t.profile.links.telegram]}):null,!((I=t.profile.links)!=null&&I.website)&&!((S=t.profile.links)!=null&&S.discord)&&!(($=t.profile.links)!=null&&$.telegram)&&e.jsx("span",{children:"No links added."})]})})]}),e.jsx(F,{title:"Signature",children:e.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/80",children:t.profile.signature||"No signature."})}),((R=(C=t.profile)==null?void 0:C.privacy)==null?void 0:R.showFollowers)!==!1&&e.jsx(F,{title:`Followers (${p.length})`,children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/80",children:p.length===0?e.jsx("span",{children:"No followers yet."}):p.slice(0,14).map(l=>{const m=ce(l);return e.jsx("span",{className:"rounded-full bg-white/5 px-3 py-1",children:(m==null?void 0:m.username)||"User"},l)})})}),((T=(z=t.profile)==null?void 0:z.privacy)==null?void 0:T.allowComments)!==!1&&e.jsx(F,{title:"Profile comments",children:e.jsxs("div",{className:"grid gap-3",children:[(a==null?void 0:a.id)&&e.jsx(Te,{onPost:l=>{a!=null&&a.id&&(ue(t.id,a.id,l,{authorName:a.username}),j(A(t.id)))}}),e.jsxs("div",{className:"grid gap-2",children:[g.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"No comments yet."}),Be(g).map(l=>e.jsx(pe,{node:l,currentUserId:(a==null?void 0:a.id)||"",ownerId:t.id,onReply:(m,x)=>{a!=null&&a.id&&(Le(t.id,a.id,m,x,a.username),j(A(t.id)))},onDelete:m=>{a!=null&&a.id&&(Ee(t.id,m,a.id),j(A(t.id)))}},l.comment.id))]})]})})]})})}function $e({user:s,onUpdated:t,saveProfile:r}){const[a,i]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>i(!0),children:[e.jsx(ke,{size:16})," Settings"]}),a&&e.jsx(Re,{user:s,onClose:()=>i(!1),onSaved:()=>{t(),i(!1)},saveProfile:r})]})}function Re({user:s,onClose:t,onSaved:r,saveProfile:a}){var K,V,q,H,Q,X,Z,ee;const[i,o]=c.useState(s.profile.avatarData||""),[u,d]=c.useState(s.profile.bannerData||""),[p,h]=c.useState(s.profile.accentFrom||"#22d3ee"),[g,j]=c.useState(s.profile.accentTo||"#8b5cf6"),[v,U]=c.useState(s.profile.bio||""),[b,E]=c.useState(s.profile.signature||""),[N,L]=c.useState(((K=s.profile.links)==null?void 0:K.website)||""),[w,D]=c.useState(((V=s.profile.links)==null?void 0:V.discord)||""),[k,P]=c.useState(((q=s.profile.links)==null?void 0:q.telegram)||""),[y,I]=c.useState(s.profile.badges||[]),[S,$]=c.useState(((H=s.profile.privacy)==null?void 0:H.showEmail)??!1),[C,R]=c.useState(((Q=s.profile.privacy)==null?void 0:Q.showStats)??!0),[z,T]=c.useState(((X=s.profile.privacy)==null?void 0:X.showLinks)??!0),[l,m]=c.useState(((Z=s.profile.privacy)==null?void 0:Z.allowComments)??!0),[x,M]=c.useState(((ee=s.profile.privacy)==null?void 0:ee.showFollowers)??!0),he=n=>{I(f=>f.includes(n)?f.filter(B=>B!==n):f.length>=3?f:[...f,n])},G=n=>f=>{var te;const B=(te=f.target.files)==null?void 0:te[0];if(!B)return;const _=new FileReader;_.onload=()=>n(String(_.result||"")),_.readAsDataURL(B)},fe=async()=>{await a({avatarData:i||void 0,bannerData:u||void 0,accentFrom:p,accentTo:g,bio:v.trim()||void 0,signature:b.trim()||void 0,links:{website:N.trim()||void 0,discord:w.trim()||void 0,telegram:k.trim()||void 0},badges:y,privacy:{showEmail:S,showStats:C,showLinks:z,allowComments:l,showFollowers:x}}),r()};return e.jsx("div",{className:"fixed inset-0 z-[120] grid place-items-center bg-black/70 px-4 py-6",children:e.jsxs("div",{className:"card w-[min(780px,96vw)] max-h-[90vh] overflow-y-auto p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Customize profile"}),e.jsx("button",{className:"btn",onClick:t,children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Avatar"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:i?`url(${i}) center/cover`:`linear-gradient(135deg, ${p}, ${g})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(le,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:G(o)})]}),i&&e.jsx("button",{className:"btn",onClick:()=>o(""),children:"Remove"})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Banner"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:u?`url(${u}) center/cover`:`linear-gradient(135deg, ${p}, ${g})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(le,{size:16}),"Upload",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:G(d)})]}),u&&e.jsx("button",{className:"btn",onClick:()=>d(""),children:"Remove"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Accent"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"From"}),e.jsx("input",{type:"color",value:p,onChange:n=>h(n.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-zinc-400/80",children:"To"}),e.jsx("input",{type:"color",value:g,onChange:n=>j(n.target.value)})]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Badges (max 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Pe.map(n=>{const f=y.includes(n);return e.jsxs("button",{className:`btn flex items-center gap-2 ${f?"btn-primary":""}`,onClick:()=>he(n),type:"button",children:[e.jsx(Ce,{size:16})," ",n]},n)})})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Bio"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:v,onChange:n=>U(n.target.value),placeholder:"Tell the community a bit about yourself"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Signature"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:b,onChange:n=>E(n.target.value),placeholder:"Signature displayed under your posts"})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Links"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:N,onChange:n=>L(n.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:w,onChange:n=>D(n.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:k,onChange:n=>P(n.target.value)})]})]}),e.jsxs("div",{className:"card p-4 sm:col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"Privacy"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:n=>$(n.target.checked)})," Show email"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:n=>R(n.target.checked)})," Show stats (posts, topics, likes)"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:n=>T(n.target.checked)})," Show links"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:n=>M(n.target.checked)})," Show followers"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:n=>m(n.target.checked)})," Allow comments on profile"]})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:fe,children:"Save changes"})]})]})})}function Te({onPost:s}){const[t,r]=c.useState("");return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"Write a comment...",value:t,onChange:a=>r(a.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=t.trim();a&&(s(a),r(""))},children:"Post comment"})})]})}function Be(s){const t={};s.forEach(i=>{t[i.id]={comment:i,replies:[]}});const r=[];s.forEach(i=>{const o=i.parentId||"";o&&t[o]?t[o].replies.push(t[i.id]):r.push(t[i.id])}),r.sort((i,o)=>i.comment.createdAt<o.comment.createdAt?1:-1);const a=i=>i.replies.sort((o,u)=>o.comment.createdAt>u.comment.createdAt?1:-1).forEach(a);return r.forEach(a),r}function pe({node:s,currentUserId:t,ownerId:r,onReply:a,onDelete:i}){const[o,u]=c.useState(!1),d=ce(s.comment.authorId),p=s.comment.authorName||(d==null?void 0:d.username)||(s.comment.authorId===r?"Owner":s.comment.authorId===t?"You":"User");return e.jsx("div",{className:"rounded-xl border border-white/5 bg-white/3 p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-zinc-300/90",children:[d!=null&&d.username?e.jsx("a",{href:`/forum/profile/${d.username}`,className:"font-semibold text-white hover:underline",children:p}):e.jsx("span",{className:"font-semibold text-white",children:p}),e.jsxs("span",{className:"opacity-70",children:[" · ",new Date(s.comment.createdAt).toLocaleString()]})]}),(t===s.comment.authorId||t===r)&&e.jsx("button",{className:"btn",title:"Delete",onClick:()=>i(s.comment.id),children:e.jsx(Se,{size:14})})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:s.comment.content}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>u(h=>!h),children:"Reply"})}),o&&e.jsx("div",{className:"mt-2",children:e.jsx(Oe,{onSend:h=>{a(s.comment.id,h),u(!1)}})}),s.replies.length>0&&e.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:s.replies.map(h=>e.jsx(pe,{node:h,currentUserId:t,ownerId:r,onReply:a,onDelete:i},h.comment.id))})]})]})})}function Oe({onSend:s}){const[t,r]=c.useState("");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"Write a reply...",value:t,onChange:a=>r(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const a=t.trim();a&&(s(a),r(""))},children:"Send"})]})}export{We as default};
