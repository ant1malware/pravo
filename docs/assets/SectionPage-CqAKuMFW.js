import{j as u}from"./index-SvquseAp.js";import{u as P,R as a,L as b}from"./react-vendor-DTkXckhQ.js";import{listSections as L,listTopics as R,createTopic as z}from"./forumRemote-D5s3MT8n.js";import{F as I,t as j}from"./ForumSubnav-Cb6ZP_YC.js";import{M}from"./MarkdownEditor-tV_H8sgp.js";import{F as K}from"./FavStar-DA837_J-.js";import{a1 as O,a2 as U,a3 as _}from"./icons-wEjUy8Cq.js";import"./purify.es-DnfDK_hS.js";function u4(){const{id:n=""}=P(),[i,g]=a.useState(null),[d,v]=a.useState([]),[w,N]=a.useState(""),[m,E]=a.useState(""),[y,C]=a.useState(!1),[r,c]=a.useState("all"),[o,S]=a.useState("all"),[p,x]=a.useState(20),[A,B]=a.useState(!1),h=a.useCallback(async()=>{try{const[e,s]=await Promise.all([L(),R(n)]);g(e.find(l=>l.id===n)||null),v(Array.isArray(s)?s:[])}catch{g(null),v([])}},[n]);a.useEffect(()=>{h()},[h]);const t=((i==null?void 0:i.title)||"").toLowerCase()==="workshop",T=a.useMemo(()=>{const e=new Set;for(const s of d){const l=String(s.title||"").match(/\[(.+?)\]/g)||[];for(const W of l){const $=W.replace(/[\[\]]/g,"");["wip","review","done"].includes($.toLowerCase())||e.add($)}}return Array.from(e).sort((s,l)=>s.localeCompare(l))},[d]),D=async e=>{e.preventDefault();const s=w.trim();if(s){if(t&&!m.trim()){alert("\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0435\u043A\u0442\u0430 \u043F\u0435\u0440\u0435\u0434 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0435\u0439.");return}C(!0);try{await z({sectionId:n,title:s,content:t?m:void 0}),N(""),E(""),h()}catch(l){alert((l==null?void 0:l.message)||"Failed to create topic")}finally{C(!1)}}};function f(e){const s=(e||"").toLowerCase();return s.startsWith("[wip]")?"wip":s.startsWith("[review]")?"review":s.startsWith("[done]")?"done":"none"}const F=d.filter(e=>r==="all"?!0:f(e.title)===r).filter(e=>o==="all"?!0:new RegExp(`\\[${o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}\\]`,"i").test(String(e.title||""))),k=F.slice(0,p);return u.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 620px at 18% -12%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1200px 760px at 92% 0%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:u.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6",children:[u.jsx(I,{}),u.jsxs("nav",{className:"mb-3 text-sm opacity-80",children:[u.jsx(b,{to:"/forum",className:"hover:underline",children:j("\u0424\u043E\u0440\u0443\u043C","Forum")}),u.jsx("span",{className:"mx-2",children:"/"}),u.jsx("span",{children:(i==null?void 0:i.title)||"..."})]}),u.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[u.jsxs(b,{to:"/forum",className:"btn flex items-center gap-2",children:[u.jsx(O,{size:16})," Back"]}),u.jsx("div",{className:"text-sm opacity-70",children:"Section"}),u.jsx("div",{className:"font-semibold",children:(i==null?void 0:i.title)||"..."})]}),t&&u.jsxs("div",{className:"card mb-4 p-4",children:[u.jsxs("div",{className:"mb-2 flex items-center gap-2 font-semibold",children:[u.jsx(U,{size:16})," Workshop: \u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u0438"]}),u.jsx("div",{className:"text-sm opacity-70",children:"\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043F\u0440\u0435\u0444\u0438\u043A\u0441\u044B \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0432 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A: [WIP], [Review], [Done]. \u041F\u0438\u0448\u0438\u0442\u0435 \u043A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435, \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u0441\u0442\u0435\u043A \u0438 \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u2014 \u0431\u0443\u0434\u0435\u0442 \u043F\u0440\u043E\u0449\u0435 \u0440\u0435\u0432\u044C\u044E\u0438\u0442\u044C."}),u.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs",children:[u.jsx("button",{className:`tab ${r==="all"?"tab-active":""}`,onClick:()=>c("all"),children:"All"}),u.jsx("button",{className:`tab ${r==="wip"?"tab-active":""}`,onClick:()=>c("wip"),children:"[WIP]"}),u.jsx("button",{className:`tab ${r==="review"?"tab-active":""}`,onClick:()=>c("review"),children:"[Review]"}),u.jsx("button",{className:`tab ${r==="done"?"tab-active":""}`,onClick:()=>c("done"),children:"[Done]"})]})]}),t&&!A&&u.jsx("div",{className:"mb-3 flex justify-end",children:u.jsx("button",{className:"btn btn-primary",onClick:()=>B(!0),children:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u043E\u0435\u043A\u0442"})}),(!t||A)&&u.jsxs("form",{onSubmit:D,className:"card mb-4 grid gap-2 p-4",children:[u.jsx("input",{className:"input",placeholder:t?"[WIP] \u041A\u043E\u0440\u043E\u0442\u043A\u0438\u0439 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u0430":"Topic title",value:w,onChange:e=>N(e.target.value),disabled:y}),t&&u.jsx(M,{value:m,onChange:E,placeholder:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0435\u043A\u0442\u0430...",projectTemplate:!0,draftKey:i?`forum:draft:new:${i.id}`:void 0}),u.jsxs("button",{className:"btn btn-primary flex items-center gap-2",disabled:y,children:[u.jsx(_,{size:16})," ",t?"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u043E\u0435\u043A\u0442":"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0435\u043C\u0443"]})]}),u.jsxs("div",{className:t?"grid gap-4 md:grid-cols-2 lg:grid-cols-3":"grid gap-3",children:[!t&&u.jsxs("div",{className:"card flex flex-wrap items-center gap-2 p-2 text-xs",children:[u.jsxs("span",{className:"opacity-70",children:[j("\u0422\u0435\u0433\u0438","Tags"),":"]}),u.jsx("button",{className:`tab ${o==="all"?"tab-active":""}`,onClick:()=>{S("all"),x(20)},children:"All"}),T.map(e=>u.jsx("button",{className:`tab ${o===e?"tab-active":""}`,onClick:()=>{S(e),x(20)},children:`[${e}]`},e))]}),k.map(e=>u.jsxs(b,{to:`/forum/topic/${e.id}`,className:`card p-4 ${t?"grid grid-cols-[1fr_auto] items-center":""}`,children:[u.jsxs("div",{className:"min-w-0",children:[u.jsxs("div",{className:"font-semibold truncate",children:[t&&f(e.title)!=="none"&&u.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:`[${f(e.title).toUpperCase()}]`}),e.title]}),u.jsxs("div",{className:"mt-1 text-xs opacity-70",children:["replies: ",e.replyCount," \u2022 views: ",e.viewCount]})]}),t&&u.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-emerald-300/80",children:"\u041F\u0440\u043E\u0435\u043A\u0442"}),u.jsx(K,{kind:"topic",id:e.id,title:e.title,url:`/forum/topic/${e.id}`,size:"sm"})]},e.id)),!k.length&&u.jsx("div",{className:"card p-4 text-sm opacity-70",children:"No topics yet."}),F.length>p&&u.jsx("button",{className:"btn",onClick:()=>x(p+20),children:j("\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0435\u0449\u0451","Show more")})]})]})})}export{u4 as default};
