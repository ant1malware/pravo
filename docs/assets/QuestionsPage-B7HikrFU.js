import{j as s}from"./index-Bnj-KSBv.js";import{R as a,L as F}from"./react-vendor-DTkXckhQ.js";import{g as J}from"./authRemote-D9Q-aZvG.js";import{l as M,b as U,d as q,c as D,e as $,u as C}from"./forumRemote-Bdz4lbgB.js";import{ag as G,ah as H,ai as K,L as V,o as W}from"./icons-C8fXSpVf.js";function se(){const[c,m]=a.useState(null),[l,o]=a.useState(null),[f,u]=a.useState([]),[j,L]=a.useState(null),[g,b]=a.useState({}),[r,y]=a.useState({}),[x,N]=a.useState(""),[v,k]=a.useState(""),[p,S]=a.useState(null);a.useEffect(()=>{(async()=>{try{const e=await J();m(e)}catch{}try{const t=(await M()).find(n=>(n.title||"").toLowerCase()==="questions"||(n.title||"").toLowerCase()==="вопросы");if(o(t||null),t){const n=await U(t.id);u(n)}}catch{}})()},[]);async function T(e){if(L(j===e.id?null:e.id),!g[e.id])try{const t=await q(e.id);b(n=>({...n,[e.id]:t}))}catch{}r[e.id]||y(t=>({...t,[e.id]:P(e.id)}))}const w=c&&(c.role==="admin"||c.role==="moderator"||c.role==="developer");async function z(){if(!(!c||!l))try{const e=v+(p?`

![attachment](${p})`:""),t=await D({sectionId:l.id,title:x.trim(),content:e});u([t,...f]),N(""),k(""),S(null)}catch{}}function R(e){var i;const t=(i=e.target.files)==null?void 0:i[0];if(!t)return;const n=new FileReader;n.onload=()=>S(String(n.result||"")),n.readAsDataURL(t)}async function O(e,t){if(c&&t.trim())try{const n=await $({topicId:e,content:t.trim()});b(i=>({...i,[e]:[...i[e]||[],n]}))}catch{}}async function A(e){try{const t=await C(e.id,{locked:!e.locked});u(n=>n.map(i=>i.id===e.id?t:i))}catch{}}async function Q(e){try{const t=await C(e.id,{pinned:!e.pinned});u(n=>n.map(i=>i.id===e.id?t:i))}catch{}}function P(e){try{return JSON.parse(localStorage.getItem("forum:topic:pins:"+e)||"[]")}catch{return[]}}function B(e,t){try{localStorage.setItem("forum:topic:pins:"+e,JSON.stringify(t))}catch{}}function E(e,t){const n=r[e]||P(e),d=n.includes(t)?n.filter(h=>h!==t):[t,...n];y(h=>({...h,[e]:d})),B(e,d)}return s.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:s.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-extrabold",children:"Вопросы"}),s.jsx(F,{to:"/forum",className:"btn",children:"Назад"})]}),!l&&s.jsx("div",{className:"card p-4 text-sm text-zinc-300",children:"Раздел «Questions» не найден. Создайте раздел с названием «Questions» (или «Вопросы») в админке."}),c&&l&&s.jsxs("div",{className:"card p-4 mb-6",children:[s.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80 mb-2",children:"Создать тему"}),s.jsx("input",{className:"input mb-2",placeholder:"Заголовок",value:x,onChange:e=>N(e.target.value)}),s.jsx("textarea",{className:"input min-h-[120px]",placeholder:"Опишите проблему, можно приложить скрин",value:v,onChange:e=>k(e.target.value)}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsxs("label",{className:"btn inline-flex items-center gap-2",children:[s.jsx(G,{size:16})," Прикрепить скрин",s.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:R})]}),p&&s.jsx("span",{className:"text-xs opacity-80",children:"прикреплено"}),s.jsx("button",{className:"btn btn-primary ml-auto",onClick:z,disabled:!x.trim(),children:"Опубликовать"})]})]}),s.jsx("div",{className:"grid gap-3",children:f.map(e=>s.jsxs("div",{className:"card p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("button",{className:"text-left font-semibold hover:underline",onClick:()=>T(e),children:[e.pinned&&s.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),e.title]}),w&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:"btn",onClick:()=>Q(e),title:e.pinned?"Снять закрепление":"Закрепить",children:s.jsx(H,{size:16})}),s.jsx("button",{className:"btn",onClick:()=>A(e),title:e.locked?"Открыть":"Закрыть",children:e.locked?s.jsx(K,{size:16}):s.jsx(V,{size:16})})]})]}),j===e.id&&s.jsxs("div",{className:"mt-3 grid gap-3",children:[(g[e.id]||[]).slice().sort((t,n)=>{var i,d;return((i=r[e.id])!=null&&i.includes(t.id)?-1:0)-((d=r[e.id])!=null&&d.includes(n.id)?-1:0)}).map(t=>{var n,i;return s.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[((n=r[e.id])==null?void 0:n.includes(t.id))&&s.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),t.content,w&&s.jsx("div",{className:"mt-2 text-right",children:s.jsx("button",{className:"btn text-xs",onClick:()=>E(e.id,t.id),children:(i=r[e.id])!=null&&i.includes(t.id)?"Unpin reply":"Pin reply"})})]},t.id)}),!e.locked&&c&&s.jsx(X,{onSend:t=>O(e.id,t)}),e.locked&&s.jsx("div",{className:"text-xs opacity-70",children:"Тема закрыта."})]})]},e.id))})]})})}function X({onSend:c}){const[m,l]=a.useState("");return s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("textarea",{className:"input min-h-[90px] flex-1",placeholder:"Ваш ответ",value:m,onChange:o=>l(o.target.value)}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>{const o=m.trim();o&&(c(o),l(""))},children:[s.jsx(W,{size:16})," Отправить"]})]})}export{se as default};
