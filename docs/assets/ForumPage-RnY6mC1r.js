import{b as le,j as e,c as $e}from"./index-SvquseAp.js";import{R as u,L as M}from"./react-vendor-DTkXckhQ.js";import{g as Re}from"./forumStore-Bc0qmPB_.js";import{listSections as Ie,listLatestPosts as Oe,listTopics as Te}from"./forumRemote-D5s3MT8n.js";import{F as Pe}from"./ForumSubnav-Cb6ZP_YC.js";import{F as _e}from"./ForumSearch-D6gs6iuR.js";import{z as Ke,S as We}from"./icons-wEjUy8Cq.js";const se=800,ke=["\u0421\u043A\u0430\u0439-\u0421\u0442\u0440\u0430\u0436","\u041F\u0440\u0430\u0432\u043E-\u0421\u0430\u043C\u0443\u0440\u0430\u0439","\u041F\u0443\u043B\u044C\u0441-\u0420\u0435\u0439\u0434\u0435\u0440","\u041A\u0438\u0431\u0435\u0440-\u041C\u0435\u0434\u0438\u043A","\u041D\u0435\u043E\u043D-\u0422\u0430\u043A\u0442\u0438\u043A","\u0410\u0441\u0442\u0440\u0430\u043B-\u041E\u0444\u0438\u0446\u0435\u0440","\u0424\u0430\u043D\u0442\u043E\u043C-\u041B\u0435\u0447\u0430\u0449\u0438\u0439","\u0428\u0438\u0444\u0440-\u0418\u043D\u0441\u043F\u0435\u043A\u0442\u043E\u0440","\u041A\u0432\u0430\u043D\u0442-\u0411\u043E\u0435\u0446","\u041F\u0438\u043A\u0441\u0435\u043B\u044C-\u0412\u043E\u043B\u043A","\u0422\u0443\u043C\u0430\u043D-\u041A\u043E\u043C\u0430\u043D\u0434\u043E\u0440","\u0418\u0441\u043A\u0440\u0430-\u041D\u0430\u0431\u043B\u044E\u0434\u0430\u0442\u0435\u043B\u044C","\u041D\u0443\u043B\u044C-\u0413\u0440\u0430\u0432\u0438\u0442\u0430\u0446\u0438\u044F","\u041F\u043E\u043B\u044F\u0440\u043D\u044B\u0439 \u041F\u0438\u043B\u043E\u0442","\u0413\u043E\u0440\u043E\u0434\u0441\u043A\u043E\u0439 \u0425\u0438\u0440\u0443\u0440\u0433","\u0421\u044B\u0432\u043E\u0440\u043E\u0442\u043A\u0430-Vibe","\u0421\u0442\u0435\u0440\u0438\u043B\u044C\u043D\u044B\u0439 \u041D\u0438\u043D\u0434\u0437\u044F","\u0421\u043A\u0430\u043B\u044C\u043F\u0435\u043B\u044C-\u041E\u0431\u043B\u0430\u043A\u043E","\u0420\u0435\u043D\u0442\u0433\u0435\u043D-\u041F\u0430\u043D\u043A","\u0412\u0430\u0442\u043A\u0430-Supreme"];function Ee(){const n=ke[Math.floor(Math.random()*ke.length)],i=Math.floor(Math.random()*900+100);return`${n} ${i}`}function Ue(n){try{return typeof n=="string"?JSON.parse(n):(typeof Blob<"u"&&n instanceof Blob,null)}catch{return null}}function Fe(n){return new Date(n).toLocaleTimeString(void 0,{hour12:!1})}function Je(n){return n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function Ye(n){if(!n)return null;const i=n.trim();return i?`@${Je(i).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Ae(n,i){if(!i)return!1;try{return new RegExp(i,"iu").test(n)}catch{return!1}}function Ce(n,i){if(!i)return n;try{const z=new RegExp(i,"giu"),N=[];let k=0,S=0,D;for(;(D=z.exec(n))!==null;)D.index>k&&N.push(e.jsx(u.Fragment,{children:n.slice(k,D.index)},`text-${S++}`)),N.push(e.jsx("span",{className:"rc-ping",children:D[0]},`mention-${S++}`)),k=z.lastIndex;return k<n.length&&N.push(e.jsx(u.Fragment,{children:n.slice(k)},`text-${S++}`)),N.length?N:n}catch{return n}}const ne=["\u{1F600}","\u{1F601}","\u{1F602}","\u{1F923}","\u{1F605}","\u{1F60E}","\u{1F60D}","\u{1F618}","\u{1F607}","\u{1F91D}","\u{1F44C}","\u{1F44D}","\u{1F525}","\u{1F4AF}","\u2728","\u26A1","\u{1F3AF}","\u{1F680}","\u{1F6E1}\uFE0F","\u{1F3C6}","\u{1F4AC}","\u{1F4DD}","\u{1F4CC}","\u{1F4E3}","\u{1F5C2}\uFE0F","\u{1F9E0}","\u{1F4C8}","\u{1F552}","\u{1F6E0}\uFE0F","\u{1F512}","\u2705","\u2757","\u26A0\uFE0F","\u2753","\u{1F389}","\u{1F973}","\u{1F64C}","\u{1F918}","\u{1F916}","\u{1F440}","\u{1F4A1}","\u{1F9ED}","\u{1F4E6}","\u{1F6CE}\uFE0F","\u{1F4E1}","\u{1F6F0}\uFE0F","\u{1F9EA}","\u{1F4D5}","\u{1F9F7}","\u{1FAAA}","\u{1F9F0}","\u{1F9F1}","\u{1F6F0}","\u{1F5C3}\uFE0F"],He=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function qe(n){try{const i=new URL(n);return i.protocol=i.protocol==="wss:"?"https:":i.protocol==="ws:"?"http:":i.protocol,i.pathname="/",i.search="",i.hash="",i.toString().replace(/\/+$/,"")}catch{return""}}function Xe(n){const i=`@e${n}`;return{NAME_KEY:`chat:nick${i}`,NAME_LOCK:`chat:nick:lock${i}`}}function Ve({room:n="global",className:i,variant:z="classic",onRosterChange:N,resolveRole:k}){const S="wss://notifications-worker.wizardiowhy.workers.dev/chat",D=u.useMemo(()=>qe(S),[S]),[P,ae]=u.useState(1),[m,ue]=u.useState(!1),h=u.useMemo(()=>Xe(P),[P]),[F,A]=u.useState(!1),[K,Q]=u.useState(0),[W,H]=u.useState([]),[q,s]=u.useState(!1),[l,d]=u.useState(!1);u.useEffect(()=>{if(l){try{X(!1)}catch{}try{v||U("Admin")}catch{}}},[l]);const[x,C]=u.useState(""),[w,B]=u.useState([]),E=u.useRef(null),g=u.useRef(null),L=u.useRef(null),$=u.useRef(null),Z=u.useRef(null),[V,ee]=u.useState(!1),te=u.useRef({}),[v,U]=u.useState(null),[R,X]=u.useState(!0),[de,I]=u.useState(""),pe=u.useRef({epochReady:m,needNick:R,nick:v}),fe=u.useRef(h),_=u.useRef(null),me=u.useMemo(()=>l?"Admin":v??"",[l,v]),O=u.useMemo(()=>me.trim(),[me]),G=u.useMemo(()=>Ye(O||null),[O]),xe=u.useCallback(t=>{const a=k==null?void 0:k(t);return a||(t.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[k]),he=u.useCallback(t=>{const a=t.trim();if(!a)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let r=0;for(let j=0;j<a.length;j+=1)r=(r+a.charCodeAt(j)*17)%360;const o=r,f=(r+42)%360;return{background:`linear-gradient(135deg, hsla(${o},80%,56%,0.85), hsla(${f},78%,48%,0.85))`,color:"#fdfcff"}},[]);u.useEffect(()=>{if(m)try{const t=localStorage.getItem(h.NAME_KEY),a=localStorage.getItem(h.NAME_LOCK)==="1";t&&a?(U(t),X(!1),I(t)):t&&!a?(U(t),I(t),X(!0)):(U(null),I(""),X(!0))}catch{U(null),I(""),X(!0)}},[m,h.NAME_KEY,h.NAME_LOCK]),u.useEffect(()=>{pe.current={epochReady:m,needNick:R,nick:v}},[m,R,v]),u.useEffect(()=>{m&&(async()=>{let t=null;try{const a=Re();a!=null&&a.username&&(t=a.username)}catch{}try{const a=await le();a!=null&&a.username&&(t=a.username)}catch{}if(!t)try{const a=localStorage.getItem("forum:session")||sessionStorage.getItem("forum:session"),r=a?JSON.parse(a):null;r!=null&&r.username&&(t=r.username)}catch{}if(t){U(t),I(t),X(!1);try{localStorage.setItem(h.NAME_KEY,t),localStorage.setItem(h.NAME_LOCK,"1")}catch{}const a=E.current;if(a&&a.readyState===WebSocket.OPEN&&_.current!==t)try{a.send(JSON.stringify({type:"hello",name:t})),_.current=t}catch{}}})()},[m,h.NAME_KEY,h.NAME_LOCK]),u.useEffect(()=>{fe.current=h},[h]),u.useEffect(()=>{l||s(!1)},[l]),u.useEffect(()=>{typeof N=="function"&&N(W,K)},[N,W,K]),u.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=l;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:l}}))}catch{}}},[l]),u.useEffect(()=>{F||(s(!1),H([]))},[F]),u.useEffect(()=>{if(!q)return;const t=r=>{const o=L.current;o&&!o.contains(r.target)&&s(!1)},a=r=>{r.key==="Escape"&&s(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",a),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",a)}},[q]),u.useEffect(()=>{if(!V)return;const t=r=>{const o=$.current;o&&!o.contains(r.target)&&ee(!1)},a=r=>{r.key==="Escape"&&ee(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",a),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",a)}},[V]),u.useEffect(()=>{R&&(_.current=null)},[R]),u.useEffect(()=>{let t=!1,a=null;const r=Date.now(),o=f=>{if(t)return;ae(f);const j=Date.now()-r,c=Math.max(0,Math.min(900,520-j)),p=()=>{t||ue(!0)};c<=0?p():a=setTimeout(p,c)};return D?((async()=>{try{const f=await fetch(`${D}/nick-epoch`,{credentials:"include"}),j=f.ok?await f.json().catch(()=>({})):{},y=Number(j.epoch)||1;o(y)}catch{o(1)}})(),()=>{t=!0,a&&clearTimeout(a)}):(o(1),()=>{t=!0,a&&clearTimeout(a)})},[D]),u.useEffect(()=>{const t=g.current;t&&(t.scrollTop=t.scrollHeight)},[w.length]),u.useEffect(()=>{let t=!1,a=0,r=null;const o=()=>{if(t)return;A(!1);const f=new URL(S);f.searchParams.set("room",n),r=new WebSocket(f),E.current=r,r.addEventListener("open",()=>{A(!0),te.current={},a=0,Q(0);const{epochReady:y,needNick:c,nick:p}=pe.current;if(y&&p&&!c)try{r.send(JSON.stringify({type:"hello",name:p})),_.current=p}catch{}}),r.addEventListener("message",async y=>{try{let c=Ue(y.data);if(!c&&typeof Blob<"u"&&y.data instanceof Blob&&(c=JSON.parse(await y.data.text())),!c)return;if(c.type==="history")B(c.messages);else if(c.type==="message"){const p=c.cid;if(p&&te.current[p]){const b=te.current[p];delete te.current[p],B(Y=>{const ce=Y.filter(ie=>ie.id!==b);return ce.some(ie=>ie.id===c.message.id)?ce:[...ce,c.message]})}else B(b=>b.some(Y=>Y.id===c.message.id)?b:[...b,c.message])}else if(c.type==="delete")B(p=>p.filter(b=>b.id!==c.id));else if(c.type==="edit")B(p=>p.map(b=>b.id===c.id?{...b,text:c.text}:b));else if(c.type==="system"){if(c.text==="admin-ok"?d(!0):c.text==="hello-ok"&&!c.name&&d(!1),c.text==="presence"){const p=Number(c.count);if(Q(Number.isFinite(p)&&p>0?Math.round(p):0),Array.isArray(c.names)){const b=c.names.map(Y=>typeof Y=="string"?Y.trim():"").filter(Y=>Y.length>0);H(b)}else H([])}if(c.name&&(c.text==="hello-ok"||c.text==="admin-ok")){U(c.name),I(c.name),_.current=c.name;try{const{NAME_KEY:p,NAME_LOCK:b}=fe.current;localStorage.setItem(p,c.name),localStorage.setItem(b,"1")}catch{}X(!1)}}}catch{}});const j=()=>{t||(A(!1),Q(0),H([]),s(!1),a=Math.min(a+1,6),setTimeout(o,400*a))};r.addEventListener("close",j),r.addEventListener("error",()=>r==null?void 0:r.close())};return o(),()=>{t=!0;try{r==null||r.close()}catch{}E.current=null,_.current=null}},[S,n]),u.useEffect(()=>{const t=E.current;if(!(!t||t.readyState!==WebSocket.OPEN)&&!(!m||R||!v)&&_.current!==v)try{t.send(JSON.stringify({type:"hello",name:v})),_.current=v}catch{}},[m,R,v]);function De(){const a=(de||"").trim().slice(0,80).replace(/[^\p{L}\p{N}_ -]+/gu,"");U(a||null),I(a);try{localStorage.setItem(h.NAME_KEY,a)}catch{}const r=E.current;if(r&&r.readyState===WebSocket.OPEN)try{r.send(JSON.stringify({type:"hello",name:a})),_.current=a}catch{}}const[J,ge]=u.useState(null);u.useEffect(()=>{(async()=>{try{ge(await le())}catch{ge(null)}})()},[]);const be=u.useMemo(()=>{const t=J!=null&&J.mutedUntil?Date.parse(J.mutedUntil):0;return!["developer","admin","moderator"].includes(String((J==null?void 0:J.role)||""))&&!!t&&t>Date.now()},[J]);function oe(){const a=x.replace(/\r/g,"").trim(),r=E.current;if(!m||!v||R||!a||!r||r.readyState!==WebSocket.OPEN||be)return;const o=`${Date.now()}_${Math.random().toString(36).slice(2)}`,f=`loc_${o}`;te.current[o]=f,B(j=>[...j,{id:f,author:l?"Admin":v,text:a,ts:Date.now()}]),r.send(JSON.stringify({type:"message",text:a.slice(0,se),cid:o})),C(""),re()}const T=m&&F&&(!!v||l)&&!R&&!be,Be=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),oe())};u.useEffect(()=>{T||ee(!1)},[T]);function ve(t){const a=`@${t} `;C(o=>o?o.replace(/\s+$/," ")+a:a);const r=Z.current;setTimeout(()=>{try{if(r){r.focus();const o=r.value.length;r.selectionStart=r.selectionEnd=o}}catch{}},0)}const ye=()=>{T&&ee(t=>!t)},re=u.useCallback(()=>{if(z!=="forum")return;const t=Z.current;if(!t||t.tagName!=="TEXTAREA")return;const a=t;a.style.height="auto";const r=Math.min(a.scrollHeight,220);a.style.height=`${r}px`},[z]);u.useEffect(()=>{re()},[x,re]);const we=t=>{C(r=>`${r}${t}`),ee(!1);const a=()=>{const r=Z.current;if(r){const o=r.value.length;r.focus();try{r.setSelectionRange(o,o)}catch{}re()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(a):setTimeout(a,0)},je=t=>{const a=E.current;!l||!a||a.readyState!==WebSocket.OPEN||a.send(JSON.stringify({type:"delete",id:t}))},Ne=(t,a)=>{var f;const r=E.current;if(!l||!r||r.readyState!==WebSocket.OPEN)return;const o=(f=prompt("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435:",a))==null?void 0:f.trim();o&&r.send(JSON.stringify({type:"edit",id:t,text:o.slice(0,se)}))},Me=t=>t==="Admin"?"rc-admin":t===v?"rc-me":"rc-other",ze=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!m,children:[e.jsxs("div",{ref:L,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"\u041A\u043E\u043C\u0430\u043D\u0434\u043D\u044B\u0439 \u0447\u0430\u0442"}),e.jsxs("div",{className:"rc-head-meta",children:[l?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${q?" open":""}`,onClick:()=>s(t=>!t),"aria-expanded":q,"aria-controls":"rc-presence-panel","aria-label":"\u041A\u0442\u043E \u0441\u0435\u0439\u0447\u0430\u0441 \u0432 \u0441\u0435\u0442\u0438",children:[e.jsx("span",{className:`rc-presence-dot ${F?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[F?Math.max(K,0):0,e.jsx("span",{children:"\u0432 \u0441\u0435\u0442\u0438"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${F?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[F?Math.max(K,0):0,e.jsx("span",{children:"\u0432 \u0441\u0435\u0442\u0438"})]})]}),l&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),l&&q&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"\u0421\u043F\u0438\u0441\u043E\u043A \u043A\u0442\u043E \u0432 \u0441\u0435\u0442\u0438",children:[e.jsx("div",{className:"rc-presence-title",children:"\u0421\u0435\u0439\u0447\u0430\u0441 \u0432 \u0441\u0435\u0442\u0438"}),W.length?e.jsx("ul",{children:W.map(t=>e.jsxs("li",{className:t===O?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:t}),t===O&&e.jsx("span",{className:"rc-presence-you",children:"\u0432\u044B"})]},t))}):e.jsx("div",{className:"rc-presence-empty",children:"\u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435\u0442"})]})]}),e.jsx("div",{ref:g,className:"rc-list",children:m?w.length===0?e.jsx("div",{className:"rc-empty",children:"\u2026"}):e.jsx("ul",{children:w.map(t=>{const a=O?t.author.trim()===O:!1,r=!!(G&&O&&!a&&Ae(t.text,G)),o=r?Ce(t.text,G):t.text;return e.jsxs("li",{className:r?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",Fe(t.ts),"]"]}),e.jsx(M,{to:`/forum/profile/${encodeURIComponent(t.author)}`,className:Me(t.author),children:t.author}),e.jsx("button",{className:"rc-ax",type:"button",onClick:()=>ve(t.author),title:`@${t.author}`,children:"@"}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:o}),l&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>Ne(t.id,t.text),children:"\u0420\u0435\u0434."}),e.jsx("button",{className:"rc-ax",onClick:()=>je(t.id),children:"\u0423\u0434\u0430\u043B."})]})]},t.id)})}):e.jsx("div",{className:"rc-empty",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430\u2026"})}),e.jsxs("form",{ref:$,className:"rc-form",onSubmit:t=>{t.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${V?" open":""}`,onClick:ye,disabled:!T,"aria-label":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0441\u043C\u0430\u0439\u043B\u0438\u043A",children:"\u{1F60A}"}),e.jsx("input",{ref:Z,className:"rc-input",placeholder:"\u043D\u0430\u043F\u0438\u0448\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435\u2026",value:x,onChange:t=>C(t.target.value),maxLength:se,disabled:!T}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!T,children:"\u25B6"}),V&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"\u041F\u0430\u043B\u0438\u0442\u0440\u0430 \u0441\u043C\u0430\u0439\u043B\u0438\u043A\u043E\u0432",children:[e.jsx("div",{className:"rc-emoji-title",children:"\u0421\u043C\u0430\u0439\u043B\u0438\u043A\u0438"}),ne.length?e.jsx("div",{className:"rc-emoji-grid",children:ne.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>we(t),"aria-label":`\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435\u0442"})]})]})]}),Le=()=>{const t=W,a=F?Math.max(K,t.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!m,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"\u041E\u043D\u043B\u0430\u0439\u043D"}),m?e.jsx("div",{className:"fc-roster-list",children:t.length?t.map(r=>{const o=xe(r),f=r.trim(),j=f?f.slice(0,2).toUpperCase():"??",y=he(r);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:y,children:j}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:r}),e.jsx("div",{className:"fc-roster-role",style:o?{color:o.textColor??"#ede9fe"}:void 0,children:o?o.label:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},r)}):e.jsx("div",{className:"fc-roster-empty",children:"\u041F\u043E\u043A\u0430 \u043D\u0438\u043A\u043E\u0433\u043E"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((r,o)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},o))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"\u041A\u043E\u043C\u0430\u043D\u0434\u043D\u044B\u0439 \u0447\u0430\u0442"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${F?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:a}),e.jsx("span",{children:"\u0432 \u0441\u0435\u0442\u0438"})]})]})]}),m?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,className:"forum-chat-list",children:w.length===0?e.jsx("div",{className:"fc-empty",children:"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442"}):w.map(r=>{const o=O?r.author.trim()===O:!1,f=!!(G&&O&&!o&&Ae(r.text,G)),j=f?Ce(r.text,G):r.text,y=xe(r.author),c=r.author.trim(),p=c?c.slice(0,2).toUpperCase():"??",b=he(r.author);return e.jsxs("div",{className:`fc-item${o?" self":""}${f?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:b,children:p}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[e.jsx(M,{to:`/forum/profile/${encodeURIComponent(r.author)}`,children:r.author}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ve(r.author),title:`@${r.author}`,children:"@"}),y&&e.jsx("span",{className:"fc-role",style:{background:`${y.color}33`,color:y.textColor??"#ede9fe",borderColor:`${y.color}55`},children:y.label})]}),e.jsx("span",{className:"fc-time",children:Fe(r.ts)})]}),e.jsx("div",{className:"fc-bubble",children:j}),l&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>Ne(r.id,r.text),children:"\u0420\u0435\u0434."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>je(r.id),children:"\u0423\u0434\u0430\u043B."})]})]})]},r.id)})}),e.jsxs("form",{ref:$,className:"forum-chat-form",onSubmit:r=>{r.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043A\u0430 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E \u0432 \u0434\u0435\u043C\u043E."),disabled:!T,"aria-label":"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u0430\u0439\u043B",children:"\u{1F4CE}"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:r=>{Z.current=r,r&&re()},value:x,onChange:r=>C(r.target.value),onKeyDown:Be,placeholder:"\u041D\u0430\u043F\u0438\u0448\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435\u2026",disabled:!T,maxLength:se}),V&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"\u041F\u0430\u043B\u0438\u0442\u0440\u0430 \u0441\u043C\u0430\u0439\u043B\u0438\u043A\u043E\u0432",children:[e.jsx("div",{className:"rc-emoji-title",children:"\u0421\u043C\u0430\u0439\u043B\u0438\u043A\u0438"}),ne.length?e.jsx("div",{className:"rc-emoji-grid",children:ne.map(r=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>we(r),"aria-label":`\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C ${r}`,children:r},r))}):e.jsx("div",{className:"rc-emoji-empty",children:"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435\u0442"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${V?" open":""}`,onClick:ye,disabled:!T,"aria-label":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0441\u043C\u0430\u0439\u043B\u0438\u043A",children:"\u{1F642}"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!T,children:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:i??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:He}}),z==="forum"?Le():ze(),m&&R&&v&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043D\u0438\u043A"}),e.jsx("div",{className:"nick-warn",children:"\u041D\u0438\u043A \u0437\u0430\u0434\u0430\u0451\u0442\u0441\u044F \u043E\u0434\u0438\u043D \u0440\u0430\u0437. \u0421\u043C\u0435\u043D\u0438\u0442\u044C \u0435\u0433\u043E \u043F\u043E\u0442\u043E\u043C \u043D\u0435\u043B\u044C\u0437\u044F."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:de,onChange:t=>I(t.target.value),maxLength:80,placeholder:"\u0412\u0430\u0448 \u043D\u0438\u043A\u2026",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>I(Ee()),children:"\u{1F3B2}"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:De,children:"\u041E\u043A"})]}),e.jsx("div",{children:Array.from({length:5}).map((t,a)=>e.jsx("span",{className:"nick-pill",onClick:()=>I(Ee()),children:"\u{1F3B2} \u0421\u043B\u0443\u0447\u0430\u0439\u043D\u044B\u0439"},a))})]})})]})}function Ge({role:n}){const i={developer:{color:"#22d3ee",text:"\u0420\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A"},admin:{color:"#ef4444",text:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440"},moderator:{color:"#8b5cf6",text:"\u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"},newbie:{color:"#22d3ee",text:"\u041D\u043E\u0432\u0438\u0447\u043E\u043A"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:i[n].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:i[n].text})}function Se(n){const i=String(n||"").toLowerCase();return i.startsWith("[wip]")?"wip":i.startsWith("[review]")?"review":i.startsWith("[done]")?"done":"none"}function Qe({me:n,onLogout:i}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.6)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl items-center gap-3 px-4 py-3",children:[e.jsxs(M,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(We,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"Forum // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"\u041F\u0440\u0430\u0432\u0438\u0442\u0435\u043B\u044C\u0441\u0442\u0432\u043E"})]})]}),n&&(n.role==="admin"||n.role==="developer"||n.role==="moderator")&&e.jsx(M,{to:"/forum/admin",className:"ml-2 btn",children:"\u0410\u0434\u043C\u0438\u043D"}),e.jsxs(M,{to:`/forum/profile/${n.username}`,className:"ml-2 flex items-center gap-2 rounded-xl border px-3 py-2 card",children:[e.jsx(Ge,{role:n.role}),e.jsx("div",{className:"text-sm font-semibold",children:n.username}),e.jsxs("div",{className:"border-l pl-2 text-xs opacity-70",children:["#",n.userNumber]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",className:"btn",onClick:i,children:"\u0412\u044B\u0439\u0442\u0438"})]})})}function nt(){const[,n]=u.useReducer(s=>s+1,0),[i,z]=u.useState(void 0),[N,k]=u.useState([]),[S,D]=u.useState([]),[P,ae]=u.useState(null),[m,ue]=u.useState([]),[h,F]=u.useState({total:0,wip:0,review:0,done:0}),A=u.useMemo(()=>{try{return new Intl.RelativeTimeFormat("ru",{numeric:"auto"})}catch{try{return new Intl.RelativeTimeFormat("en",{numeric:"auto"})}catch{return null}}},[]),K=u.useCallback(s=>{if(!s)return"";const l=new Date(s);if(Number.isNaN(l.getTime()))return"";if(!A)return l.toLocaleString();const d=l.getTime()-Date.now(),x=60*1e3,C=60*x,w=24*C,B=30*w,E=365*w;return Math.abs(d)<x?A.format(Math.round(d/1e3),"second"):Math.abs(d)<C?A.format(Math.round(d/x),"minute"):Math.abs(d)<w?A.format(Math.round(d/C),"hour"):Math.abs(d)<B?A.format(Math.round(d/w),"day"):Math.abs(d)<E?A.format(Math.round(d/B),"month"):A.format(Math.round(d/E),"year")},[A]);u.useEffect(()=>{let s=!0;const l=async()=>{try{const x=await le();s&&z(x)}catch{s&&z(null)}};l();const d=()=>l();return window.addEventListener("forum:session",d),window.addEventListener("storage",d),()=>{s=!1,window.removeEventListener("forum:session",d),window.removeEventListener("storage",d)}},[]),u.useEffect(()=>{let s=!0;return(async()=>{try{const l=await Ie(),d=Array.isArray(l)?[...l].sort((g,L)=>{const $=(g.order??0)-(L.order??0);return $!==0?$:new Date(L.createdAt||0).getTime()-new Date(g.createdAt||0).getTime()}):[],x=d.find(g=>String(g.title||"").toLowerCase()==="workshop")||null,[C,w]=await Promise.all([Oe(8).catch(()=>[]),x!=null&&x.id?Te(x.id).catch(()=>[]):Promise.resolve([])]);if(!s)return;k(d),D(Array.isArray(C)?C:[]),ae(x);const B=Array.isArray(w)?w.reduce((g,L)=>{const $=Se(L.title);return $==="wip"?g.wip+=1:$==="review"?g.review+=1:$==="done"&&(g.done+=1),g.total+=1,g},{total:0,wip:0,review:0,done:0}):{total:0,wip:0,review:0,done:0},E=Array.isArray(w)?[...w].sort((g,L)=>new Date(L.updatedAt||L.createdAt||0).getTime()-new Date(g.updatedAt||g.createdAt||0).getTime()).slice(0,4):[];ue(E),F(B)}catch{if(!s)return;k([]),D([]),ae(null),ue([]),F({total:0,wip:0,review:0,done:0})}})(),()=>{s=!1}},[i]),u.useEffect(()=>{let s=!1;function l(d){if(d.key==="/"){const x=document.getElementById("forum-search-input");x&&(d.preventDefault(),x.focus());return}if(d.key.toLowerCase()==="g"){s=!0,setTimeout(()=>{s=!1},800);return}if(s){if(d.key.toLowerCase()==="h"){d.preventDefault();try{window.location.href="/forum"}catch{location.assign("/forum")}}if(d.key.toLowerCase()==="q"){d.preventDefault();try{window.location.href="/forum/questions"}catch{location.assign("/forum/questions")}}}}return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[]);const Q=u.useMemo(()=>({id:"guest",username:"guest",role:"user",userNumber:"0000"}),[]);if(i===void 0)return e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}});const W=Array.isArray(N)?N:[],H=Array.isArray(S)?S:[],q={wip:{label:"WIP",className:"bg-amber-400/10 text-amber-300"},review:{label:"Review",className:"bg-sky-400/10 text-sky-300"},done:{label:"Done",className:"bg-emerald-400/10 text-emerald-300"},none:{label:"Idea",className:"bg-zinc-200/10 text-zinc-200"}};return e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[e.jsx(Qe,{me:i??Q,onLogout:()=>{$e(),n()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[e.jsx(Pe,{}),e.jsx(_e,{}),e.jsx("div",{className:"relative mb-6 overflow-hidden card",children:e.jsx(M,{to:"/forum",className:"block focus:outline-none focus:ring-2 focus:ring-cyan-400/60 rounded-md",children:e.jsx("h1",{className:"select-none py-10 text-center font-black tracking-[0.16em] text-transparent bg-clip-text shimmer-text",style:{fontSize:"clamp(64px,12vw,140px)",lineHeight:1},title:"Go to forum home",children:"SKY"})})}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.45fr_.85fr]",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"\u0420\u0430\u0437\u0434\u0435\u043B\u044B"}),W.map(s=>{const l=s.id===(P==null?void 0:P.id)||String(s.title||"").toLowerCase()==="workshop";return e.jsx(M,{to:`/forum/section/${s.id}`,className:"card p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[s.icon?e.jsx("span",{className:"text-xl",children:s.icon}):e.jsx(Ke,{size:16}),e.jsx("span",{className:"truncate",children:s.title}),l&&e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] text-emerald-300",children:"Workshop"})]}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:s.description})]}),e.jsxs("div",{className:"text-right text-xs uppercase tracking-[0.28em] text-zinc-500",children:[e.jsxs("div",{children:["Topics ",s.topicCount??0]}),e.jsxs("div",{children:["Posts ",s.postCount??0]})]})]})},s.id)}),!W.length&&e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"\u0420\u0430\u0437\u0434\u0435\u043B\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442. \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0430\u0434\u043C\u0438\u043D-\u043F\u0430\u043D\u0435\u043B\u044C, \u0447\u0442\u043E\u0431\u044B \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u044B\u0439 \u0440\u0430\u0437\u0434\u0435\u043B."})]}),e.jsxs("aside",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.28em] text-zinc-400",children:"Latest activity"}),e.jsx(M,{to:"/forum?feed=latest",className:"text-xs text-cyan-300 hover:underline",children:"Feed"})]}),H.map(s=>e.jsx(M,{to:`/forum/topic/${s.topicId||s.id}`,className:"block card px-3 py-3 transition hover:border-cyan-400/40",children:e.jsxs("div",{className:"relative pl-4",children:[e.jsx("span",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full",style:{background:"#22d3ee"}}),e.jsx("div",{className:"truncate font-semibold",children:s.title||s.topicTitle||"\u041F\u043E\u0441\u0442"}),e.jsx("div",{className:"mt-1 text-xs",style:{color:"var(--text-2)"},children:K(s.createdAt||s.updatedAt)||(s.createdAt?new Date(s.createdAt).toLocaleString():"")})]})},s.id)),!H.length&&e.jsx("div",{className:"card p-3 text-sm opacity-70",children:"\u041F\u043E\u0441\u0442\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442"}),P?e.jsxs("div",{className:"mt-4 card p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-emerald-300/80",children:"Workshop"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:P.title||"\u041C\u0430\u0441\u0442\u0435\u0440\u0441\u043A\u0430\u044F"}),e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:"\u041C\u0430\u0441\u0442\u0435\u0440\u0441\u043A\u0430\u044F \u0434\u043B\u044F \u043F\u0440\u043E\u0435\u043A\u0442\u043D\u044B\u0445 \u0442\u0435\u043C: \u0441\u0442\u0430\u0442\u0443\u0441, \u0441\u0442\u0435\u043A, \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0438 \u0440\u0435\u0432\u044C\u044E \u0441\u043E\u043E\u0431\u0449\u0435\u0441\u0442\u0432\u0430."})]}),e.jsx(M,{to:`/forum/section/${P.id}`,className:"btn btn-primary",children:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u043C\u0430\u0441\u0442\u0435\u0440\u0441\u043A\u0443\u044E"})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.32em] text-zinc-400/80",children:[e.jsxs("span",{children:["\u041F\u0440\u043E\u0435\u043A\u0442\u043E\u0432 ",h.total]}),e.jsxs("span",{children:["[WIP] ",h.wip]}),e.jsxs("span",{children:["[Review] ",h.review]}),e.jsxs("span",{children:["[Done] ",h.done]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 md:grid-cols-2",children:[m.map(s=>{const l=Se(s.title),d=q[l];return e.jsxs(M,{to:`/forum/topic/${s.id}`,className:"card p-4 transition hover:border-emerald-400/40",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] ${d.className}`,children:d.label}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate font-semibold text-white",children:s.title}),e.jsx("div",{className:"mt-1 text-xs text-zinc-400/80",children:K(s.updatedAt||s.createdAt)||(s.updatedAt?new Date(s.updatedAt).toLocaleString():"")})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 text-[11px] uppercase tracking-[0.3em] text-zinc-500",children:[e.jsxs("span",{children:["Replies ",s.replyCount??0]}),e.jsxs("span",{children:["Views ",s.viewCount??0]})]})]},s.id)}),!m.length&&e.jsx("div",{className:"card p-4 text-sm text-zinc-300/80",children:"\u0412 \u043C\u0430\u0441\u0442\u0435\u0440\u0441\u043A\u043E\u0439 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0440\u0435\u0432\u044C\u044E."})]})]}):e.jsx("div",{className:"mt-4 card border border-dashed border-white/10 p-5 text-sm text-zinc-300/70",children:"Workshop-\u0440\u0430\u0437\u0434\u0435\u043B \u0435\u0449\u0451 \u043D\u0435 \u0441\u043E\u0437\u0434\u0430\u043D. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0435\u0433\u043E \u0432 \u043F\u0430\u043D\u0435\u043B\u0438 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0430, \u0447\u0442\u043E\u0431\u044B \u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442\u0430\u043C\u0438."})]})]}),e.jsxs("div",{className:"mt-8 card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(Ve,{})})]})]})]})}export{nt as default};
