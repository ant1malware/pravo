import{b as me,m as ze,n as xe,j as e,o as Ae,p as Pe,q as $e}from"./index-cmJC3FCm.js";import{u as Re,R as r}from"./react-vendor-DTkXckhQ.js";import{f as ue,g as pe,u as Ee,a as De}from"./forumStore-DUt9vuUB.js";import{a as he,i as Me,u as Fe,f as _e,b as V,c as Ie,r as Le,d as Te,e as Oe,g as Be,t as Ue}from"./socialStore-D4aUy79F.js";import{H as We,J as He,N as fe,O as Ye,V as Ve,W as Xe,Y as ge,S as be,Z as ve,_ as qe,$ as ye,a0 as je,M as Ge,a1 as Je}from"./icons-h3n1fb3S.js";const Z={developer:{label:"�����������",color:"#22d3ee",glow:"from-cyan-400/35"},admin:{label:"�������������",color:"#e5e7eb",glow:"from-white/40"},moderator:{label:"���������",color:"#ef4444",glow:"from-rose-400/35"},vip:{label:"VIP",color:"#eab308",glow:"from-amber-400/35"},user:{label:"��������",color:"#94a3b8",glow:"from-slate-300/30"},newbie:{label:"�������",color:"#22d3ee",glow:"from-cyan-400/35"}},we={owner:{label:"Owner",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:ve},developer:{label:"Developer",grad:"from-emerald-400 via-lime-400 to-emerald-400",Icon:ge},admin:{label:"Admin",grad:"from-white via-slate-200 to-white",Icon:be},moderator:{label:"Moderator",grad:"from-rose-400 via-red-400 to-rose-400",Icon:qe},vip:{label:"Premium",grad:"from-amber-400 via-yellow-300 to-amber-400",Icon:ve},user:{label:"User",grad:"from-slate-300 via-slate-400 to-slate-300",Icon:be},newbie:{label:"Newbie",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:ge}};function K(s){switch(s){case"developer":return"linear-gradient(90deg,#22c55e,#84cc16)";case"admin":return"linear-gradient(90deg,#ffffff,#d1d5db)";case"moderator":return"linear-gradient(90deg,#ef4444,#f43f5e)";case"vip":return"linear-gradient(90deg,#eab308,#facc15)";case"user":return"linear-gradient(90deg,#a855f7,#8b5cf6)";case"newbie":return"linear-gradient(90deg,#4c1d95,#6d28d9)";default:return null}}function Ze(s){if(!s)return!1;if(!s.until)return!0;const t=new Date(s.until).getTime();return!Number.isNaN(t)&&t>Date.now()}function Ke(s){const t=s.lastActiveAt||$e(s.id);if(!t)return!1;const a=new Date(t).getTime();return!Number.isNaN(a)&&a>Date.now()-5*60*1e3}const E="rounded-3xl border border-white/10 bg-[#101321]/85 p-5 shadow-[0_40px_120px_-70px_rgba(15,23,42,0.9)] backdrop-blur",N="rounded-3xl border border-white/10 bg-white/[0.05] p-4 shadow-[0_30px_90px_-70px_rgba(15,23,42,0.85)] backdrop-blur";function Qe({role:s}){const t=we[s]??we.user,a=t.Icon;return e.jsxs("span",{className:"relative inline-flex",children:[e.jsx("span",{className:`absolute -inset-[2px] rounded-full blur-md bg-gradient-to-r ${t.grad} opacity-50`}),e.jsxs("span",{className:"relative inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3.5 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.22em] text-white",children:[e.jsx(a,{size:14,className:"opacity-90"}),t.label]})]})}function et({role:s}){var a;const t=K(s);return e.jsx("span",{title:((a=Z[s])==null?void 0:a.label)||s,className:"inline-block h-3.5 w-3.5 rounded-full border border-white/20 align-middle",style:t?{backgroundImage:t}:{backgroundColor:"#94a3b8"}})}function G({value:s,label:t}){return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-extrabold text-white",children:s}),e.jsx("div",{className:"mt-0.5 text-[11px] uppercase tracking-[0.28em] text-zinc-300/80",children:t})]})}function tt({badges:s}){if(!(s!=null&&s.length))return null;const t={Founder:"from-rose-500/25 to-rose-400/10 text-rose-200",Early:"from-sky-500/25 to-sky-400/10 text-sky-200",Contributor:"from-emerald-500/25 to-emerald-400/10 text-emerald-200",VIP:"from-amber-500/25 to-amber-400/10 text-amber-200",Designer:"from-violet-500/25 to-violet-400/10 text-violet-200"};return e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:s.slice(0,3).map(a=>e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border border-white/10 bg-gradient-to-br ${t[a]||"from-white/20 to-white/5 text-zinc-200"} px-2.5 py-1 text-xs`,children:[e.jsx(ye,{size:14,className:"opacity-90"})," ",a]},a))})}function Ne(s){const t=s.profile||{},a=s.stats||{},i=s.lastActiveAt||s.lastSeenAt||s.lastOnlineAt||null,n={bio:t.bio||"",signature:t.signature||"",links:t.links?{...t.links}:{},accentFrom:t.accentFrom||"#8b5cf6",accentTo:t.accentTo||"#0ea5e9",avatarData:t.avatarData||t.avatar||t.avatarUrl||void 0,bannerData:t.bannerData||t.banner||t.bannerUrl||void 0,badges:Array.isArray(t.badges)?t.badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0,...t.privacy||{}}};Array.isArray(t.labels)&&(n.labels=t.labels);const o={id:s.user.id,username:s.user.username,email:s.user.email,createdAt:s.user.createdAt,role:s.user.role,userNumber:s.user.userNumber,posts:typeof a.posts=="number"?a.posts:0,likes:typeof a.likes=="number"?a.likes:0,topics:typeof a.topics=="number"?a.topics:0,profile:n,bans:s.user.bannedUntil?{until:s.user.bannedUntil}:null,mutes:null};return typeof a.score=="number"&&(o.score=a.score),i&&(o.lastActiveAt=i),o}function bt(){var v,M,L,F,X,W,q,H;const{username:s=""}=Re(),[t,a]=r.useState(null),[i,n]=r.useState(null),[o,d]=r.useState(!1),[p,c]=r.useState(!1),[g,j]=r.useState(null),[b,z]=r.useState(!1),[k,A]=r.useState({}),[S,D]=r.useState("posts");if(r.useEffect(()=>{(async()=>{var C;try{const w=await me();if(w){d(!0),n({id:w.id,username:w.username}),j(w.role),z(!!w.owner);try{const _=await ze(),$={};for(const R of _)$[R.id]=R.username;A($)}catch{}const T=await xe(s);if(T){a(Ne(T)),c(!!((C=T.user)!=null&&C.owner));return}}}catch{}d(!1),a(ue(s)||null);const h=pe();n(h?{id:h.id,username:h.username}:null)})()},[s]),r.useEffect(()=>{const h=async()=>{try{const w=await me();if(w){n({id:w.id,username:w.username}),j(w.role),z(!!w.owner);return}}catch{}const C=pe();n(C?{id:C.id,username:C.username}:null)};return window.addEventListener("forum:session",h),window.addEventListener("storage",h),()=>{window.removeEventListener("forum:session",h),window.removeEventListener("storage",h)}},[]),!t)return e.jsx("main",{className:"min-h-screen text-slate-200",style:{background:"linear-gradient(180deg,#04060d 0%,#090b16 100%)"},children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-16",children:e.jsx("div",{className:`${E} text-center text-sm text-zinc-300`,children:"��������� ���� ��� ��������� ��������."})})});const P=(i==null?void 0:i.id)===t.id,I=!!((M=(v=t.profile)==null?void 0:v.privacy)!=null&&M.hiddenProfile),B=t.role==="admin"||t.role==="developer"||p;if(I&&B&&!P&&!(b||g==="developer"||g==="admin"))return e.jsx("main",{className:"min-h-screen text-slate-200",style:{background:"linear-gradient(180deg,#04060d 0%,#090b16 100%)"},children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-16",children:e.jsx("div",{className:`${E} text-center text-sm text-zinc-300`,children:"������� �����. ������ ������ ��� �������������."})})});const m=t.profile.accentFrom||"#22d3ee",x=t.profile.accentTo||"#8b5cf6",f=Ze(t.bans),u=Ke(t);return e.jsx("main",{className:"min-h-screen text-slate-100",style:{background:"radial-gradient(1200px 700px at 12% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-8 space-y-6",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-[#101321]/85 shadow-[0_50px_140px_-80px_rgba(15,23,42,0.9)] backdrop-blur",children:[e.jsx("div",{className:"h-[220px] w-full",style:{background:t.profile.bannerData?`url(${t.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${m}, ${x})`}}),e.jsxs("div",{className:"px-6 pb-6 pt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"rounded-full p-[3px]",style:{backgroundImage:K(t.role)||`linear-gradient(135deg,${m},${x})`},children:e.jsx("div",{className:"h-24 w-24 overflow-hidden rounded-full border-4 border-[#101321] shadow-[0_25px_70px_-35px_rgba(15,23,42,0.9)]",style:{background:t.profile.avatarData?`url(${t.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${m}, ${x})`}})}),e.jsx("span",{className:`absolute -right-1 bottom-2 h-4 w-4 rounded-full border-2 ${u?"border-emerald-900/60 bg-emerald-400":"border-zinc-900/70 bg-zinc-400/70"}`,title:u?"Online":"Offline",children:u&&e.jsx("span",{className:"absolute inset-0 -z-10 animate-ping rounded-full bg-emerald-400/50"})}),e.jsx("div",{className:`absolute -inset-1 -z-10 rounded-full bg-gradient-to-br ${(Z[t.role]||Z.user).glow} to-transparent blur-lg`})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h1",{className:`text-3xl font-extrabold tracking-tight ${f?"line-through text-black":"text-white"}`,style:f?void 0:(()=>{const h=K(t.role);return h?{backgroundImage:h,WebkitBackgroundClip:"text",backgroundClip:"text",WebkitTextFillColor:"transparent"}:void 0})(),children:t.username}),e.jsx(et,{role:t.role}),e.jsx("span",{className:`ml-1 rounded-full px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] ${u?"bg-emerald-500/15 text-emerald-200":"bg-white/10 text-zinc-300"}`,children:u?"Online":t.lastActiveAt?Ae(t.lastActiveAt):"Offline"}),f&&e.jsx("span",{className:"rounded-full bg-black/50 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-zinc-200 ml-1",children:"Banned"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-8",children:[e.jsx(G,{value:t.posts,label:"messages"}),e.jsx(G,{value:t.likes,label:"reaction score"}),e.jsx(G,{value:t.topics,label:"topics"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-sm",children:[e.jsx("button",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",onClick:()=>alert("Points system coming soon �"),children:"Send points"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30 inline-flex items-center gap-2",children:["Find ",e.jsx(We,{size:14})]}),e.jsxs("div",{className:"absolute left-0 top-full hidden w-56 rounded-xl border border-white/10 bg-[#0b0f1b]/95 p-2 text-sm text-zinc-200 shadow-2xl backdrop-blur group-hover:block",children:[e.jsx("a",{className:"block rounded-lg px-2 py-1 hover:bg-white/10",href:`/forum/search?author=${encodeURIComponent(t.username)}`,children:"��� ���������"}),e.jsx("a",{className:"block rounded-lg px-2 py-1 hover:bg-white/10",href:`/forum/search?starter=${encodeURIComponent(t.username)}`,children:"���� ������������"})]})]})]})]}),P?e.jsx(ct,{user:t,onUpdated:async()=>{if(o){const h=await xe(s);h&&a(Ne(h))}else a(ue(s)||null)},saveProfile:async h=>{o?await Pe(h):Ee(t.id,h)}}):e.jsx("div",{className:"flex gap-2",children:e.jsx(st,{session:i,user:t})})]}),e.jsx("div",{className:"mt-3 flex items-center gap-6 border-t border-white/10 pt-3 text-sm",children:[{k:"posts",label:"Profile posts"},{k:"activity",label:"Latest activity"},{k:"postings",label:"Postings"},{k:"about",label:"About"}].map(({k:h,label:C})=>e.jsx("button",{className:`pb-2 ${S===h?"border-b-2 border-cyan-400 text-white":"text-zinc-400 hover:text-zinc-200"}`,onClick:()=>D(h),children:C},h))})]})]}),S==="about"&&e.jsxs("section",{className:"grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[e.jsxs("div",{className:E,children:[e.jsx("div",{className:"mb-2 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"����"}),e.jsx(Qe,{role:t.role}),e.jsx("div",{className:"mt-5 mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"� ����"}),e.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:t.profile.bio||"���� ��� ��������."}),e.jsx("div",{className:"mt-3",children:e.jsx(tt,{badges:t.profile.badges})})]}),e.jsxs("div",{className:E,children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:"������"}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:[(L=t.profile.links)!=null&&L.website?e.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",href:t.profile.links.website,target:"_blank",rel:"noreferrer",children:[e.jsx(He,{size:14})," ����"]}):null,((F=t.profile.links)==null?void 0:F.discord)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(fe,{size:14})," ",t.profile.links.discord]}),((X=t.profile.links)==null?void 0:X.telegram)&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[e.jsx(fe,{size:14})," ",t.profile.links.telegram]}),!((W=t.profile.links)!=null&&W.website)&&!((q=t.profile.links)!=null&&q.discord)&&!((H=t.profile.links)!=null&&H.telegram)&&e.jsx("span",{className:"opacity-70",children:"������ ��� �� ���������."})]})]})]}),S!=="about"&&e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"�����"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.posts})]}),e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"����"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.topics})]}),e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"�����"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold text-white",children:t.likes})]})]}),S==="posts"&&e.jsx(at,{user:t,session:i,memberMap:k}),S==="activity"&&e.jsx("div",{className:E,children:e.jsx("div",{className:"text-sm text-zinc-300/85",children:"����� ���������� ����� ����� ��� (�������, �������, ��������)."})}),S==="postings"&&e.jsx("div",{className:E,children:e.jsx("div",{className:"text-sm text-zinc-300/85",children:"������ ��������� ������������ �������� ����� ����������� ��������� ������."})})]})})}function st({session:s,user:t}){const[a,i]=r.useState(()=>t.id?he(t.id):[]),n=r.useMemo(()=>Me((s==null?void 0:s.id)||null,t.id),[s==null?void 0:s.id,t.id,a.length]);return e.jsx("button",{className:`btn ${n?"":"btn-primary"}`,onClick:()=>{s!=null&&s.id&&(n?Fe(s.id,t.id):_e(s.id,t.id),i(he(t.id)))},children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{size:16})," ����������"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16})," �����������"]})})}function at({user:s,session:t,memberMap:a}){const[i,n]=r.useState(()=>V(s.id));return r.useEffect(()=>{const o=()=>n(V(s.id));return window.addEventListener("forum:social-change",o),()=>window.removeEventListener("forum:social-change",o)},[s.id]),e.jsxs("section",{className:"grid gap-3",children:[(t==null?void 0:t.id)&&e.jsx(nt,{onPost:o=>{Ie(s.id,t.id,o,{authorName:t.username}),n(V(s.id))}}),e.jsxs("div",{className:"grid gap-2",children:[i.length===0&&e.jsx("div",{className:`${E} text-sm text-zinc-300/80`,children:"������������ ���� ���."}),rt(i).map(o=>e.jsx(ke,{node:o,currentUserId:(t==null?void 0:t.id)||"",ownerId:s.id,memberMap:a,onReply:(d,p)=>{t!=null&&t.id&&(Te(s.id,t.id,d,p,t.username),n(V(s.id)))},onDelete:d=>{t!=null&&t.id&&(Le(s.id,d,t.id),n(V(s.id)))}},o.comment.id))]})]})}function nt({onPost:s}){const[t,a]=r.useState("");return e.jsxs("div",{className:N,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ge,{size:16,className:"mt-1 shrink-0"}),e.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"�������� �����������...",value:t,onChange:i=>a(i.target.value)})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const i=t.trim();i&&(s(i),a(""))},children:"���������"})})]})}function rt(s){const t={};s.forEach(n=>{t[n.id]={comment:n,replies:[]}});const a=[];s.forEach(n=>{const o=n.parentId||"";o&&t[o]?t[o].replies.push(t[n.id]):a.push(t[n.id])}),a.sort((n,o)=>n.comment.createdAt<o.comment.createdAt?1:-1);const i=n=>n.replies.sort((o,d)=>o.comment.createdAt>d.comment.createdAt?1:-1).forEach(i);return a.forEach(i),a}function ke({node:s,currentUserId:t,ownerId:a,onReply:i,onDelete:n,memberMap:o}){const[d,p]=r.useState(!1),c=De(s.comment.authorId),g=s.comment.authorName||(c==null?void 0:c.username)||(s.comment.authorId===a?"��������":s.comment.authorId===t?"��":"��������"),j=(c==null?void 0:c.username)||s.comment.authorName;return e.jsx("div",{className:N,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-zinc-300/90",children:[j?e.jsx("a",{href:`/forum/profile/${j}`,className:"font-semibold text-white hover:underline",children:g}):e.jsx("span",{className:"font-semibold text-white",children:g}),e.jsxs("span",{className:"opacity-70",children:[" � ",new Date(s.comment.createdAt).toLocaleString("ru-RU")]})]}),(t===s.comment.authorId||t===a)&&e.jsx("button",{className:"btn",title:"�������",onClick:()=>n(s.comment.id),children:e.jsx(Je,{size:14})})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:s.comment.content}),e.jsx(it,{targetId:a,commentId:s.comment.id,currentUserId:t}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>p(b=>!b),children:"��������"})}),d&&e.jsx("div",{className:"mt-2",children:e.jsx(lt,{onSend:b=>{i(s.comment.id,b),p(!1)}})}),!!s.replies.length&&e.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:s.replies.map(b=>e.jsx(ke,{node:b,currentUserId:t,ownerId:a,onReply:i,onDelete:n,memberMap:o},b.comment.id))})]})]})})}function lt({onSend:s}){const[t,a]=r.useState("");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"�����...",value:t,onChange:i=>a(i.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const i=t.trim();i&&(s(i),a(""))},children:"���������"})]})}function it({targetId:s,commentId:t,currentUserId:a}){const[,i]=r.useReducer(p=>p+1,0),n=Oe(s)[t]||{counts:{like:0,smile:0,useful:0}},o=a?Be(s,t,a):void 0,d=({r:p,label:c})=>{var g;return e.jsxs("button",{className:`btn text-xs ${o===p?"btn-primary":""}`,onClick:()=>{a&&(Ue(s,t,a,p),i())},children:[c," ",(g=n.counts)!=null&&g[p]?e.jsx("span",{className:"opacity-80",children:n.counts[p]}):null]})};return e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx(d,{r:"like",label:"??"}),e.jsx(d,{r:"smile",label:"??"}),e.jsx(d,{r:"useful",label:"??"})]})}function ct({user:s,onUpdated:t,saveProfile:a}){const[i,n]=r.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>n(!0),children:[e.jsx(Ye,{size:16})," ��������� �������"]}),i&&e.jsx(xt,{user:s,onClose:()=>n(!1),onSaved:()=>{t(),n(!1)},saveProfile:a})]})}const ot=["Founder","Early","Contributor","VIP","Designer"];function J(s,t,a){return Math.max(t,Math.min(a,s))}function dt(s){const[t,a]=r.useState(null);return r.useEffect(()=>{if(!s){a(null);return}const i=new Image;return i.onload=()=>a(i),i.src=s,()=>{}},[s]),t}function mt({src:s,aspect:t,round:a=!1,title:i="�������� �����������",onCancel:n,onDone:o}){const d=a?360:900,p=Math.round(d/t),c=dt(s),[g,j]=r.useState(1),[b,z]=r.useState({x:0,y:0}),k=r.useRef(null);r.useEffect(()=>{if(!c)return;const x=Math.max(d/c.naturalWidth,p/c.naturalHeight)*1.05;j(x);const f=c.naturalWidth*x,u=c.naturalHeight*x;z({x:(d-f)/2,y:(p-u)/2})},[c]);const A=r.useCallback((m,x)=>{if(!c)return m;const f=c.naturalWidth*x,u=c.naturalHeight*x;return{x:J(m.x,d-f,0),y:J(m.y,p-u,0)}},[c,d,p]),S=m=>{const x="touches"in m?m.touches[0]:m;k.current={x:b.x,y:b.y,startX:x.clientX,startY:x.clientY}},D=m=>{if(!k.current)return;const x="touches"in m?m.touches[0]:m,f=x.clientX-k.current.startX,u=x.clientY-k.current.startY;z(v=>A({x:k.current.x+f,y:k.current.y+u},g))},P=()=>{k.current=null},I=m=>{if(!c)return;m.preventDefault();const x=Math.max(d/c.naturalWidth,p/c.naturalHeight),f=x*6,u=J(g*(m.deltaY>0?.94:1.06),x,f);j(u),z(v=>A(v,u))},B=()=>{if(!c)return;const m=a?800:1920,x=Math.round(m/t),f=m/d,u=document.createElement("canvas");u.width=m,u.height=x;const v=u.getContext("2d");if(a){v.save(),v.beginPath();const F=Math.min(m,x)/2;v.arc(m/2,x/2,F,0,Math.PI*2),v.clip()}const M=c.naturalWidth*g*f,L=c.naturalHeight*g*f;v.drawImage(c,b.x*f,b.y*f,M,L),a&&v.restore(),o(u.toDataURL("image/png",.95))},U=()=>{if(!c)return null;const m=Math.max(d/c.naturalWidth,p/c.naturalHeight),x=m*6;return e.jsx("input",{type:"range",min:m,max:x,step:m/50,value:g,onChange:f=>{const u=Number(f.target.value);j(u),z(v=>A(v,u))},className:"w-full"})};return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/70 px-4",children:e.jsxs("div",{className:"w-[min(96vw,1000px)] rounded-3xl border border-white/10 bg-[#0b0f1b]/95 p-5 shadow-2xl backdrop-blur",children:[e.jsx("div",{className:"mb-3 text-lg font-semibold text-white",children:i}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[auto_1fr]",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-white/10 bg-black/40 select-none touch-none",style:{width:d,height:p,cursor:"grab"},onMouseDown:S,onMouseMove:D,onMouseUp:P,onMouseLeave:P,onTouchStart:S,onTouchMove:D,onTouchEnd:P,onWheel:I,children:[c&&e.jsx("img",{src:s,alt:"crop",draggable:!1,style:{position:"absolute",left:0,top:0,transform:`translate(${b.x}px, ${b.y}px) scale(${g})`,transformOrigin:"top left",userSelect:"none",pointerEvents:"none"}}),a&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-[90%] aspect-square rounded-full ring-2 ring-white/40"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"��� / ��������������"}),U(),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:n,children:"������"}),e.jsx("div",{className:"grow"}),e.jsx("button",{className:"btn btn-primary",onClick:B,children:"������"})]})]})]})]})})}function xt({user:s,onClose:t,onSaved:a,saveProfile:i}){var ee,te,se,ae,ne,re,le,ie,ce,oe;const[n,o]=r.useState(s.profile.avatarData||""),[d,p]=r.useState(s.profile.bannerData||""),[c,g]=r.useState(s.profile.accentFrom||"#22d3ee"),[j,b]=r.useState(s.profile.accentTo||"#8b5cf6"),[z,k]=r.useState(s.profile.bio||""),[A,S]=r.useState(s.profile.signature||""),[D,P]=r.useState(((ee=s.profile.links)==null?void 0:ee.website)||""),[I,B]=r.useState(((te=s.profile.links)==null?void 0:te.discord)||""),[U,m]=r.useState(((se=s.profile.links)==null?void 0:se.telegram)||""),[x,f]=r.useState(s.profile.badges||[]),[u,v]=r.useState(((ae=s.profile.privacy)==null?void 0:ae.showEmail)??!1),[M,L]=r.useState(((ne=s.profile.privacy)==null?void 0:ne.showStats)??!0),[F,X]=r.useState(((re=s.profile.privacy)==null?void 0:re.showLinks)??!0),[W,q]=r.useState(((le=s.profile.privacy)==null?void 0:le.allowComments)??!0),[H,h]=r.useState(((ie=s.profile.privacy)==null?void 0:ie.showFollowers)??!0),[C,w]=r.useState(((ce=s.profile.privacy)==null?void 0:ce.showSecondaryRole)!==!1),[T,_]=r.useState(null),[$,R]=r.useState(null),Se=l=>f(y=>y.includes(l)?y.filter(O=>O!==l):y.length>=3?y:[...y,l]),Q=l=>y=>{var de;const O=(de=y.target.files)==null?void 0:de[0];if(!O)return;const Y=new FileReader;Y.onload=()=>{_(String(Y.result||"")),R(l)},Y.readAsDataURL(O)},Ce=async()=>{const l={website:D.trim(),discord:I.trim(),telegram:U.trim()},y=Object.fromEntries(Object.entries(l).filter(([,Y])=>Y)),O={...s.profile.privacy||{},showEmail:u,showStats:M,showLinks:F,allowComments:W,showFollowers:H,showSecondaryRole:C};await i({avatarData:n||void 0,bannerData:d||void 0,accentFrom:c,accentTo:j,bio:z.trim()||void 0,signature:A.trim()||void 0,links:Object.keys(y).length?y:void 0,badges:x,privacy:O}),a()};return e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-start justify-center bg-black/70 px-4 py-8 overflow-y-auto",children:[e.jsxs("div",{className:`${E} w-[min(820px,96vw)]`,style:{position:"relative"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"��������� �������"}),e.jsx("button",{className:"btn",onClick:t,children:"�������"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"������"}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:n?`url(${n}) center/cover`:`linear-gradient(135deg, ${c}, ${j})`}}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(je,{size:16})," ���������",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:Q("avatar")})]}),n&&e.jsx("button",{className:"btn",onClick:()=>o(""),children:"�������"}),n&&e.jsx("button",{className:"btn",onClick:()=>{_(n),R("avatar")},children:"�������� ������"})]})]})]}),e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"������"}),e.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:d?`url(${d}) center/cover`:`linear-gradient(135deg, ${c}, ${j})`}}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("label",{className:"btn flex items-center gap-2",children:[e.jsx(je,{size:16})," ���������",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:Q("banner")})]}),d&&e.jsx("button",{className:"btn",onClick:()=>p(""),children:"�������"}),d&&e.jsx("button",{className:"btn",onClick:()=>{_(d),R("banner")},children:"�������� ������"})]})]}),e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"��������"}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"��"}),e.jsx("input",{type:"color",value:c,onChange:l=>g(l.target.value)})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[e.jsx("span",{children:"��"}),e.jsx("input",{type:"color",value:j,onChange:l=>b(l.target.value)})]})]})]}),e.jsxs("div",{className:N,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"������ (�� 3)"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:ot.map(l=>{const y=x.includes(l);return e.jsxs("button",{className:`btn flex items-center gap-2 ${y?"btn-primary":""}`,onClick:()=>Se(l),type:"button",children:[e.jsx(ye,{size:16})," ",l]},l)})})]}),e.jsxs("div",{className:`${N} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"� ����"}),e.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:z,onChange:l=>k(l.target.value),placeholder:"���������� � ����"})]}),e.jsxs("div",{className:`${N} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"�������"}),e.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:A,onChange:l=>S(l.target.value),placeholder:"����� ��� �����������"})]}),e.jsxs("div",{className:`${N} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"������"}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[e.jsx("input",{className:"input",placeholder:"https://website",value:D,onChange:l=>P(l.target.value)}),e.jsx("input",{className:"input",placeholder:"discord username",value:I,onChange:l=>B(l.target.value)}),e.jsx("input",{className:"input",placeholder:"@telegram",value:U,onChange:l=>m(l.target.value)})]})]}),e.jsxs("div",{className:`${N} sm:col-span-2`,children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"�����������"}),e.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:["                ",s.role==="admin"||s.role==="developer"?e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!((oe=s.profile.privacy)!=null&&oe.hiddenProfile),onChange:l=>{},disabled:!0})," ������ ������� (������ �������������)"]}):null,e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:l=>v(l.target.checked)})," ���������� e-mail"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:l=>L(l.target.checked)})," ���������� ����������"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:l=>X(l.target.checked)})," ���������� ������"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:l=>h(l.target.checked)})," ���������� �����������"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:l=>q(l.target.checked)})," ��������� �����������"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:l=>w(l.target.checked)})," ���������� ������ ����"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"������"}),e.jsx("button",{className:"btn btn-primary",onClick:Ce,children:"���������"})]})]})]}),T&&$&&e.jsx(mt,{src:T,aspect:$==="avatar"?1:21/6,round:$==="avatar",title:"�������� ������",onCancel:()=>{_(null),R(null)},onDone:l=>{$==="avatar"?o(l):p(l),_(null),R(null)}})]})}export{bt as default};
