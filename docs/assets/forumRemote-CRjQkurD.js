const w="https://notifications-worker.wizardiowhy.workers.dev/skyapi",u="forum:token",m="forum:session";function f(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function y(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function S(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function r(t,e={}){const n=y(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${w}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function l(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:n,user:s}=await r("/register",{method:"POST",body:e});f(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function g(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:n,user:s}=await r("/login",{method:"POST",body:e});f(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function h(){if(!y())return null;try{const{user:e}=await r("/me");return e}catch{return S(),null}}async function p(){const{users:t}=await r("/users");return t}async function O(t,e){const{user:n}=await r(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return n}async function T(){const{invites:t}=await r("/invites");return t}async function v(t=5,e){const{invites:n}=await r("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return n}async function E(t,e){const n=JSON.stringify(e?{until:e}:{days:7}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/ban",{method:"POST",body:n});return s}async function I(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unban",{method:"POST"});return e}async function b(t,e){const n=JSON.stringify(e?{until:e}:{minutes:60}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/mute",{method:"POST",body:n});return s}async function $(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unmute",{method:"POST"});return e}async function k(t){await r(`/invites/${encodeURIComponent(t)}`,{method:"DELETE"})}async function N(){const{settings:t}=await r("/settings");return t}async function J(t){const{settings:e}=await r("/settings",{method:"PATCH",body:JSON.stringify(t)});return e}const A=Object.freeze(Object.defineProperty({__proto__:null,authenticateAccount:g,banUser:E,clearSession:S,deleteInvite:k,generateInvites:v,getServerSettings:N,getSessionAccount:h,listAccounts:p,listInvites:T,muteUser:b,registerAccount:l,setRole:O,unbanUser:I,unmuteUser:$,updateServerSettings:J},Symbol.toStringTag,{value:"Module"})),C="https://notifications-worker.wizardiowhy.workers.dev/skyapi",d="forum:token";function P(){try{return localStorage.getItem(d)??sessionStorage.getItem(d)}catch{return null}}async function i(t,e={}){const n=P(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${C}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function U(){const{sections:t}=await i("/sections");return t}async function x(t){const{section:e}=await i("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function R(t,e){const{section:n}=await i(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function _(t){await i(`/sections/${encodeURIComponent(t)}`,{method:"DELETE"})}async function L(t){const e="",{topics:n}=await i(`/topics${e}`);return n}async function j(t,e){const{topic:n}=await i(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function z(t,e){const{topic:n}=await i(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return n}async function D(t){await i(`/topics/${encodeURIComponent(t)}`,{method:"DELETE"})}async function K(t=8){const{posts:e}=await i(`/latest-posts?limit=${t}`);return e}export{K as a,g as b,S as c,p as d,L as e,T as f,h as g,N as h,$ as i,E as j,I as k,U as l,b as m,x as n,R as o,_ as p,j as q,l as r,O as s,z as t,J as u,D as v,v as w,k as x,A as y};
