import{j as e}from"./index-Al6zsSQi.js";import{R as l}from"./react-vendor-DTkXckhQ.js";import{r as j}from"./forumStore-DzsR4JCd.js";import{g as b,d as y,l as N,e as f,f as w,h as S,u as k,s as C,m as F,i as I,j as _,k as T,n as M,o as R,p as D,q as v,t as E,v as A,w as U,x as B}from"./forumRemote-WR7EwF9i.js";import"./icons-Bt7Fym03.js";function h(){try{const i=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),o=i?JSON.parse(i):null;return(o==null?void 0:o.userId)||"unknown"}catch{return"unknown"}}function H(){const[i,o]=l.useState("users"),[d,n]=l.useState(void 0);return l.useEffect(()=>{(async()=>{try{const c=await b();n(c==null?void 0:c.role)}catch{n(void 0)}})()},[]),e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:["users","sections","topics","invites","maintenance"].map(c=>e.jsx("button",{className:`btn ${i===c?"btn-primary":""}`,onClick:()=>o(c),children:c},c))}),i==="users"&&e.jsx(O,{meRole:d}),i==="sections"&&e.jsx($,{}),i==="topics"&&e.jsx(P,{meRole:d}),i==="invites"&&e.jsx(q,{}),i==="maintenance"&&e.jsx(G,{})]})}function O({meRole:i}){const[o,d]=l.useState([]),n=l.useCallback(async()=>{try{d(await y())}catch(s){alert((s==null?void 0:s.message)||"Failed to load users")}},[]);l.useEffect(()=>{n()},[n]);const c=async(s,t)=>{try{await C(s,t),n()}catch(r){alert((r==null?void 0:r.message)||"Failed to set role")}},u=async s=>{const t=parseInt(prompt("Mute minutes","60")||"60",10),r=new Date(Date.now()+Math.max(1,t)*6e4).toISOString();try{await F(s,r),await n()}catch(p){alert((p==null?void 0:p.message)||"Failed to mute")}},m=async s=>{try{await I(s),await n()}catch(t){alert((t==null?void 0:t.message)||"Failed to unmute")}},x=async s=>{const t=parseInt(prompt("Ban days","7")||"7",10),r=new Date(Date.now()+Math.max(1,t)*864e5).toISOString();try{await _(s,r),await n()}catch(p){alert((p==null?void 0:p.message)||"Failed to ban")}},a=async s=>{try{await T(s),await n()}catch(t){alert((t==null?void 0:t.message)||"Failed to unban")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Пользователи (через Worker API). Мут/бан — локальны для чата."}),e.jsxs("div",{className:"grid gap-2",children:[o.map(s=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_1fr]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",s.userNumber]}),e.jsx("div",{className:"font-semibold",children:s.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:s.email}),e.jsxs("select",{className:"input",value:s.role,onChange:t=>c(s.id,t.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("button",{className:"btn",onClick:()=>u(s.id),children:"Mute"}),e.jsx("button",{className:"btn",onClick:()=>m(s.id),children:"Unmute"}),e.jsx("button",{className:"btn",onClick:()=>x(s.id),children:"Ban"}),e.jsx("button",{className:"btn",onClick:()=>a(s.id),children:"Unban"})]})]},s.id)),!o.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function $(){const[i,o]=l.useState([]),[d,n]=l.useState(""),[c,u]=l.useState(""),m=l.useCallback(async()=>{try{o(await N())}catch(t){alert((t==null?void 0:t.message)||"Failed to load sections")}},[]);l.useEffect(()=>{m()},[m]);const x=async()=>{if(d.trim())try{await M({title:d.trim(),description:c.trim(),actorId:h()}),n(""),u(""),m()}catch(t){alert((t==null?void 0:t.message)||"Failed to create section")}},a=async(t,r,p)=>{try{await R(t,{[r]:p,actorId:h()}),m()}catch(g){alert((g==null?void 0:g.message)||"Failed to update section")}},s=async t=>{if(confirm("Удалить раздел?"))try{await D(t),m()}catch(r){alert((r==null?void 0:r.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Создать раздел"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:d,onChange:t=>n(t.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:c,onChange:t=>u(t.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Разделы"}),e.jsxs("div",{className:"grid gap-2",children:[i.map(t=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[String(t.id).slice(0,8),"…"]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{className:"input",value:t.title,onChange:r=>a(t.id,"title",r.target.value)}),e.jsx("input",{className:"input",value:t.description||"",onChange:r=>a(t.id,"description",r.target.value)})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>s(t.id),children:"Delete"})})]},t.id)),!i.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})]})}function P({meRole:i}){const[o,d]=l.useState([]),n=l.useCallback(async()=>{try{d(await f())}catch(a){alert((a==null?void 0:a.message)||"Failed to load topics")}},[]);l.useEffect(()=>{n()},[n]);const c=async(a,s)=>{try{await v(a,{pinned:s,actorId:h()}),n()}catch(t){alert((t==null?void 0:t.message)||"Failed to update topic")}},u=async(a,s)=>{try{await v(a,{locked:s,actorId:h()}),n()}catch(t){alert((t==null?void 0:t.message)||"Failed to update topic")}},m=async(a,s)=>{const t=s.trim();if(t)try{await E(a,t),n()}catch(r){alert((r==null?void 0:r.message)||"Failed to move topic")}},x=async a=>{if(confirm("Удалить тему?"))try{await A(a),n()}catch(s){alert((s==null?void 0:s.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Темы"}),e.jsxs("div",{className:"grid gap-2",children:[o.map(a=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto_auto_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: "," ",String(a.id).slice(0,8)," ","…"," • section: "," ",String(a.sectionId).slice(0,8)," ","…"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!a.pinned,onChange:s=>c(a.id,s.target.checked)}),"pinned"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!a.locked,onChange:s=>u(a.id,s.target.checked)}),"locked"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"to sectionId",onKeyDown:s=>{if(s.key==="Enter"){const t=s.target.value;m(a.id,t),s.target.value=""}}}),e.jsx("button",{className:"btn",onClick:s=>{const t=s.currentTarget.previousElementSibling;m(a.id,t.value),t.value=""},children:"Move"}),(i==="admin"||i==="developer")&&e.jsx("button",{className:"btn",onClick:()=>x(a.id),children:"Delete"})]})]},a.id)),!o.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function q(){const[i,o]=l.useState([]),[d,n]=l.useState(5),[c,u]=l.useState(""),m=l.useCallback(async()=>{try{o(await w())}catch(s){alert((s==null?void 0:s.message)||"Failed")}},[]);l.useEffect(()=>{m()},[m]);const x=async()=>{try{await U(Math.max(1,Math.min(20,d)),c||void 0),u(""),m()}catch(s){alert((s==null?void 0:s.message)||"Failed to generate")}},a=async s=>{if(confirm("Удалить инвайт?"))try{await B(s),m()}catch(t){alert((t==null?void 0:t.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Генерация инвайтов"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:20,value:d,onChange:s=>n(parseInt(s.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:c,onChange:s=>u(s.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Generate"})]}),e.jsxs("div",{className:"grid gap-2",children:[i.map(s=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:s.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(s.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs",children:s.note||""}),e.jsx("div",{className:"text-xs",children:s.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>a(s.code),children:"Delete"})})]},`${s.code}-${s.createdAt}`)),!i.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function G(){const[i,o]=l.useState("invite");l.useEffect(()=>{(async()=>{try{const n=await S();o((n==null?void 0:n.registrationMode)||"invite")}catch{}})()},[]);const d=()=>{confirm("Очистить форум (пустой старт)?")&&(j(h()),alert("Ок. Форум очищен."),location.reload())};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Настройки форума"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Регистрация:"}),e.jsxs("select",{className:"input",value:i,onChange:async n=>{const c=n.target.value;o(c);try{await k({registrationMode:c})}catch(u){alert((u==null?void 0:u.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"по инвайтам"}),e.jsx("option",{value:"open",children:"открытая"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Обслуживание"}),e.jsx("p",{className:"text-sm opacity-70 mb-3",children:"Очистить локальные разделы/темы/сообщения без демо-данных."}),e.jsx("button",{className:"btn btn-primary",onClick:d,children:"Reset forum (empty)"})]})}export{H as default};
