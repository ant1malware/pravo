import{j as s}from"./index-DDMfrihc.js";import{b as E,R as i,L as x}from"./react-vendor-DTkXckhQ.js";import{listSections as U}from"./forumRemote-DZSWY5Uv.js";import{ah as C,ae as W,U as z,a0 as I}from"./icons-zK4tVMYI.js";const k="forum:default_feed";function R(){try{const t=localStorage.getItem(k);if(t==="hot"||t==="new"||t==="questions")return t}catch{}return"hot"}function D(t){try{localStorage.setItem(k,t)}catch{}}const P="app:lang";function M(){try{const t=localStorage.getItem(P);if(t==="ru"||t==="en")return t}catch{}return"ru"}function r(t,a){return M()==="ru"?t:a}function H(){const t=E(),[a,f]=i.useState(null);i.useEffect(()=>{let e=!0;return(async()=>{try{const n=(await U()||[]).find(c=>String(c.title||"").toLowerCase()==="workshop");e&&f((n==null?void 0:n.id)||null)}catch{e&&f(null)}})(),()=>{e=!1}},[]);const h=t.pathname.includes("/forum/members"),p=a?t.pathname.startsWith(`/forum/section/${a}`):!1,y=!h&&!p,w=new URLSearchParams(t.search||"").get("feed"),j=R(),m=w||j,u=({to:e,active:o,icon:n,children:c,disabled:$,title:g})=>$?s.jsxs("span",{className:`btn inline-flex items-center gap-2 ${o?"btn-primary":""} opacity-60 cursor-not-allowed`,title:g||"","aria-disabled":!0,children:[n," ",c]}):s.jsxs(x,{to:e,className:`btn inline-flex items-center gap-2 ${o?"btn-primary":""}`,title:g||"",children:[n," ",c]}),[v,d]=i.useState(!1);i.useEffect(()=>{const e=()=>d(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const b=[{key:"latest",label:r("Свежие","Latest")},{key:"hot",label:r("Топ","Hot")},{key:"new",label:r("Новые","New")},{key:"following",label:r("Подписки","Following")}],F=e=>{var o;return((o=b.find(n=>n.key===e))==null?void 0:o.label)||r("Лента","Feed")},l=(e,o)=>{const n=new URLSearchParams(t.search);o?n.set("feed",o):n.delete("feed");const c=n.toString();return`${e}${c?`?${c}`:""}`},S=l("/forum",m),L=l("/forum/members",null),N=a?l(`/forum/section/${a}`,null):"#";return s.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[s.jsx(u,{to:S,active:y,icon:s.jsx(C,{size:16}),children:r("Форум","Forums")}),s.jsx(u,{to:N,active:p,disabled:!a,icon:s.jsx(W,{size:16}),title:a?"":r("Раздел Workshop ещё не создан","Workshop section is not created yet"),children:r("Мастерская","Workshop")}),s.jsx(u,{to:L,active:h,icon:s.jsx(z,{size:16}),children:r("Участники","Members")}),s.jsxs("div",{className:"relative ml-auto",onClick:e=>e.stopPropagation(),"aria-label":r("Выбрать ленту","Choose feed"),children:[s.jsxs("button",{type:"button",className:"btn inline-flex items-center gap-2",onClick:()=>d(e=>!e),children:[s.jsx("span",{className:"truncate max-w-[10rem]",children:F(m)}),s.jsx(I,{size:16})]}),v&&s.jsx("div",{className:"absolute right-0 z-20 mt-2 min-w-40 rounded-xl border bg-background p-2 shadow-lg",children:b.map(e=>{const o=l("/forum",e.key),n=m===e.key;return s.jsx(x,{to:o,className:`block rounded-md px-3 py-2 text-sm hover:bg-muted ${n?"font-semibold":""}`,onClick:()=>{try{D(e.key)}catch{}d(!1)},children:e.label},String(e.key))})})]})]})}export{H as F,r as t};
