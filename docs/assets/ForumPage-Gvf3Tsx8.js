import{b as ve,j as e,c as Pe,e as _e,f as Ke,h as We,k as Ue}from"./index-C5TXn_k8.js";import{R as s,L as H,b as Be,e as qe}from"./react-vendor-DTkXckhQ.js";import{g as He}from"./forumStore-Hny9Lm0f.js";import{listSections as Je,listLatestPosts as Ye,listTopics as Ve}from"./forumRemote-D5s3MT8n.js";import{i as Xe,g as Ge,F as Ze}from"./ForumSubnav-Ds2QEJHS.js";import{F as Qe}from"./ForumSearch-B7O9eJBi.js";import{i as et}from"./readTracker-D5ICW4Ou.js";import{l as tt}from"./socialStore-D4aUy79F.js";import{H as rt,L as st,S as at}from"./icons-CDjAZjRL.js";const me=800,Ee=["–°–∫–∞–π-–°—Ç—Ä–∞–∂","–ü—Ä–∞–≤–æ-–°–∞–º—É—Ä–∞–π","–ü—É–ª—å—Å-–†–µ–π–¥–µ—Ä","–ö–∏–±–µ—Ä-–ú–µ–¥–∏–∫","–ù–µ–æ–Ω-–¢–∞–∫—Ç–∏–∫","–ê—Å—Ç—Ä–∞–ª-–û—Ñ–∏—Ü–µ—Ä","–§–∞–Ω—Ç–æ–º-–õ–µ—á–∞—â–∏–π","–®–∏—Ñ—Ä-–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä","–ö–≤–∞–Ω—Ç-–ë–æ–µ—Ü","–ü–∏–∫—Å–µ–ª—å-–í–æ–ª–∫","–¢—É–º–∞–Ω-–ö–æ–º–∞–Ω–¥–æ—Ä","–ò—Å–∫—Ä–∞-–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å","–ù—É–ª—å-–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–ü–æ–ª—è—Ä–Ω—ã–π –ü–∏–ª–æ—Ç","–ì–æ—Ä–æ–¥—Å–∫–æ–π –•–∏—Ä—É—Ä–≥","–°—ã–≤–æ—Ä–æ—Ç–∫–∞-Vibe","–°—Ç–µ—Ä–∏–ª—å–Ω—ã–π –ù–∏–Ω–¥–∑—è","–°–∫–∞–ª—å–ø–µ–ª—å-–û–±–ª–∞–∫–æ","–†–µ–Ω—Ç–≥–µ–Ω-–ü–∞–Ω–∫","–í–∞—Ç–∫–∞-Supreme"];function Ce(){const o=Ee[Math.floor(Math.random()*Ee.length)],i=Math.floor(Math.random()*900+100);return`${o} ${i}`}function nt(o){try{return typeof o=="string"?JSON.parse(o):(typeof Blob<"u"&&o instanceof Blob,null)}catch{return null}}function Ae(o){return new Date(o).toLocaleTimeString(void 0,{hour12:!1})}function ot(o){return o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function it(o){if(!o)return null;const i=o.trim();return i?`@${ot(i).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Me(o,i){if(!i)return!1;try{return new RegExp(i,"iu").test(o)}catch{return!1}}function ze(o,i){if(!i)return o;try{const w=new RegExp(i,"giu"),c=[];let y=0,h=0,D;for(;(D=w.exec(o))!==null;)D.index>y&&c.push(e.jsx(s.Fragment,{children:o.slice(y,D.index)},`text-${h++}`)),c.push(e.jsx("span",{className:"rc-ping",children:D[0]},`mention-${h++}`)),y=w.lastIndex;return y<o.length&&c.push(e.jsx(s.Fragment,{children:o.slice(y)},`text-${h++}`)),c.length?c:o}catch{return o}}const fe=["üòÄ","üòÅ","üòÇ","ü§£","üòÖ","üòé","üòç","üòò","üòá","ü§ù","üëå","üëç","üî•","üíØ","‚ú®","‚ö°","üéØ","üöÄ","üõ°Ô∏è","üèÜ","üí¨","üìù","üìå","üì£","üóÇÔ∏è","üß†","üìà","üïí","üõ†Ô∏è","üîí","‚úÖ","‚ùó","‚ö†Ô∏è","‚ùì","üéâ","ü•≥","üôå","ü§ò","ü§ñ","üëÄ","üí°","üß≠","üì¶","üõéÔ∏è","üì°","üõ∞Ô∏è","üß™","üìï","üß∑","ü™™","üß∞","üß±","üõ∞","üóÉÔ∏è"],ct=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function lt(o){try{const i=new URL(o);return i.protocol=i.protocol==="wss:"?"https:":i.protocol==="ws:"?"http:":i.protocol,i.pathname="/",i.search="",i.hash="",i.toString().replace(/\/+$/,"")}catch{return""}}function dt(o){const i=`@e${o}`;return{NAME_KEY:`chat:nick${i}`,NAME_LOCK:`chat:nick:lock${i}`}}function ut({room:o="global",className:i,variant:w="classic",onRosterChange:c,resolveRole:y}){const h="wss://notifications-worker.wizardiowhy.workers.dev/chat",D=s.useMemo(()=>lt(h),[h]),[J,g]=s.useState(1),[f,ie]=s.useState(!1),k=s.useMemo(()=>dt(J),[J]),[T,K]=s.useState(!1),[W,M]=s.useState(0),[G,U]=s.useState([]),[Z,$]=s.useState(!1),[j,re]=s.useState(!1);s.useEffect(()=>{if(j){try{ne(!1)}catch{}try{C||P("Admin")}catch{}}},[j]);const[Q,B]=s.useState(""),[ee,Y]=s.useState([]),O=s.useRef(null),F=s.useRef(null),se=s.useRef(null),ae=s.useRef(null),V=s.useRef(null),[x,X]=s.useState(!1),ce=s.useRef({}),[C,P]=s.useState(null),[q,ne]=s.useState(!0),[a,l]=s.useState(""),u=s.useRef({epochReady:f,needNick:q,nick:C}),v=s.useRef(k),d=s.useRef(null),b=s.useMemo(()=>j?"Admin":C??"",[j,C]),E=s.useMemo(()=>b.trim(),[b]),_=s.useMemo(()=>it(E||null),[E]),de=s.useCallback(t=>{const n=y==null?void 0:y(t);return n||(t.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[y]),ue=s.useCallback(t=>{const n=t.trim();if(!n)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let r=0;for(let R=0;R<n.length;R+=1)r=(r+n.charCodeAt(R)*17)%360;const p=r,S=(r+42)%360;return{background:`linear-gradient(135deg, hsla(${p},80%,56%,0.85), hsla(${S},78%,48%,0.85))`,color:"#fdfcff"}},[]);s.useEffect(()=>{if(f)try{const t=localStorage.getItem(k.NAME_KEY),n=localStorage.getItem(k.NAME_LOCK)==="1";t&&n?(P(t),ne(!1),l(t)):t&&!n?(P(t),l(t),ne(!0)):(P(null),l(""),ne(!0))}catch{P(null),l(""),ne(!0)}},[f,k.NAME_KEY,k.NAME_LOCK]),s.useEffect(()=>{u.current={epochReady:f,needNick:q,nick:C}},[f,q,C]),s.useEffect(()=>{f&&(async()=>{let t=null;try{const n=He();n!=null&&n.username&&(t=n.username)}catch{}try{const n=await ve();n!=null&&n.username&&(t=n.username)}catch{}if(!t)try{const n=localStorage.getItem("forum:session")||sessionStorage.getItem("forum:session"),r=n?JSON.parse(n):null;r!=null&&r.username&&(t=r.username)}catch{}if(t){P(t),l(t),ne(!1);try{localStorage.setItem(k.NAME_KEY,t),localStorage.setItem(k.NAME_LOCK,"1")}catch{}const n=O.current;if(n&&n.readyState===WebSocket.OPEN&&d.current!==t)try{n.send(JSON.stringify({type:"hello",name:t})),d.current=t}catch{}}})()},[f,k.NAME_KEY,k.NAME_LOCK]),s.useEffect(()=>{v.current=k},[k]),s.useEffect(()=>{j||$(!1)},[j]),s.useEffect(()=>{typeof c=="function"&&c(G,W)},[c,G,W]),s.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=j;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:j}}))}catch{}}},[j]),s.useEffect(()=>{T||($(!1),U([]))},[T]),s.useEffect(()=>{if(!Z)return;const t=r=>{const p=se.current;p&&!p.contains(r.target)&&$(!1)},n=r=>{r.key==="Escape"&&$(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",n)}},[Z]),s.useEffect(()=>{if(!x)return;const t=r=>{const p=ae.current;p&&!p.contains(r.target)&&X(!1)},n=r=>{r.key==="Escape"&&X(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",n)}},[x]),s.useEffect(()=>{q&&(d.current=null)},[q]),s.useEffect(()=>{let t=!1,n=null;const r=Date.now(),p=S=>{if(t)return;g(S);const R=Date.now()-r,m=Math.max(0,Math.min(900,520-R)),N=()=>{t||ie(!0)};m<=0?N():n=setTimeout(N,m)};return D?((async()=>{try{const S=await fetch(`${D}/nick-epoch`,{credentials:"include"}),R=S.ok?await S.json().catch(()=>({})):{},I=Number(R.epoch)||1;p(I)}catch{p(1)}})(),()=>{t=!0,n&&clearTimeout(n)}):(p(1),()=>{t=!0,n&&clearTimeout(n)})},[D]),s.useEffect(()=>{const t=F.current;t&&(t.scrollTop=t.scrollHeight)},[ee.length]),s.useEffect(()=>{let t=!1,n=0,r=null;const p=()=>{if(t)return;K(!1);const S=new URL(h);S.searchParams.set("room",o),r=new WebSocket(S),O.current=r,r.addEventListener("open",()=>{K(!0),ce.current={},n=0,M(0);const{epochReady:I,needNick:m,nick:N}=u.current;if(I&&N&&!m)try{r.send(JSON.stringify({type:"hello",name:N})),d.current=N}catch{}}),r.addEventListener("message",async I=>{try{let m=nt(I.data);if(!m&&typeof Blob<"u"&&I.data instanceof Blob&&(m=JSON.parse(await I.data.text())),!m)return;if(m.type==="history")Y(m.messages);else if(m.type==="message"){const N=m.cid;if(N&&ce.current[N]){const L=ce.current[N];delete ce.current[N],Y(le=>{const he=le.filter(ge=>ge.id!==L);return he.some(ge=>ge.id===m.message.id)?he:[...he,m.message]})}else Y(L=>L.some(le=>le.id===m.message.id)?L:[...L,m.message])}else if(m.type==="delete")Y(N=>N.filter(L=>L.id!==m.id));else if(m.type==="edit")Y(N=>N.map(L=>L.id===m.id?{...L,text:m.text}:L));else if(m.type==="system"){if(m.text==="admin-ok"?re(!0):m.text==="hello-ok"&&!m.name&&re(!1),m.text==="presence"){const N=Number(m.count);if(M(Number.isFinite(N)&&N>0?Math.round(N):0),Array.isArray(m.names)){const L=m.names.map(le=>typeof le=="string"?le.trim():"").filter(le=>le.length>0);U(L)}else U([])}if(m.name&&(m.text==="hello-ok"||m.text==="admin-ok")){P(m.name),l(m.name),d.current=m.name;try{const{NAME_KEY:N,NAME_LOCK:L}=v.current;localStorage.setItem(N,m.name),localStorage.setItem(L,"1")}catch{}ne(!1)}}}catch{}});const R=()=>{t||(K(!1),M(0),U([]),$(!1),n=Math.min(n+1,6),setTimeout(p,400*n))};r.addEventListener("close",R),r.addEventListener("error",()=>r==null?void 0:r.close())};return p(),()=>{t=!0;try{r==null||r.close()}catch{}O.current=null,d.current=null}},[h,o]),s.useEffect(()=>{const t=O.current;if(!(!t||t.readyState!==WebSocket.OPEN)&&!(!f||q||!C)&&d.current!==C)try{t.send(JSON.stringify({type:"hello",name:C})),d.current=C}catch{}},[f,q,C]);function A(){const n=(a||"").trim().slice(0,80).replace(/[^\p{L}\p{N}_ -]+/gu,"");P(n||null),l(n);try{localStorage.setItem(k.NAME_KEY,n)}catch{}const r=O.current;if(r&&r.readyState===WebSocket.OPEN)try{r.send(JSON.stringify({type:"hello",name:n})),d.current=n}catch{}}const[z,oe]=s.useState(null);s.useEffect(()=>{(async()=>{try{oe(await ve())}catch{oe(null)}})()},[]);const we=s.useMemo(()=>{const t=z!=null&&z.mutedUntil?Date.parse(z.mutedUntil):0;return!["developer","admin","moderator"].includes(String((z==null?void 0:z.role)||""))&&!!t&&t>Date.now()},[z]);function xe(){const n=Q.replace(/\r/g,"").trim(),r=O.current;if(!f||!C||q||!n||!r||r.readyState!==WebSocket.OPEN||we)return;const p=`${Date.now()}_${Math.random().toString(36).slice(2)}`,S=`loc_${p}`;ce.current[p]=S,Y(R=>[...R,{id:S,author:j?"Admin":C,text:n,ts:Date.now()}]),r.send(JSON.stringify({type:"message",text:n.slice(0,me),cid:p})),B(""),pe()}const te=f&&T&&(!!C||j)&&!q&&!we,Re=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),xe())};s.useEffect(()=>{te||X(!1)},[te]);function ye(t){const n=`@${t} `;B(p=>p?p.replace(/\s+$/," ")+n:n);const r=V.current;setTimeout(()=>{try{if(r){r.focus();const p=r.value.length;r.selectionStart=r.selectionEnd=p}}catch{}},0)}const je=()=>{te&&X(t=>!t)},pe=s.useCallback(()=>{if(w!=="forum")return;const t=V.current;if(!t||t.tagName!=="TEXTAREA")return;const n=t;n.style.height="auto";const r=Math.min(n.scrollHeight,220);n.style.height=`${r}px`},[w]);s.useEffect(()=>{pe()},[Q,pe]);const Ne=t=>{B(r=>`${r}${t}`),X(!1);const n=()=>{const r=V.current;if(r){const p=r.value.length;r.focus();try{r.setSelectionRange(p,p)}catch{}pe()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(n):setTimeout(n,0)},ke=t=>{const n=O.current;!j||!n||n.readyState!==WebSocket.OPEN||n.send(JSON.stringify({type:"delete",id:t}))},Se=(t,n)=>{var S;const r=O.current;if(!j||!r||r.readyState!==WebSocket.OPEN)return;const p=(S=prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",n))==null?void 0:S.trim();p&&r.send(JSON.stringify({type:"edit",id:t,text:p.slice(0,me)}))},Te=t=>t==="Admin"?"rc-admin":t===C?"rc-me":"rc-other",Oe=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!f,children:[e.jsxs("div",{ref:se,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"rc-head-meta",children:[j?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${Z?" open":""}`,onClick:()=>$(t=>!t),"aria-expanded":Z,"aria-controls":"rc-presence-panel","aria-label":"–ö—Ç–æ —Å–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏",children:[e.jsx("span",{className:`rc-presence-dot ${T?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[T?Math.max(W,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${T?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[T?Math.max(W,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}),j&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),j&&Z&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"–°–ø–∏—Å–æ–∫ –∫—Ç–æ –≤ —Å–µ—Ç–∏",children:[e.jsx("div",{className:"rc-presence-title",children:"–°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏"}),G.length?e.jsx("ul",{children:G.map(t=>e.jsxs("li",{className:t===E?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:t}),t===E&&e.jsx("span",{className:"rc-presence-you",children:"–≤—ã"})]},t))}):e.jsx("div",{className:"rc-presence-empty",children:"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("div",{ref:F,className:"rc-list",children:f?ee.length===0?e.jsx("div",{className:"rc-empty",children:"‚Ä¶"}):e.jsx("ul",{children:ee.map(t=>{const n=E?t.author.trim()===E:!1,r=!!(_&&E&&!n&&Me(t.text,_)),p=r?ze(t.text,_):t.text;return e.jsxs("li",{className:r?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",Ae(t.ts),"]"]}),e.jsx(H,{to:`/forum/profile/${encodeURIComponent(t.author)}`,className:Te(t.author),children:t.author}),e.jsx("button",{className:"rc-ax",type:"button",onClick:()=>ye(t.author),title:`@${t.author}`,children:"@"}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:p}),j&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>Se(t.id,t.text),children:"–†–µ–¥."}),e.jsx("button",{className:"rc-ax",onClick:()=>ke(t.id),children:"–£–¥–∞–ª."})]})]},t.id)})}):e.jsx("div",{className:"rc-empty",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"})}),e.jsxs("form",{ref:ae,className:"rc-form",onSubmit:t=>{t.preventDefault(),xe()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${x?" open":""}`,onClick:je,disabled:!te,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üòä"}),e.jsx("input",{ref:V,className:"rc-input",placeholder:"–Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",value:Q,onChange:t=>B(t.target.value),maxLength:me,disabled:!te}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!te,children:"‚ñ∂"}),x&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),fe.length?e.jsx("div",{className:"rc-emoji-grid",children:fe.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(t),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]})]}),Fe=()=>{const t=G,n=T?Math.max(W,t.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!f,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"–û–Ω–ª–∞–π–Ω"}),f?e.jsx("div",{className:"fc-roster-list",children:t.length?t.map(r=>{const p=de(r),S=r.trim(),R=S?S.slice(0,2).toUpperCase():"??",I=ue(r);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:I,children:R}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:r}),e.jsx("div",{className:"fc-roster-role",style:p?{color:p.textColor??"#ede9fe"}:void 0,children:p?p.label:"–£—á–∞—Å—Ç–Ω–∏–∫"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},r)}):e.jsx("div",{className:"fc-roster-empty",children:"–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((r,p)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},p))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${T?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:n}),e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]})]}),f?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:F,className:"forum-chat-list",children:ee.length===0?e.jsx("div",{className:"fc-empty",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç"}):ee.map(r=>{const p=E?r.author.trim()===E:!1,S=!!(_&&E&&!p&&Me(r.text,_)),R=S?ze(r.text,_):r.text,I=de(r.author),m=r.author.trim(),N=m?m.slice(0,2).toUpperCase():"??",L=ue(r.author);return e.jsxs("div",{className:`fc-item${p?" self":""}${S?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:L,children:N}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[e.jsx(H,{to:`/forum/profile/${encodeURIComponent(r.author)}`,children:r.author}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ye(r.author),title:`@${r.author}`,children:"@"}),I&&e.jsx("span",{className:"fc-role",style:{background:`${I.color}33`,color:I.textColor??"#ede9fe",borderColor:`${I.color}55`},children:I.label})]}),e.jsx("span",{className:"fc-time",children:Ae(r.ts)})]}),e.jsx("div",{className:"fc-bubble",children:R}),j&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>Se(r.id,r.text),children:"–†–µ–¥."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ke(r.id),children:"–£–¥–∞–ª."})]})]})]},r.id)})}),e.jsxs("form",{ref:ae,className:"forum-chat-form",onSubmit:r=>{r.preventDefault(),xe()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –¥–µ–º–æ."),disabled:!te,"aria-label":"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",children:"üìé"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:r=>{V.current=r,r&&pe()},value:Q,onChange:r=>B(r.target.value),onKeyDown:Re,placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",disabled:!te,maxLength:me}),x&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),fe.length?e.jsx("div",{className:"rc-emoji-grid",children:fe.map(r=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(r),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${r}`,children:r},r))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${x?" open":""}`,onClick:je,disabled:!te,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üôÇ"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!te,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:i??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:ct}}),w==="forum"?Fe():Oe(),f&&q&&C&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫"}),e.jsx("div",{className:"nick-warn",children:"–ù–∏–∫ –∑–∞–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –°–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –Ω–µ–ª—å–∑—è."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:a,onChange:t=>l(t.target.value),maxLength:80,placeholder:"–í–∞—à –Ω–∏–∫‚Ä¶",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>l(Ce()),children:"üé≤"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:A,children:"–û–∫"})]}),e.jsx("div",{children:Array.from({length:5}).map((t,n)=>e.jsx("span",{className:"nick-pill",onClick:()=>l(Ce()),children:"üé≤ –°–ª—É—á–∞–π–Ω—ã–π"},n))})]})})]})}const be={};function pt({onToken:o,className:i}){const w=(be==null?void 0:be.VITE_RECAPTCHA_SITE_KEY)||"",[c,y]=s.useState(!1),[h,D]=s.useState(null);s.useEffect(()=>{if(!w){const ie=1+Math.floor(Math.random()*9),k=1+Math.floor(Math.random()*9);D({a:ie,b:k,answer:""}),y(!0);return}const g="recaptcha-v3";if(document.getElementById(g)){y(!0);return}const f=document.createElement("script");f.id=g,f.src=`https://www.google.com/recaptcha/api.js?render=${encodeURIComponent(w)}`,f.async=!0,f.defer=!0,f.onload=()=>y(!0),f.onerror=()=>{y(!0)},document.head.appendChild(f)},[w]);async function J(){try{const g=window.grecaptcha;if(!g||!w)return o(null);const f=await g.execute(w,{action:"submit"});o(f||null)}catch{o(null)}}if(!c)return e.jsx("div",{className:i||""});if(h){const g=String(Number(h.answer))===String(h.a+h.b);return e.jsx("div",{className:i||"",children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{children:"–ê–Ω—Ç–∏—Å–ø–∞–º:"}),e.jsxs("span",{className:"rounded bg-white/10 px-2 py-1",children:[h.a," + ",h.b," ="]}),e.jsx("input",{className:"input w-16",value:h.answer||"",onChange:f=>D({...h,answer:f.target.value})}),e.jsx("button",{type:"button",className:"btn",onClick:()=>o(g?"math_ok":null),children:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"})]})})}return e.jsx("div",{className:i||"",children:e.jsx("button",{type:"button",className:"btn",onClick:J,children:"–ü—Ä–æ–≤–µ—Ä–∫–∞ reCAPTCHA"})})}const De="forum:email_verify:";function Le(o){const i=String(Math.floor(1e5+Math.random()*9e5)),w={code:i,issuedAt:Date.now()};try{localStorage.setItem(De+o.toLowerCase(),JSON.stringify(w))}catch{}return i}function mt(o,i,w=15*60*1e3){try{const c=localStorage.getItem(De+o.toLowerCase());if(!c)return!1;const y=JSON.parse(c);if(Date.now()-(y.issuedAt||0)>w)return!1;const h=String(y.code)===String(i).trim();if(h)try{localStorage.setItem("forum:email_verified:"+o.toLowerCase(),"1")}catch{}return h}catch{return!1}}function ft({role:o}){const i={developer:{color:"#22d3ee",text:"Developer"},admin:{color:"#ef4444",text:"Admin"},moderator:{color:"#8b5cf6",text:"Moderator"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"User"},newbie:{color:"#22d3ee",text:"Newbie"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:i[o].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:i[o].text})}function $e(o){const i=String(o||"").toLowerCase();return i.startsWith("[wip]")?"wip":i.startsWith("[review]")?"review":i.startsWith("[done]")?"done":"none"}function Ie({onDone:o}){const[i,w]=s.useState("login"),[c,y]=s.useState(""),[h,D]=s.useState(""),[J,g]=s.useState(""),[f,ie]=s.useState(""),[k,T]=s.useState(!0),[K,W]=s.useState(null),[M,G]=s.useState(!1),[U,Z]=s.useState(null),[$,j]=s.useState(""),[re,Q]=s.useState(!1),[B,ee]=s.useState(""),[Y,O]=s.useState(!1),F=/^[A-Za-z0-9_]{3,16}$/,[se,ae]=s.useState(!0);s.useEffect(()=>{(async()=>{try{const x=await _e();ae((x.registrationMode||"invite")!=="open")}catch{ae(!0)}})()},[]),s.useEffect(()=>{try{const x=Ke();x&&(!x.until||new Date(x.until).getTime()>Date.now())?O(!0):O(!1)}catch{O(!1)}},[]);const V=async x=>{if(x.preventDefault(),Y){W("–†‚Äô–°‚Äπ –†¬∑–†¬∞–†¬±–†¬ª–†—ï–†—î–†—ë–°–Ç–†—ï–†–Ü–†¬∞–†–Ö–°‚Äπ –†—ë –†–Ö–†¬µ –†—ò–†—ï–†¬∂–†¬µ–°‚Äö–†¬µ –†–Ü–†—ï–†‚Ññ–°‚Äö–†—ë –†—ë–†¬ª–†—ë –†¬∑–†¬∞–°–Ç–†¬µ–†—ñ–†—ë–°–É–°‚Äö–°–Ç–†—ë–°–Ç–†—ï–†–Ü–†¬∞–°‚Äö–°–ä–°–É–°–è.");return}W(null),G(!0);try{if(i==="login")await We({usernameOrEmail:c.trim()||h.trim(),password:J,remember:k,otp:$.trim()||void 0,captchaToken:U}),o();else{if(!F.test(c.trim()))throw new Error("Username: 3–≤–Ç‚Äú16 chars (A–≤–Ç‚ÄúZ a–≤–Ç‚Äúz 0–≤–Ç‚Äú9 _)");await Ue({username:c.trim(),email:h.trim(),password:J||void 0,inviteCode:se?f.trim():"",remember:k,captchaToken:U});try{Le(h.trim())}catch{}Q("email")}}catch(X){W((X==null?void 0:X.message)||"–†¬ß–°‚Äö–†—ï-–°‚Äö–†—ï –†—ó–†—ï–°‚Ç¨–†¬ª–†—ï –†–Ö–†¬µ –°‚Äö–†¬∞–†—î")}finally{G(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[90] grid place-items-center bg-black/70 p-4",children:e.jsxs("form",{onSubmit:V,className:"w-[min(560px,92vw)] card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{size:18}),e.jsx("b",{children:i==="login"?"–†‚Äô–°‚Ä¶–†—ï–†“ë":"–†¬†–†¬µ–†—ñ–†—ë–°–É–°‚Äö–°–Ç–†¬∞–°‚Ä†–†—ë–°–è"})]}),!re&&Y&&e.jsx("div",{className:"grid gap-3 mt-3",children:e.jsx("div",{className:"rounded-xl border border-rose-500/30 bg-rose-500/10 p-3 text-rose-200 text-sm",children:"–†‚Äô–°‚Äπ –†¬∑–†¬∞–†¬±–†¬∞–†–Ö–†¬µ–†–Ö–°‚Äπ. –†‚Äô–°‚Ä¶–†—ï–†“ë –†—ë –°–Ç–†¬µ–†—ñ–†—ë–°–É–°‚Äö–°–Ç–†¬∞–°‚Ä†–†—ë–°–è –†–Ö–†¬µ–†“ë–†—ï–°–É–°‚Äö–°—ì–†—ó–†–Ö–°‚Äπ."})}),!re&&!Y&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsx("input",{className:"input",placeholder:i==="login"?"–†‚Ä∫–†—ï–†—ñ–†—ë–†–Ö –†—ë–†¬ª–†—ë e-mail":"–†‚Ä∫–†—ï–†—ñ–†—ë–†–Ö (–†¬ª–†¬∞–°‚Äö–†—ë–†–Ö–†—ë–°‚Ä†–†¬∞/–°‚Ä†–†—ë–°‚Äû–°–Ç–°‚Äπ/_ )",value:c,onChange:x=>y(x.target.value),disabled:M,required:!0}),i==="signup"&&e.jsx("input",{className:"input",placeholder:"E-mail",value:h,onChange:x=>D(x.target.value),disabled:M,required:!0}),i==="signup"&&se&&e.jsx("input",{className:"input",placeholder:"Invite code",value:f,onChange:x=>ie(x.target.value),disabled:M,required:!0}),e.jsx("input",{className:"input",type:"password",placeholder:"–†—ü–†¬∞–°–Ç–†—ï–†¬ª–°–ä",value:J,onChange:x=>g(x.target.value),disabled:M,required:!0}),i==="login"&&e.jsx("input",{className:"input",placeholder:"2FA –†—î–†—ï–†“ë (–†¬µ–°–É–†¬ª–†—ë –†–Ü–†—î–†¬ª–°–ã–°‚Ä°–†¬µ–†–Ö–†—ï)",value:$,onChange:x=>j(x.target.value),disabled:M}),e.jsx(pt,{onToken:Z}),K&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:K}),e.jsx("div",{className:"flex items-center gap-2 text-xs opacity-80",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:x=>T(x.target.checked),disabled:M}),"–†‚Äî–†¬∞–†—ó–†—ï–†—ò–†–Ö–†—ë–°‚Äö–°–ä –†—ò–†¬µ–†–Ö–°–è"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:M,children:i==="login"?"–†‚Äô–†—ï–†‚Ññ–°‚Äö–†—ë":"–†‚Äî–†¬∞–°–Ç–†¬µ–†—ñ–†—ë–°–É–°‚Äö–°–Ç–†—ë–°–Ç–†—ï–†–Ü–†¬∞–°‚Äö–°–ä–°–É–°–è"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>w(i==="login"?"signup":"login"),disabled:M,children:i==="login"?"–†—ú–†¬µ–°‚Äö –†¬∞–†—î–†—î–†¬∞–°—ì–†–Ö–°‚Äö–†¬∞? –†¬†–†¬µ–†—ñ–†—ë–°–É–°‚Äö–°–Ç–†¬∞–°‚Ä†–†—ë–°–è":"–†–à–†¬∂–†¬µ –†¬µ–°–É–°‚Äö–°–ä? –†‚Äô–†—ï–†‚Ññ–°‚Äö–†—ë"})]})]}),re==="email"&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsxs("div",{className:"text-sm text-zinc-300",children:["–†—ö–°‚Äπ –†—ï–°‚Äö–†—ó–°–Ç–†¬∞–†–Ü–†—ë–†¬ª–†—ë –†—î–†—ï–†“ë –†—ó–†—ï–†“ë–°‚Äö–†–Ü–†¬µ–°–Ç–†¬∂–†“ë–†¬µ–†–Ö–†—ë–°–è –†–Ö–†¬∞ ",h,". –†‚Äô–†–Ü–†¬µ–†“ë–†—ë–°‚Äö–†¬µ –†—î–†—ï–†“ë –†–Ö–†—ë–†¬∂–†¬µ."]}),e.jsx("input",{className:"input",placeholder:"–†—ô–†—ï–†“ë –†—ó–†—ï–†“ë–°‚Äö–†–Ü–†¬µ–°–Ç–†¬∂–†“ë–†¬µ–†–Ö–†—ë–°–è",value:B,onChange:x=>ee(x.target.value)}),!!K&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:K}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{mt(h,B)?(Q(!1),o()):W("–†—ú–†¬µ–†–Ü–†¬µ–°–Ç–†–Ö–°‚Äπ–†‚Ññ –†—î–†—ï–†“ë")},children:"–†—ü–†—ï–†“ë–°‚Äö–†–Ü–†¬µ–°–Ç–†“ë–†—ë–°‚Äö–°–ä"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>{Le(h)},children:"–†—õ–°‚Äö–†—ó–°–Ç–†¬∞–†–Ü–†—ë–°‚Äö–°–ä –†—î–†—ï–†“ë –†¬µ–°‚Ä∞–°‚Äò –°–Ç–†¬∞–†¬∑"})]})]})]})})}function xt({me:o,onLogout:i}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.6)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl items-center gap-3 px-4 py-3",children:[e.jsxs(H,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(at,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"Forum // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"–†—ü–°–Ç–†¬∞–†–Ü–†—ë–°‚Äö–†¬µ–†¬ª–°–ä–°–É–°‚Äö–†–Ü–†—ï"})]})]}),o&&(o.role==="admin"||o.role==="developer"||o.role==="moderator")&&e.jsx(H,{to:"/forum/admin",className:"ml-2 btn",children:"Admin"}),e.jsxs(H,{to:`/forum/profile/${o.username}`,className:"ml-2 flex items-center gap-2 rounded-xl border px-3 py-2 card",children:[e.jsx(ft,{role:o.role}),e.jsx("div",{className:"text-sm font-semibold",children:o.username}),e.jsxs("div",{className:"border-l pl-2 text-xs opacity-70",children:["#",o.userNumber]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",className:"btn",onClick:i,children:"–†‚Äô–°‚Äπ–†‚Ññ–°‚Äö–†—ë"})]})})}function St(){const o=Be(),i=qe(),[,w]=s.useReducer(a=>a+1,0),[c,y]=s.useState(void 0),[h,D]=s.useState("latest"),J=s.useMemo(()=>new URLSearchParams(o.search||"").get("feed"),[o.search]),g=s.useMemo(()=>Xe(J)?J:h,[J,h]);s.useEffect(()=>{try{D(Ge())}catch{}},[]),s.useEffect(()=>{g==="questions"&&i("/forum/questions",{replace:!0})},[g,i]);const[f,ie]=s.useState([]),[k,T]=s.useState([]),[K,W]=s.useState([]),[M,G]=s.useState(!1),[U,Z]=s.useState(null),[$,j]=s.useState(null),[re,Q]=s.useState([]),[B,ee]=s.useState({total:0,wip:0,review:0,done:0}),[Y,O]=s.useReducer(a=>a+1,0),F=s.useMemo(()=>{try{return new Intl.RelativeTimeFormat("ru",{numeric:"auto"})}catch{try{return new Intl.RelativeTimeFormat("en",{numeric:"auto"})}catch{return null}}},[]),se=s.useCallback(a=>{if(!a)return"";const l=new Date(a);if(Number.isNaN(l.getTime()))return"";if(!F)return l.toLocaleString();const u=l.getTime()-Date.now(),v=60*1e3,d=60*v,b=24*d,E=30*b,_=365*b;return Math.abs(u)<v?F.format(Math.round(u/1e3),"second"):Math.abs(u)<d?F.format(Math.round(u/v),"minute"):Math.abs(u)<b?F.format(Math.round(u/d),"hour"):Math.abs(u)<E?F.format(Math.round(u/b),"day"):Math.abs(u)<_?F.format(Math.round(u/E),"month"):F.format(Math.round(u/_),"year")},[F]);s.useEffect(()=>{let a=!0;const l=async()=>{try{const v=await ve();a&&y(v)}catch{a&&y(null)}};l();const u=()=>l();return window.addEventListener("forum:session",u),window.addEventListener("storage",u),()=>{a=!1,window.removeEventListener("forum:session",u),window.removeEventListener("storage",u)}},[]),s.useEffect(()=>{if(typeof window>"u")return;const a=()=>O();return window.addEventListener("forum:social-change",a),()=>window.removeEventListener("forum:social-change",a)},[]),s.useEffect(()=>{let a=!0;return G(!0),Z(null),(async()=>{try{const l=await Je(),u=Array.isArray(l)?[...l].sort((A,z)=>{const oe=(A.order??0)-(z.order??0);return oe!==0?oe:new Date(z.createdAt||0).getTime()-new Date(A.createdAt||0).getTime()}):[],v=u.find(A=>String(A.title||"").toLowerCase()==="workshop")||null,[d,b]=await Promise.all([Ye(8).catch(()=>[]),Ve().catch(()=>[])]);if(!a)return;const E=Array.isArray(b)?b:[];ie(u),T(Array.isArray(d)?d:[]),W(E),j(v);const _=v?E.filter(A=>A.sectionId===v.id):[],de=_.reduce((A,z)=>{const oe=$e(z.title);return oe==="wip"?A.wip+=1:oe==="review"?A.review+=1:oe==="done"&&(A.done+=1),A.total+=1,A},{total:0,wip:0,review:0,done:0}),ue=[..._].sort((A,z)=>new Date(z.updatedAt||z.createdAt||0).getTime()-new Date(A.updatedAt||A.createdAt||0).getTime()).slice(0,4);Q(ue),ee(de)}catch(l){if(!a)return;ie([]),T([]),W([]),j(null),Q([]),ee({total:0,wip:0,review:0,done:0}),Z(l instanceof Error?l.message:"Failed to load feed")}finally{a&&G(!1)}})(),()=>{a=!1}},[c]);const ae=s.useMemo(()=>{const a=new Map;return Array.isArray(f)&&f.forEach(l=>{l!=null&&l.id&&a.set(l.id,l)}),a},[f]),V=s.useMemo(()=>c!=null&&c.id?tt(c.id):[],[c==null?void 0:c.id,Y]),x=s.useMemo(()=>{if(g==="questions")return[];if(!Array.isArray(K)||K.length===0)return[];const a=[...K],l=d=>new Date(d.lastPostAt||d.updatedAt||d.createdAt||0).getTime(),u=a.map(d=>({topic:d,section:ae.get(d.sectionId)||null}));let v=[...u];if(g==="following"){if(!(c!=null&&c.id))return[];const d=new Set(V);v=u.filter(b=>d.has(b.topic.authorId))}if(g==="latest"||g==="following")v.sort((d,b)=>l(b.topic)-l(d.topic));else if(g==="new")v.sort((d,b)=>new Date(b.topic.createdAt||0).getTime()-new Date(d.topic.createdAt||0).getTime());else if(g==="hot"){const d=b=>{const E=Number(b.replyCount??0),_=Number(b.viewCount??0),de=l(b),ue=Math.max(1,(Date.now()-de)/36e5),A=E*4+_,z=b.pinned?1e3:0;return A/ue+z};v.sort((b,E)=>d(E.topic)-d(b.topic))}else g==="unanswered"?v=u.filter(d=>Number(d.topic.replyCount??0)===0).sort((d,b)=>new Date(b.topic.createdAt||0).getTime()-new Date(d.topic.createdAt||0).getTime()):g==="unread"&&(v=u.filter(d=>et(c==null?void 0:c.id,d.topic)).sort((d,b)=>l(b.topic)-l(d.topic)));return v.slice(0,12)},[K,ae,g,c==null?void 0:c.id,V]),X={latest:{label:"–ü–æ—Å–ª–µ–¥–Ω–µ–µ",description:"–°–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ–º—ã."},hot:{label:"–ì–æ—Ä—è—á–µ–µ",description:"–û–±—Å—É–∂–¥–µ–Ω–∏—è —Å –≤—ã—Å–æ–∫–∏–º –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ–º —Å–µ–π—á–∞—Å."},new:{label:"–ù–æ–≤–æ–µ",description:"–¢–µ–º—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è, –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º."},following:{label:"–ü–æ–¥–ø–∏—Å–∫–∏",description:"–ü–æ—Å—Ç—ã –æ—Ç –∞–≤—Ç–æ—Ä–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã."},unanswered:{label:"–ë–µ–∑ –æ—Ç–≤–µ—Ç–∞",description:"–¢–µ–º—ã –±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π —à–∞–Ω—Å –ø–æ–º–æ—á—å."},unread:{label:"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ",description:"–ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞—à–µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞."},questions:{label:"–í–æ–ø—Ä–æ—Å—ã",description:"–†–∞–∑–¥–µ–ª –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞."}},ce=X[g]??X.latest,C=s.useMemo(()=>{if(g==="questions")return null;if(g==="following"){if(!(c!=null&&c.id))return"–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ª–µ–Ω—Ç—É –ø–æ–¥–ø–∏—Å–æ–∫.";if(V.length===0)return"–í—ã –ø–æ–∫–∞ –Ω–∏ –Ω–∞ –∫–æ–≥–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.";if(!M&&x.length===0&&!U)return"–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º–∏ ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ–º—É!"}return!M&&x.length===0&&!U?"–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º–∏ ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ–º—É!":null},[g,c==null?void 0:c.id,V.length,M,x.length,U]);if(s.useEffect(()=>{let a=!1;function l(u){if(u.key==="/"){const v=document.getElementById("forum-search-input");v&&(u.preventDefault(),v.focus());return}if(u.key.toLowerCase()==="g"){a=!0,setTimeout(()=>{a=!1},800);return}if(a){if(u.key.toLowerCase()==="h"){u.preventDefault();try{window.location.href="/forum"}catch{window.location.assign("/forum")}}if(u.key.toLowerCase()==="q"){u.preventDefault();try{window.location.href="/forum/questions"}catch{window.location.assign("/forum/questions")}}}}return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[]),c===void 0)return e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}});if(!c)return e.jsx("div",{className:"min-h-dvh forum-theme",children:e.jsx("div",{className:"container mx-auto px-3 py-10",children:e.jsx(Ie,{onDone:()=>w()})})});const P=Array.isArray(f)?f:[],q=Array.isArray(k)?k:[],ne={wip:{label:"WIP",className:"bg-amber-400/10 text-amber-300"},review:{label:"Review",className:"bg-sky-400/10 text-sky-300"},done:{label:"Done",className:"bg-emerald-400/10 text-emerald-300"},none:{label:"Idea",className:"bg-zinc-200/10 text-zinc-200"}};return e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[c===null&&e.jsx(Ie,{onDone:()=>w()}),e.jsx(xt,{me:c,onLogout:()=>{Pe(),w()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[e.jsx(Ze,{}),e.jsx(Qe,{}),e.jsx("div",{className:"relative mb-6 overflow-hidden card",children:e.jsx(H,{to:"/forum",className:"block focus:outline-none focus:ring-2 focus:ring-cyan-400/60 rounded-md",children:e.jsx("h1",{className:"select-none py-10 text-center font-black tracking-[0.16em] text-transparent bg-clip-text shimmer-text",style:{fontSize:"clamp(64px,12vw,140px)",lineHeight:1},title:"Go to forum home",children:"SKY"})})}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.65fr_.85fr] xl:grid-cols-[1.8fr_.9fr]",children:[e.jsxs("section",{className:"grid gap-6",children:[g!=="questions"&&e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"border-b px-4 py-3",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("span",{className:"text-xs uppercase tracking-[0.3em]",style:{color:"var(--text-2)"},children:["–†‚Ä∫–†¬µ–†–Ö–°‚Äö–†¬∞ –í¬∑ ",ce.label]}),M&&e.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-zinc-400",children:"–†‚Äî–†¬∞–†—ñ–°–Ç–°—ì–†¬∑–†—î–†¬∞–≤–Ç¬¶"})]}),e.jsx("div",{className:"mt-1 text-sm text-zinc-300/80",children:ce.description})]}),U&&e.jsxs("div",{className:"border-b border-white/5 px-4 py-3 text-sm text-rose-300/90",children:["–†—ú–†¬µ –°—ì–†“ë–†¬∞–†¬ª–†—ï–°–É–°–ä –†¬∑–†¬∞–†—ñ–°–Ç–°—ì–†¬∑–†—ë–°‚Äö–°–ä –†¬ª–†¬µ–†–Ö–°‚Äö–°—ì: ",U]}),e.jsx("div",{className:"divide-y divide-white/5",children:M?Array.from({length:4}).map((a,l)=>e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"h-4 w-2/3 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"mt-3 flex gap-3",children:[e.jsx("span",{className:"h-3 w-20 rounded-full bg-white/5 animate-pulse"}),e.jsx("span",{className:"h-3 w-16 rounded-full bg-white/5 animate-pulse"})]})]},l)):e.jsxs(e.Fragment,{children:[x.map(({topic:a,section:l})=>{const u=a.sectionTitle||a.section_name||(l==null?void 0:l.title)||"",v=a.authorUsername||a.authorName||a.author||(a.authorId?`@${String(a.authorId).slice(0,6)}`:"–†—í–†–Ü–°‚Äö–†—ï–°–Ç"),d=se(a.lastPostAt||a.updatedAt||a.createdAt)||(a.updatedAt?new Date(a.updatedAt).toLocaleString():a.createdAt?new Date(a.createdAt).toLocaleString():"");return e.jsxs(H,{to:`/forum/topic/${a.id}`,className:"block px-4 py-4 transition hover:bg-white/[0.05] focus:outline-none focus:ring-2 focus:ring-cyan-400/40",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.pinned&&e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-2 py-0.5 text-[10px] uppercase tracking-[0.26em] text-emerald-300",children:"PIN"}),e.jsx("span",{className:"font-semibold text-white truncate",children:a.title||"–†‚Äò–†¬µ–†¬∑ –†–Ö–†¬∞–†¬∑–†–Ü–†¬∞–†–Ö–†—ë–°–è"})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-zinc-400/80",children:[u?e.jsx("span",{className:"truncate",children:u}):null,e.jsx("span",{className:"truncate",children:v})]})]}),e.jsx("div",{className:"text-right text-xs text-zinc-400/80 whitespace-nowrap",children:d})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 text-[11px] uppercase tracking-[0.28em] text-zinc-500",children:[e.jsxs("span",{children:["Replies ",a.replyCount??0]}),e.jsxs("span",{children:["Views ",a.viewCount??0]})]})]},a.id)}),C&&e.jsx("div",{className:"px-4 py-4 text-sm text-zinc-300/80",children:C})]})})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"–†¬†–†¬∞–†¬∑–†“ë–†¬µ–†¬ª–°‚Äπ"}),P.map(a=>{const l=a.id===($==null?void 0:$.id)||String(a.title||"").toLowerCase()==="workshop";return e.jsx(H,{to:`/forum/section/${a.id}`,className:"card p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[a.icon?e.jsx("span",{className:"text-xl",children:a.icon}):e.jsx(rt,{size:16}),e.jsx("span",{className:"truncate",children:a.title}),l&&e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] text-emerald-300",children:"Workshop"})]}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:a.description})]}),e.jsxs("div",{className:"text-right text-xs uppercase tracking-[0.28em] text-zinc-500",children:[e.jsxs("div",{children:["Topics ",a.topicCount??0]}),e.jsxs("div",{children:["Posts ",a.postCount??0]})]})]})},a.id)}),!P.length&&e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"–†¬†–†¬∞–†¬∑–†“ë–†¬µ–†¬ª–†—ï–†–Ü –†—ó–†—ï–†—î–†¬∞ –†–Ö–†¬µ–°‚Äö. –†¬ò–°–É–†—ó–†—ï–†¬ª–°–ä–†¬∑–°—ì–†‚Ññ–°‚Äö–†¬µ –†¬∞–†“ë–†—ò–†—ë–†–Ö-–†—ó–†¬∞–†–Ö–†¬µ–†¬ª–°–ä, –°‚Ä°–°‚Äö–†—ï–†¬±–°‚Äπ –°–É–†—ï–†¬∑–†“ë–†¬∞–°‚Äö–°–ä –†—ó–†¬µ–°–Ç–†–Ü–°‚Äπ–†‚Ññ –°–Ç–†¬∞–†¬∑–†“ë–†¬µ–†¬ª."})]})]}),e.jsxs("aside",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.28em] text-zinc-400",children:"Latest activity"}),e.jsx(H,{to:"/forum?feed=latest",className:"text-xs text-cyan-300 hover:underline",children:"Feed"})]}),q.map(a=>e.jsx(H,{to:`/forum/topic/${a.topicId||a.id}`,className:"block card px-3 py-3 transition hover:border-cyan-400/40",children:e.jsxs("div",{className:"relative pl-4",children:[e.jsx("span",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full",style:{background:"#22d3ee"}}),e.jsx("div",{className:"truncate font-semibold",children:a.title||a.topicTitle||"–†—ü–†—ï–°–É–°‚Äö"}),e.jsx("div",{className:"mt-1 text-xs",style:{color:"var(--text-2)"},children:se(a.createdAt||a.updatedAt)||(a.createdAt?new Date(a.createdAt).toLocaleString():"")})]})},a.id)),!q.length&&e.jsx("div",{className:"card p-3 text-sm opacity-70",children:"–†—ü–†—ï–°–É–°‚Äö–†—ï–†–Ü –†—ó–†—ï–†—î–†¬∞ –†–Ö–†¬µ–°‚Äö"}),$?e.jsxs("div",{className:"mt-4 card p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-emerald-300/80",children:"Workshop"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:$.title||"Workshop"}),e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:"–†—ö–†¬∞–°–É–°‚Äö–†¬µ–°–Ç–°–É–†—î–†¬∞–°–è –†“ë–†¬ª–°–è –†—ó–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†–Ö–°‚Äπ–°‚Ä¶ –°‚Äö–†¬µ–†—ò: –°–É–°‚Äö–†¬∞–°‚Äö–°—ì–°–É, –°–É–°‚Äö–†¬µ–†—î, –†—ó–°–Ç–†—ï–†—ñ–°–Ç–†¬µ–°–É–°–É –†—ë –°–Ç–†¬µ–†–Ü–°–ä–°–ã –°–É–†—ï–†—ï–†¬±–°‚Ä∞–†¬µ–°–É–°‚Äö–†–Ü–†¬∞."})]}),e.jsx(H,{to:`/forum/section/${$.id}`,className:"btn btn-primary",children:"–†—õ–°‚Äö–†—î–°–Ç–°‚Äπ–°‚Äö–°–ä –†—ò–†¬∞–°–É–°‚Äö–†¬µ–°–Ç–°–É–†—î–°—ì–°–ã"})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.32em] text-zinc-400/80",children:[e.jsxs("span",{children:["–†—ü–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†—ï–†–Ü ",B.total]}),e.jsxs("span",{children:["[WIP] ",B.wip]}),e.jsxs("span",{children:["[Review] ",B.review]}),e.jsxs("span",{children:["[Done] ",B.done]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 md:grid-cols-2",children:[re.map(a=>{const l=$e(a.title),u=ne[l];return e.jsxs(H,{to:`/forum/topic/${a.id}`,className:"card p-4 transition hover:border-emerald-400/40",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] ${u.className}`,children:u.label}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate font-semibold text-white",children:a.title}),e.jsx("div",{className:"mt-1 text-xs text-zinc-400/80",children:se(a.updatedAt||a.createdAt)||(a.updatedAt?new Date(a.updatedAt).toLocaleString():"")})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 text-[11px] uppercase tracking-[0.3em] text-zinc-500",children:[e.jsxs("span",{children:["Replies ",a.replyCount??0]}),e.jsxs("span",{children:["Views ",a.viewCount??0]})]})]},a.id)}),!re.length&&e.jsx("div",{className:"card p-4 text-sm text-zinc-300/80",children:"–†‚Äô –†—ò–†¬∞–°–É–°‚Äö–†¬µ–°–Ç–°–É–†—î–†—ï–†‚Ññ –†—ó–†—ï–†—î–†¬∞ –†–Ö–†¬µ–°‚Äö –†—ó–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†—ï–†–Ü. –†‚Äù–†—ï–†¬±–†¬∞–†–Ü–°–ä–°‚Äö–†¬µ –†—ó–†¬µ–°–Ç–†–Ü–°‚Äπ–†‚Ññ, –°‚Ä°–°‚Äö–†—ï–†¬±–°‚Äπ –†—ó–†—ï–†¬ª–°—ì–°‚Ä°–†—ë–°‚Äö–°–ä –°–Ç–†¬µ–†–Ü–°–ä–°–ã."})]})]}):e.jsx("div",{className:"mt-4 card border border-dashed border-white/10 p-5 text-sm text-zinc-300/70",children:"Workshop-–°–Ç–†¬∞–†¬∑–†“ë–†¬µ–†¬ª –†¬µ–°‚Ä∞–°‚Äò –†–Ö–†¬µ –°–É–†—ï–†¬∑–†“ë–†¬∞–†–Ö. –†–é–†—ï–†¬∑–†“ë–†¬∞–†‚Ññ–°‚Äö–†¬µ –†¬µ–†—ñ–†—ï –†–Ü –†—ó–†¬∞–†–Ö–†¬µ–†¬ª–†—ë –†¬∞–†“ë–†—ò–†—ë–†–Ö–†—ë–°–É–°‚Äö–°–Ç–†¬∞–°‚Äö–†—ï–°–Ç–†¬∞, –°‚Ä°–°‚Äö–†—ï–†¬±–°‚Äπ –†“ë–†¬µ–†¬ª–†—ë–°‚Äö–°–ä–°–É–°–è –†—ó–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†¬∞–†—ò–†—ë."})]})]}),e.jsxs("div",{className:"mt-8 card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(ut,{})})]}),c&&P.length>0&&e.jsx(H,{to:`/forum/section/${(P.find(a=>String(a.title||"").toLowerCase()==="questions")||P[0]).id}`,className:"fixed bottom-6 right-6 z-40 inline-flex h-12 w-12 items-center justify-center rounded-full bg-[color:var(--accent)] text-black shadow-lg transition hover:scale-105 focus:outline-none focus:ring-2 focus:ring-cyan-400/60 lg:hidden",title:"New topic",children:"+"})]})]})}export{St as default};
