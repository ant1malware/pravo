import{b as Y,j as e,o as G,p as R,q as P,t as Z,w as ee,s as te,x as z,y as se,z as ae,A as ne,B as ie,D as ce,E as re,F as le,G as oe}from"./index-CAkmMo7n.js";import{R as o,L as de}from"./react-vendor-DTkXckhQ.js";import{listSections as W,listTopics as q,listLatestPosts as ue,createSection as me,updateSection as pe,deleteSection as xe,updateTopic as $,moveTopic as he,deleteTopic as ve}from"./forumRemote-D5s3MT8n.js";import"./icons-wEjUy8Cq.js";const O=["cheb","cheb-access","chebzik"];function T(){try{const a=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),v=a?JSON.parse(a):null;return(v==null?void 0:v.userId)||"unknown"}catch{return"unknown"}}function ke(){const[a,v]=o.useState("users"),[r,h]=o.useState(null);o.useEffect(()=>{(async()=>{try{h(await Y())}catch{h(null)}})()},[]);const m=r==null?void 0:r.role,N=!!(r!=null&&r.owner),g=N||m==="developer"?["insights","users","sections","topics","invites","maintenance"]:m==="admin"?["users","topics","invites"]:m==="moderator"?["users","invites"]:["topics"];return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:g.map(b=>e.jsx("button",{className:`btn ${a===b?"btn-primary":""}`,onClick:()=>v(b),children:b},b))}),a==="insights"&&e.jsx(ge,{}),a==="users"&&e.jsx(be,{meRole:m,meId:r==null?void 0:r.id,meOwner:N}),a==="sections"&&e.jsx(fe,{}),a==="topics"&&e.jsx(je,{meRole:m}),a==="invites"&&e.jsx(ye,{meRole:m,meId:(r==null?void 0:r.id)||""}),a==="maintenance"&&e.jsx(Ne,{})]})}function ge(){const[a,v]=o.useState(!0),[r,h]=o.useState(null),[m,N]=o.useState({members:0,sections:0,topics:0,replies:0,views:0}),[g,b]=o.useState([]),[f,S]=o.useState([]),[l,d]=o.useState([]);o.useEffect(()=>{let s=!0;return v(!0),h(null),(async()=>{try{const[x,j,D,A,c]=await Promise.all([G(),W(),q(),R().catch(()=>[]),ue(5).catch(()=>[])]);if(!s)return;const y=D.reduce((t,n)=>t+(n.replyCount??0),0),E=D.reduce((t,n)=>t+(n.viewCount??0),0),M=[...D].sort((t,n)=>new Date(n.updatedAt||n.createdAt||0).getTime()-new Date(t.updatedAt||t.createdAt||0).getTime()).slice(0,5),L=Array.isArray(A)?[...A].sort((t,n)=>new Date(n.createdAt||0).getTime()-new Date(t.createdAt||0).getTime()):[];N({members:x.length,sections:j.length,topics:D.length,replies:y,views:E}),b(M),S(L.slice(0,5)),d(Array.isArray(c)?c:[])}catch(x){if(!s)return;h((x==null?void 0:x.message)||"Failed to load insights")}finally{s&&v(!1)}})(),()=>{s=!1}},[]);const i=s=>{if(!s)return"\u2014";try{return new Date(s).toLocaleString()}catch{return s}};return e.jsxs("div",{className:"grid gap-4",children:[r&&e.jsx("div",{className:"card border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200",children:r}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:[{label:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438",value:m.members},{label:"\u0420\u0430\u0437\u0434\u0435\u043B\u044B",value:m.sections},{label:"\u0422\u0435\u043C\u044B",value:m.topics},{label:"\u041E\u0442\u0432\u0435\u0442\u044B",value:m.replies}].map(s=>e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:s.label}),e.jsx("div",{className:"mt-2 text-2xl font-bold text-white",children:a?"\u2026":s.value})]},s.label))}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0435 \u0442\u0435\u043C\u044B"}),a&&e.jsx("span",{className:"text-xs text-zinc-400/80",children:"\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435\u2026"})]}),e.jsxs("div",{className:"grid gap-2",children:[!a&&g.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"\u0422\u0435\u043C \u043F\u043E\u043A\u0430 \u043D\u0435\u0442."}),g.map(s=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-white",children:s.title}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-400/80",children:["\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u043E: ",i(s.updatedAt||s.createdAt)," \xB7 \u041E\u0442\u0432\u0435\u0442\u043E\u0432"," ",s.replyCount??0]})]},s.id))]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"\u0421\u0432\u0435\u0436\u0438\u0435 \u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F"}),e.jsx("span",{className:"text-xs text-zinc-400/80",children:f.length})]}),e.jsxs("div",{className:"grid gap-2",children:[!a&&f.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"\u041F\u043E\u043A\u0430 \u043D\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u043E \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F."}),f.slice(0,5).map(s=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[e.jsx("div",{className:"font-mono text-xs text-cyan-300",children:s.code}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-400/80",children:[i(s.createdAt)," ",s.note?`\xB7 ${s.note}`:""]})]},`${s.code}-${s.createdAt}`))]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043E\u0442\u0432\u0435\u0442\u044B"}),e.jsx(de,{to:"/forum?feed=latest",className:"text-xs text-cyan-300 hover:underline",children:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043B\u0435\u043D\u0442\u0443"})]}),e.jsxs("div",{className:"grid gap-2",children:[!a&&l.length===0&&e.jsx("div",{className:"text-sm text-zinc-400/80",children:"\u0421\u0432\u0435\u0436\u0438\u0445 \u043E\u0442\u0432\u0435\u0442\u043E\u0432 \u043D\u0435\u0442."}),l.map(s=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-white truncate",children:s.topicTitle||s.title||"\u041F\u043E\u0441\u0442"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-400/80",children:i(s.createdAt||s.updatedAt)})]},s.id))]})]})]})}function be({meRole:a,meId:v,meOwner:r}){const[h,m]=o.useState([]),[N,g]=o.useState(""),[b,f]=o.useState({}),[S,l]=o.useState({}),d=o.useCallback(async()=>{try{const t=await G();m(t);const n=await Promise.allSettled(t.map(async u=>{try{const w=await P(u.id),U=((w==null?void 0:w.labels)||[]).map(F=>F.trim().toLowerCase()).filter(Boolean).some(F=>O.includes(F));return[u.id,U]}catch{return[u.id,!1]}})),p={};for(const u of n)if(u.status==="fulfilled"){const[w,B]=u.value;p[w]=B}f(p)}catch(t){alert((t==null?void 0:t.message)||"Failed to load users")}},[]);o.useEffect(()=>{d()},[d]);const i=o.useMemo(()=>{const t=N.trim().toLowerCase();return t?h.filter(n=>{const p=String(n.username||"").toLowerCase(),u=String(n.email||"").toLowerCase(),w=String(n.userNumber||""),B=String(n.invitedByName||"").toLowerCase();return p.includes(t)||u.includes(t)||w.includes(t)||B.includes(t)}):h},[h,N]),s=a==="developer",x=a==="developer"||a==="admin",j=a==="developer"||a==="admin"||a==="moderator",D=!!r||a==="developer",A=async(t,n)=>{if(s)try{await te(t,n),d()}catch(p){alert((p==null?void 0:p.message)||"Failed to set role")}},c=async t=>{if(!j)return;const n=parseInt(prompt("Mute minutes","60")||"60",10),p=new Date(Date.now()+Math.max(1,n)*6e4).toISOString();try{await ce(t,p),await d()}catch(u){alert((u==null?void 0:u.message)||"Failed to mute")}},y=async t=>{if(j)try{await re(t),await d()}catch(n){alert((n==null?void 0:n.message)||"Failed to unmute")}},E=async t=>{if(!x)return;const n=parseInt(prompt("Ban days","7")||"7",10),p=new Date(Date.now()+Math.max(1,n)*864e5).toISOString();try{await le(t,p),await d()}catch(u){alert((u==null?void 0:u.message)||"Failed to ban")}},M=async t=>{if(x)try{await oe(t),await d()}catch(n){alert((n==null?void 0:n.message)||"Failed to unban")}},L=async(t,n)=>{if(D){l(p=>({...p,[t]:!0}));try{const p=await P(t),u=new Set(((p==null?void 0:p.labels)||[]).map(w=>w.trim()).filter(Boolean));for(const w of O)u.delete(w);n&&u.add("cheb-access"),await z(t,Array.from(u).slice(0,7)),f(w=>({...w,[t]:n}))}catch(p){alert((p==null?void 0:p.message)||"Failed to update Cheb access")}finally{l(p=>({...p,[t]:!1}))}}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Remote accounts fetched from the Worker API. Use this panel to adjust roles and moderation privileges."}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-full sm:w-72",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0438\u043A\u0443, e-mail \u0438\u043B\u0438 \u043D\u043E\u043C\u0435\u0440\u0443",value:N,onChange:t=>g(t.target.value)}),e.jsx("button",{className:"btn",onClick:d,children:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C"}),N&&e.jsx("button",{className:"btn",onClick:()=>g(""),children:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C"})]}),e.jsxs("div",{className:"grid gap-2",children:[i.map(t=>{const n=Number(t.userNumber||0)===1,p=String(t.role||"user"),u=[];j&&!n&&(u.push(e.jsx("button",{className:"btn",onClick:()=>c(t.id),children:"Mute"},"mute")),u.push(e.jsx("button",{className:"btn",onClick:()=>y(t.id),children:"Unmute"},"unmute"))),x&&!n&&(u.push(e.jsx("button",{className:"btn",onClick:()=>E(t.id),children:"Ban"},"ban")),u.push(e.jsx("button",{className:"btn",onClick:()=>M(t.id),children:"Unban"},"unban")));const w=Date.now(),B=!!t.vipUntil&&new Date(t.vipUntil).getTime()>w,U=!!t.mutedUntil&&new Date(t.mutedUntil).getTime()>w,F=!!t.bannedUntil&&new Date(t.bannedUntil).getTime()>w,H=async()=>{try{const C=await P(t.id),I=((C==null?void 0:C.labels)||[]).join(", "),V=prompt("Custom labels (comma-separated, up to 7)",I||"");if(V===null)return;const K=V.split(",").map(X=>X.trim()).filter(Boolean).slice(0,7);await z(t.id,K),alert("Labels updated")}catch(C){alert((C==null?void 0:C.message)||"Failed to update labels")}},Q=async()=>{const C=parseInt(prompt("VIP days","30")||"30",10);try{await se(t.id,isNaN(C)?30:Math.max(1,C)),await d()}catch(I){alert((I==null?void 0:I.message)||"Failed to set VIP")}},J=async()=>{try{await ae(t.id),await d()}catch(C){alert((C==null?void 0:C.message)||"Failed to remove VIP")}},_=n?"OWNER":a==="developer"?t.invitedByName?`invited by: ${t.invitedByName}`:"":v&&t.invitedById&&t.invitedById===v?"invited by: you":"",k=[];return _&&k.push(e.jsx("span",{className:"rounded-full bg-white/5 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-zinc-300",children:_},"invited")),B&&k.push(e.jsx("span",{className:"rounded-full bg-amber-500/10 px-2 py-0.5 text-[11px] uppercase tracking-wider text-amber-300",title:`VIP until ${new Date(t.vipUntil).toLocaleString()}`,children:"VIP"},"vip")),F&&k.push(e.jsx("span",{className:"rounded-full bg-rose-500/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-rose-300",title:`Banned until ${t.bannedUntil?new Date(t.bannedUntil).toLocaleString():""}`,children:"Banned"},"banned")),U&&k.push(e.jsx("span",{className:"rounded-full bg-amber-500/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-amber-300",title:`Muted until ${t.mutedUntil?new Date(t.mutedUntil).toLocaleString():""}`,children:"Muted"},"muted")),b[t.id]&&k.push(e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.26em] text-emerald-300",children:"CHEB"},"cheb")),e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",t.userNumber]}),e.jsx("div",{className:"font-semibold",children:t.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:r||a==="developer"?t.email:""}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs opacity-70",children:k.length?k:null}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[s&&!n||n&&v===t.id?e.jsxs("select",{className:"input",value:t.role,onChange:C=>A(t.id,C.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}):e.jsx("span",{className:"rounded-full border px-2 py-1 text-xs uppercase tracking-wider",style:{borderColor:"var(--border)"},children:n?"OWNER":p}),D&&!n&&e.jsx("button",{className:"btn",onClick:()=>L(t.id,!b[t.id]),disabled:!!S[t.id],title:b[t.id]?"\u0423\u0431\u0440\u0430\u0442\u044C \u0434\u043E\u0441\u0442\u0443\u043F \u043A \u0427\u0435\u0431\u0437\u0438\u043A\u0443":"\u0412\u044B\u0434\u0430\u0442\u044C \u0434\u043E\u0441\u0442\u0443\u043F \u043A \u0427\u0435\u0431\u0437\u0438\u043A\u0443",children:b[t.id]?"\u0423\u0431\u0440\u0430\u0442\u044C \u0427\u0435\u0431\u0437\u0438\u043A\u0430":"\u0414\u0430\u0442\u044C \u0427\u0435\u0431\u0437\u0438\u043A\u0430"}),e.jsx("button",{className:"btn",onClick:H,title:"Custom labels",children:"Labels"}),e.jsx("button",{className:"btn",onClick:Q,title:"Give VIP",children:"Give VIP"}),t.vipUntil&&e.jsx("button",{className:"btn",onClick:J,title:"Remove VIP",children:"UnVIP"}),u.length?u:null]})]},t.id)}),!i.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No users found."})]})]})}function fe(){const[a,v]=o.useState([]),[r,h]=o.useState(""),[m,N]=o.useState(""),g=o.useCallback(async()=>{try{v(await W())}catch(l){alert((l==null?void 0:l.message)||"Failed to load sections")}},[]);o.useEffect(()=>{g()},[g]);const b=async()=>{if(r.trim())try{await me({title:r.trim(),description:m.trim(),actorId:T()}),h(""),N(""),g()}catch(l){alert((l==null?void 0:l.message)||"Failed to create section")}},f=async(l,d,i)=>{try{await pe(l,{[d]:i,actorId:T()}),g()}catch(s){alert((s==null?void 0:s.message)||"Failed to update section")}},S=async l=>{if(confirm("Delete this section?"))try{await xe(l),g()}catch(d){alert((d==null?void 0:d.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Create section"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:r,onChange:l=>h(l.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:m,onChange:l=>N(l.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:b,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Sections"}),e.jsxs("div",{className:"grid gap-2",children:[a.map(l=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[l.id.slice(0,8),":"]}),e.jsx("input",{className:"input",value:l.title,onChange:d=>f(l.id,"title",d.target.value)}),e.jsx("input",{className:"input",value:l.description||"",onChange:d=>f(l.id,"description",d.target.value)}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>S(l.id),children:"Delete"})})]},l.id)),!a.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No sections yet."})]})]})]})}function je({meRole:a}){const[v,r]=o.useState([]),h=o.useCallback(async()=>{try{r(await q())}catch(i){alert((i==null?void 0:i.message)||"Failed to load topics")}},[]);o.useEffect(()=>{h()},[h]);const m=a==="developer",N=a==="developer",g=a==="developer",b=a==="developer"||a==="admin",f=async(i,s)=>{if(m)try{await $(i,{pinned:s,actorId:T()}),h()}catch(x){alert((x==null?void 0:x.message)||"Failed to update topic")}},S=async(i,s)=>{if(N)try{await $(i,{locked:s,actorId:T()}),h()}catch(x){alert((x==null?void 0:x.message)||"Failed to update topic")}},l=async i=>{if(!g)return;const x=(prompt("Move to section ID","")||"").trim();if(x)try{await he(i,x),h()}catch(j){alert((j==null?void 0:j.message)||"Failed to move topic")}},d=async i=>{if(b&&confirm("Delete this topic?"))try{await ve(i),h()}catch(s){alert((s==null?void 0:s.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Topics"}),e.jsxs("div",{className:"grid gap-2",children:[v.map(i=>{const s=[];return m&&s.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.pinned,onChange:x=>f(i.id,x.target.checked)}),"pinned"]},"pin")),N&&s.push(e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.locked,onChange:x=>S(i.id,x.target.checked)}),"locked"]},"lock")),g&&s.push(e.jsx("button",{className:"btn",onClick:()=>l(i.id),children:"Move"},"move")),b&&s.push(e.jsx("button",{className:"btn",onClick:()=>d(i.id),children:"Delete"},"delete")),e.jsxs("div",{className:"grid grid-cols-1 items-start gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:i.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",i.id.slice(0,8),": section: ",i.sectionId.slice(0,8),":"]}),(i.pinned||i.locked)&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[10px] uppercase tracking-[0.2em] opacity-70",children:[i.pinned&&e.jsx("span",{children:"pinned"}),i.locked&&e.jsx("span",{children:"locked"})]})]}),s.length?e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:s}):null]},i.id)}),!v.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No topics yet."})]})]})}function ye({meRole:a,meId:v}){const[r,h]=o.useState([]),[m,N]=o.useState(5),[g,b]=o.useState(""),f=a==="developer",S=o.useCallback(async()=>{try{const c=await R(),y=f?c:c.filter(E=>(E.createdBy||"")===(v||""));h(y)}catch(c){alert((c==null?void 0:c.message)||"Failed")}},[f,v]);o.useEffect(()=>{S()},[S]);const l=Date.now(),d=a==="admin"?48*3600*1e3:a==="moderator"?72*3600*1e3:0,i=d?l-d:0,s=r.filter(c=>{const y=new Date(c.createdAt).getTime();return!isNaN(y)&&y>=i}),j=Math.max(0,(a==="admin"?2:a==="moderator"?1:1/0)-s.length),D=async()=>{try{const c=Math.max(1,Math.min(20,m)),y=isFinite(j)?Math.min(j,c):c;if(!f&&y<=0){alert("Invite quota reached. Try again later.");return}await ne(y,g||void 0),b(""),S()}catch(c){alert((c==null?void 0:c.message)||"Failed to generate")}},A=async c=>{if(confirm("Delete this invite?"))try{await ie(c),S()}catch(y){alert((y==null?void 0:y.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Invite codes"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:Math.min(20,isFinite(j)?Math.max(j,0):20),value:m,onChange:c=>N(parseInt(c.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:g,onChange:c=>b(c.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:D,disabled:!f&&j<=0,title:!f&&j<=0?"Quota reached":void 0,children:"Generate"})]}),!f&&e.jsxs("div",{className:"mb-4 text-xs opacity-70",children:[a==="admin"&&e.jsxs("span",{children:["Remaining in 48h window: ",e.jsx("b",{children:j})," of 2"]}),a==="moderator"&&e.jsxs("span",{children:["Remaining in 72h window: ",e.jsx("b",{children:j})," of 1"]})]}),e.jsxs("div",{className:"grid gap-2",children:[r.map(c=>{var y;return e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:c.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(c.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs opacity-80",children:f?`by: ${c.createdByName||((y=c.createdBy)==null?void 0:y.slice(0,8))}`:"by: you"}),e.jsx("div",{className:"text-xs",children:c.note||""}),e.jsx("div",{className:"text-xs",children:c.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>A(c.code),children:"Delete"})})]},`${c.code}-${c.createdAt}`)}),!r.length&&e.jsx("div",{className:"text-sm opacity-70",children:"No invite codes yet."})]})]})}function Ne(){const[a,v]=o.useState("invite");return o.useEffect(()=>{(async()=>{try{const r=await Z();v((r==null?void 0:r.registrationMode)||"invite")}catch{}})()},[]),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Registration settings"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Registration:"}),e.jsxs("select",{className:"input",value:a,onChange:async r=>{const h=r.target.value;v(h);try{await ee({registrationMode:h})}catch(m){alert((m==null?void 0:m.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"Invite only"}),e.jsx("option",{value:"open",children:"Open"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Maintenance"}),e.jsx("p",{className:"mb-0 text-sm opacity-70",children:"All maintenance is server-driven. Contact the owner/developer to perform administrative maintenance tasks."})]})}export{ke as default};
