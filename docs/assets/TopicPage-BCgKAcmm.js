import{j as t}from"./index-DbAFBgKr.js";import{u as j,R as l,L as N}from"./react-vendor-DTkXckhQ.js";import{g as b}from"./authRemote-D9Q-aZvG.js";import{g as v,d as w,t as k,e as P,u as C,f as R}from"./forumRemote-BYvX5m8l.js";import{ab as S,ag as T,o as A}from"./icons-_pZg0EN0.js";function M(){const{id:d=""}=j(),[n,u]=l.useState(null),[s,h]=l.useState(null),[p,c]=l.useState([]),[m,x]=l.useState(""),o=!!n&&(n.role==="developer"||n.role==="admin"||n.role==="moderator");l.useEffect(()=>{(async()=>{try{u(await b())}catch{}try{const e=await v(d);e&&h(e);const a=await w(d);c(Array.isArray(a)?a:[])}catch{}})()},[d]);async function f(){const e=m.trim();if(!(!e||!n||!s||s.locked))try{const a=await P({topicId:s.id,content:e});c(i=>[...i,a]),x("")}catch{}}async function g(e){if(o)try{const a=await C(e.id,{pinned:!e.pinned});c(i=>i.map(r=>r.id===e.id?a:r))}catch{}}async function y(e){try{await R(e.id),c(a=>a.filter(i=>i.id!==e.id))}catch{}}return t.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:t.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsxs(N,{to:"/forum",className:"btn flex items-center gap-2",children:[t.jsx(S,{size:16})," Back"]}),t.jsx("div",{className:"text-sm opacity-70",children:"Topic"}),t.jsx("div",{className:"font-semibold truncate",children:(s==null?void 0:s.title)||"..."}),t.jsxs("div",{className:"ml-auto text-xs opacity-70",children:["Replies ",(s==null?void 0:s.replyCount)??0," â€¢ Views ",(s==null?void 0:s.viewCount)??0]})]}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"grid gap-3",children:[p.slice().sort((e,a)=>(a.pinned?1:0)-(e.pinned?1:0)||new Date(e.createdAt).getTime()-new Date(a.createdAt).getTime()).map(e=>t.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[e.pinned&&t.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),e.content,(o||(n==null?void 0:n.id)===e.authorId)&&t.jsxs("div",{className:"mt-2 text-right",children:[o&&t.jsx("button",{className:"btn text-xs",onClick:()=>g(e),style:{marginRight:8},children:e.pinned?"Unpin":"Pin"}),t.jsx("button",{className:"btn text-xs",onClick:()=>y(e),children:"Delete"})]}),t.jsx("div",{className:"mt-2 text-xs opacity-80 flex items-center gap-2",children:t.jsxs("button",{className:"btn text-xs",onClick:async()=>{try{const a=await k(e.id);c(i=>i.map(r=>r.id===e.id?a:r))}catch{}},children:[t.jsx(T,{size:14})," ",(e.likes||[]).length]})})]},e.id)),!(s!=null&&s.locked)&&n&&t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("textarea",{className:"input min-h-[90px] flex-1",placeholder:"Reply",value:m,onChange:e=>x(e.target.value)}),t.jsxs("button",{className:"btn btn-primary",onClick:f,children:[t.jsx(A,{size:16})," Send"]})]}),(s==null?void 0:s.locked)&&t.jsx("div",{className:"text-xs opacity-70",children:"Topic is locked."})]})})]})})}export{M as default};
