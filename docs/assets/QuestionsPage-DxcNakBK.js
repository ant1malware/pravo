import{j as t}from"./index-BjJS3am-.js";import{R as c,L as A}from"./react-vendor-DTkXckhQ.js";import{g as D}from"./authRemote-D9Q-aZvG.js";import{l as Q,b as U,d as B,e as E,c as F,f as M,u as k,g as O}from"./forumRemote-DHJrJEKR.js";import{ag as q,ah as I,ai as V,L as $,o as G}from"./icons-C8fXSpVf.js";function Z(){const[a,d]=c.useState(null),[l,o]=c.useState(null),[h,r]=c.useState([]),[f,v]=c.useState(null),[j,m]=c.useState({}),[u,g]=c.useState(""),[b,y]=c.useState(""),[p,N]=c.useState(null);c.useEffect(()=>{(async()=>{try{const e=await D();d(e)}catch{}try{const s=(await Q()).find(n=>(n.title||"").toLowerCase()==="questions"||(n.title||"").toLowerCase()==="вопросы");if(o(s||null),s){const n=await U(s.id);r(n)}}catch{}})()},[]);async function S(e){if(v(f===e.id?null:e.id),!j[e.id])try{const s=await E(e.id);m(n=>({...n,[e.id]:s}))}catch{}}const x=a&&(a.role==="admin"||a.role==="moderator"||a.role==="developer");async function C(){if(!(!a||!l))try{const e=b+(p?`

![attachment](${p})`:""),s=await F({sectionId:l.id,title:u.trim(),content:e});r([s,...h]),g(""),y(""),N(null)}catch{}}function P(e){var i;const s=(i=e.target.files)==null?void 0:i[0];if(!s)return;const n=new FileReader;n.onload=()=>N(String(n.result||"")),n.readAsDataURL(s)}async function L(e,s){if(a&&s.trim())try{const n=await M({topicId:e,content:s.trim()});m(i=>({...i,[e]:[...i[e]||[],n]}))}catch{}}async function T(e){try{const s=await k(e.id,{locked:!e.locked});r(n=>n.map(i=>i.id===e.id?s:i))}catch{}}async function R(e){try{const s=await k(e.id,{pinned:!e.pinned});r(n=>n.map(i=>i.id===e.id?s:i))}catch{}}async function z(e,s){if(x)try{const n=await O(s.id,{pinned:!s.pinned});m(i=>({...i,[e]:(i[e]||[]).map(w=>w.id===s.id?n:w)}))}catch{}}return t.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:t.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-extrabold",children:"Вопросы"}),t.jsx(A,{to:"/forum",className:"btn",children:"Назад"})]}),!l&&t.jsx("div",{className:"card p-4 text-sm text-zinc-300",children:"Раздел «Questions» не найден. Создайте раздел с названием «Questions» (или «Вопросы») в админке."}),a&&l&&t.jsxs("div",{className:"card p-4 mb-6",children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80 mb-2",children:"Создать тему"}),t.jsx("input",{className:"input mb-2",placeholder:"Заголовок",value:u,onChange:e=>g(e.target.value)}),t.jsx("textarea",{className:"input min-h-[120px]",placeholder:"Опишите проблему, можно приложить скрин",value:b,onChange:e=>y(e.target.value)}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsxs("label",{className:"btn inline-flex items-center gap-2",children:[t.jsx(q,{size:16})," Прикрепить скрин",t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:P})]}),p&&t.jsx("span",{className:"text-xs opacity-80",children:"прикреплено"}),t.jsx("button",{className:"btn btn-primary ml-auto",onClick:C,disabled:!u.trim(),children:"Опубликовать"})]})]}),t.jsx("div",{className:"grid gap-3",children:h.map(e=>t.jsxs("div",{className:"card p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{className:"text-left font-semibold hover:underline",onClick:()=>S(e),children:[e.pinned&&t.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),e.title]}),x&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"btn",onClick:()=>R(e),title:e.pinned?"Снять закрепление":"Закрепить",children:t.jsx(I,{size:16})}),t.jsx("button",{className:"btn",onClick:()=>T(e),title:e.locked?"Открыть":"Закрыть",children:e.locked?t.jsx(V,{size:16}):t.jsx($,{size:16})})]})]}),t.jsxs("div",{className:"mt-1 text-xs opacity-70",children:["Replies ",e.replyCount," • Views ",e.viewCount," • Updated ",new Date(e.updatedAt).toLocaleString()]}),f===e.id&&t.jsxs("div",{className:"mt-3 grid gap-3",children:[(j[e.id]||[]).slice().sort((s,n)=>(n.pinned?1:0)-(s.pinned?1:0)||new Date(s.createdAt).getTime()-new Date(n.createdAt).getTime()).map(s=>t.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[s.pinned&&t.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),s.content,(x||a&&a.id===s.authorId)&&t.jsxs("div",{className:"mt-2 text-right",children:[x&&t.jsx("button",{className:"btn text-xs",onClick:()=>z(e.id,s),style:{marginRight:8},children:s.pinned?"Unpin reply":"Pin reply"}),t.jsx("button",{className:"btn text-xs",onClick:async()=>{try{await B(s.id),m(n=>({...n,[e.id]:(n[e.id]||[]).filter(i=>i.id!==s.id)}))}catch{}},children:"Delete"})]})]},s.id)),!e.locked&&a&&t.jsx(H,{onSend:s=>L(e.id,s)}),e.locked&&t.jsx("div",{className:"text-xs opacity-70",children:"Тема закрыта."})]})]},e.id))})]})})}function H({onSend:a}){const[d,l]=c.useState("");return t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("textarea",{className:"input min-h-[90px] flex-1",placeholder:"Ваш ответ",value:d,onChange:o=>l(o.target.value)}),t.jsxs("button",{className:"btn btn-primary",onClick:()=>{const o=d.trim();o&&(a(o),l(""))},children:[t.jsx(G,{size:16})," Отправить"]})]})}export{Z as default};
