function S(){try{const e=new URL(window.location.href),n=e.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{e.searchParams.delete("api"),history.replaceState({},"",e.toString())}catch{}}const s=localStorage.getItem("forum:api_base");if(s)return s}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const g=S(),u="forum:token",m="forum:session";function d(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function y(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function l(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function r(t,e={}){const n=y(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${g}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function w(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:n,user:s}=await r("/register",{method:"POST",body:e});d(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function h(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:n,user:s}=await r("/login",{method:"POST",body:e});d(n,t.remember!==!1);const o={userId:s.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(o)),window.dispatchEvent(new Event("forum:session")),s}async function p(){if(!y())return null;try{const{user:e}=await r("/me");return e}catch{return l(),null}}async function O(){const{users:t}=await r("/users");return t}async function v(t,e){const{user:n}=await r(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return n}async function T(){const{invites:t}=await r("/invites");return t}async function I(t=5,e){const{invites:n}=await r("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return n}async function b(t,e){const n=JSON.stringify(e?{until:e}:{days:7}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/ban",{method:"POST",body:n});return s}async function E(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unban",{method:"POST"});return e}async function $(t,e){const n=JSON.stringify(e?{until:e}:{minutes:60}),{user:s}=await r("/users/"+encodeURIComponent(t)+"/mute",{method:"POST",body:n});return s}async function k(t){const{user:e}=await r("/users/"+encodeURIComponent(t)+"/unmute",{method:"POST"});return e}async function N(t){await r(`/invites/${encodeURIComponent(t)}`,{method:"DELETE"})}async function P(){const{settings:t}=await r("/settings");return t}async function J(t){const{settings:e}=await r("/settings",{method:"PATCH",body:JSON.stringify(t)});return e}const R=Object.freeze(Object.defineProperty({__proto__:null,authenticateAccount:h,banUser:b,clearSession:l,deleteInvite:N,generateInvites:I,getServerSettings:P,getSessionAccount:p,listAccounts:O,listInvites:T,muteUser:$,registerAccount:w,setRole:v,unbanUser:E,unmuteUser:k,updateServerSettings:J},Symbol.toStringTag,{value:"Module"}));function C(){try{const e=new URL(window.location.href),n=e.searchParams.get("api");if(n){localStorage.setItem("forum:api_base",n);try{e.searchParams.delete("api"),history.replaceState({},"",e.toString())}catch{}}const s=localStorage.getItem("forum:api_base");if(s)return s}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const A=C(),f="forum:token";function U(){try{return localStorage.getItem(f)??sessionStorage.getItem(f)}catch{return null}}async function i(t,e={}){const n=U(),s={"Content-Type":"application/json",...e.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o=await fetch(`${A}${t}`,{...e,headers:s}),c=await o.text();let a={};try{a=c?JSON.parse(c):{}}catch{a={error:c||o.statusText}}if(!o.ok)throw new Error((a==null?void 0:a.error)||`${o.status} ${o.statusText}`);return a}async function _(){const{sections:t}=await i("/sections");return t}async function x(t){const{section:e}=await i("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function L(t,e){const{section:n}=await i(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function B(t){await i(`/sections/${encodeURIComponent(t)}`,{method:"DELETE"})}async function j(t){const e="",{topics:n}=await i(`/topics${e}`);return n}async function z(t,e){const{topic:n}=await i(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return n}async function D(t,e){const{topic:n}=await i(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return n}async function K(t){await i(`/topics/${encodeURIComponent(t)}`,{method:"DELETE"})}async function H(t=8){const{posts:e}=await i(`/latest-posts?limit=${t}`);return e}export{H as a,h as b,l as c,O as d,j as e,T as f,p as g,P as h,k as i,b as j,E as k,_ as l,$ as m,x as n,L as o,B as p,z as q,w as r,v as s,D as t,J as u,K as v,I as w,N as x,R as y};
