import{b as we,e as We,f as ve,j as t,h as Ge,k as Ye,m as me,s as Ke}from"./index-CAkmMo7n.js";import{u as Xe,R as c}from"./react-vendor-DTkXckhQ.js";import{f as je,g as ye,u as He,a as _e}from"./forumStore-DVlLx33I.js";import{B as qe,c as Qe}from"./Badge-Dod91j0o.js";import{H as Ze,J as et,N as tt,O as Ne,V as Ee,S as Ce,W as Ae,Y as st,Z as $e,_ as ut,M as at,$ as nt,a0 as ke}from"./icons-wEjUy8Cq.js";const W="forum:",fe=`${W}follows`,Re=`${W}profile_comments:`,rt=`${W}social-change`,ae=new Map,it={getItem:s=>ae.has(s)?ae.get(s):null,setItem:(s,e)=>void ae.set(s,e),removeItem:s=>void ae.delete(s)},N=(()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}return it})(),ze=typeof window<"u";function oe(){return new Date().toISOString()}function he(s,e){try{return s?JSON.parse(s):e}catch{return e}}function Pe(){try{const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():null;if(s)return s}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function C(s){if(ze)try{window.dispatchEvent(new CustomEvent(rt,{detail:s}))}catch{}}ze&&window.addEventListener("storage",s=>{s.key&&(s.key.startsWith(Re)||s.key===fe)&&C({key:s.key,type:"storage"})});function ce(){return he(N.getItem(fe),[])}function Ie(s){const e=new Set,a=[];for(const u of s){const n=`${u.followerId}=>${u.targetId}`;u.followerId!==u.targetId&&(e.has(n)||(e.add(n),a.push(u)))}try{N.setItem(fe,JSON.stringify(a))}catch{}C({scope:"follows"})}function lt(){try{const e=new URL(window.location.href),a=e.searchParams.get("api");if(a){localStorage.setItem("forum:api_base",a);try{e.searchParams.delete("api"),history.replaceState({},"",e.toString())}catch{}}const u=localStorage.getItem("forum:api_base");if(u)return u}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const Le=lt();function Te(){try{return localStorage.getItem("forum:token")??sessionStorage.getItem("forum:token")}catch{return null}}async function k(s,e={}){const a=Te(),u={"Content-Type":"application/json",...e.headers||{}};a&&(u.Authorization=`Bearer ${a}`);const n=await fetch(`${Le}${s}`,{...e,headers:u}),r=await n.text();let i={};try{i=r?JSON.parse(r):{}}catch{i={error:r||n.statusText}}if(!n.ok)throw new Error((i==null?void 0:i.error)||`${n.status} ${n.statusText}`);return i}function E(){return!!Le&&!!Te()}function ne(s){if(E())try{const e=window.__socialRemoteFollowersCache||(window.__socialRemoteFollowersCache=new Map),a=e.get(s);if(a)return a;k(`/social/followers/${encodeURIComponent(s)}`).then(u=>{try{e.set(s,Array.isArray(u.followers)?u.followers:[]),C({scope:"follows",targetId:s})}catch{}})}catch{}return ce().filter(e=>e.targetId===s).map(e=>e.followerId)}function ot(s,e){if(!s)return!1;if(E())try{const a=window.__socialRemoteFollowingCache||(window.__socialRemoteFollowingCache=new Map),u=a.get(s);if(u)return u.includes(e);k(`/social/following/${encodeURIComponent(s)}`).then(n=>{try{a.set(s,Array.isArray(n.following)?n.following:[]),C({scope:"follows",followerId:s})}catch{}})}catch{}return ce().some(a=>a.followerId===s&&a.targetId===e)}function ct(s,e){if(!s||!e||s===e)return;if(E())try{k("/social/follow",{method:"POST",body:JSON.stringify({targetId:e})})}catch{}const a=ce();a.some(u=>u.followerId===s&&u.targetId===e)||(a.push({followerId:s,targetId:e,createdAt:oe()}),Ie(a))}function dt(s,e){if(E())try{k("/social/unfollow",{method:"POST",body:JSON.stringify({targetId:e})})}catch{}const a=ce().filter(u=>!(u.followerId===s&&u.targetId===e));Ie(a)}function Oe(s){return`${Re}${s}`}function pe(s){return s.map(e=>({id:e.id??Pe(),targetId:e.targetId,authorId:e.authorId,authorName:e.authorName,content:typeof e.content=="string"?e.content:"",createdAt:e.createdAt??oe(),parentId:e.parentId??null,updatedAt:e.updatedAt??null,edited:!!e.edited,deleted:!!e.deleted,deletedAt:e.deletedAt??null,deletedById:e.deletedById??null}))}function re(s){if(E())try{const u=window.__socialRemoteCommentsCache||(window.__socialRemoteCommentsCache=new Map),n=u.get(s);if(n)return n;k(`/profiles/${encodeURIComponent(s)}/comments`).then(r=>{try{const i=pe(Array.isArray(r.comments)?r.comments:[]);u.set(s,i),C({scope:"comments",targetId:s})}catch{}})}catch{}const e=N.getItem(Oe(s)),a=he(e,[]);return pe(a)}function Me(s,e){try{N.setItem(Oe(s),JSON.stringify(e))}catch{}C({scope:"comments",targetId:s})}const mt=1e4;function xt(s,e){const a=`${W}last_post:${s}:${e}`,u=Number(N.getItem(a)||"0"),n=Date.now()-u>=mt;if(n)try{N.setItem(a,String(Date.now()))}catch{}return n}const Se=2e3;function D(s,e){const a=re(s),n=!1?a:a.filter(d=>!d.deleted);n.sort((d,x)=>d.createdAt<x.createdAt?1:-1);const r=Math.max(0,0);return n.slice(r,void 0)}function Ue(s,e,a,u){const n=(a??"").trim();if(!n)throw new Error("Comment is empty");if(n.length>Se)throw new Error(`Comment too long (${n.length} > ${Se})`);if(!E()&&!xt(s,e))throw new Error("You are posting too fast. Please wait a bit.");if(E())try{k(`/profiles/${encodeURIComponent(s)}/comments`,{method:"POST",body:JSON.stringify({content:n,parentId:(u==null?void 0:u.parentId)||null})}).then(d=>{try{const x=window.__socialRemoteCommentsCache;if(x){const b=x.get(s)||[],h=pe(Array.isArray(d.comment)?d.comment:[d.comment]);x.set(s,[...h,...b]),C({scope:"comments",targetId:s})}}catch{}}).catch(()=>{})}catch{}if(u!=null&&u.parentId&&!re(s).find(x=>x.id===u.parentId))throw new Error("Parent comment not found");const r={id:Pe(),targetId:s,authorId:e,authorName:u==null?void 0:u.authorName,content:n,createdAt:oe(),parentId:(u==null?void 0:u.parentId)??null,updatedAt:null,edited:!1,deleted:!1,deletedAt:null,deletedById:null},i=re(s);return i.unshift(r),Me(s,i),r}function pt(s,e,a,u,n){return Ue(s,e,u,{authorName:n,parentId:a})}function ft(s,e,a){if(E())try{k(`/profiles/${encodeURIComponent(s)}/comments/${encodeURIComponent(e)}`,{method:"DELETE"})}catch{}const u=re(s),n=u.findIndex(i=>i.id===e);if(n<0)return;const r=u[n];(r.authorId===a||s===a)&&(r.deleted||(u[n]={...r,content:"",deleted:!0,deletedAt:oe(),deletedById:a},Me(s,u)))}function Je(s){return`${W}comment_reactions:${s}`}function ge(s){return he(N.getItem(Je(s)),{})}function ht(s,e){try{N.setItem(Je(s),JSON.stringify(e))}catch{}C({scope:"reactions",targetId:s})}function gt(s){return ge(s)}function bt(s,e,a){var u,n;return(n=(u=ge(s)[e])==null?void 0:u.byUser)==null?void 0:n[a]}function wt(s,e,a,u){const n=ge(s),r=n[e]||{counts:{like:0,smile:0,useful:0},byUser:{}},i=r.byUser[a];return i===u?(r.byUser[a]=void 0,r.counts[u]=Math.max(0,(r.counts[u]||0)-1)):(i&&(r.counts[i]=Math.max(0,(r.counts[i]||0)-1)),r.byUser[a]=u,r.counts[u]=(r.counts[u]||0)+1),n[e]=r,ht(s,n),r}const Fe={developer:{label:"\u0420\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A",color:"#22d3ee",glow:"from-cyan-400/35"},admin:{label:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440",color:"#ef4444",glow:"from-rose-400/35"},moderator:{label:"\u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440",color:"#8b5cf6",glow:"from-violet-400/35"},vip:{label:"VIP",color:"#eab308",glow:"from-amber-400/35"},user:{label:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A",color:"#94a3b8",glow:"from-slate-300/30"},newbie:{label:"\u041D\u043E\u0432\u0438\u0447\u043E\u043A",color:"#22d3ee",glow:"from-cyan-400/35"}},ie={owner:{label:"\u0412\u043B\u0430\u0434\u0435\u043B\u0435\u0446",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:Ae},developer:{label:"\u0420\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:Ee},admin:{label:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440",grad:"from-rose-400 via-amber-400 to-rose-400",Icon:Ce},moderator:{label:"\u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440",grad:"from-violet-400 via-sky-400 to-violet-400",Icon:st},vip:{label:"VIP",grad:"from-amber-400 via-rose-400 to-amber-400",Icon:Ae},user:{label:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A",grad:"from-slate-300 via-slate-400 to-slate-300",Icon:Ce},newbie:{label:"\u041D\u043E\u0432\u0438\u0447\u043E\u043A",grad:"from-cyan-400 via-fuchsia-400 to-cyan-400",Icon:Ee}};function xe({value:s,label:e}){return t.jsxs("div",{className:`${j} text-center`,children:[t.jsx("div",{className:"text-3xl font-extrabold text-white",children:s}),t.jsx("div",{className:"mt-1 text-xs uppercase tracking-[0.3em] text-zinc-300/80",children:e})]})}function V({title:s,children:e,right:a}){return t.jsxs("div",{className:le,children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-zinc-400/75",children:s}),a]}),e]})}function De({role:s}){const e=ie[s]??ie.user,a=e.Icon;return t.jsxs("span",{className:"relative inline-flex",children:[t.jsx("span",{className:`absolute -inset-[2px] rounded-full blur-md bg-gradient-to-r ${e.grad} opacity-50`}),t.jsxs("span",{className:"relative inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3.5 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.22em] text-white shadow-[0_0_0_1px_rgba(255,255,255,0.06)_inset]",children:[t.jsx(a,{size:14,className:"opacity-90"}),e.label]})]})}function vt({role:s}){const e=ie[s]??ie.user;return t.jsx("span",{className:"rounded-full border border-white/15 bg-black/50 px-2 py-0.5 text-[10px] font-bold uppercase tracking-[0.18em] text-white backdrop-blur",style:{boxShadow:"0 0 16px rgba(255,255,255,0.08), inset 0 0 0 1px rgba(255,255,255,0.05)"},children:e.label})}const jt={Founder:"from-rose-500/25 to-rose-400/10 text-rose-200",Early:"from-sky-500/25 to-sky-400/10 text-sky-200",Contributor:"from-emerald-500/25 to-emerald-400/10 text-emerald-200",VIP:"from-amber-500/25 to-amber-400/10 text-amber-200",Designer:"from-violet-500/25 to-violet-400/10 text-violet-200"},le="rounded-3xl border border-white/10 bg-[#101321]/85 p-5 shadow-[0_40px_120px_-70px_rgba(15,23,42,0.9)] backdrop-blur",j="rounded-3xl border border-white/10 bg-white/[0.05] p-4 shadow-[0_30px_90px_-70px_rgba(15,23,42,0.85)] backdrop-blur",yt=new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",year:"numeric"});function Be(s){const e=s.profile||{},a=s.stats||{},u=typeof a.posts=="number"?a.posts:0,n=typeof a.likes=="number"?a.likes:0,r=typeof a.topics=="number"?a.topics:0,i=s.lastActiveAt||s.lastSeenAt||s.lastOnlineAt||null,d=e.accentFrom||"#8b5cf6",x=e.accentTo||"#0ea5e9",b=e.avatarData||e.avatar||e.avatarUrl||void 0,h=e.bannerData||e.banner||e.bannerUrl||void 0,p={bio:e.bio||"",signature:e.signature||"",links:e.links?{...e.links}:{},accentFrom:d,accentTo:x,avatarData:b,bannerData:h,badges:Array.isArray(e.badges)?e.badges:[],privacy:{showEmail:!1,showStats:!0,showLinks:!0,allowComments:!0,showFollowers:!0,...e.privacy||{}}};Array.isArray(e.labels)&&(p.labels=e.labels);const v={id:s.user.id,username:s.user.username,email:s.user.email,createdAt:s.user.createdAt,role:s.user.role,userNumber:s.user.userNumber,posts:u,likes:n,topics:r,profile:p,bans:null,mutes:null};return typeof a.score=="number"&&(v.score=a.score),i&&(v.lastActiveAt=i),v}function Nt({badges:s}){return!s||s.length===0?null:t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:s.slice(0,3).map(e=>{const a=jt[e]||"from-white/20 to-white/5 text-zinc-200";return t.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border border-white/10 bg-gradient-to-br ${a} px-2.5 py-1 text-xs`,title:`Badge: ${e}`,children:[t.jsx($e,{size:14,className:"opacity-90"})," ",e]},e)})})}function Pt(){var X,$,H,R,q,z,Q,P,Z,I,ee,L,te,se,T,ue,O,M,U,J;const{username:s=""}=Xe(),[e,a]=c.useState(null),[u,n]=c.useState(null),[r,i]=c.useState(!1),[d,x]=c.useState(!1),[b,h]=c.useState({});c.useEffect(()=>{(async()=>{var m;try{const f=await we();if(f){i(!0),n({id:f.id,username:f.username});try{const o=await We(),w={};for(const A of o)w[A.id]=A.username;h(w)}catch{}const g=await ve(s);if(g){a(Be(g));try{x(!!((m=g.user)!=null&&m.owner))}catch{}return}}}catch{}i(!1),a(je(s)||null);const l=ye();n(l?{id:l.id,username:l.username}:null)})()},[s]),c.useEffect(()=>{const l=async()=>{try{const f=await we();if(f){n({id:f.id,username:f.username});return}}catch{}const m=ye();n(m?{id:m.id,username:m.username}:null)};return window.addEventListener("forum:session",l),window.addEventListener("storage",l),()=>{window.removeEventListener("forum:session",l),window.removeEventListener("storage",l)}},[]);const p=(e==null?void 0:e.id)||"",[v,S]=c.useState(()=>p?ne(p):[]),[B,y]=c.useState(()=>p?D(p):[]),F=c.useMemo(()=>ot((u==null?void 0:u.id)||null,p),[u==null?void 0:u.id,p,v.length]);if(c.useEffect(()=>{if(!p){S([]),y([]);return}S(ne(p)),y(D(p))},[p]),c.useEffect(()=>{const l=()=>{p&&(S(ne(p)),y(D(p)))};return window.addEventListener("forum:social-change",l),()=>window.removeEventListener("forum:social-change",l)},[p]),!e)return t.jsx("main",{className:"min-h-screen text-slate-200",style:{background:"radial-gradient(1100px 680px at 15% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:t.jsx("div",{className:"mx-auto max-w-3xl px-4 py-16",children:t.jsx("div",{className:`${le} text-center text-sm text-zinc-300`,children:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D."})})});const G=(u==null?void 0:u.id)===e.id,_=e.profile.accentFrom||"#22d3ee",Y=e.profile.accentTo||"#8b5cf6",K=Fe[e.role]||Fe.user;return t.jsx("main",{className:"min-h-screen text-slate-100",style:{background:"radial-gradient(1200px 700px at 12% -10%, rgba(56,189,248,0.18), transparent 65%), radial-gradient(1000px 720px at 90% -6%, rgba(167,139,250,0.14), transparent 70%), linear-gradient(180deg, #04060d 0%, #090b16 100%)"},children:t.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-8 space-y-6",children:[t.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-[#101321]/85 shadow-[0_50px_140px_-80px_rgba(15,23,42,0.9)] backdrop-blur",children:[t.jsx("div",{className:"h-[220px] w-full",style:{background:e.profile.bannerData?`url(${e.profile.bannerData}) center/cover`:`linear-gradient(135deg, ${_}, ${Y})`}}),t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/15 via-transparent to-black/70"}),t.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-white/10 to-transparent mix-blend-overlay"}),t.jsxs("div",{className:"relative -mt-16 flex flex-wrap items-end gap-5 px-6 pb-6",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-24 w-24 overflow-hidden rounded-full border-4 border-[#101321] shadow-[0_25px_70px_-35px_rgba(15,23,42,0.9)]",style:{background:e.profile.avatarData?`url(${e.profile.avatarData}) center/cover`:`linear-gradient(135deg, ${_}, ${Y})`}}),t.jsx("div",{className:`absolute -inset-1 -z-10 rounded-full bg-gradient-to-br ${K.glow} to-transparent blur-lg`}),t.jsx("div",{className:"absolute -bottom-2 left-1",children:t.jsx(vt,{role:e.role})})]}),t.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-white",children:e.username}),t.jsxs("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.28em] text-zinc-200/80",children:["#",e.userNumber]}),t.jsx(qe,{points:e.score??Qe({posts:e.posts,likes:e.likes,topics:e.topics})})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d&&t.jsx(De,{role:"owner"}),(($=(X=e.profile)==null?void 0:X.privacy)==null?void 0:$.showSecondaryRole)!==!1&&t.jsx(De,{role:e.role})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-zinc-300/90",children:[t.jsxs("span",{children:["Joined: ",yt.format(new Date(e.createdAt))]}),(H=e.profile.privacy)!=null&&H.showEmail&&e.email?t.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-1",children:e.email}):null]}),(()=>{const l=e.lastActiveAt||Ge(e.id);return l?t.jsxs("div",{className:"text-xs text-zinc-300/90",children:["Last seen: ",Ye(l)]}):null})(),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Nt,{badges:e.profile.badges}),Array.isArray((R=e.profile)==null?void 0:R.labels)&&e.profile.labels.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:e.profile.labels.slice(0,7).map((l,m)=>t.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2.5 py-1 text-xs text-white/85",children:l},m))})]})]}),G?t.jsx(Et,{user:e,onUpdated:async()=>{if(r){const l=await ve(s);l&&a(Be(l))}else a(je(s)||null)},saveProfile:async l=>{r?await me(l):He(e.id,l)}}):t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:`btn ${F?"":"btn-primary"}`,onClick:()=>{u!=null&&u.id&&(F?dt(u.id,e.id):ct(u.id,e.id),S(ne(e.id)))},children:F?t.jsxs(t.Fragment,{children:[t.jsx(Ze,{size:16})," \u041E\u0442\u043F\u0438\u0441\u0430\u0442\u044C\u0441\u044F"]}):t.jsxs(t.Fragment,{children:[t.jsx(et,{size:16})," \u041F\u043E\u0434\u043F\u0438\u0441\u0430\u0442\u044C\u0441\u044F"]})})})]})]}),r&&G&&d&&t.jsxs("div",{className:le,children:[t.jsx("div",{className:"mb-3 text-xs uppercase tracking-[0.3em] text-zinc-400/80",children:"\u0412\u0442\u043E\u0440\u0430\u044F \u0440\u043E\u043B\u044C"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("select",{className:"input",value:((z=(q=e.profile)==null?void 0:q.privacy)==null?void 0:z.showSecondaryRole)===!1?"none":e.role,onChange:async l=>{var f;const m=l.target.value;try{const g=((f=e.profile)==null?void 0:f.privacy)||{showEmail:!1,showStats:!0};m==="none"?(await me({privacy:{...g,showSecondaryRole:!1}}),a({...e,profile:{...e.profile,privacy:{...g,showSecondaryRole:!1}}})):(await Ke(e.id,m),await me({privacy:{...g,showSecondaryRole:!0}}),a({...e,role:m,profile:{...e.profile,privacy:{...g,showSecondaryRole:!0}}}))}catch(g){alert((g==null?void 0:g.message)||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0440\u043E\u043B\u044C")}},children:[t.jsx("option",{value:"none",children:"\u041D\u0435 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C"}),t.jsx("option",{value:"developer",children:"\u0420\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A"}),t.jsx("option",{value:"admin",children:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440"}),t.jsx("option",{value:"moderator",children:"\u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440"}),t.jsx("option",{value:"vip",children:"VIP"}),t.jsx("option",{value:"user",children:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"}),t.jsx("option",{value:"newbie",children:"\u041D\u043E\u0432\u0438\u0447\u043E\u043A"})]}),t.jsx("div",{className:"text-xs text-zinc-300/80",children:"\u0420\u043E\u043B\u044C \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0430 \u043F\u043E\u0441\u0442\u043E\u044F\u043D\u043D\u0430; \u0437\u0434\u0435\u0441\u044C \u043C\u043E\u0436\u043D\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u043C\u0443\u044E."})]})]}),((P=(Q=e.profile)==null?void 0:Q.privacy)==null?void 0:P.showStats)!==!1&&t.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[t.jsx(xe,{value:e.posts,label:"\u041F\u043E\u0441\u0442\u044B"}),t.jsx(xe,{value:e.topics,label:"\u0422\u0435\u043C\u044B"}),t.jsx(xe,{value:e.likes,label:"\u041B\u0430\u0439\u043A\u0438"})]}),t.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.35fr_.85fr]",children:[t.jsx(V,{title:"\u041E \u0441\u0435\u0431\u0435",children:t.jsx("p",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:e.profile.bio||"\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u044F."})}),((I=(Z=e.profile)==null?void 0:Z.privacy)==null?void 0:I.showLinks)!==!1&&t.jsx(V,{title:"\u0421\u0441\u044B\u043B\u043A\u0438",children:t.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:[((ee=e.profile.links)==null?void 0:ee.website)&&t.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 hover:border-white/30",href:e.profile.links.website,target:"_blank",rel:"noreferrer",children:[t.jsx(tt,{size:14})," \u0421\u0430\u0439\u0442"]}),((L=e.profile.links)==null?void 0:L.discord)&&t.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[t.jsx(Ne,{size:14})," ",e.profile.links.discord]}),((te=e.profile.links)==null?void 0:te.telegram)&&t.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1",children:[t.jsx(Ne,{size:14})," ",e.profile.links.telegram]}),!((se=e.profile.links)!=null&&se.website)&&!((T=e.profile.links)!=null&&T.discord)&&!((ue=e.profile.links)!=null&&ue.telegram)&&t.jsx("span",{className:"opacity-70",children:"\u0421\u0441\u044B\u043B\u043A\u0438 \u0435\u0449\u0451 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u044B."})]})})]}),t.jsx(V,{title:"\u041F\u043E\u0434\u043F\u0438\u0441\u044C",children:t.jsx("div",{className:"whitespace-pre-wrap text-sm text-zinc-200/85",children:e.profile.signature||"\u041F\u043E\u0434\u043F\u0438\u0441\u044C \u043D\u0435 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0430."})}),((M=(O=e.profile)==null?void 0:O.privacy)==null?void 0:M.showFollowers)!==!1&&t.jsx(V,{title:`\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438 (${v.length})`,children:t.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-zinc-200/90",children:v.length===0?t.jsx("span",{className:"opacity-70",children:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442."}):v.slice(0,18).map(l=>{const m=_e(l),f=(m==null?void 0:m.username)||b[l];return t.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1",children:f?t.jsx("a",{href:`/forum/profile/${f}`,className:"hover:underline",children:f}):"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"},l)})})}),((J=(U=e.profile)==null?void 0:U.privacy)==null?void 0:J.allowComments)!==!1&&t.jsx(V,{title:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u043F\u0440\u043E\u0444\u0438\u043B\u044F",children:t.jsxs("div",{className:"grid gap-3",children:[(u==null?void 0:u.id)&&t.jsx(kt,{onPost:l=>{u!=null&&u.id&&(Ue(e.id,u.id,l,{authorName:u.username}),y(D(e.id)))}}),t.jsxs("div",{className:"grid gap-2",children:[B.length===0&&t.jsx("div",{className:"text-sm text-zinc-400/80",children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442."}),St(B).map(l=>t.jsx(Ve,{node:l,currentUserId:(u==null?void 0:u.id)||"",ownerId:e.id,onReply:(m,f)=>{u!=null&&u.id&&(pt(e.id,u.id,m,f,u.username),y(D(e.id)))},onDelete:m=>{u!=null&&u.id&&(ft(e.id,m,u.id),y(D(e.id)))}},l.comment.id))]})]})})]})})}function Et({user:s,onUpdated:e,saveProfile:a}){const[u,n]=c.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"btn",onClick:()=>n(!0),children:[t.jsx(ut,{size:16})," \u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C \u043F\u0440\u043E\u0444\u0438\u043B\u044C"]}),u&&t.jsx(At,{user:s,onClose:()=>n(!1),onSaved:()=>{e(),n(!1)},saveProfile:a})]})}const Ct=["Founder","Early","Contributor","VIP","Designer"];function At({user:s,onClose:e,onSaved:a,saveProfile:u}){var O,M,U,J,l,m,f,g;const[n,r]=c.useState(s.profile.avatarData||""),[i,d]=c.useState(s.profile.bannerData||""),[x,b]=c.useState(s.profile.accentFrom||"#22d3ee"),[h,p]=c.useState(s.profile.accentTo||"#8b5cf6"),[v,S]=c.useState(s.profile.bio||""),[B,y]=c.useState(s.profile.signature||""),[F,G]=c.useState(((O=s.profile.links)==null?void 0:O.website)||""),[_,Y]=c.useState(((M=s.profile.links)==null?void 0:M.discord)||""),[K,X]=c.useState(((U=s.profile.links)==null?void 0:U.telegram)||""),[$,H]=c.useState(s.profile.badges||[]),[R,q]=c.useState(((J=s.profile.privacy)==null?void 0:J.showEmail)??!1),[z,Q]=c.useState(((l=s.profile.privacy)==null?void 0:l.showStats)??!0),[P,Z]=c.useState(((m=s.profile.privacy)==null?void 0:m.showLinks)??!0),[I,ee]=c.useState(((f=s.profile.privacy)==null?void 0:f.allowComments)??!0),[L,te]=c.useState(((g=s.profile.privacy)==null?void 0:g.showFollowers)??!0),se=o=>{H(w=>w.includes(o)?w.filter(A=>A!==o):w.length>=3?w:[...w,o])},T=o=>w=>{var be;const A=(be=w.target.files)==null?void 0:be[0];if(!A)return;const de=new FileReader;de.onload=()=>o(String(de.result||"")),de.readAsDataURL(A)},ue=async()=>{await u({avatarData:n||void 0,bannerData:i||void 0,accentFrom:x,accentTo:h,bio:v.trim()||void 0,signature:B.trim()||void 0,links:{website:F.trim()||void 0,discord:_.trim()||void 0,telegram:K.trim()||void 0},badges:$,privacy:{showEmail:R,showStats:z,showLinks:P,allowComments:I,showFollowers:L}}),a()};return t.jsx("div",{className:"fixed inset-0 z-[120] grid place-items-center bg-black/70 px-4 py-6",children:t.jsxs("div",{className:`${le} w-[min(820px,96vw)] max-h-[90vh] overflow-y-auto space-y-5`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-lg font-semibold text-white",children:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043F\u0440\u043E\u0444\u0438\u043B\u044F"}),t.jsx("button",{className:"btn",onClick:e,children:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:j,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u0410\u0432\u0430\u0442\u0430\u0440"}),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("div",{className:"h-20 w-20 rounded-full",style:{background:n?`url(${n}) center/cover`:`linear-gradient(135deg, ${x}, ${h})`}}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("label",{className:"btn flex items-center gap-2",children:[t.jsx(ke,{size:16})," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:T(r)})]}),n&&t.jsx("button",{className:"btn",onClick:()=>r(""),children:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})]})]})]}),t.jsxs("div",{className:j,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u0411\u0430\u043D\u043D\u0435\u0440"}),t.jsx("div",{className:"mt-3 h-20 w-full rounded-xl",style:{background:i?`url(${i}) center/cover`:`linear-gradient(135deg, ${x}, ${h})`}}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsxs("label",{className:"btn flex items-center gap-2",children:[t.jsx(ke,{size:16})," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:T(d)})]}),i&&t.jsx("button",{className:"btn",onClick:()=>d(""),children:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})]})]}),t.jsxs("div",{className:j,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u0413\u0440\u0430\u0434\u0438\u0435\u043D\u0442"}),t.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[t.jsx("span",{children:"\u041E\u0442"}),t.jsx("input",{type:"color",value:x,onChange:o=>b(o.target.value)})]}),t.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-400/80",children:[t.jsx("span",{children:"\u0414\u043E"}),t.jsx("input",{type:"color",value:h,onChange:o=>p(o.target.value)})]})]})]}),t.jsxs("div",{className:j,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u0411\u0435\u0439\u0434\u0436\u0438 (\u0434\u043E 3)"}),t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ct.map(o=>{const w=$.includes(o);return t.jsxs("button",{className:`btn flex items-center gap-2 ${w?"btn-primary":""}`,onClick:()=>se(o),type:"button",title:w?"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0443\u0431\u0440\u0430\u0442\u044C":"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C",children:[t.jsx($e,{size:16})," ",o]},o)})})]}),t.jsxs("div",{className:`${j} sm:col-span-2`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u041E \u0441\u0435\u0431\u0435"}),t.jsx("textarea",{className:"input mt-2 min-h-[120px]",value:v,onChange:o=>S(o.target.value),placeholder:"\u0420\u0430\u0441\u0441\u043A\u0430\u0436\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u0441\u0442\u0432\u0443 \u043D\u0435\u043C\u043D\u043E\u0433\u043E \u043E \u0441\u0435\u0431\u0435"})]}),t.jsxs("div",{className:`${j} sm:col-span-2`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u041F\u043E\u0434\u043F\u0438\u0441\u044C"}),t.jsx("textarea",{className:"input mt-2 min-h-[90px]",value:B,onChange:o=>y(o.target.value),placeholder:"\u0422\u0435\u043A\u0441\u0442, \u043A\u043E\u0442\u043E\u0440\u044B\u0439 \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u043F\u043E\u0434 \u0432\u0430\u0448\u0438\u043C\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F\u043C\u0438"})]}),t.jsxs("div",{className:`${j} sm:col-span-2`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u0421\u0441\u044B\u043B\u043A\u0438"}),t.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[t.jsx("input",{className:"input",placeholder:"https://website",value:F,onChange:o=>G(o.target.value)}),t.jsx("input",{className:"input",placeholder:"discord username",value:_,onChange:o=>Y(o.target.value)}),t.jsx("input",{className:"input",placeholder:"@telegram",value:K,onChange:o=>X(o.target.value)})]})]}),t.jsxs("div",{className:`${j} sm:col-span-2`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-zinc-400/80",children:"\u041F\u0440\u0438\u0432\u0430\u0442\u043D\u043E\u0441\u0442\u044C"}),t.jsxs("div",{className:"mt-3 grid gap-2 text-sm",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:R,onChange:o=>q(o.target.checked)})," \u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C e-mail"]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:z,onChange:o=>Q(o.target.checked)})," \u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0443"]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:P,onChange:o=>Z(o.target.checked)})," \u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u0441\u044B\u043B\u043A\u0438"]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:L,onChange:o=>te(o.target.checked)})," \u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u043E\u0432"]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:I,onChange:o=>ee(o.target.checked)})," \u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438"]})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{className:"btn",onClick:e,children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),t.jsx("button",{className:"btn btn-primary",onClick:ue,children:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})]})]})})}function kt({onPost:s}){const[e,a]=c.useState("");return t.jsxs("div",{className:j,children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(at,{size:16,className:"mt-1 shrink-0"}),t.jsx("textarea",{className:"input min-h-[80px] flex-1",placeholder:"\u041D\u0430\u043F\u0438\u0448\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439...",value:e,onChange:u=>a(u.target.value)})]}),t.jsx("div",{className:"mt-2 flex justify-end",children:t.jsx("button",{className:"btn btn-primary",onClick:()=>{const u=e.trim();u&&(s(u),a(""))},children:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"})})]})}function St(s){const e={};s.forEach(n=>{e[n.id]={comment:n,replies:[]}});const a=[];s.forEach(n=>{const r=n.parentId||"";r&&e[r]?e[r].replies.push(e[n.id]):a.push(e[n.id])}),a.sort((n,r)=>n.comment.createdAt<r.comment.createdAt?1:-1);const u=n=>n.replies.sort((r,i)=>r.comment.createdAt>i.comment.createdAt?1:-1).forEach(u);return a.forEach(u),a}function Ve({node:s,currentUserId:e,ownerId:a,onReply:u,onDelete:n}){const[r,i]=c.useState(!1),d=_e(s.comment.authorId),x=s.comment.authorName||(d==null?void 0:d.username)||(s.comment.authorId===a?"\u0412\u043B\u0430\u0434\u0435\u043B\u0435\u0446":s.comment.authorId===e?"\u0412\u044B":"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"),b=(d==null?void 0:d.username)||s.comment.authorName;return t.jsx("div",{className:j,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gradient-to-br from-sky-500/60 to-violet-500/60"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"text-xs text-zinc-300/90",children:[b?t.jsx("a",{href:`/forum/profile/${b}`,className:"font-semibold text-white hover:underline",children:x}):t.jsx("span",{className:"font-semibold text-white",children:x}),t.jsxs("span",{className:"opacity-70",children:[" \xB7 ",new Date(s.comment.createdAt).toLocaleString("ru-RU")]})]}),(e===s.comment.authorId||e===a)&&t.jsx("button",{className:"btn",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",onClick:()=>n(s.comment.id),children:t.jsx(nt,{size:14})})]}),t.jsx("div",{className:"mt-1 whitespace-pre-wrap text-sm text-zinc-100/90",children:s.comment.content}),t.jsx(Dt,{targetId:a,commentId:s.comment.id,currentUserId:e}),t.jsx("div",{className:"mt-2 flex items-center gap-2",children:t.jsx("button",{className:"btn",onClick:()=>i(h=>!h),children:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C"})}),r&&t.jsx("div",{className:"mt-2",children:t.jsx(Ft,{onSend:h=>{u(s.comment.id,h),i(!1)}})}),s.replies.length>0&&t.jsx("div",{className:"mt-3 space-y-2 border-l border-white/10 pl-3",children:s.replies.map(h=>t.jsx(Ve,{node:h,currentUserId:e,ownerId:a,onReply:u,onDelete:n},h.comment.id))})]})]})})}function Ft({onSend:s}){const[e,a]=c.useState("");return t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("textarea",{className:"input min-h-[60px] flex-1",placeholder:"\u041E\u0442\u0432\u0435\u0442...",value:e,onChange:u=>a(u.target.value)}),t.jsx("button",{className:"btn btn-primary",onClick:()=>{const u=e.trim();u&&(s(u),a(""))},children:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"})]})}function Dt({targetId:s,commentId:e,currentUserId:a}){const[,u]=c.useReducer(d=>d+1,0),n=gt(s)[e]||{counts:{like:0,smile:0,useful:0}},r=a?bt(s,e,a):void 0,i=({r:d,label:x})=>{var b;return t.jsxs("button",{className:`btn text-xs ${r===d?"btn-primary":""}`,onClick:()=>{a&&(wt(s,e,a,d),u())},children:[x," ",(b=n.counts)!=null&&b[d]?t.jsx("span",{className:"opacity-80",children:n.counts[d]}):null]})};return t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[t.jsx(i,{r:"like",label:"\u{1F44D}"}),t.jsx(i,{r:"smile",label:"\u{1F60A}"}),t.jsx(i,{r:"useful",label:"\u{1F4A1}"})]})}export{Pt as default};
