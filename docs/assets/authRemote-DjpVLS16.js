import{c as C,e as D}from"./index-CAVntdfB.js";function w(){if(!(typeof window>"u"))return window}function m(e,t){const o=w();if(!o)return t;try{const n=o.localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function s(e,t){const o=w();if(o)try{o.localStorage.setItem(e,JSON.stringify(t))}catch{}}function d(e){const t=w();if(t)try{t.localStorage.removeItem(e)}catch{}}function S(){return new Date().toISOString()}function E(e){return e?e.until?new Date(e.until).getTime()>Date.now():!0:!1}let h=!1;function I(){if(h)return;h=!0,m("forum:initialized",!1)||(O(),s("forum:initialized",!0))}function O(){const e=S(),t={id:crypto.randomUUID(),username:"Pavel",email:"pavel@forum.local",createdAt:e,role:"developer",userNumber:1,posts:3,likes:6,topics:2,profile:{bio:"Создатель SKY форума. Слежу за порядком и вдохновляю команду.",links:{website:"https://sky.local"},accentFrom:"#a855f7",accentTo:"#22d3ee",badges:["Founder","Core"],privacy:{showEmail:!0,showStats:!0}},bans:null,mutes:null},o={id:crypto.randomUUID(),username:"elysia",email:"elysia@forum.local",createdAt:e,role:"moderator",userNumber:2,posts:5,likes:8,topics:1,profile:{bio:"Фанат ретро-интерфейсов, модерирую раздел дизайна.",signature:"Stay liquid",links:{discord:"elysia#2048"},accentFrom:"#f472b6",accentTo:"#c084fc",badges:["Moderator"],privacy:{showEmail:!1,showStats:!0}},bans:null,mutes:null},n={id:crypto.randomUUID(),username:"raptor",email:"raptor@forum.local",createdAt:e,role:"vip",userNumber:3,posts:2,likes:3,topics:1,profile:{bio:"Тестирую новые версии SKY. Люблю длинные треды.",links:{telegram:"@raptor"},accentFrom:"#38bdf8",accentTo:"#a855f7",badges:["Early"],privacy:{showEmail:!1,showStats:!0}},bans:null,mutes:null};s("forum:accounts",[t,o,n]);const i=[{id:crypto.randomUUID(),title:"SKY Update Log",description:"Release notes, hotfixes, infrastructure work, and roadmap teasers.",icon:"??",createdAt:e,order:1,moderatorIds:[t.id],topicCount:1,postCount:4},{id:crypto.randomUUID(),title:"Design Lab",description:"Visual experiments, UI reviews, and branding explorations from the crew.",icon:"??",createdAt:e,order:2,moderatorIds:[o.id],topicCount:1,postCount:3},{id:crypto.randomUUID(),title:"Community Lounge",description:"Introductions, collaborations, and day-to-day chatter with the SKY family.",icon:"??",createdAt:e,order:3,moderatorIds:[o.id,n.id],topicCount:1,postCount:3},{id:crypto.randomUUID(),title:"Workshop",description:"Marketplace for merch drops, digital kits, and bespoke commission offers.",icon:"???",createdAt:e,order:4,moderatorIds:[t.id],topicCount:1,postCount:2}];s("forum:sections",i);const r=[{id:crypto.randomUUID(),sectionId:i[0].id,title:"SKY 0.9 Roadmap",authorId:t.id,createdAt:e,updatedAt:e,pinned:!0,locked:!1,movedTo:null,viewCount:124,replyCount:2,lastPostAt:e,lastPostBy:o.id},{id:crypto.randomUUID(),sectionId:i[1].id,title:"Liquid glass interface lookbook",authorId:o.id,createdAt:e,updatedAt:e,pinned:!1,locked:!1,movedTo:null,viewCount:86,replyCount:1,lastPostAt:e,lastPostBy:t.id},{id:crypto.randomUUID(),sectionId:i[2].id,title:"Community launch party recap",authorId:n.id,createdAt:e,updatedAt:e,pinned:!0,locked:!1,movedTo:null,viewCount:96,replyCount:2,lastPostAt:e,lastPostBy:t.id},{id:crypto.randomUUID(),sectionId:i[3].id,title:"Hand-crafted drops and commission board",authorId:t.id,createdAt:e,updatedAt:e,pinned:!0,locked:!1,movedTo:null,viewCount:72,replyCount:1,lastPostAt:e,lastPostBy:o.id}];s("forum:topics",r);const c=[{id:crypto.randomUUID(),topicId:r[0].id,authorId:t.id,content:"Milestones for 0.9 include the permissions overhaul, a refreshed landing page, and the new notification worker.",createdAt:e,likes:[o.id,n.id]},{id:crypto.randomUUID(),topicId:r[0].id,authorId:o.id,content:"Pinned the roadmap so testers can follow along. Let us know which items you want prioritized first!",createdAt:e,likes:[n.id]},{id:crypto.randomUUID(),topicId:r[0].id,authorId:n.id,content:"Loving the quality-of-life focus. The new invite flow already feels smoother on mobile.",createdAt:e,likes:[t.id]},{id:crypto.randomUUID(),topicId:r[1].id,authorId:o.id,content:"Uploaded a batch of liquid glass mockups with dynamic lighting. Feedback welcome before we freeze colors.",createdAt:e,likes:[t.id]},{id:crypto.randomUUID(),topicId:r[1].id,authorId:t.id,content:"That neon violet variant is perfect for the beta shell. Let's try it inside the command palette too.",createdAt:e,likes:[n.id]},{id:crypto.randomUUID(),topicId:r[2].id,authorId:n.id,content:"Recap thread is live! Share your favourite photos from the launch party and tag who you met.",createdAt:e,likes:[t.id,o.id]},{id:crypto.randomUUID(),topicId:r[2].id,authorId:o.id,content:"Added the aftermovie link and playlists from the DJ set�enjoy the nostalgia.",createdAt:e,likes:[t.id]},{id:crypto.randomUUID(),topicId:r[2].id,authorId:t.id,content:"Thanks everyone who joined and helped moderate. This energy is why SKY exists.",createdAt:e,likes:[n.id]},{id:crypto.randomUUID(),topicId:r[3].id,authorId:t.id,content:"Opening the Workshop board with curated artisan drops and safe trading guidelines.",createdAt:e,likes:[n.id]},{id:crypto.randomUUID(),topicId:r[3].id,authorId:o.id,content:"First batch features screen-printed posters, keycaps, and a limited synthwave sticker set.",createdAt:e,likes:[t.id]}];s("forum:posts",c),s("forum:settings",{heroTitle:"SKY Forum",heroSubtitle:"Эксклюзивное сообщество для разработчиков и исследователей SKY.",heroMessage:"Обсуждаем обновления, делимся концептами и тестируем будущее интерфейсов.",registrationOpen:!0,requireEnglishNick:!0,allowGuestRead:!1}),s("forum:counters",{nextUserNumber:4});const g=[{code:"SKYACCESSCODE000",createdAt:e,createdBy:t.id,note:"Демо приглашение",usedBy:o.id,usedAt:e},{code:"SKYACCESSCODE001",createdAt:e,createdBy:t.id,note:"Запас для теста",usedBy:null,usedAt:null}];s("forum:invites",g);const k={id:crypto.randomUUID(),createdAt:e,actorId:t.id,action:"seed",targetType:"settings",notes:"Инициализация демо-данных форума"};s("forum:logs",[k])}function f(){return I(),m("forum:accounts",[])}function T(e){s("forum:accounts",e)}function A(){return I(),m("forum:settings",{heroTitle:"SKY Forum",heroSubtitle:"",heroMessage:"",registrationOpen:!1,requireEnglishNick:!0,allowGuestRead:!1})}function P(){return I(),m("forum:logs",[])}function N(e){s("forum:logs",e)}function v(e){const t=P(),o={id:crypto.randomUUID(),createdAt:S(),...e};t.unshift(o),N(t.slice(0,200))}function x(){const e=C();return e?J(e.userId):null}function Y(){return f()}function J(e){return f().find(t=>t.id===e)||null}function F(e){return f().find(t=>t.username.toLowerCase()===e.toLowerCase())||null}function $(e,t){var r,c,p,y;const o=f(),n=o.findIndex(g=>g.id===e);if(n===-1)return;const i=t.badges?t.badges.slice(0,3):void 0;o[n]={...o[n],profile:{...o[n].profile,...t,badges:i,privacy:{showEmail:((r=t.privacy)==null?void 0:r.showEmail)??((c=o[n].profile.privacy)==null?void 0:c.showEmail)??!1,showStats:((p=t.privacy)==null?void 0:p.showStats)??((y=o[n].profile.privacy)==null?void 0:y.showStats)??!0}}},T(o),v({actorId:e,action:"profile_update",targetType:"account",targetId:e,notes:"Обновление профиля"})}function z(){return A()}function M(e){d("forum:accounts"),d("forum:sections"),d("forum:topics"),d("forum:posts"),d("forum:logs"),d("forum:invites"),s("forum:settings",{heroTitle:"SKY Forum",heroSubtitle:"",heroMessage:"",registrationOpen:!0,requireEnglishNick:!0,allowGuestRead:!1}),s("forum:counters",{nextUserNumber:1}),s("forum:sections",[]),s("forum:topics",[]),s("forum:posts",[]),s("forum:accounts",[]),s("forum:logs",[]),s("forum:invites",[]),s("forum:initialized",!0),h=!0,e&&v({actorId:e,action:"reset_empty",targetType:"settings"}),D()}function q(e){return e?E(e.mutes||void 0):!1}function L(){try{const t=new URL(window.location.href),o=t.searchParams.get("api");if(o){localStorage.setItem("forum:api_base",o);try{t.searchParams.delete("api"),history.replaceState({},"",t.toString())}catch{}}const n=localStorage.getItem("forum:api_base");if(n)return n}catch{}return"https://notifications-worker.wizardiowhy.workers.dev/skyapi"}const B=L(),u="forum:token",l="forum:session";function U(e,t=!0){(t?localStorage:sessionStorage).setItem(u,e)}function b(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function K(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(l),sessionStorage.removeItem(l)}finally{window.dispatchEvent(new Event("forum:session"))}}async function a(e,t={}){const o=b(),n={"Content-Type":"application/json",...t.headers||{}};o&&(n.Authorization=`Bearer ${o}`);const i=await fetch(`${B}${e}`,{...t,headers:n}),r=await i.text();let c={};try{c=r?JSON.parse(r):{}}catch{c={error:r||i.statusText}}if(!i.ok)throw new Error((c==null?void 0:c.error)||`${i.status} ${i.statusText}`);return c}async function _(e){const t=JSON.stringify({username:e.username,email:e.email,password:e.password||"1234",inviteCode:e.inviteCode||""}),{token:o,user:n}=await a("/register",{method:"POST",body:t});U(o,e.remember!==!1);const i={userId:n.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(l,JSON.stringify(i)),window.dispatchEvent(new Event("forum:session")),n}async function j(e){const t=JSON.stringify({usernameOrEmail:e.usernameOrEmail,password:e.password||"1234"}),{token:o,user:n}=await a("/login",{method:"POST",body:t});U(o,e.remember!==!1);const i={userId:n.id,remember:e.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(l,JSON.stringify(i)),window.dispatchEvent(new Event("forum:session")),n}async function H(){if(!b())return null;try{const{user:t}=await a("/me");return t}catch{return K(),null}}async function G(){const{users:e}=await a("/users");return e}async function W(e,t){const{user:o}=await a(`/users/${e}/role`,{method:"PATCH",body:JSON.stringify({role:t})});return o}async function Q(){const{invites:e}=await a("/invites");return e}async function V(e=5,t){const{invites:o}=await a("/invites",{method:"POST",body:JSON.stringify({count:e,note:t})});return o}async function X(e,t){const o=JSON.stringify(t?{until:t}:{days:7}),{user:n}=await a("/users/"+encodeURIComponent(e)+"/ban",{method:"POST",body:o});return n}async function Z(e){const{user:t}=await a("/users/"+encodeURIComponent(e)+"/unban",{method:"POST"});return t}async function ee(e,t){const o=JSON.stringify(t?{until:t}:{minutes:60}),{user:n}=await a("/users/"+encodeURIComponent(e)+"/mute",{method:"POST",body:o});return n}async function te(e){const{user:t}=await a("/users/"+encodeURIComponent(e)+"/unmute",{method:"POST"});return t}async function oe(e){await a(`/invites/${encodeURIComponent(e)}`,{method:"DELETE"})}async function ne(){const{settings:e}=await a("/settings");return e}async function se(e){const{settings:t}=await a("/settings",{method:"PATCH",body:JSON.stringify(e)});return t}async function re(e){try{const t=await a(`/profiles/by-username/${encodeURIComponent(e)}`);return{user:t.user,profile:t.profile}}catch{return null}}async function ie(e){const{profile:t}=await a("/profiles/me",{method:"PATCH",body:JSON.stringify(e)});return t}async function ae(){const{members:e}=await a("/members");return e}export{z as a,H as b,K as c,j as d,re as e,F as f,x as g,$ as h,q as i,ae as j,G as k,Y as l,Q as m,ne as n,se as o,V as p,oe as q,_ as r,W as s,M as t,ie as u,ee as v,te as w,X as x,Z as y};
