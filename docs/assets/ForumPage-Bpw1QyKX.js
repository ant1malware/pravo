import{j as e}from"./index-Dc2yicJU.js";import{R as a,L as Q}from"./react-vendor-DTkXckhQ.js";import{g as ue,c as Ke,a as Pe,r as Te}from"./authRemote-D9Q-aZvG.js";import{listSections as Fe,listLatestPosts as Ue}from"./forumRemote-D5s3MT8n.js";import{F as Be,t as Ee}from"./ForumSubnav-CyGaNLwd.js";import{F as Je}from"./ForumSearch-CO4IONAA.js";import{$ as He,L as We,S as Ye}from"./icons-GyIOUIPt.js";const oe=800,Ce=["–°–∫–∞–π-–°—Ç—Ä–∞–∂","–ü—Ä–∞–≤–æ-–°–∞–º—É—Ä–∞–π","–ü—É–ª—å—Å-–†–µ–π–¥–µ—Ä","–ö–∏–±–µ—Ä-–ú–µ–¥–∏–∫","–ù–µ–æ–Ω-–¢–∞–∫—Ç–∏–∫","–ê—Å—Ç—Ä–∞–ª-–û—Ñ–∏—Ü–µ—Ä","–§–∞–Ω—Ç–æ–º-–õ–µ—á–∞—â–∏–π","–®–∏—Ñ—Ä-–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä","–ö–≤–∞–Ω—Ç-–ë–æ–µ—Ü","–ü–∏–∫—Å–µ–ª—å-–í–æ–ª–∫","–¢—É–º–∞–Ω-–ö–æ–º–∞–Ω–¥–æ—Ä","–ò—Å–∫—Ä–∞-–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å","–ù—É–ª—å-–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–ü–æ–ª—è—Ä–Ω—ã–π –ü–∏–ª–æ—Ç","–ì–æ—Ä–æ–¥—Å–∫–æ–π –•–∏—Ä—É—Ä–≥","–°—ã–≤–æ—Ä–æ—Ç–∫–∞-Vibe","–°—Ç–µ—Ä–∏–ª—å–Ω—ã–π –ù–∏–Ω–¥–∑—è","–°–∫–∞–ª—å–ø–µ–ª—å-–û–±–ª–∞–∫–æ","–†–µ–Ω—Ç–≥–µ–Ω-–ü–∞–Ω–∫","–í–∞—Ç–∫–∞-Supreme"];function Z(){const n=Ce[Math.floor(Math.random()*Ce.length)],o=Math.floor(Math.random()*900+100);return`${n} ${o}`}function qe(n){try{return typeof n=="string"?JSON.parse(n):(typeof Blob<"u"&&n instanceof Blob,null)}catch{return null}}function Ae(n){return new Date(n).toLocaleTimeString(void 0,{hour12:!1})}function Ve(n){return n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function Xe(n){if(!n)return null;const o=n.trim();return o?`@${Ve(o).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Me(n,o){if(!o)return!1;try{return new RegExp(o,"iu").test(n)}catch{return!1}}function ze(n,o){if(!o)return n;try{const x=new RegExp(o,"giu"),u=[];let f=0,p=0,w;for(;(w=x.exec(n))!==null;)w.index>f&&u.push(e.jsx(a.Fragment,{children:n.slice(f,w.index)},`text-${p++}`)),u.push(e.jsx("span",{className:"rc-ping",children:w[0]},`mention-${p++}`)),f=x.lastIndex;return f<n.length&&u.push(e.jsx(a.Fragment,{children:n.slice(f)},`text-${p++}`)),u.length?u:n}catch{return n}}const ce=["üòÄ","üòÅ","üòÇ","ü§£","üòÖ","üòé","üòç","üòò","üòá","ü§ù","üëå","üëç","üî•","üíØ","‚ú®","‚ö°","üéØ","üöÄ","üõ°Ô∏è","üèÜ","üí¨","üìù","üìå","üì£","üóÇÔ∏è","üß†","üìà","üïí","üõ†Ô∏è","üîí","‚úÖ","‚ùó","‚ö†Ô∏è","‚ùì","üéâ","ü•≥","üôå","ü§ò","ü§ñ","üëÄ","üí°","üß≠","üì¶","üõéÔ∏è","üì°","üõ∞Ô∏è","üß™","üìï","üß∑","ü™™","üß∞","üß±","üõ∞","üóÉÔ∏è"],Ge=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function Ze(n){try{const o=new URL(n);return o.protocol=o.protocol==="wss:"?"https:":o.protocol==="ws:"?"http:":o.protocol,o.pathname="/",o.search="",o.hash="",o.toString().replace(/\/+$/,"")}catch{return""}}function Qe(n){const o=`@e${n}`;return{NAME_KEY:`chat:nick${o}`,NAME_LOCK:`chat:nick:lock${o}`}}function et({room:n="global",className:o,variant:x="classic",onRosterChange:u,resolveRole:f}){const p="wss://notifications-worker.wizardiowhy.workers.dev/chat",w=a.useMemo(()=>Ze(p),[p]),[d,g]=a.useState(1),[c,M]=a.useState(!1),v=a.useMemo(()=>Qe(d),[d]),[C,D]=a.useState(!1),[O,E]=a.useState(0),[K,J]=a.useState([]),[H,I]=a.useState(!1),[b,ee]=a.useState(!1);a.useEffect(()=>{if(b){try{V(!1)}catch{}try{k||F("Admin")}catch{}}},[b]);const[W,P]=a.useState(""),[Y,T]=a.useState([]),A=a.useRef(null),te=a.useRef(null),y=a.useRef(null),q=a.useRef(null),re=a.useRef(null),[X,ae]=a.useState(!1),se=a.useRef({}),[k,F]=a.useState(null),[z,V]=a.useState(!0),[fe,L]=a.useState(Z()),me=a.useRef({epochReady:c,needNick:z,nick:k}),xe=a.useRef(v),_=a.useRef(null),he=a.useMemo(()=>b?"Admin":k??"",[b,k]),$=a.useMemo(()=>he.trim(),[he]),G=a.useMemo(()=>Xe($||null),[$]),ge=a.useCallback(t=>{const s=f==null?void 0:f(t);return s||(t.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[f]),be=a.useCallback(t=>{const s=t.trim();if(!s)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let r=0;for(let S=0;S<s.length;S+=1)r=(r+s.charCodeAt(S)*17)%360;const i=r,h=(r+42)%360;return{background:`linear-gradient(135deg, hsla(${i},80%,56%,0.85), hsla(${h},78%,48%,0.85))`,color:"#fdfcff"}},[]);a.useEffect(()=>{if(c)try{const t=localStorage.getItem(v.NAME_KEY),s=localStorage.getItem(v.NAME_LOCK)==="1";t&&s?(F(t),V(!1),L(t)):t&&!s?(F(t),L(t),V(!0)):(F(null),L(Z()),V(!0))}catch{F(null),L(Z()),V(!0)}},[c,v.NAME_KEY,v.NAME_LOCK]),a.useEffect(()=>{me.current={epochReady:c,needNick:z,nick:k}},[c,z,k]),a.useEffect(()=>{c&&(async()=>{let t=null;try{const s=await ue();s!=null&&s.username&&(t=s.username)}catch{}if(!t)try{const s=localStorage.getItem("forum:session")||sessionStorage.getItem("forum:session"),r=s?JSON.parse(s):null;r!=null&&r.username&&(t=r.username)}catch{}if(t){F(t),L(t),V(!1);try{localStorage.setItem(v.NAME_KEY,t),localStorage.setItem(v.NAME_LOCK,"1")}catch{}const s=A.current;if(s&&s.readyState===WebSocket.OPEN&&_.current!==t)try{s.send(JSON.stringify({type:"hello",name:t})),_.current=t}catch{}}})()},[c,v.NAME_KEY,v.NAME_LOCK]),a.useEffect(()=>{xe.current=v},[v]),a.useEffect(()=>{b||I(!1)},[b]),a.useEffect(()=>{typeof u=="function"&&u(K,O)},[u,K,O]),a.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=b;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:b}}))}catch{}}},[b]),a.useEffect(()=>{C||(I(!1),J([]))},[C]),a.useEffect(()=>{if(!H)return;const t=r=>{const i=y.current;i&&!i.contains(r.target)&&I(!1)},s=r=>{r.key==="Escape"&&I(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",s),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",s)}},[H]),a.useEffect(()=>{if(!X)return;const t=r=>{const i=q.current;i&&!i.contains(r.target)&&ae(!1)},s=r=>{r.key==="Escape"&&ae(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",s),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",s)}},[X]),a.useEffect(()=>{z&&(_.current=null)},[z]),a.useEffect(()=>{let t=!1,s=null;const r=Date.now(),i=h=>{if(t)return;g(h);const S=Date.now()-r,l=Math.max(0,Math.min(900,520-S)),m=()=>{t||M(!0)};l<=0?m():s=setTimeout(m,l)};return w?((async()=>{try{const h=await fetch(`${w}/nick-epoch`,{credentials:"include"}),S=h.ok?await h.json().catch(()=>({})):{},N=Number(S.epoch)||1;i(N)}catch{i(1)}})(),()=>{t=!0,s&&clearTimeout(s)}):(i(1),()=>{t=!0,s&&clearTimeout(s)})},[w]),a.useEffect(()=>{const t=te.current;t&&(t.scrollTop=t.scrollHeight)},[Y.length]),a.useEffect(()=>{let t=!1,s=0,r=null;const i=()=>{if(t)return;D(!1);const h=new URL(p);h.searchParams.set("room",n),r=new WebSocket(h),A.current=r,r.addEventListener("open",()=>{D(!0),se.current={},s=0,E(0);const{epochReady:N,needNick:l,nick:m}=me.current;if(N&&m&&!l)try{r.send(JSON.stringify({type:"hello",name:m})),_.current=m}catch{}}),r.addEventListener("message",async N=>{try{let l=qe(N.data);if(!l&&typeof Blob<"u"&&N.data instanceof Blob&&(l=JSON.parse(await N.data.text())),!l)return;if(l.type==="history")T(l.messages);else if(l.type==="message"){const m=l.cid;if(m&&se.current[m]){const j=se.current[m];delete se.current[m],T(B=>{const le=B.filter(de=>de.id!==j);return le.some(de=>de.id===l.message.id)?le:[...le,l.message]})}else T(j=>j.some(B=>B.id===l.message.id)?j:[...j,l.message])}else if(l.type==="delete")T(m=>m.filter(j=>j.id!==l.id));else if(l.type==="edit")T(m=>m.map(j=>j.id===l.id?{...j,text:l.text}:j));else if(l.type==="system"){if(l.text==="admin-ok"?ee(!0):l.text==="hello-ok"&&!l.name&&ee(!1),l.text==="presence"){const m=Number(l.count);if(E(Number.isFinite(m)&&m>0?Math.round(m):0),Array.isArray(l.names)){const j=l.names.map(B=>typeof B=="string"?B.trim():"").filter(B=>B.length>0);J(j)}else J([])}if(l.name&&(l.text==="hello-ok"||l.text==="admin-ok")){F(l.name),L(l.name),_.current=l.name;try{const{NAME_KEY:m,NAME_LOCK:j}=xe.current;localStorage.setItem(m,l.name),localStorage.setItem(j,"1")}catch{}V(!1)}}}catch{}});const S=()=>{t||(D(!1),E(0),J([]),I(!1),s=Math.min(s+1,6),setTimeout(i,400*s))};r.addEventListener("close",S),r.addEventListener("error",()=>r==null?void 0:r.close())};return i(),()=>{t=!0;try{r==null||r.close()}catch{}A.current=null,_.current=null}},[p,n]),a.useEffect(()=>{const t=A.current;if(!(!t||t.readyState!==WebSocket.OPEN)&&!(!c||z||!k)&&_.current!==k)try{t.send(JSON.stringify({type:"hello",name:k})),_.current=k}catch{}},[c,z,k]);function Re(){const s=((fe||"").trim().slice(0,80)||Z()).replace(/[^\p{L}\p{N}_ -]+/gu,"");F(s),L(s);try{localStorage.setItem(v.NAME_KEY,s)}catch{}const r=A.current;if(r&&r.readyState===WebSocket.OPEN)try{r.send(JSON.stringify({type:"hello",name:s})),_.current=s}catch{}}const[U,ve]=a.useState(null);a.useEffect(()=>{(async()=>{try{ve(await ue())}catch{ve(null)}})()},[]);const ye=a.useMemo(()=>{const t=U!=null&&U.mutedUntil?Date.parse(U.mutedUntil):0;return!["developer","admin","moderator"].includes(String((U==null?void 0:U.role)||""))&&!!t&&t>Date.now()},[U]);function ie(){const s=W.replace(/\r/g,"").trim(),r=A.current;if(!c||!k||z||!s||!r||r.readyState!==WebSocket.OPEN||ye)return;const i=`${Date.now()}_${Math.random().toString(36).slice(2)}`,h=`loc_${i}`;se.current[i]=h,T(S=>[...S,{id:h,author:b?"Admin":k,text:s,ts:Date.now()}]),r.send(JSON.stringify({type:"message",text:s.slice(0,oe),cid:i})),P(""),ne()}const R=c&&C&&(!!k||b)&&!z&&!ye,Oe=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),ie())};a.useEffect(()=>{R||ae(!1)},[R]);function je(t){const s=`@${t} `;P(i=>i?i.replace(/\s+$/," ")+s:s);const r=re.current;setTimeout(()=>{try{if(r){r.focus();const i=r.value.length;r.selectionStart=r.selectionEnd=i}}catch{}},0)}const we=()=>{R&&ae(t=>!t)},ne=a.useCallback(()=>{if(x!=="forum")return;const t=re.current;if(!t||t.tagName!=="TEXTAREA")return;const s=t;s.style.height="auto";const r=Math.min(s.scrollHeight,220);s.style.height=`${r}px`},[x]);a.useEffect(()=>{ne()},[W,ne]);const Ne=t=>{P(r=>`${r}${t}`),ae(!1);const s=()=>{const r=re.current;if(r){const i=r.value.length;r.focus();try{r.setSelectionRange(i,i)}catch{}ne()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(s):setTimeout(s,0)},ke=t=>{const s=A.current;!b||!s||s.readyState!==WebSocket.OPEN||s.send(JSON.stringify({type:"delete",id:t}))},Se=(t,s)=>{var h;const r=A.current;if(!b||!r||r.readyState!==WebSocket.OPEN)return;const i=(h=prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",s))==null?void 0:h.trim();i&&r.send(JSON.stringify({type:"edit",id:t,text:i.slice(0,oe)}))},Ie=t=>t==="Admin"?"rc-admin":t===k?"rc-me":"rc-other",_e=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!c,children:[e.jsxs("div",{ref:y,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"rc-head-meta",children:[b?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${H?" open":""}`,onClick:()=>I(t=>!t),"aria-expanded":H,"aria-controls":"rc-presence-panel","aria-label":"–ö—Ç–æ —Å–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏",children:[e.jsx("span",{className:`rc-presence-dot ${C?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[C?Math.max(O,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${C?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[C?Math.max(O,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}),b&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),b&&H&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"–°–ø–∏—Å–æ–∫ –∫—Ç–æ –≤ —Å–µ—Ç–∏",children:[e.jsx("div",{className:"rc-presence-title",children:"–°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏"}),K.length?e.jsx("ul",{children:K.map(t=>e.jsxs("li",{className:t===$?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:t}),t===$&&e.jsx("span",{className:"rc-presence-you",children:"–≤—ã"})]},t))}):e.jsx("div",{className:"rc-presence-empty",children:"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("div",{ref:te,className:"rc-list",children:c?Y.length===0?e.jsx("div",{className:"rc-empty",children:"‚Ä¶"}):e.jsx("ul",{children:Y.map(t=>{const s=$?t.author.trim()===$:!1,r=!!(G&&$&&!s&&Me(t.text,G)),i=r?ze(t.text,G):t.text;return e.jsxs("li",{className:r?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",Ae(t.ts),"]"]}),e.jsx(Q,{to:`/forum/profile/${encodeURIComponent(t.author)}`,className:Ie(t.author),children:t.author}),e.jsx("button",{className:"rc-ax",type:"button",onClick:()=>je(t.author),title:`@${t.author}`,children:"@"}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:i}),b&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>Se(t.id,t.text),children:"–†–µ–¥."}),e.jsx("button",{className:"rc-ax",onClick:()=>ke(t.id),children:"–£–¥–∞–ª."})]})]},t.id)})}):e.jsx("div",{className:"rc-empty",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"})}),e.jsxs("form",{ref:q,className:"rc-form",onSubmit:t=>{t.preventDefault(),ie()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${X?" open":""}`,onClick:we,disabled:!R,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üòä"}),e.jsx("input",{ref:re,className:"rc-input",placeholder:"–Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",value:W,onChange:t=>P(t.target.value),maxLength:oe,disabled:!R}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!R,children:"‚ñ∂"}),X&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ce.length?e.jsx("div",{className:"rc-emoji-grid",children:ce.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(t),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]})]}),De=()=>{const t=K,s=C?Math.max(O,t.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!c,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"–û–Ω–ª–∞–π–Ω"}),c?e.jsx("div",{className:"fc-roster-list",children:t.length?t.map(r=>{const i=ge(r),h=r.trim(),S=h?h.slice(0,2).toUpperCase():"??",N=be(r);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:N,children:S}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:r}),e.jsx("div",{className:"fc-roster-role",style:i?{color:i.textColor??"#ede9fe"}:void 0,children:i?i.label:"–£—á–∞—Å—Ç–Ω–∏–∫"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},r)}):e.jsx("div",{className:"fc-roster-empty",children:"–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((r,i)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},i))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${C?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:s}),e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]})]}),c?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:te,className:"forum-chat-list",children:Y.length===0?e.jsx("div",{className:"fc-empty",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç"}):Y.map(r=>{const i=$?r.author.trim()===$:!1,h=!!(G&&$&&!i&&Me(r.text,G)),S=h?ze(r.text,G):r.text,N=ge(r.author),l=r.author.trim(),m=l?l.slice(0,2).toUpperCase():"??",j=be(r.author);return e.jsxs("div",{className:`fc-item${i?" self":""}${h?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:j,children:m}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[e.jsx(Q,{to:`/forum/profile/${encodeURIComponent(r.author)}`,children:r.author}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>je(r.author),title:`@${r.author}`,children:"@"}),N&&e.jsx("span",{className:"fc-role",style:{background:`${N.color}33`,color:N.textColor??"#ede9fe",borderColor:`${N.color}55`},children:N.label})]}),e.jsx("span",{className:"fc-time",children:Ae(r.ts)})]}),e.jsx("div",{className:"fc-bubble",children:S}),b&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>Se(r.id,r.text),children:"–†–µ–¥."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ke(r.id),children:"–£–¥–∞–ª."})]})]})]},r.id)})}),e.jsxs("form",{ref:q,className:"forum-chat-form",onSubmit:r=>{r.preventDefault(),ie()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –¥–µ–º–æ."),disabled:!R,"aria-label":"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",children:"üìé"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:r=>{re.current=r,r&&ne()},value:W,onChange:r=>P(r.target.value),onKeyDown:Oe,placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",disabled:!R,maxLength:oe}),X&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ce.length?e.jsx("div",{className:"rc-emoji-grid",children:ce.map(r=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(r),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${r}`,children:r},r))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${X?" open":""}`,onClick:we,disabled:!R,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üôÇ"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!R,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:o??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Ge}}),x==="forum"?De():_e(),c&&z&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫"}),e.jsx("div",{className:"nick-warn",children:"–ù–∏–∫ –∑–∞–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –°–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –Ω–µ–ª—å–∑—è."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:fe,onChange:t=>L(t.target.value),maxLength:80,placeholder:"–í–∞—à –Ω–∏–∫‚Ä¶",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>L(Z()),children:"üé≤"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:Re,children:"–û–∫"})]}),e.jsx("div",{children:Array.from({length:5}).map((t,s)=>e.jsx("span",{className:"nick-pill",onClick:()=>L(Z()),children:"üé≤ –°–ª—É—á–∞–π–Ω—ã–π"},s))})]})})]})}const pe={};function tt({onToken:n,className:o}){const x=(pe==null?void 0:pe.VITE_RECAPTCHA_SITE_KEY)||"",[u,f]=a.useState(!1),[p,w]=a.useState(null);a.useEffect(()=>{if(!x){const M=1+Math.floor(Math.random()*9),v=1+Math.floor(Math.random()*9);w({a:M,b:v,answer:""}),f(!0);return}const g="recaptcha-v3";if(document.getElementById(g)){f(!0);return}const c=document.createElement("script");c.id=g,c.src=`https://www.google.com/recaptcha/api.js?render=${encodeURIComponent(x)}`,c.async=!0,c.defer=!0,c.onload=()=>f(!0),c.onerror=()=>{f(!0)},document.head.appendChild(c)},[x]);async function d(){try{const g=window.grecaptcha;if(!g||!x)return n(null);const c=await g.execute(x,{action:"submit"});n(c||null)}catch{n(null)}}if(!u)return e.jsx("div",{className:o||""});if(p){const g=String(Number(p.answer))===String(p.a+p.b);return e.jsx("div",{className:o||"",children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{children:"–ê–Ω—Ç–∏—Å–ø–∞–º:"}),e.jsxs("span",{className:"rounded bg-white/10 px-2 py-1",children:[p.a," + ",p.b," ="]}),e.jsx("input",{className:"input w-16",value:p.answer||"",onChange:c=>w({...p,answer:c.target.value})}),e.jsx("button",{type:"button",className:"btn",onClick:()=>n(g?"math_ok":null),children:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"})]})})}return e.jsx("div",{className:o||"",children:e.jsx("button",{type:"button",className:"btn",onClick:d,children:"–ü—Ä–æ–≤–µ—Ä–∫–∞ reCAPTCHA"})})}const $e="forum:email_verify:";function Le(n){const o=String(Math.floor(1e5+Math.random()*9e5)),x={code:o,issuedAt:Date.now()};try{localStorage.setItem($e+n.toLowerCase(),JSON.stringify(x))}catch{}return o}function rt(n,o,x=15*60*1e3){try{const u=localStorage.getItem($e+n.toLowerCase());if(!u)return!1;const f=JSON.parse(u);if(Date.now()-(f.issuedAt||0)>x)return!1;const p=String(f.code)===String(o).trim();if(p)try{localStorage.setItem("forum:email_verified:"+n.toLowerCase(),"1")}catch{}return p}catch{return!1}}function at({role:n}){const o={developer:{color:"#22d3ee",text:"Developer"},admin:{color:"#ef4444",text:"Admin"},moderator:{color:"#8b5cf6",text:"Moderator"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"User"},newbie:{color:"#22d3ee",text:"Newbie"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:o[n].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:o[n].text})}function st({onDone:n}){const[o,x]=a.useState("login"),[u,f]=a.useState(""),[p,w]=a.useState(""),[d,g]=a.useState(""),[c,M]=a.useState(""),[v,C]=a.useState(!0),[D,O]=a.useState(null),[E,K]=a.useState(!1),[J,H]=a.useState(null),[I,b]=a.useState(""),[ee,W]=a.useState(!1),[P,Y]=a.useState(""),T=/^[A-Za-z0-9_]{3,16}$/,A=!0,te=async y=>{y.preventDefault(),O(null),K(!0);try{if(o==="login")await Pe({usernameOrEmail:u.trim()||p.trim(),password:d,remember:v,otp:I.trim()||void 0,captchaToken:J}),n();else{if(!T.test(u.trim()))throw new Error("Username: 3-16 chars (A-Z a-z 0-9 _)");await Te({username:u.trim(),email:p.trim(),password:d||void 0,inviteCode:A?c.trim():"",remember:v,captchaToken:J});try{Le(p.trim())}catch{}W("email")}}catch(q){O((q==null?void 0:q.message)||"–†¬†–í¬ß–†–é–≤–Ç—ô–†¬†–°‚Ä¢-–†–é–≤–Ç—ô–†¬†–°‚Ä¢ –†¬†–°‚Äî–†¬†–°‚Ä¢–†–é–≤‚Äö¬¨–†¬†–í¬ª–†¬†–°‚Ä¢ –†¬†–†‚Ä¶–†¬†–í¬µ –†–é–≤–Ç—ô–†¬†–í¬∞–†¬†–°‚Äù")}finally{K(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[90] grid place-items-center bg-black/70 p-4",children:e.jsxs("form",{onSubmit:te,className:"w-[min(560px,92vw)] card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{size:18}),e.jsx("b",{children:o==="login"?"–†¬†–≤–Ç‚Ñ¢–†–é–≤–Ç¬¶–†¬†–°‚Ä¢–†¬†–¢‚Äò":"–†¬†–í¬†–†¬†–í¬µ–†¬†–°‚Äì–†¬†–°‚Äò–†–é–†—ì–†–é–≤–Ç—ô–†–é–†‚Äö–†¬†–í¬∞–†–é–≤–Ç¬†–†¬†–°‚Äò–†–é–†–è"})]}),!ee&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsx("input",{className:"input",placeholder:o==="login"?"–†¬†–≤–Ç—î–†¬†–°‚Ä¢–†¬†–°‚Äì–†¬†–°‚Äò–†¬†–†‚Ä¶ –†¬†–°‚Äò–†¬†–í¬ª–†¬†–°‚Äò e-mail":"–†¬†–≤–Ç—î–†¬†–°‚Ä¢–†¬†–°‚Äì–†¬†–°‚Äò–†¬†–†‚Ä¶ (–†¬†–í¬ª–†¬†–í¬∞–†–é–≤–Ç—ô–†¬†–°‚Äò–†¬†–†‚Ä¶–†¬†–°‚Äò–†–é–≤–Ç¬†–†¬†–í¬∞/–†–é–≤–Ç¬†–†¬†–°‚Äò–†–é–≤–Ç—õ–†–é–†‚Äö–†–é–≤–Ç‚Ññ/_ )",value:u,onChange:y=>f(y.target.value),disabled:E,required:!0}),o==="signup"&&e.jsx("input",{className:"input",placeholder:"E-mail",value:p,onChange:y=>w(y.target.value),disabled:E,required:!0}),o==="signup"&&A&&e.jsx("input",{className:"input",placeholder:"Invite code",value:c,onChange:y=>M(y.target.value),disabled:E,required:!0}),e.jsx("input",{className:"input",type:"password",placeholder:"–†¬†–°—ü–†¬†–í¬∞–†–é–†‚Äö–†¬†–°‚Ä¢–†¬†–í¬ª–†–é–†–â",value:d,onChange:y=>g(y.target.value),disabled:E,required:!0}),o==="login"&&e.jsx("input",{className:"input",placeholder:"2FA –†¬†–°‚Äù–†¬†–°‚Ä¢–†¬†–¢‚Äò (–†¬†–í¬µ–†–é–†—ì–†¬†–í¬ª–†¬†–°‚Äò –†¬†–†‚Ä†–†¬†–°‚Äù–†¬†–í¬ª–†–é–†‚Äπ–†–é–≤–Ç–é–†¬†–í¬µ–†¬†–†‚Ä¶–†¬†–°‚Ä¢)",value:I,onChange:y=>b(y.target.value),disabled:E}),e.jsx(tt,{onToken:H}),D&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:D}),e.jsx("div",{className:"flex items-center gap-2 text-xs opacity-80",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:y=>C(y.target.checked),disabled:E}),"–†¬†–≤–Ç‚Äù–†¬†–í¬∞–†¬†–°‚Äî–†¬†–°‚Ä¢–†¬†–°¬ò–†¬†–†‚Ä¶–†¬†–°‚Äò–†–é–≤–Ç—ô–†–é–†–â –†¬†–°¬ò–†¬†–í¬µ–†¬†–†‚Ä¶–†–é–†–è"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:E,children:o==="login"?"–†¬†–≤–Ç‚Ñ¢–†¬†–°‚Ä¢–†¬†–≤‚Äû‚Äì–†–é–≤–Ç—ô–†¬†–°‚Äò":"–†¬†–≤–Ç‚Äù–†¬†–í¬∞–†–é–†‚Äö–†¬†–í¬µ–†¬†–°‚Äì–†¬†–°‚Äò–†–é–†—ì–†–é–≤–Ç—ô–†–é–†‚Äö–†¬†–°‚Äò–†–é–†‚Äö–†¬†–°‚Ä¢–†¬†–†‚Ä†–†¬†–í¬∞–†–é–≤–Ç—ô–†–é–†–â–†–é–†—ì–†–é–†–è"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>x(o==="login"?"signup":"login"),disabled:E,children:o==="login"?"–†¬†–°—ö–†¬†–í¬µ–†–é–≤–Ç—ô –†¬†–í¬∞–†¬†–°‚Äù–†¬†–°‚Äù–†¬†–í¬∞–†–é–°‚Äú–†¬†–†‚Ä¶–†–é–≤–Ç—ô–†¬†–í¬∞? –†¬†–í¬†–†¬†–í¬µ–†¬†–°‚Äì–†¬†–°‚Äò–†–é–†—ì–†–é–≤–Ç—ô–†–é–†‚Äö–†¬†–í¬∞–†–é–≤–Ç¬†–†¬†–°‚Äò–†–é–†–è":"–†¬†–†‚Ç¨–†¬†–í¬∂–†¬†–í¬µ –†¬†–í¬µ–†–é–†—ì–†–é–≤–Ç—ô–†–é–†–â? –†¬†–≤–Ç‚Ñ¢–†¬†–°‚Ä¢–†¬†–≤‚Äû‚Äì–†–é–≤–Ç—ô–†¬†–°‚Äò"})]})]}),ee==="email"&&e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsxs("div",{className:"text-sm text-zinc-300",children:["–†¬†–°—ô–†–é–≤–Ç‚Ññ –†¬†–°‚Ä¢–†–é–≤–Ç—ô–†¬†–°‚Äî–†–é–†‚Äö–†¬†–í¬∞–†¬†–†‚Ä†–†¬†–°‚Äò–†¬†–í¬ª–†¬†–°‚Äò –†¬†–°‚Äù–†¬†–°‚Ä¢–†¬†–¢‚Äò –†¬†–°‚Äî–†¬†–°‚Ä¢–†¬†–¢‚Äò–†–é–≤–Ç—ô–†¬†–†‚Ä†–†¬†–í¬µ–†–é–†‚Äö–†¬†–í¬∂–†¬†–¢‚Äò–†¬†–í¬µ–†¬†–†‚Ä¶–†¬†–°‚Äò–†–é–†–è –†¬†–†‚Ä¶–†¬†–í¬∞ ",p,". –†¬†–≤–Ç‚Ñ¢–†¬†–†‚Ä†–†¬†–í¬µ–†¬†–¢‚Äò–†¬†–°‚Äò–†–é–≤–Ç—ô–†¬†–í¬µ –†¬†–°‚Äù–†¬†–°‚Ä¢–†¬†–¢‚Äò –†¬†–†‚Ä¶–†¬†–°‚Äò–†¬†–í¬∂–†¬†–í¬µ."]}),e.jsx("input",{className:"input",placeholder:"–†¬†–°‚Ñ¢–†¬†–°‚Ä¢–†¬†–¢‚Äò –†¬†–°‚Äî–†¬†–°‚Ä¢–†¬†–¢‚Äò–†–é–≤–Ç—ô–†¬†–†‚Ä†–†¬†–í¬µ–†–é–†‚Äö–†¬†–í¬∂–†¬†–¢‚Äò–†¬†–í¬µ–†¬†–†‚Ä¶–†¬†–°‚Äò–†–é–†–è",value:P,onChange:y=>Y(y.target.value)}),!!D&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:D}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{rt(p,P)?(W(!1),n()):O("–†¬†–°—ö–†¬†–í¬µ–†¬†–†‚Ä†–†¬†–í¬µ–†–é–†‚Äö–†¬†–†‚Ä¶–†–é–≤–Ç‚Ññ–†¬†–≤‚Äû‚Äì –†¬†–°‚Äù–†¬†–°‚Ä¢–†¬†–¢‚Äò")},children:"–†¬†–°—ü–†¬†–°‚Ä¢–†¬†–¢‚Äò–†–é–≤–Ç—ô–†¬†–†‚Ä†–†¬†–í¬µ–†–é–†‚Äö–†¬†–¢‚Äò–†¬†–°‚Äò–†–é–≤–Ç—ô–†–é–†–â"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>{Le(p)},children:"–†¬†–°‚Ä∫–†–é–≤–Ç—ô–†¬†–°‚Äî–†–é–†‚Äö–†¬†–í¬∞–†¬†–†‚Ä†–†¬†–°‚Äò–†–é–≤–Ç—ô–†–é–†–â –†¬†–°‚Äù–†¬†–°‚Ä¢–†¬†–¢‚Äò –†¬†–í¬µ–†–é–≤–Ç¬∞–†–é–≤–Ç¬ò –†–é–†‚Äö–†¬†–í¬∞–†¬†–í¬∑"})]})]})]})})}function nt({me:n,onLogout:o}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.6)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl items-center gap-3 px-4 py-3",children:[e.jsxs(Q,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(Ye,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"Forum // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"–†¬†–°—ü–†–é–†‚Äö–†¬†–í¬∞–†¬†–†‚Ä†–†¬†–°‚Äò–†–é–≤–Ç—ô–†¬†–í¬µ–†¬†–í¬ª–†–é–†–â–†–é–†—ì–†–é–≤–Ç—ô–†¬†–†‚Ä†–†¬†–°‚Ä¢"})]})]}),(n.role==="admin"||n.role==="developer"||n.role==="moderator")&&e.jsx(Q,{to:"/forum/admin",className:"ml-2 btn",children:"Admin"}),e.jsxs(Q,{to:`/forum/profile/${n.username}`,className:"ml-2 flex items-center gap-2 rounded-xl border px-3 py-2 card",children:[e.jsx(at,{role:n.role}),e.jsx("div",{className:"text-sm font-semibold",children:n.username}),e.jsxs("div",{className:"border-l pl-2 text-xs opacity-70",children:["#",n.userNumber]})]})]})})}function ft(){const[,n]=a.useReducer(d=>d+1,0),[o,x]=a.useState(void 0),[u,f]=a.useState([]),[p,w]=a.useState([]);return a.useEffect(()=>{let d=!0;const g=async()=>{try{const M=await ue();d&&x(M)}catch{d&&x(null)}};g();const c=()=>g();return window.addEventListener("forum:session",c),window.addEventListener("storage",c),()=>{d=!1,window.removeEventListener("forum:session",c),window.removeEventListener("storage",c)}},[]),a.useEffect(()=>{if(!o)return;let d=!0;return(async()=>{try{const[g,c]=await Promise.all([Fe(),Ue(8)]);d&&(f(Array.isArray(g)?g:[]),w(Array.isArray(c)?c:[]))}catch{d&&(f([]),w([]))}})(),()=>{d=!1}},[o]),a.useEffect(()=>{let d=!1;function g(c){if(c.key==="/"){const M=document.getElementById("forum-search-input");M&&(c.preventDefault(),M.focus());return}if(c.key.toLowerCase()==="g"){d=!0,setTimeout(()=>{d=!1},800);return}if(d){if(c.key.toLowerCase()==="h"){c.preventDefault();try{window.location.href="/forum"}catch{location.assign("/forum")}}if(c.key.toLowerCase()==="q"){c.preventDefault();try{window.location.href="/forum/questions"}catch{location.assign("/forum/questions")}}}}return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[]),o===void 0?e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}}):o?e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[e.jsx(nt,{me:o,onLogout:()=>{Ke(),n()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[e.jsx(Be,{}),e.jsx(Je,{}),e.jsx("div",{className:"relative mb-6 overflow-hidden card",children:e.jsx("h1",{className:"select-none py-10 text-center font-black tracking-[0.16em] text-transparent bg-clip-text shimmer-text",style:{fontSize:"clamp(64px,12vw,140px)",lineHeight:1},children:"SKY"})}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.45fr_.85fr]",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:Ee("–†–ê–ó–î–ï–õ–´","SECTIONS")}),(Array.isArray(u)?u:[]).map(d=>e.jsxs(Q,{to:`/forum/section/${d.id}`,className:"card p-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[d.icon?e.jsx("span",{className:"text-xl",children:d.icon}):e.jsx(He,{size:16}),d.title]}),d.description&&e.jsx("div",{className:"text-sm opacity-70 mt-1",children:d.description})]},d.id)),!Array.isArray(u)||u.length===0?e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"–†¬†–°—ö–†¬†–í¬µ–†–é–≤–Ç—ô –†–é–†‚Äö–†¬†–í¬∞–†¬†–í¬∑–†¬†–¢‚Äò–†¬†–í¬µ–†¬†–í¬ª–†¬†–°‚Ä¢–†¬†–†‚Ä†"}):null]}),e.jsxs("aside",{className:"grid content-start gap-4",children:[e.jsx("div",{className:"card flex items-center justify-between px-3 py-2",children:e.jsx("div",{className:"text-xs uppercase tracking-[0.28em]",children:Ee("–ü–û–°–õ–ï–î–ù–ò–ï –ü–û–°–¢–´","LATEST POSTS")})}),(Array.isArray(p)?p:[]).map(d=>e.jsx("div",{className:"block card px-3 py-3",children:e.jsxs("div",{className:"relative pl-4",children:[e.jsx("span",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full",style:{background:"#22d3ee"}}),e.jsx("div",{className:"font-semibold",children:d.title||"–†¬†–°—ü–†¬†–°‚Ä¢–†–é–†—ì–†–é–≤–Ç—ô"}),e.jsx("div",{className:"text-xs",style:{color:"var(--text-2)"},children:d.createdAt?new Date(d.createdAt).toLocaleString():""})]})},d.id)),!Array.isArray(p)||p.length===0?e.jsx("div",{className:"card p-3 text-sm opacity-70",children:"–†¬†–°—ü–†¬†–°‚Ä¢–†–é–†—ì–†–é–≤–Ç—ô–†¬†–°‚Ä¢–†¬†–†‚Ä† –†¬†–°‚Äî–†¬†–°‚Ä¢–†¬†–°‚Äù–†¬†–í¬∞ –†¬†–†‚Ä¶–†¬†–í¬µ–†–é–≤–Ç—ô"}):null]})]}),e.jsxs("div",{className:"mt-8 card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(et,{})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{onDone:()=>n()}),e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}})]})}export{ft as default};
