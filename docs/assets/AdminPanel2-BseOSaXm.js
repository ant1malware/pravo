import{j as e}from"./index-ByoAOyU0.js";import{R as r}from"./react-vendor-DTkXckhQ.js";import{r as j}from"./forumStore-BCxyOpHa.js";import{d as b,l as y,e as N,f,h as w,u as k,s as C,m as S,i as F,j as I,k as _,n as T,o as D,p as M,q as g,t as R,v as E,w as A,x as U}from"./forumRemote-CRjQkurD.js";import"./icons-DET5c9ig.js";function p(){try{const c=localStorage.getItem("forum:session")??sessionStorage.getItem("forum:session"),o=c?JSON.parse(c):null;return(o==null?void 0:o.userId)||"unknown"}catch{return"unknown"}}function z(){const[c,o]=r.useState("users");return e.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:["users","sections","topics","invites","maintenance"].map(n=>e.jsx("button",{className:`btn ${c===n?"btn-primary":""}`,onClick:()=>o(n),children:n},n))}),c==="users"&&e.jsx(B,{}),c==="sections"&&e.jsx(O,{}),c==="topics"&&e.jsx($,{}),c==="invites"&&e.jsx(P,{}),c==="maintenance"&&e.jsx(q,{})]})}function B(){const[c,o]=r.useState([]),n=r.useCallback(async()=>{try{o(await b())}catch(t){alert((t==null?void 0:t.message)||"Failed to load users")}},[]);r.useEffect(()=>{n()},[n]);const d=async(t,s)=>{try{await C(t,s),n()}catch(a){alert((a==null?void 0:a.message)||"Failed to set role")}},x=async t=>{const s=parseInt(prompt("Mute minutes","60")||"60",10),a=new Date(Date.now()+Math.max(1,s)*6e4).toISOString();try{await S(t,a),await n()}catch(l){alert((l==null?void 0:l.message)||"Failed to mute")}},m=async t=>{try{await F(t),await n()}catch(s){alert((s==null?void 0:s.message)||"Failed to unmute")}},u=async t=>{const s=parseInt(prompt("Ban days","7")||"7",10),a=new Date(Date.now()+Math.max(1,s)*864e5).toISOString();try{await I(t,a),await n()}catch(l){alert((l==null?void 0:l.message)||"Failed to ban")}},i=async t=>{try{await _(t),await n()}catch(s){alert((s==null?void 0:s.message)||"Failed to unban")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 text-sm opacity-70",children:"Пользователи (через Worker API). Мут/бан — локальны для чата."}),e.jsxs("div",{className:"grid gap-2",children:[c.map(t=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-2 sm:grid-cols-[80px_1fr_1fr_220px_1fr]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:["#",t.userNumber]}),e.jsx("div",{className:"font-semibold",children:t.username}),e.jsx("div",{className:"text-sm opacity-80 truncate",children:t.email}),e.jsxs("select",{className:"input",value:t.role,onChange:s=>d(t.id,s.target.value),children:[e.jsx("option",{value:"developer",children:"developer"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"moderator",children:"moderator"}),e.jsx("option",{value:"vip",children:"vip"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"newbie",children:"newbie"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("button",{className:"btn",onClick:()=>x(t.id),children:"Mute"}),e.jsx("button",{className:"btn",onClick:()=>m(t.id),children:"Unmute"}),e.jsx("button",{className:"btn",onClick:()=>u(t.id),children:"Ban"}),e.jsx("button",{className:"btn",onClick:()=>i(t.id),children:"Unban"})]})]},t.id)),!c.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function O(){const[c,o]=r.useState([]),[n,d]=r.useState(""),[x,m]=r.useState(""),u=r.useCallback(async()=>{try{o(await y())}catch(a){alert((a==null?void 0:a.message)||"Failed to load sections")}},[]);r.useEffect(()=>{u()},[u]);const i=async()=>{if(n.trim())try{await T({title:n.trim(),description:x.trim(),actorId:p()}),d(""),m(""),u()}catch(a){alert((a==null?void 0:a.message)||"Failed to create section")}},t=async(a,l,v)=>{try{await D(a,{[l]:v,actorId:p()}),u()}catch(h){alert((h==null?void 0:h.message)||"Failed to update section")}},s=async a=>{if(confirm("Удалить раздел?"))try{await M(a),u()}catch(l){alert((l==null?void 0:l.message)||"Failed")}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Создать раздел"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_1fr_auto]",children:[e.jsx("input",{className:"input",placeholder:"Title",value:n,onChange:a=>d(a.target.value)}),e.jsx("input",{className:"input",placeholder:"Description",value:x,onChange:a=>m(a.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Add"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Разделы"}),e.jsxs("div",{className:"grid gap-2",children:[c.map(a=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{className:"text-xs opacity-70",children:[a.id.slice(0,8),"…"]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{className:"input",value:a.title,onChange:l=>t(a.id,"title",l.target.value)}),e.jsx("input",{className:"input",value:a.description||"",onChange:l=>t(a.id,"description",l.target.value)})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>s(a.id),children:"Delete"})})]},a.id)),!c.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})]})}function $(){const[c,o]=r.useState([]),n=r.useCallback(async()=>{try{o(await N())}catch(i){alert((i==null?void 0:i.message)||"Failed to load topics")}},[]);r.useEffect(()=>{n()},[n]);const d=async(i,t)=>{try{await g(i,{pinned:t,actorId:p()}),n()}catch(s){alert((s==null?void 0:s.message)||"Failed to update topic")}},x=async(i,t)=>{try{await g(i,{locked:t,actorId:p()}),n()}catch(s){alert((s==null?void 0:s.message)||"Failed to update topic")}},m=async(i,t)=>{const s=t.trim();if(s)try{await R(i,s),n()}catch(a){alert((a==null?void 0:a.message)||"Failed to move topic")}},u=async i=>{if(confirm("Удалить тему?"))try{await E(i),n()}catch(t){alert((t==null?void 0:t.message)||"Failed to delete")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Темы"}),e.jsxs("div",{className:"grid gap-2",children:[c.map(i=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-3 rounded-xl border px-3 py-3 sm:grid-cols-[1fr_auto_auto_auto]",style:{borderColor:"var(--border)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:i.title}),e.jsxs("div",{className:"text-xs opacity-70",children:["id: ",i.id.slice(0,8),"… • section: ",i.sectionId.slice(0,8),"…"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.pinned,onChange:t=>d(i.id,t.target.checked)}),"pinned"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!i.locked,onChange:t=>x(i.id,t.target.checked)}),"locked"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"to sectionId",onKeyDown:t=>{t.key==="Enter"&&(m(i.id,t.target.value),t.target.value="")}}),e.jsx("button",{className:"btn",onClick:t=>{const s=t.currentTarget.previousElementSibling;m(i.id,s.value),s.value=""},children:"Move"}),e.jsx("button",{className:"btn",onClick:()=>u(i.id),children:"Delete"})]})]},i.id)),!c.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function P(){const[c,o]=r.useState([]),[n,d]=r.useState(5),[x,m]=r.useState(""),u=r.useCallback(async()=>{try{o(await f())}catch(s){alert((s==null?void 0:s.message)||"Failed")}},[]);r.useEffect(()=>{u()},[u]);const i=async()=>{try{await A(Math.max(1,Math.min(20,n)),x||void 0),m(""),u()}catch(s){alert((s==null?void 0:s.message)||"Failed to generate")}},t=async s=>{if(confirm("Удалить инвайт?"))try{await U(s),u()}catch(a){alert((a==null?void 0:a.message)||"Failed")}};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-3 font-semibold",children:"Генерация инвайтов"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[120px_1fr_auto]",children:[e.jsx("input",{className:"input",type:"number",min:1,max:20,value:n,onChange:s=>d(parseInt(s.target.value||"1",10))}),e.jsx("input",{className:"input",placeholder:"note (optional)",value:x,onChange:s=>m(s.target.value)}),e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Generate"})]}),e.jsxs("div",{className:"grid gap-2",children:[c.map(s=>e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 rounded-xl border px-3 py-2 sm:grid-cols-[160px_1fr_1fr_1fr_auto]",style:{borderColor:"var(--border)"},children:[e.jsx("div",{className:"font-mono text-sm",children:s.code}),e.jsxs("div",{className:"text-xs opacity-70",children:["created: ",new Date(s.createdAt).toLocaleString()]}),e.jsx("div",{className:"text-xs",children:s.note||""}),e.jsx("div",{className:"text-xs",children:s.usedBy?e.jsx("span",{className:"text-emerald-400",children:"used"}):e.jsx("span",{className:"opacity-70",children:"unused"})}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn",onClick:()=>t(s.code),children:"Delete"})})]},`${s.code}-${s.createdAt}`)),!c.length&&e.jsx("div",{className:"text-sm opacity-70",children:"Пусто"})]})]})}function q(){const[c,o]=r.useState("invite");r.useEffect(()=>{(async()=>{try{const d=await w();o((d==null?void 0:d.registrationMode)||"invite")}catch{}})()},[]);const n=()=>{confirm("Очистить форум (пустой старт)?")&&(j(p()),alert("Ок. Форум очищен."),location.reload())};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Настройки форума"}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"Регистрация:"}),e.jsxs("select",{className:"input",value:c,onChange:async d=>{const x=d.target.value;o(x);try{await k({registrationMode:x})}catch(m){alert((m==null?void 0:m.message)||"Failed")}},children:[e.jsx("option",{value:"invite",children:"по инвайтам"}),e.jsx("option",{value:"open",children:"открытая"})]})]}),e.jsx("div",{className:"mb-2 font-semibold",children:"Обслуживание"}),e.jsx("p",{className:"text-sm opacity-70 mb-3",children:"Очистить локальные разделы/темы/сообщения без демо-данных."}),e.jsx("button",{className:"btn btn-primary",onClick:n,children:"Reset forum (empty)"})]})}export{z as default};
