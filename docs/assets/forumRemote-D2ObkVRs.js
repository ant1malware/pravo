const S="https://notifications-worker.wizardiowhy.workers.dev/skyapi",u="forum:token",m="forum:session";function d(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function l(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function y(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function a(t,e={}){const s=l(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${S}${t}`,{...e,headers:r}),c=await n.text();let o={};try{o=c?JSON.parse(c):{}}catch{o={error:c||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function w(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:s,user:r}=await a("/register",{method:"POST",body:e});d(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function g(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:s,user:r}=await a("/login",{method:"POST",body:e});d(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function h(){if(!l())return null;try{const{user:e}=await a("/me");return e}catch{return y(),null}}async function p(){const{users:t}=await a("/users");return t}async function v(t,e){const{user:s}=await a(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return s}async function T(){const{invites:t}=await a("/invites");return t}async function E(t=5,e){const{invites:s}=await a("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return s}async function O(t){await a(`/invites/${encodeURIComponent(t)}`,{method:"DELETE"})}async function I(){const{settings:t}=await a("/settings");return t}async function $(t){const{settings:e}=await a("/settings",{method:"PATCH",body:JSON.stringify(t)});return e}const N=Object.freeze(Object.defineProperty({__proto__:null,authenticateAccount:g,clearSession:y,deleteInvite:O,generateInvites:E,getServerSettings:I,getSessionAccount:h,listAccounts:p,listInvites:T,registerAccount:w,setRole:v,updateServerSettings:$},Symbol.toStringTag,{value:"Module"})),k="https://notifications-worker.wizardiowhy.workers.dev/skyapi",f="forum:token";function b(){try{return localStorage.getItem(f)??sessionStorage.getItem(f)}catch{return null}}async function i(t,e={}){const s=b(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${k}${t}`,{...e,headers:r}),c=await n.text();let o={};try{o=c?JSON.parse(c):{}}catch{o={error:c||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function J(){const{sections:t}=await i("/sections");return t}async function A(t){const{section:e}=await i("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function C(t,e){const{section:s}=await i(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function P(t){await i(`/sections/${encodeURIComponent(t)}`,{method:"DELETE"})}async function x(t){const e="",{topics:s}=await i(`/topics${e}`);return s}async function _(t,e){const{topic:s}=await i(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function L(t,e){const{topic:s}=await i(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return s}async function j(t){await i(`/topics/${encodeURIComponent(t)}`,{method:"DELETE"})}async function z(t=8){const{posts:e}=await i(`/latest-posts?limit=${t}`);return e}export{z as a,g as b,y as c,p as d,x as e,T as f,h as g,I as h,A as i,C as j,P as k,J as l,_ as m,L as n,j as o,E as p,O as q,w as r,v as s,N as t,$ as u};
