const w="https://notifications-worker.wizardiowhy.workers.dev/skyapi",u="forum:token",m="forum:session";function l(t,e=!0){(e?localStorage:sessionStorage).setItem(u,t)}function y(){return localStorage.getItem(u)??sessionStorage.getItem(u)}function d(){try{localStorage.removeItem(u),sessionStorage.removeItem(u),localStorage.removeItem(m),sessionStorage.removeItem(m)}finally{window.dispatchEvent(new Event("forum:session"))}}async function i(t,e={}){const s=y(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${w}${t}`,{...e,headers:r}),a=await n.text();let o={};try{o=a?JSON.parse(a):{}}catch{o={error:a||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function h(t){const e=JSON.stringify({username:t.username,email:t.email,password:t.password||"1234",inviteCode:t.inviteCode||""}),{token:s,user:r}=await i("/register",{method:"POST",body:e});l(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function p(t){const e=JSON.stringify({usernameOrEmail:t.usernameOrEmail,password:t.password||"1234"}),{token:s,user:r}=await i("/login",{method:"POST",body:e});l(s,t.remember!==!1);const n={userId:r.id,remember:t.remember!==!1,lastLogin:new Date().toISOString()};return localStorage.setItem(m,JSON.stringify(n)),window.dispatchEvent(new Event("forum:session")),r}async function O(){if(!y())return null;try{const{user:e}=await i("/me");return e}catch{return d(),null}}async function v(){const{users:t}=await i("/users");return t}async function T(t,e){const{user:s}=await i(`/users/${t}/role`,{method:"PATCH",body:JSON.stringify({role:e})});return s}async function $(){const{invites:t}=await i("/invites");return t}async function k(t=5,e){const{invites:s}=await i("/invites",{method:"POST",body:JSON.stringify({count:t,note:e})});return s}const S="https://notifications-worker.wizardiowhy.workers.dev/skyapi",f="forum:token";function g(){try{return localStorage.getItem(f)??sessionStorage.getItem(f)}catch{return null}}async function c(t,e={}){const s=g(),r={"Content-Type":"application/json",...e.headers||{}};s&&(r.Authorization=`Bearer ${s}`);const n=await fetch(`${S}${t}`,{...e,headers:r}),a=await n.text();let o={};try{o=a?JSON.parse(a):{}}catch{o={error:a||n.statusText}}if(!n.ok)throw new Error((o==null?void 0:o.error)||`${n.status} ${n.statusText}`);return o}async function I(){const{sections:t}=await c("/sections");return t}async function E(t){const{section:e}=await c("/sections",{method:"POST",body:JSON.stringify(t)});return e}async function b(t,e){const{section:s}=await c(`/sections/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function N(t){const e="",{topics:s}=await c(`/topics${e}`);return s}async function J(t,e){const{topic:s}=await c(`/topics/${t}`,{method:"PATCH",body:JSON.stringify(e)});return s}async function A(t,e){const{topic:s}=await c(`/topics/${t}/move`,{method:"POST",body:JSON.stringify({to:e})});return s}async function x(t=8){const{posts:e}=await c(`/latest-posts?limit=${t}`);return e}export{x as a,p as b,d as c,v as d,N as e,$ as f,O as g,E as h,J as i,k as j,I as l,A as m,h as r,T as s,b as u};
