import{j as e}from"./index-BegF4YQh.js";import{R as a,L as te,c as Re,d as we}from"./react-vendor-DTkXckhQ.js";import{g as Oe,i as _e,l as Ie,a as De,b as Ke}from"./forumStore-DelI90S4.js";import{c as Te,g as Fe,a as Be,r as Pe}from"./authRemote-DRv3ZFbe.js";import{L as We,S as He,a as Je,i as Ue,$ as Ye}from"./icons-DET5c9ig.js";const ee=800,Ne=["–°–∫–∞–π-–°—Ç—Ä–∞–∂","–ü—Ä–∞–≤–æ-–°–∞–º—É—Ä–∞–π","–ü—É–ª—å—Å-–†–µ–π–¥–µ—Ä","–ö–∏–±–µ—Ä-–ú–µ–¥–∏–∫","–ù–µ–æ–Ω-–¢–∞–∫—Ç–∏–∫","–ê—Å—Ç—Ä–∞–ª-–û—Ñ–∏—Ü–µ—Ä","–§–∞–Ω—Ç–æ–º-–õ–µ—á–∞—â–∏–π","–®–∏—Ñ—Ä-–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä","–ö–≤–∞–Ω—Ç-–ë–æ–µ—Ü","–ü–∏–∫—Å–µ–ª—å-–í–æ–ª–∫","–¢—É–º–∞–Ω-–ö–æ–º–∞–Ω–¥–æ—Ä","–ò—Å–∫—Ä–∞-–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å","–ù—É–ª—å-–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–ü–æ–ª—è—Ä–Ω—ã–π –ü–∏–ª–æ—Ç","–ì–æ—Ä–æ–¥—Å–∫–æ–π –•–∏—Ä—É—Ä–≥","–°—ã–≤–æ—Ä–æ—Ç–∫–∞-Vibe","–°—Ç–µ—Ä–∏–ª—å–Ω—ã–π –ù–∏–Ω–¥–∑—è","–°–∫–∞–ª—å–ø–µ–ª—å-–û–±–ª–∞–∫–æ","–†–µ–Ω—Ç–≥–µ–Ω-–ü–∞–Ω–∫","–í–∞—Ç–∫–∞-Supreme"];function H(){const o=Ne[Math.floor(Math.random()*Ne.length)],n=Math.floor(Math.random()*900+100);return`${o} ${n}`}function qe(o){try{return typeof o=="string"?JSON.parse(o):o instanceof ArrayBuffer?JSON.parse(new TextDecoder().decode(o)):(typeof Blob<"u"&&o instanceof Blob,null)}catch{return null}}function ke(o){return new Date(o).toLocaleTimeString(void 0,{hour12:!1})}function Xe(o){return o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function Ve(o){if(!o)return null;const n=o.trim();return n?`@${Xe(n).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Se(o,n){if(!n)return!1;try{return new RegExp(n,"iu").test(o)}catch{return!1}}function Ee(o,n){if(!n)return o;try{const y=new RegExp(n,"giu"),m=[];let j=0,l=0,p;for(;(p=y.exec(o))!==null;)p.index>j&&m.push(e.jsx(a.Fragment,{children:o.slice(j,p.index)},`text-${l++}`)),m.push(e.jsx("span",{className:"rc-ping",children:p[0]},`mention-${l++}`)),j=y.lastIndex;return j<o.length&&m.push(e.jsx(a.Fragment,{children:o.slice(j)},`text-${l++}`)),m.length?m:o}catch{return o}}const re=["üòÄ","üòÅ","üòÇ","ü§£","üòÖ","üòé","üòç","üòò","üòá","ü§ù","üëå","üëç","üî•","üíØ","‚ú®","‚ö°","üéØ","üöÄ","üõ°Ô∏è","üèÜ","üí¨","üìù","üìå","üì£","üóÇÔ∏è","üß†","üìà","üïí","üõ†Ô∏è","üîí","‚úÖ","‚ùó","‚ö†Ô∏è","‚ùì","üéâ","ü•≥","üôå","ü§ò","ü§ñ","üëÄ","üí°","üß≠","üì¶","üõéÔ∏è","üì°","üõ∞Ô∏è","üß™","üìï","üß∑","ü™™","üß∞","üß±","üõ∞","üóÉÔ∏è"],Ge=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function Ze(o){try{const n=new URL(o);return n.protocol=n.protocol==="wss:"?"https:":n.protocol==="ws:"?"http:":n.protocol,n.pathname="/",n.search="",n.hash="",n.toString().replace(/\/+$/,"")}catch{return""}}function Qe(o){const n=`@e${o}`;return{NAME_KEY:`chat:nick${n}`,NAME_LOCK:`chat:nick:lock${n}`}}function er({room:o="global",className:n,variant:y="classic",onRosterChange:m,resolveRole:j}){const l="wss://notifications-worker.wizardiowhy.workers.dev/chat",p=a.useMemo(()=>Ze(l),[l]),[b,J]=a.useState(1),[f,ae]=a.useState(!1),N=a.useMemo(()=>Qe(b),[b]),[k,D]=a.useState(!1),[L,S]=a.useState(0),[A,K]=a.useState([]),[$,R]=a.useState(!1),[d,T]=a.useState(!1),[G,Z]=a.useState(""),[U,F]=a.useState([]),_=a.useRef(null),se=a.useRef(null),le=a.useRef(null),ne=a.useRef(null),Q=a.useRef(null),[B,Y]=a.useState(!1),q=a.useRef({}),[w,P]=a.useState(null),[E,X]=a.useState(!0),[de,M]=a.useState(H()),pe=a.useRef({epochReady:f,needNick:E,nick:w}),ue=a.useRef(N),I=a.useRef(null),xe=a.useMemo(()=>d?"Admin":w??"",[d,w]),C=a.useMemo(()=>xe.trim(),[xe]),W=a.useMemo(()=>Ve(C||null),[C]),fe=a.useCallback(r=>{const s=j==null?void 0:j(r);return s||(r.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[j]),me=a.useCallback(r=>{const s=r.trim();if(!s)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let t=0;for(let v=0;v<s.length;v+=1)t=(t+s.charCodeAt(v)*17)%360;const c=t,x=(t+42)%360;return{background:`linear-gradient(135deg, hsla(${c},80%,56%,0.85), hsla(${x},78%,48%,0.85))`,color:"#fdfcff"}},[]);a.useEffect(()=>{if(f)try{const r=localStorage.getItem(N.NAME_KEY),s=localStorage.getItem(N.NAME_LOCK)==="1";r&&s?(P(r),X(!1),M(r)):r&&!s?(P(r),M(r),X(!0)):(P(null),M(H()),X(!0))}catch{P(null),M(H()),X(!0)}},[f,N.NAME_KEY,N.NAME_LOCK]),a.useEffect(()=>{pe.current={epochReady:f,needNick:E,nick:w}},[f,E,w]),a.useEffect(()=>{ue.current=N},[N]),a.useEffect(()=>{d||R(!1)},[d]),a.useEffect(()=>{typeof m=="function"&&m(A,L)},[m,A,L]),a.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=d;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:d}}))}catch{}}},[d]),a.useEffect(()=>{k||(R(!1),K([]))},[k]),a.useEffect(()=>{if(!$)return;const r=t=>{const c=le.current;c&&!c.contains(t.target)&&R(!1)},s=t=>{t.key==="Escape"&&R(!1)};return window.addEventListener("mousedown",r),window.addEventListener("keydown",s),()=>{window.removeEventListener("mousedown",r),window.removeEventListener("keydown",s)}},[$]),a.useEffect(()=>{if(!B)return;const r=t=>{const c=ne.current;c&&!c.contains(t.target)&&Y(!1)},s=t=>{t.key==="Escape"&&Y(!1)};return window.addEventListener("mousedown",r),window.addEventListener("keydown",s),()=>{window.removeEventListener("mousedown",r),window.removeEventListener("keydown",s)}},[B]),a.useEffect(()=>{E&&(I.current=null)},[E]),a.useEffect(()=>{let r=!1,s=null;const t=Date.now(),c=x=>{if(r)return;J(x);const v=Date.now()-t,i=Math.max(0,Math.min(900,520-v)),u=()=>{r||ae(!0)};i<=0?u():s=setTimeout(u,i)};return p?((async()=>{try{const x=await fetch(`${p}/nick-epoch`,{credentials:"include"}),v=x.ok?await x.json().catch(()=>({})):{},g=Number(v.epoch)||1;c(g)}catch{c(1)}})(),()=>{r=!0,s&&clearTimeout(s)}):(c(1),()=>{r=!0,s&&clearTimeout(s)})},[p]),a.useEffect(()=>{const r=se.current;r&&(r.scrollTop=r.scrollHeight)},[U.length]),a.useEffect(()=>{let r=!1,s=0,t=null;const c=()=>{if(r)return;D(!1);const x=new URL(l);x.searchParams.set("room",o),t=new WebSocket(x),_.current=t,t.addEventListener("open",()=>{D(!0),q.current={},s=0,S(0);const{epochReady:g,needNick:i,nick:u}=pe.current;if(g&&u&&!i)try{t.send(JSON.stringify({type:"hello",name:u})),I.current=u}catch{}}),t.addEventListener("message",async g=>{try{let i=qe(g.data);if(!i&&typeof Blob<"u"&&g.data instanceof Blob&&(i=JSON.parse(await g.data.text())),!i)return;if(i.type==="history")F(i.messages);else if(i.type==="message"){const u=i.cid;if(u&&q.current[u]){const h=q.current[u];delete q.current[u],F(O=>{const ie=O.filter(ce=>ce.id!==h);return ie.some(ce=>ce.id===i.message.id)?ie:[...ie,i.message]})}else F(h=>h.some(O=>O.id===i.message.id)?h:[...h,i.message])}else if(i.type==="delete")F(u=>u.filter(h=>h.id!==i.id));else if(i.type==="edit")F(u=>u.map(h=>h.id===i.id?{...h,text:i.text}:h));else if(i.type==="system"){if(i.text==="admin-ok"?T(!0):i.text==="hello-ok"&&!i.name&&T(!1),i.text==="presence"){const u=Number(i.count);if(S(Number.isFinite(u)&&u>0?Math.round(u):0),Array.isArray(i.names)){const h=i.names.map(O=>typeof O=="string"?O.trim():"").filter(O=>O.length>0);K(h)}else K([])}if(i.name&&(i.text==="hello-ok"||i.text==="admin-ok")){P(i.name),M(i.name),I.current=i.name;try{const{NAME_KEY:u,NAME_LOCK:h}=ue.current;localStorage.setItem(u,i.name),localStorage.setItem(h,"1")}catch{}X(!1)}}}catch{}});const v=()=>{r||(D(!1),S(0),K([]),R(!1),s=Math.min(s+1,6),setTimeout(c,400*s))};t.addEventListener("close",v),t.addEventListener("error",()=>t==null?void 0:t.close())};return c(),()=>{r=!0;try{t==null||t.close()}catch{}_.current=null,I.current=null}},[l,o]),a.useEffect(()=>{const r=_.current;if(!(!r||r.readyState!==WebSocket.OPEN)&&!(!f||E||!w)&&I.current!==w)try{r.send(JSON.stringify({type:"hello",name:w})),I.current=w}catch{}},[f,E,w]);function ze(){const s=((de||"").trim().slice(0,80)||H()).replace(/[^\p{L}\p{N}_ -]+/gu,"");P(s),M(s);try{localStorage.setItem(N.NAME_KEY,s)}catch{}const t=_.current;if(t&&t.readyState===WebSocket.OPEN)try{t.send(JSON.stringify({type:"hello",name:s})),I.current=s}catch{}}const he=a.useMemo(()=>{try{return Oe()}catch{return null}},[]),ge=a.useMemo(()=>_e(he),[he]);function oe(){const s=G.replace(/\r/g,"").trim(),t=_.current;if(!f||!w||E||!s||!t||t.readyState!==WebSocket.OPEN||ge)return;const c=`${Date.now()}_${Math.random().toString(36).slice(2)}`,x=`loc_${c}`;q.current[c]=x,F(v=>[...v,{id:x,author:d?"Admin":w,text:s,ts:Date.now()}]),t.send(JSON.stringify({type:"message",text:s.slice(0,ee),cid:c})),Z(""),V()}const z=f&&k&&!!w&&!E&&!ge,Me=r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&(r.preventDefault(),oe())};a.useEffect(()=>{z||Y(!1)},[z]);const be=()=>{z&&Y(r=>!r)},V=a.useCallback(()=>{if(y!=="forum")return;const r=Q.current;if(!r||r.tagName!=="TEXTAREA")return;const s=r;s.style.height="auto";const t=Math.min(s.scrollHeight,220);s.style.height=`${t}px`},[y]);a.useEffect(()=>{V()},[G,V]);const ve=r=>{Z(t=>`${t}${r}`),Y(!1);const s=()=>{const t=Q.current;if(t){const c=t.value.length;t.focus();try{t.setSelectionRange(c,c)}catch{}V()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(s):setTimeout(s,0)},ye=r=>{const s=_.current;!d||!s||s.readyState!==WebSocket.OPEN||s.send(JSON.stringify({type:"delete",id:r}))},je=(r,s)=>{var x;const t=_.current;if(!d||!t||t.readyState!==WebSocket.OPEN)return;const c=(x=prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",s))==null?void 0:x.trim();c&&t.send(JSON.stringify({type:"edit",id:r,text:c.slice(0,ee)}))},Le=r=>r==="Admin"?"rc-admin":r===w?"rc-me":"rc-other",Ae=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!f,children:[e.jsxs("div",{ref:le,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"rc-head-meta",children:[d?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${$?" open":""}`,onClick:()=>R(r=>!r),"aria-expanded":$,"aria-controls":"rc-presence-panel","aria-label":"–ö—Ç–æ —Å–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏",children:[e.jsx("span",{className:`rc-presence-dot ${k?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[k?Math.max(L,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${k?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[k?Math.max(L,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}),d&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),d&&$&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"–°–ø–∏—Å–æ–∫ –∫—Ç–æ –≤ —Å–µ—Ç–∏",children:[e.jsx("div",{className:"rc-presence-title",children:"–°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏"}),A.length?e.jsx("ul",{children:A.map(r=>e.jsxs("li",{className:r===C?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:r}),r===C&&e.jsx("span",{className:"rc-presence-you",children:"–≤—ã"})]},r))}):e.jsx("div",{className:"rc-presence-empty",children:"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("div",{ref:se,className:"rc-list",children:f?U.length===0?e.jsx("div",{className:"rc-empty",children:"‚Ä¶"}):e.jsx("ul",{children:U.map(r=>{const s=C?r.author.trim()===C:!1,t=!!(W&&C&&!s&&Se(r.text,W)),c=t?Ee(r.text,W):r.text;return e.jsxs("li",{className:t?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",ke(r.ts),"]"]}),e.jsx("span",{className:Le(r.author),children:r.author}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:c}),d&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>je(r.id,r.text),children:"–†–µ–¥."}),e.jsx("button",{className:"rc-ax",onClick:()=>ye(r.id),children:"–£–¥–∞–ª."})]})]},r.id)})}):e.jsx("div",{className:"rc-empty",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"})}),e.jsxs("form",{ref:ne,className:"rc-form",onSubmit:r=>{r.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${B?" open":""}`,onClick:be,disabled:!z,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üòä"}),e.jsx("input",{ref:Q,className:"rc-input",placeholder:"–Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",value:G,onChange:r=>Z(r.target.value),maxLength:ee,disabled:!z}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!z,children:"‚ñ∂"}),B&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),re.length?e.jsx("div",{className:"rc-emoji-grid",children:re.map(r=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>ve(r),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${r}`,children:r},r))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]})]}),$e=()=>{const r=A,s=k?Math.max(L,r.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!f,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"–û–Ω–ª–∞–π–Ω"}),f?e.jsx("div",{className:"fc-roster-list",children:r.length?r.map(t=>{const c=fe(t),x=t.trim(),v=x?x.slice(0,2).toUpperCase():"??",g=me(t);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:g,children:v}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:t}),e.jsx("div",{className:"fc-roster-role",style:c?{color:c.textColor??"#ede9fe"}:void 0,children:c?c.label:"–£—á–∞—Å—Ç–Ω–∏–∫"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},t)}):e.jsx("div",{className:"fc-roster-empty",children:"–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((t,c)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},c))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${k?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:s}),e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]})]}),f?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:se,className:"forum-chat-list",children:U.length===0?e.jsx("div",{className:"fc-empty",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç"}):U.map(t=>{const c=C?t.author.trim()===C:!1,x=!!(W&&C&&!c&&Se(t.text,W)),v=x?Ee(t.text,W):t.text,g=fe(t.author),i=t.author.trim(),u=i?i.slice(0,2).toUpperCase():"??",h=me(t.author);return e.jsxs("div",{className:`fc-item${c?" self":""}${x?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:h,children:u}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[t.author,g&&e.jsx("span",{className:"fc-role",style:{background:`${g.color}33`,color:g.textColor??"#ede9fe",borderColor:`${g.color}55`},children:g.label})]}),e.jsx("span",{className:"fc-time",children:ke(t.ts)})]}),e.jsx("div",{className:"fc-bubble",children:v}),d&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>je(t.id,t.text),children:"–†–µ–¥."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ye(t.id),children:"–£–¥–∞–ª."})]})]})]},t.id)})}),e.jsxs("form",{ref:ne,className:"forum-chat-form",onSubmit:t=>{t.preventDefault(),oe()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –¥–µ–º–æ."),disabled:!z,"aria-label":"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",children:"üìé"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:t=>{Q.current=t,t&&V()},value:G,onChange:t=>Z(t.target.value),onKeyDown:Me,placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",disabled:!z,maxLength:ee}),B&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),re.length?e.jsx("div",{className:"rc-emoji-grid",children:re.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>ve(t),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${B?" open":""}`,onClick:be,disabled:!z,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üôÇ"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!z,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:n??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Ge}}),y==="forum"?$e():Ae(),f&&E&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫"}),e.jsx("div",{className:"nick-warn",children:"–ù–∏–∫ –∑–∞–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –°–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –Ω–µ–ª—å–∑—è."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:de,onChange:r=>M(r.target.value),maxLength:80,placeholder:"–í–∞—à –Ω–∏–∫‚Ä¶",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>M(H()),children:"üé≤"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:ze,children:"–û–∫"})]}),e.jsx("div",{children:Array.from({length:5}).map((r,s)=>e.jsx("span",{className:"nick-pill",onClick:()=>M(H()),children:"üé≤ –°–ª—É—á–∞–π–Ω—ã–π"},s))})]})})]})}function rr({role:o}){const n={developer:{color:"#22d3ee",text:"Developer"},admin:{color:"#ef4444",text:"Admin"},moderator:{color:"#8b5cf6",text:"Moderator"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"User"},newbie:{color:"#22d3ee",text:"Newbie"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:n[o].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:n[o].text})}function tr({onDone:o}){const[n,y]=a.useState("signup"),[m,j]=a.useState(""),[l,p]=a.useState(""),[b,J]=a.useState(""),[f,ae]=a.useState(!0),[N,k]=a.useState(""),[D,L]=a.useState(null),[S,A]=a.useState(!1),K=/^[A-Za-z0-9_]{3,16}$/;Ke();const $=!0,R=async d=>{d.preventDefault(),L(null),A(!0);try{if(n==="login")await Be({usernameOrEmail:m.trim()||l.trim(),password:b,remember:f});else{if(!K.test(m.trim()))throw new Error("–ù–∏–∫: 3‚Äì16 —Å–∏–º–≤–æ–ª–æ–≤, –ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/_");await Pe({username:m.trim(),email:l.trim(),password:b||void 0,remember:f,inviteCode:$?N.trim():""})}o()}catch(T){L((T==null?void 0:T.message)||"–û—à–∏–±–∫–∞")}finally{A(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[90] grid place-items-center bg-black/70 p-4",children:e.jsxs("form",{onSubmit:R,className:"w-[min(560px,92vw)] card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{size:18}),e.jsx("b",{children:"–î–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ä—É–º—É –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"})]}),e.jsx("p",{style:{color:"var(--text-2)",fontSize:13,marginTop:6},children:"–ù–æ–≤–∏—á–∫–∏: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –∏–Ω–≤–∞–π—Ç‚Äë–∫–æ–¥—É."}),e.jsxs("div",{className:"grid gap-3 mt-3",children:[e.jsx("input",{className:"input",placeholder:n==="login"?"–ù–∏–∫ –∏–ª–∏ e-mail":"–ù–∏–∫ (–ª–∞—Ç/—Ü–∏—Ñ—Ä—ã/_)",value:m,onChange:d=>j(d.target.value),disabled:S,required:!0}),n==="signup"&&e.jsx("input",{className:"input",placeholder:"E-mail",value:l,onChange:d=>p(d.target.value),disabled:S,required:!0}),n==="signup"&&$&&e.jsx("input",{className:"input",placeholder:"Invite code",value:N,onChange:d=>k(d.target.value),disabled:S,required:!0}),e.jsx("input",{className:"input",type:"password",placeholder:"–ü–∞—Ä–æ–ª—å",value:b,onChange:d=>J(d.target.value),disabled:S,required:!0}),e.jsxs("label",{className:"text-sm",style:{color:"var(--text-2)"},children:[e.jsx("input",{type:"checkbox",checked:f,onChange:d=>ae(d.target.checked),disabled:S})," "," ","–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è"]}),D&&e.jsx("div",{style:{color:"#ef4444",fontSize:13},children:D}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:S,children:n==="login"?"–í–æ–π—Ç–∏":"–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>y(n==="login"?"signup":"login"),disabled:S,children:n==="login"?"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è":"–£ –º–µ–Ω—è –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç"})]})]})]})})}function ar({onLogout:o,me:n}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.6)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl items-center gap-3 px-4 py-3",children:[e.jsxs(te,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(He,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"SKY // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"–†‚Äú–†¬ª–†¬∞–†–Ü–†–Ö–†¬∞–°–è"})]})]}),e.jsx("div",{className:"mx-4 hidden flex-1 items-center justify-center sm:flex",children:e.jsxs("label",{className:"relative flex w-full max-w-xl items-center gap-2 rounded-full border px-4 py-2 text-sm shadow-sm",style:{borderColor:"var(--border)"},children:[e.jsx(Je,{size:16}),e.jsx("input",{placeholder:"–†¬ò–°–É–†—î–†¬∞–°‚Äö–°–ä–≤–Ç¬¶",className:"w-full bg-transparent outline-none",style:{color:"var(--text-1)"}})]})}),e.jsxs("button",{className:"relative grid h-10 w-10 place-items-center rounded-xl border card",title:"–†–à–†–Ü–†¬µ–†“ë–†—ï–†—ò–†¬ª–†¬µ–†–Ö–†—ë–°–è",children:[e.jsx(Ue,{size:16}),e.jsx("span",{className:"absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-rose-500"})]}),e.jsxs(te,{to:`/forum/profile/${n.username}`,className:"ml-2 flex items-center gap-2 rounded-xl border px-3 py-2 card",children:[e.jsx(rr,{role:n.role}),e.jsx("div",{className:"text-sm font-semibold",children:n.username}),e.jsxs("div",{className:"border-l pl-2 text-xs opacity-70",children:["#",n.userNumber]})]}),e.jsx("button",{onClick:o,className:"ml-2 text-xs btn",children:"–†‚Äô–°‚Äπ–†‚Ññ–°‚Äö–†—ë"})]})})}function Ce({color:o,title:n,children:y}){return e.jsxs("div",{className:"relative card flex items-center gap-3 px-4 py-3",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl",style:{boxShadow:`0 0 0 1px ${o} inset, 0 0 28px ${o}33 inset`}}),e.jsx("div",{className:"h-2 w-2 rounded-full",style:{background:o}}),e.jsx("div",{className:"font-semibold",children:n}),e.jsx("div",{className:"flex-1 text-sm",style:{color:"var(--text-2)"},children:y}),e.jsx(Ye,{size:16})]})}function lr(){const[,o]=a.useReducer(l=>l+1,0);a.useEffect(()=>{const l=()=>o();return window.addEventListener("forum:session",l),window.addEventListener("forum:changed",l),()=>{window.removeEventListener("forum:session",l),window.removeEventListener("forum:changed",l)}},[]);const[n,y]=a.useState(void 0);if(a.useEffect(()=>{let l=!0;const p=async()=>{try{const J=await Fe();l&&y(J)}catch{l&&y(null)}};p();const b=()=>p();return window.addEventListener("forum:session",b),window.addEventListener("storage",b),()=>{l=!1,window.removeEventListener("forum:session",b),window.removeEventListener("storage",b)}},[]),n===void 0)return e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}});if(!n)return e.jsxs(e.Fragment,{children:[e.jsx(tr,{onDone:()=>o()}),e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}})]});const m=Ie(),j=De(8);return e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[e.jsx(ar,{me:n,onLogout:()=>{Te(),o()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[e.jsx("div",{className:"relative mb-6 overflow-hidden card",children:e.jsx("h1",{className:"select-none py-10 text-center font-black tracking-[0.16em]",style:{fontSize:"clamp(64px,12vw,140px)",lineHeight:1,background:"linear-gradient(180deg,#fff,#d1c3ff 38%,#8b5cf6 60%,rgba(255,255,255,.7))",WebkitBackgroundClip:"text",color:"transparent",textShadow:"0 18px 80px rgba(139,92,246,.35)"},children:"SKY"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(Ce,{color:"#10b981",title:"Important note",children:"–†‚Äô–†—î–†¬ª–°–ã–°‚Ä°–†—ë–°‚Äö–†¬µ 2FA –†—ë –†¬±–†¬µ–°–Ç–†¬µ–†—ñ–†—ë–°‚Äö–†¬µ –†“ë–†—ï–°–É–°‚Äö–°—ì–†—ó –†—î –°‚Äû–†—ï–°–Ç–°—ì–†—ò–°—ì."}),e.jsx(Ce,{color:"#f59e0b",title:"Rules",children:"–†—ú–†—ï–†–Ü–†—ë–°‚Ä°–†—î–†—ë: –†–Ö–†¬µ–°‚Äö –°–É–°–É–°‚Äπ–†¬ª–†—ï–†—î/–†–Ü–†¬ª–†—ï–†¬∂–†¬µ–†–Ö–†—ë–†‚Ññ –†—ë –†—î–°—ì–†¬ª–†“ë–†¬∞–°—ì–†–Ö 30 –°–É–†¬µ–†—î."})]}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.45fr_.85fr]",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"SECTIONS"}),m.map(l=>e.jsxs(te,{to:`/forum/section/${l.id}`,className:"card flex items-center gap-3 px-4 py-3",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center rounded-xl border",style:{borderColor:"var(--border)",background:"var(--surface-2)"},children:e.jsx("span",{style:{fontSize:16},children:l.icon||"—Ä—ü‚Äô¬¨"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:l.title}),e.jsx("div",{className:"text-sm",style:{color:"var(--text-2)"},children:l.description})]}),e.jsxs("div",{className:"grid justify-items-end text-xs",style:{color:"var(--text-2)"},children:[e.jsxs("div",{children:[l.topicCount||0," threads"]}),e.jsxs("div",{children:[l.postCount||0," posts"]})]})]},l.id))]}),e.jsxs("aside",{className:"grid content-start gap-4",children:[e.jsx("div",{className:"card flex items-center justify-between px-3 py-2",children:e.jsx("div",{className:"text-xs uppercase tracking-[0.28em]",children:"LATEST POSTS"})}),j.map(({post:l,topic:p,author:b})=>e.jsx(te,{to:`/forum/topic/${(p==null?void 0:p.id)||""}`,className:"block card px-3 py-3",children:e.jsxs("div",{className:"relative pl-4",children:[e.jsx("span",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full",style:{background:p!=null&&p.pinned?"#a855f7":"#22d3ee"}}),e.jsx("div",{className:"font-semibold",children:(p==null?void 0:p.title)||"–†—û–†¬µ–†—ò–†¬∞"}),e.jsxs("div",{className:"text-xs",style:{color:"var(--text-2)"},children:["Latest: ",(b==null?void 0:b.username)||"user"," –≤–Ç—û"," ",new Date(l.createdAt).toLocaleString()]})]})},l.id))]})]}),e.jsxs("div",{className:"mt-8 card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(er,{})})]}),e.jsxs(Re,{children:[e.jsx(we,{path:"section/:id",element:e.jsx("div",{})}),e.jsx(we,{path:"topic/:id",element:e.jsx("div",{})})]})]})]})}export{lr as default};
