import{j as s}from"./index-Co1JD_1i.js";import{u as w,R as r,L as v}from"./react-vendor-DTkXckhQ.js";import{g as N}from"./authRemote-D9Q-aZvG.js";import{g as k,d as u,t as P,e as R,u as A,f as C}from"./forumRemote-BYvX5m8l.js";import{R as M,M as S}from"./ReactionBar-C7A0fKxK.js";import{s as h}from"./seo-CqyG8vOX.js";import{ab as T,Q as I}from"./icons-B96iOv9Z.js";import"./purify.es-DnfDK_hS.js";function F(){const{id:d=""}=w(),[i,p]=r.useState(null),[t,f]=r.useState(null),[y,c]=r.useState([]),[x,l]=r.useState(""),m=!!i&&(i.role==="developer"||i.role==="admin"||i.role==="moderator");r.useEffect(()=>{(async()=>{try{p(await N())}catch{}try{const e=await k(d);if(e){f(e);try{h(`${e.title} — Тема`,e.title)}catch{}}const a=await u(d);c(Array.isArray(a)?a:[])}catch{}})()},[d]);async function g(){const e=x.trim();if(!(!e||!i||!t||t.locked))try{const a=await R({topicId:t.id,content:e});c(n=>[...n,a]),l("")}catch{}}async function j(e){if(m)try{const a=await A(e.id,{pinned:!e.pinned});c(n=>n.map(o=>o.id===e.id?a:o))}catch{}}async function b(e){try{await C(e.id),c(a=>a.filter(n=>n.id!==e.id))}catch{}}return r.useEffect(()=>{if(t)try{const e={"@context":"https://schema.org","@type":"DiscussionForumPosting",headline:t.title,datePublished:t.createdAt,dateModified:t.updatedAt};h(void 0,t.title,e)}catch{}},[t==null?void 0:t.id]),s.jsx("main",{className:"min-h-screen",style:{background:"#0d0d12",color:"#f8fafc"},children:s.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsxs(v,{to:"/forum",className:"btn flex items-center gap-2",children:[s.jsx(T,{size:16})," Back"]}),s.jsx("div",{className:"text-sm opacity-70",children:"Topic"}),s.jsx("div",{className:"font-semibold truncate",children:(t==null?void 0:t.title)||"..."}),s.jsxs("div",{className:"ml-auto text-xs opacity-70",children:["Replies ",(t==null?void 0:t.replyCount)??0," • Views ",(t==null?void 0:t.viewCount)??0]})]}),s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"grid gap-3",children:[y.slice().sort((e,a)=>(a.pinned?1:0)-(e.pinned?1:0)||new Date(e.createdAt).getTime()-new Date(a.createdAt).getTime()).map(e=>s.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.04] p-3 text-sm",children:[e.pinned&&s.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:"Pinned"}),s.jsx("div",{className:"prose prose-invert max-w-none whitespace-pre-wrap",children:e.content}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsxs("button",{className:"btn text-xs",title:"Цитировать",onClick:()=>l(a=>a+`

> ${e.content}

`),children:[s.jsx(I,{size:14})," Quote"]}),s.jsxs("button",{className:"btn text-xs",onClick:async()=>{try{const a=await P(e.id);c(n=>n.map(o=>o.id===e.id?a:o))}catch{}},children:["❤️ ",(e.likes||[]).length]})]}),s.jsx(M,{postId:e.id,currentUserId:i==null?void 0:i.id,onPostUpdated:async()=>{try{const a=await u(d);c(Array.isArray(a)?a:[])}catch{}}}),(m||(i==null?void 0:i.id)===e.authorId)&&s.jsxs("div",{className:"mt-2 text-right",children:[m&&s.jsx("button",{className:"btn text-xs",onClick:()=>j(e),style:{marginRight:8},children:e.pinned?"Unpin":"Pin"}),s.jsx("button",{className:"btn text-xs",onClick:()=>b(e),children:"Delete"})]})]},e.id)),!(t!=null&&t.locked)&&i&&s.jsx(S,{value:x,onChange:l,onSubmit:()=>g(),placeholder:"Reply in Markdown...",submitLabel:"Send"}),(t==null?void 0:t.locked)&&s.jsx("div",{className:"text-xs opacity-70",children:"Topic is locked."})]})})]})})}export{F as default};
