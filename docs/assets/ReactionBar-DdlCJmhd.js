import{j as n}from"./index-Do0JvFGy.js";import{R as j}from"./react-vendor-DTkXckhQ.js";import{toggleLikePost as w}from"./forumRemote-D5s3MT8n.js";import{aj as x,ak as R,al as p,R as v,am as k}from"./icons-BBDfh7CG.js";const N="forum:",h=t=>`${N}post_reactions:${t}`,i=new Map,S={getItem:t=>i.has(t)?i.get(t):null,setItem:(t,e)=>void i.set(t,e),removeItem:t=>void i.delete(t)},g=(()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}return S})();function d(t,e){try{return t?JSON.parse(t):e}catch{return e}}function l(t){const e={counts:{like:0,smile:0,heart:0,laugh:0,rocket:0,eyes:0},byUser:{}};return d(g.getItem(h(t)),e)}function E(t,e){try{g.setItem(h(t),JSON.stringify(e))}catch{}try{window.dispatchEvent(new CustomEvent("forum:post-reactions",{detail:{postId:t}}))}catch{}}function M(t){return l(t)}function C(t,e){return l(t).byUser[e]}function L(t,e,o){const s=l(t),c=s.byUser[e];return c===o?(s.byUser[e]=void 0,s.counts[o]=Math.max(0,(s.counts[o]||0)-1)):(c&&(s.counts[c]=Math.max(0,(s.counts[c]||0)-1)),s.byUser[e]=o,s.counts[o]=(s.counts[o]||0)+1),E(t,s),s}function O({postId:t,currentUserId:e,onPostUpdated:o}){const[,s]=j.useReducer(a=>a+1,0),c=e?C(t,e):void 0,m=M(t),b=!e,r=({r:a,label:u,Icon:f})=>{var y;return n.jsxs("button",{className:`btn text-xs ${c===a?"btn-primary":""}`,onClick:()=>{e&&(L(t,e,a),s())},title:u,"aria-pressed":c===a,disabled:b,children:[f?n.jsx(f,{size:14}):u,(y=m.counts)!=null&&y[a]?n.jsx("span",{className:"opacity-80",children:m.counts[a]}):null]})};return n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsx("button",{className:"btn text-xs",onClick:async()=>{try{await w(t),o==null||o()}catch{}},title:"Like",children:n.jsx(x,{size:14})}),n.jsx(r,{r:"smile",label:":)",Icon:R}),n.jsx(r,{r:"heart",label:"❤",Icon:x}),n.jsx(r,{r:"laugh",label:"😄",Icon:p}),n.jsx(r,{r:"rocket",label:"🚀",Icon:v}),n.jsx(r,{r:"eyes",label:"👀",Icon:k})]})}export{O as R};
