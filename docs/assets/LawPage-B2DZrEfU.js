import{l as $,j as t,C as k}from"./index-SvquseAp.js";import{u as A,b as z,r as d,L as j}from"./react-vendor-DTkXckhQ.js";import{i as L,F as D,t as y}from"./FavStar-DA837_J-.js";import{d as C,p as F}from"./purify.es-DnfDK_hS.js";import{A as S,B,w as T,a as I}from"./icons-wEjUy8Cq.js";function M(m){const i=new DOMParser().parseFromString(m,"text/html");try{const a="/pravo/";i.querySelectorAll("img").forEach(r=>{const c=(r.getAttribute("src")||"").trim();if(/^(?:\/)?img\//.test(c)){const u=c.replace(/^\/+/,"");r.setAttribute("src",`${a}${u}`)}})}catch{}const e=Array.from(i.querySelectorAll("h2, h3, h4")),l=[],f=a=>a.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").trim().replace(/\s+/g,"-").slice(0,80),g=a=>{const r=a.trim(),c=r.match(/^\s*(ст\.?|статья)\s*(\d+(?:\.\d+)*)/i);if(c)return`\u0441\u0442\u0430\u0442\u044C\u044F-${c[2].replace(/\./g,"-")}`;const u=r.match(/^\s*(глава|раздел)\s*(\d+(?:\.\d+)*)/i);return u?`${u[1].toLowerCase()}-${u[2].replace(/\./g,"-")}`:f(r)};return e.forEach((a,r)=>{const c=a.textContent||"",u=g(c)||`h-${r+1}`;a.id=u;const b=a.tagName==="H2"?2:a.tagName==="H3"?3:4;l.push({id:u,text:c,level:b});const x=i.createElement("button");x.className="anchor-fav",x.setAttribute("data-id",u),x.setAttribute("data-title",c),x.setAttribute("title","\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0440\u0430\u0437\u0434\u0435\u043B \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435"),a.appendChild(x)}),{html:i.body.innerHTML,toc:l}}function v(m){return(m||"").toLowerCase().replace(/[«»"'\s]+/g," ").trim()}function q(m,i){let e=m.replace(/\r\n?/g,`
`);return e=e.replace(/^\s*#\s+(.+)\s*\n/,(l,f)=>v(f)===v(i)?"":l),e=e.replace(/^(?![#>])\s*(Глава\s+\d+[^\n]*)$/gim,"## $1"),e=e.replace(/^(?![#>])\s*(Раздел\s+\d+[^\n]*)$/gim,"## $1"),e=e.replace(/^(?![#>])\s*((?:Статья|Ст\.?|Ст)\s+\d+(?:\.\d+)?[^\n]*)$/gim,"### $1"),e=e.replace(/^(#{2,6})([^\s#])/gm,"$1 $2"),e=e.replace(/^\s*(\d+)\)\s+/gm,"$1. "),e}function V(){const{slug:m}=A(),i=z(),e=$.find(s=>s.slug===m),[l,f]=d.useState(""),[g,a]=d.useState([]),[r,c]=d.useState(""),u=d.useRef(null);if(d.useEffect(()=>{if(!e)return;const s=q(e.content,e.title),n=C.parse(s,{gfm:!0,breaks:!0}),p=F.sanitize(n,{USE_PROFILES:{html:!0}}),{html:o,toc:h}=M(p);f(o),a(h)},[m]),d.useEffect(()=>{const n=new URLSearchParams(i.search).get("q")||"";n&&c(n)},[i.search]),d.useEffect(()=>{const s=u.current;if(!s)return;s.querySelectorAll(".anchor-fav").forEach(p=>{const o=p.getAttribute("data-id")||"",h=`${(e==null?void 0:e.slug)||""}#${o}`;L("lawsec",h)&&p.classList.add("active")});function n(p){const o=p.target;if(o&&o.classList.contains("anchor-fav")){p.preventDefault();const h=o.getAttribute("data-id")||"",N=o.getAttribute("data-title")||"";if(!e)return;const E=`${e.slug}#${h}`,w=`${i.pathname}#${h}`;y("lawsec",E,{title:`${e.title} \u2014 ${N}`,url:w})?o.classList.add("active"):o.classList.remove("active")}}return s.addEventListener("click",n),()=>s.removeEventListener("click",n)},[u,l,e==null?void 0:e.slug]),!e)return t.jsxs("div",{className:"p-4",children:["\u0417\u0430\u043A\u043E\u043D \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D. ",t.jsx(j,{to:"/",className:"text-blue-600 underline",children:"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"})]});const b=d.useMemo(()=>{if(!r.trim()||!l)return l;const s=new RegExp(`(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return l.replace(s,"<mark>$1</mark>")},[r,l]);d.useEffect(()=>{if(!r.trim())return;const s=u.current;if(!s)return;const n=s.querySelector("mark");if(n)try{n.scrollIntoView({behavior:"smooth",block:"center"})}catch{n.scrollIntoView()}},[b,r]);const x=s=>s===2?"pl-0":s===3?"pl-3":"pl-6";return t.jsxs("div",{className:"min-h-screen text-zinc-900 dark:text-zinc-100",children:[t.jsx("header",{className:"sticky top-0 z-20 border-b border-zinc-200 bg-white/80 backdrop-blur dark:border-zinc-800 dark:bg-zinc-900/70",children:t.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between gap-3 px-4 py-3",children:[t.jsxs(j,{to:"/",className:"flex items-center gap-1 text-sm hover:underline",children:[t.jsx(S,{className:"h-4 w-4"})," \u041D\u0430\u0437\u0430\u0434"]}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(B,{className:"h-5 w-5"}),t.jsx("h1",{className:"text-lg font-bold leading-tight",children:e.title})]}),t.jsx(k,{})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{kind:"law",id:e.slug,title:e.title,url:`/laws/${e.slug}`}),t.jsx("div",{className:"text-xs text-zinc-500",children:e.updated?`\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u043E: ${e.updated}`:""})]})]})}),t.jsxs("main",{className:"mx-auto grid max-w-6xl grid-cols-1 gap-5 px-4 py-5 md:grid-cols-[260px,1fr]",children:[t.jsx("aside",{className:"hidden md:block",children:t.jsxs("div",{className:"sticky top-16 rounded-2xl border border-zinc-200 bg-white/70 p-3 text-sm dark:border-zinc-800 dark:bg-zinc-900/50",children:[t.jsxs("div",{className:"mb-2 flex items-center gap-2 font-semibold",children:[t.jsx(T,{className:"h-4 w-4"})," \u0421\u043E\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u0435"]}),g.length?t.jsx("ul",{className:"space-y-1",children:g.map(s=>t.jsx("li",{className:x(s.level),children:t.jsx("a",{className:"underline decoration-dotted hover:no-underline",href:`#${s.id}`,children:s.text})},s.id))}):t.jsx("div",{className:"text-xs text-zinc-500",children:"\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438 (##/###) \u0432 Markdown, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u044F\u0432\u0438\u043B\u043E\u0441\u044C \u043E\u0433\u043B\u0430\u0432\u043B\u0435\u043D\u0438\u0435."})]})}),t.jsxs("section",{children:[t.jsxs("nav",{className:"mb-3 text-xs text-zinc-500",children:[t.jsx(j,{to:"/",className:"underline decoration-dotted hover:no-underline",children:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F"}),t.jsx("span",{className:"mx-1",children:"/"}),t.jsx("span",{children:"\u0417\u0430\u043A\u043E\u043D\u044B"}),t.jsx("span",{className:"mx-1",children:"/"}),t.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:e.title})]}),t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx(I,{className:"h-4 w-4 text-zinc-500"}),t.jsx("input",{className:"w-full rounded-xl border px-3 py-1.5 text-sm focus:outline-none focus:ring",placeholder:"\u041F\u043E\u0434\u0441\u0432\u0435\u0442\u0438\u0442\u044C \u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u044F \u0432 \u0442\u0435\u043A\u0441\u0442\u0435",value:r,onChange:s=>c(s.target.value)})]}),t.jsx("div",{className:"reading",children:t.jsx("div",{className:"law prose prose-zinc max-w-none rounded-2xl border border-zinc-200 bg-white p-4 list-inside dark:prose-invert dark:border-zinc-800 dark:bg-zinc-900",ref:u,dangerouslySetInnerHTML:{__html:b}})})]})]})]})}export{V as default};
