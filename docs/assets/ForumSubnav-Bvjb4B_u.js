import{j as t}from"./index-Di8PRxAM.js";import{b as $,R as c,L as w}from"./react-vendor-DTkXckhQ.js";import{listSections as U}from"./forumRemote-D5s3MT8n.js";import{g as C,i as E,s as W}from"./feedPrefs-C1EDgGZi.js";import{ax as z,ac as M,U as R,aw as D}from"./icons-BBDfh7CG.js";const P="app:lang";function I(){try{const o=localStorage.getItem(P);if(o==="ru"||o==="en")return o}catch{}return"ru"}function r(o,a){return I()==="ru"?o:a}function Q(){const o=$(),[a,p]=c.useState(null);c.useEffect(()=>{let e=!0;return(async()=>{try{const s=(await U()||[]).find(i=>String(i.title||"").toLowerCase()==="workshop");e&&p((s==null?void 0:s.id)||null)}catch{e&&p(null)}})(),()=>{e=!1}},[]);const h=o.pathname.includes("/forum/members"),b=a?o.pathname.startsWith(`/forum/section/${a}`):!1,y=!h&&!b,u=new URLSearchParams(o.search||"").get("feed"),x=c.useMemo(()=>{try{return C()}catch{return"latest"}},[]),m=c.useMemo(()=>E(u)?u:x,[u,x]),d=({to:e,active:n,icon:s,children:i,disabled:N,title:k})=>N?t.jsxs("span",{className:`btn inline-flex items-center gap-2 ${n?"btn-primary":""} opacity-60 cursor-not-allowed`,title:k||"","aria-disabled":!0,children:[s," ",i]}):t.jsxs(w,{to:e,className:`btn inline-flex items-center gap-2 ${n?"btn-primary":""}`,title:k||"",children:[s," ",i]}),[j,f]=c.useState(!1);c.useEffect(()=>{const e=()=>f(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const g=[{key:"latest",label:r("Свежие","Latest")},{key:"hot",label:r("Топ","Hot")},{key:"new",label:r("Новые","New")},{key:"following",label:r("Подписки","Following")}],v=e=>{var n;return e==="questions"?r("Вопросы","Questions"):((n=g.find(s=>s.key===e))==null?void 0:n.label)||r("Лента","Feed")},l=(e,n)=>{const s=new URLSearchParams(o.search);n?s.set("feed",n):s.delete("feed");const i=s.toString();return`${e}${i?`?${i}`:""}`},F=l("/forum",m),L=l("/forum/members",null),S=a?l(`/forum/section/${a}`,null):"#";return t.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[t.jsx(d,{to:F,active:y,icon:t.jsx(z,{size:16}),children:r("Форум","Forums")}),t.jsx(d,{to:S,active:b,disabled:!a,icon:t.jsx(M,{size:16}),title:a?"":r("Раздел Workshop ещё не создан","Workshop section is not created yet"),children:r("Мастерская","Workshop")}),t.jsx(d,{to:L,active:h,icon:t.jsx(R,{size:16}),children:r("Участники","Members")}),t.jsxs("div",{className:"relative ml-auto",onClick:e=>e.stopPropagation(),"aria-label":r("Выбрать ленту","Choose feed"),children:[t.jsxs("button",{type:"button",className:"btn inline-flex items-center gap-2",onClick:()=>f(e=>!e),children:[t.jsx("span",{className:"truncate max-w-[10rem]",children:v(m)}),t.jsx(D,{size:16})]}),j&&t.jsx("div",{className:"absolute right-0 z-20 mt-2 min-w-40 rounded-xl border bg-background p-2 shadow-lg",children:g.map(e=>{const n=l("/forum",e.key),s=m===e.key;return t.jsx(w,{to:n,className:`block rounded-md px-3 py-2 text-sm hover:bg-muted ${s?"font-semibold":""}`,onClick:()=>{try{W(e.key)}catch{}f(!1)},children:e.label},String(e.key))})})]})]})}export{Q as F,r as t};
