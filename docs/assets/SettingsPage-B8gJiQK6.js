import{M as Te,N as Be,O as Pe,P as Ee,Q as Me,R as Oe,S as qe,T as De,U as Ge,V as M,j as e,W as Re,X as Ue,Y as _,Z as I,_ as se,$ as ae,a0 as He,a1 as Ke,a2 as O,a3 as Ve,a4 as Ye,a5 as ze,a6 as Qe,L as ne,a7 as We,a8 as Xe,a9 as Ze}from"./index-C62aR58o.js";import{R as i,L as Je}from"./react-vendor-DTkXckhQ.js";import{a as w}from"./asset-ZvONeEnI.js";import{g as et,s as tt}from"./feedPrefs-C1EDgGZi.js";import"./icons-ByfTEOcz.js";const ce="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";function st(l=16){const c=new Uint8Array(l);crypto.getRandomValues(c);let n="";for(let a=0;a<l;a++)n+=ce[c[a]%32];return n}function at(l){const c=l.replace(/=+$/,"").toUpperCase();let n=0,a=0,r=0;const g=new Uint8Array(Math.floor(c.length*5/8));for(let o=0;o<c.length;o++){const u=ce.indexOf(c[o]);u<0||(a=a<<5|u,n+=5,n>=8&&(g[r++]=a>>>n-8&255,n-=8))}return g}async function nt(l,c){const n=l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength),a=c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength),r=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-1"},!1,["sign"]);return crypto.subtle.sign("HMAC",r,a)}function ct(l){const c=new ArrayBuffer(8),n=new DataView(c),a=Math.floor(l/4294967296),r=l>>>0;return n.setUint32(0,a),n.setUint32(4,r),new Uint8Array(c)}async function lt(l,c=30,n=6,a=Date.now()){const r=at(l),g=Math.floor(a/1e3/c),o=new Uint8Array(await nt(r,ct(g))),u=o[o.length-1]&15,q=(o[u]&127)<<24|(o[u+1]&255)<<16|(o[u+2]&255)<<8|o[u+3]&255,T=10**n;return String(q%T).padStart(n,"0")}async function it(l,c,n=1,a=30,r=6){const g=Date.now();for(let o=-n;o<=n;o++)if(await lt(l,a,r,g+o*a*1e3)===c)return!0;return!1}const ot=Object.keys(We),S={bg1:w("img/bg1.png"),bg2:w("img/bg2.png"),bg3:w("img/bg3.png"),bg4:w("img/bg4.png"),bg5:w("img/bg5.png")};function pt(){const[l,c]=i.useState(()=>Te()??"indigo"),[n,a]=i.useState(()=>localStorage.getItem("accent_custom")||"#6366F1"),[r,g]=i.useState(()=>Be()??"classic"),[o,u]=i.useState(()=>Pe()),[q,T]=i.useState(()=>Ee()),[k,le]=i.useState(()=>Me()),[A,ie]=i.useState(()=>Oe()),[oe,re]=i.useState(()=>qe()),[D,de]=i.useState(()=>De()),[ge,G]=i.useState(()=>localStorage.getItem("forum:2fa_enabled")==="1"),[B,me]=i.useState(()=>localStorage.getItem("forum:2fa_secret")||""),[R,ue]=i.useState(""),[m,U]=i.useState(()=>localStorage.getItem("bg_preset")||"none"),[f,H]=i.useState(()=>Number(localStorage.getItem("bg_overlay")||.35)),[j,K]=i.useState(()=>localStorage.getItem("bg_fixed")!=="0"),[N,V]=i.useState(()=>localStorage.getItem("bg_smart")!=="0"),d=r==="liquid",[Y,he]=i.useState(()=>Ge()),h=document.documentElement;i.useEffect(()=>{d||(m==="none"?y(void 0):y(S[m],j,f,N))},[m,f,j,N,d]),i.useEffect(()=>{d&&y(void 0)},[d]);const z=t=>{h.classList.remove("ui-shadow-none","ui-shadow-soft","ui-shadow-strong"),h.classList.add(`ui-shadow-${t}`)},Q=t=>{h.classList.remove("ui-radius-subtle","ui-radius-standard","ui-radius-rounded"),h.classList.add(`ui-radius-${t}`)},W=t=>{h.classList.add("has-glass"),h.style.setProperty("--glass-blur",`${t}px`)},X=t=>{const s=M[t];s!=null&&s[500]&&(s!=null&&s[600])&&(h.style.setProperty("--accent-500",s[500]),h.style.setProperty("--accent-600",s[600]))};i.useEffect(()=>{z(k),Q(A),W(oe),X(l)},[]);const xe=()=>{const t=st(20);me(t);try{localStorage.setItem("forum:2fa_secret",t)}catch{}},pe=async()=>{try{if(!await it(B,R.trim())){alert("Неверный код");return}G(!0),localStorage.setItem("forum:2fa_enabled","1"),alert("2FA включена")}catch{alert("Ошибка проверки 2FA")}},be=()=>{G(!1);try{localStorage.removeItem("forum:2fa_enabled")}catch{}},ye=()=>{try{localStorage.removeItem("theme"),I(se()?"dark":"light")}catch{}},fe=()=>{try{I("light")}catch{}},je=()=>{try{I("dark")}catch{}},Z=t=>{g(t);try{ae(t)}catch{}},J=t=>{de(t);try{He(t)}catch{}},ee=t=>{he(t);try{Ke(t)}catch{}},Ne=t=>{c(t);try{O(t)}catch{}X(t)},P=t=>{a(t);try{Ve(t),O(l)}catch{}h.style.setProperty("--accent-500",t),h.style.setProperty("--accent-600",t)},te=t=>{U(t);try{localStorage.setItem("bg_preset",t)}catch{}d||(t==="none"?y(void 0):y(S[t],j,f,N))},ve=t=>{const s=Math.max(0,Math.min(.85,t));H(s);try{localStorage.setItem("bg_overlay",String(s))}catch{}!d&&m!=="none"&&y(S[m],j,s,N)},_e=t=>{K(t);try{localStorage.setItem("bg_fixed",t?"1":"0")}catch{}!d&&m!=="none"&&y(S[m],t,f,N)},Se=t=>{V(t);try{localStorage.setItem("bg_smart",t?"1":"0")}catch{}!d&&m!=="none"&&y(S[m],j,f,t)},E=t=>{u(t);try{Ye(t)}catch{}},ke=t=>{T(t);try{Xe(t)}catch{}},$=t=>{le(t);try{ze(t)}catch{}z(t)},F=t=>{ie(t);try{Qe(t)}catch{}Q(t)},Ce=t=>{re(t);try{Ze(t)}catch{}W(t)},we=()=>{["bg_preset","bg_overlay","bg_fixed","bg_smart","accent_custom"].forEach(t=>localStorage.removeItem(t));try{I(se()?"dark":"light")}catch{}try{O("indigo")}catch{}c("indigo"),a("#6366F1"),g("classic");try{ae("classic")}catch{}U("none"),H(.35),K(!0),V(!0),E("standard"),ke(1),$("soft"),F("standard"),Ce(8)},Ae=i.useMemo(()=>Object.keys(M),[]);function $e(){document.documentElement.style.setProperty("background-color","transparent","important"),document.body.style.setProperty("background-color","transparent","important")}const Fe=()=>typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);function Le(t,s){const b=Math.max(0,Math.min(.85,t));if(!s)return`linear-gradient(rgba(0,0,0,${b}), rgba(0,0,0,${b}))`;const v=Math.max(0,b-.15),x=Math.min(.95,b+.15);return`radial-gradient(1200px 900px at 50% -10%, rgba(0,0,0,${v}) 0%, rgba(0,0,0,${b}) 55%, rgba(0,0,0,${x}) 100%)`}function y(t,s=!0,b=.35,v=!0){$e();const x=document.body;if(!t){x.style.setProperty("background","transparent","important"),x.style.removeProperty("background-size"),x.style.removeProperty("background-repeat"),x.style.removeProperty("background-attachment"),x.style.removeProperty("background-position");return}const L=Le(b,v),C=s&&!Fe()?"fixed":"scroll";x.style.setProperty("background",`${L}, url("${t}") center / cover no-repeat ${C}`,"important")}const Ie=({children:t,className:s})=>d?e.jsx(ne,{blur:30,gloss:.88,opacity:.2,tint:"16 18 34",elevation:1.3,interactive:!1,animate:!0,className:`settings-hero ${s??""}`,children:t}):e.jsx("section",{className:`card settings-hero settings-hero--classic ${s??""}`,children:t}),p=({title:t,desc:s,tone:b="light",className:v,children:x})=>{const L=e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-tight text-[color:var(--text-1)]",children:t}),s&&e.jsx("p",{className:"text-sm text-[color:var(--text-2)]",children:s})]}),e.jsx("div",{className:"flex flex-col gap-4",children:x})]});if(d){const C=b==="accent"?{tint:"32 48 98",opacity:.28,gloss:.86}:{tint:"16 18 36",opacity:.18,gloss:.78};return e.jsx(ne,{blur:26,gloss:C.gloss,tint:C.tint,opacity:C.opacity,elevation:1.2,animate:!0,className:`settings-panel ${v??""}`,children:L})}return e.jsx("section",{className:`card settings-panel settings-panel--classic ${v??""}`,children:L})};return e.jsx("div",{className:`settings-shell ${d?"settings-shell--liquid":""}`,children:e.jsxs("div",{className:"settings-shell__inner",children:[e.jsxs("header",{className:"settings-breadcrumb",children:[e.jsx(Je,{to:"/",className:"settings-breadcrumb__link",children:"Главная"}),e.jsx("span",{className:"settings-breadcrumb__separator",children:"/"}),e.jsx("span",{children:"Настройки"})]}),e.jsx(Ie,{children:e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"settings-hero__badge",children:"Центр персонализации"}),e.jsx("h1",{className:"settings-hero__title",children:"Подберите настроение интерфейса"}),e.jsx("p",{className:"settings-hero__subtitle",children:"Управляйте темой, жидким стеклом, шрифтами и визуальными эффектами. Все изменения применяются мгновенно."})]}),e.jsxs("div",{className:"settings-hero__stats",children:[e.jsxs("div",{children:[e.jsx("span",{className:"settings-hero__stats-label",children:"Жидкое стекло"}),e.jsx("span",{className:"settings-hero__stats-value",children:d?"Активно":"Выключено"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"settings-hero__stats-label",children:"Плотность"}),e.jsx("span",{className:"settings-hero__stats-value",children:o==="compact"?"Компактная":"Стандартная"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"settings-hero__stats-label",children:"Тема"}),e.jsx("span",{className:"settings-hero__stats-value",children:document.documentElement.classList.contains("dark")?"Тёмная":"Светлая"})]})]})]})}),e.jsxs("main",{className:"settings-grid",children:[e.jsxs(p,{title:"Тема и стиль",desc:"Переключайтесь между системной, светлой и тёмной темой, а также выбирайте стиль оформления и тон Liquid.",tone:"accent",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"settings-label",children:"Тема интерфейса"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:"settings-seg__item",onClick:ye,children:"Системная"}),e.jsx("button",{type:"button",className:"settings-seg__item",onClick:fe,children:"Светлая"}),e.jsx("button",{type:"button",className:"settings-seg__item",onClick:je,children:"Тёмная"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"settings-label",children:"Стиль оформления"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${r==="classic"?"is-active":""}`,onClick:()=>Z("classic"),children:"Classic"}),e.jsx("button",{type:"button",className:`settings-seg__item ${r==="liquid"?"is-active":""}`,onClick:()=>Z("liquid"),children:"Liquid Glass"})]}),e.jsx("p",{className:"settings-help",children:"Liquid Glass — глубина и мягкий свет."}),d&&e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx("span",{className:"settings-label",children:"Тон Liquid"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${Y==="dark"?"is-active":""}`,onClick:()=>ee("dark"),children:"Тёмный"}),e.jsx("button",{type:"button",className:`settings-seg__item ${Y==="light"?"is-active":""}`,onClick:()=>ee("light"),children:"Светлый"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx("span",{className:"settings-label",children:"Анимации Liquid"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${D?"is-active":""}`,onClick:()=>J(!0),children:"Включены"}),e.jsx("button",{type:"button",className:`settings-seg__item ${D?"":"is-active"}`,onClick:()=>J(!1),children:"Отключены"})]}),e.jsx("p",{className:"settings-help",children:"Отключает плавучесть и блики стекла."})]})]})]}),e.jsxs(p,{title:"Безопасность",desc:"Антиспам и двухфакторная защита (клиентская)",children:[e.jsxs("div",{className:"settings-field",children:[e.jsx("span",{className:"settings-label",children:"Двухфакторная аутентификация"}),ge?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"2FA включена"}),e.jsx("button",{type:"button",className:"btn",onClick:be,children:"Выключить"})]}):e.jsxs("div",{className:"grid gap-2",children:[e.jsx("button",{type:"button",className:"btn",onClick:xe,children:"Сгенерировать секрет"}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs opacity-80",children:"Секрет (введите в приложение-аутентификатор):"}),e.jsx("div",{className:"rounded-xl bg-white/5 p-2 text-sm select-all",children:B}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Код из приложения",value:R,onChange:t=>ue(t.target.value)}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:pe,children:"Подтвердить"})]})]})]})]}),e.jsxs("div",{className:"settings-field",children:[e.jsx("span",{className:"settings-label",children:"Отключить трекинг"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:"settings-seg__item",onClick:()=>{try{localStorage.setItem("telemetry_disabled","1"),alert("Трекинг отключён")}catch{}},children:"Отключить"}),e.jsx("button",{type:"button",className:"settings-seg__item",onClick:()=>{try{localStorage.removeItem("telemetry_disabled"),alert("Трекинг включён")}catch{}},children:"Включить"})]})]})]}),e.jsxs(p,{title:"Чебзик",desc:"Летает по сайту и подсказывает. Можно отключить при желании.",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:(()=>{try{return Ue()}catch{return!0}})(),onChange:t=>{try{Re(t.target.checked)}catch{}}}),"Показывать Чебзика"]}),e.jsx("span",{className:"text-sm text-[color:var(--text-2)]",children:"Можно отключить. Цвет синхронизируется со скином из игры."})]}),e.jsxs("div",{className:"mt-3 grid items-center gap-3 sm:grid-cols-[auto_auto_1fr]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Цвет A"}),e.jsx("input",{type:"color",value:_().a,disabled:!0,readOnly:!0,title:"Цвет управляется сценой Чебзика"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Цвет B"}),e.jsx("input",{type:"color",value:_().b,disabled:!0,readOnly:!0,title:"Цвет управляется сценой Чебзика"})]}),e.jsx("div",{className:"justify-self-start rounded-xl p-2",style:{background:`linear-gradient(135deg, ${_().a}, ${_().b})`},children:e.jsxs("svg",{width:"36",height:"36",viewBox:"0 0 36 36",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("radialGradient",{id:"g2",cx:"50%",cy:"30%",r:"70%",children:[e.jsx("stop",{offset:"0%",stopColor:_().a,stopOpacity:"0.95"}),e.jsx("stop",{offset:"100%",stopColor:_().b,stopOpacity:"0.85"})]})}),e.jsx("path",{d:"M18 2c6.2 0 11 4.8 11 11v8.5c0 2-1.7 3.7-3.7 3.7-1.3 0-2.6-.7-3.3-1.8-.6 1.1-1.8 1.8-3 1.8s-2.4-.7-3-1.8c-.7 1.1-2 1.8-3.3 1.8-2 0-3.7-1.7-3.7-3.7V13C5 6.8 10 2 16.2 2H18z",fill:"url(#g2)"})]})})]})]}),e.jsxs(p,{title:"Геометрия и эффекты",desc:"Настройте плотность интерфейса, радиусы элементов и глубину стекла.",children:[e.jsxs("div",{className:"settings-field",children:[e.jsx("span",{className:"settings-label",children:"Плотность элементов"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${o==="standard"?"is-active":""}`,onClick:()=>E("standard"),children:"Стандартная"}),e.jsx("button",{type:"button",className:`settings-seg__item ${o==="compact"?"is-active":""}`,onClick:()=>E("compact"),children:"Компактная"})]})]}),e.jsxs("div",{className:"settings-field",children:[e.jsx("span",{className:"settings-label",children:"Силуэт и тени"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${k==="none"?"is-active":""}`,onClick:()=>$("none"),children:"Без тени"}),e.jsx("button",{type:"button",className:`settings-seg__item ${k==="soft"?"is-active":""}`,onClick:()=>$("soft"),children:"Мягкие"}),e.jsx("button",{type:"button",className:`settings-seg__item ${k==="strong"?"is-active":""}`,onClick:()=>$("strong"),children:"Выразительные"})]})]}),e.jsxs("div",{className:"settings-field",children:[e.jsx("span",{className:"settings-label",children:"Скругление"}),e.jsxs("div",{className:"settings-seg",children:[e.jsx("button",{type:"button",className:`settings-seg__item ${A==="subtle"?"is-active":""}`,onClick:()=>F("subtle"),children:"Сдержанное"}),e.jsx("button",{type:"button",className:`settings-seg__item ${A==="standard"?"is-active":""}`,onClick:()=>F("standard"),children:"Стандартное"}),e.jsx("button",{type:"button",className:`settings-seg__item ${A==="rounded"?"is-active":""}`,onClick:()=>F("rounded"),children:"Закруглённое"})]})]})]}),e.jsxs(p,{title:"Цвет акцента",desc:"Выберите основной цвет акцента для кнопок и ссылок.",children:[e.jsx("div",{className:"accent-grid",children:Ae.map(t=>{const s=M[t];return e.jsx("button",{className:`accent-swatch ${l===t?"is-active":""}`,style:{"--sw1":s==null?void 0:s[500],"--sw2":s==null?void 0:s[600]},title:t,onClick:()=>Ne(t)},t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"color",value:n,onChange:t=>P(t.target.value),className:"input w-24",title:"Пользовательский акцент"}),e.jsx("input",{type:"text",value:n,onChange:t=>P(t.target.value),className:"input w-40",placeholder:"#RRGGBB"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>P(n),children:"Применить"})]})]}),e.jsxs(p,{title:"Фон и обои",desc:"Настройте фон для классического стиля. В режиме Liquid фон не изменяется.",children:[d&&e.jsx("p",{className:"settings-help",children:"В режиме Liquid Glass фон берётся из темы/настроек пользователя."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:[e.jsx("button",{type:"button",onClick:()=>te("none"),className:`settings-bg-tile ${m==="none"?"is-active":""}`,children:e.jsx("span",{children:"Без фона"})}),ot.map(t=>e.jsx("button",{type:"button",title:t.toUpperCase(),onClick:()=>te(t),className:`settings-bg-tile ${m===t?"is-active":""}`,style:{backgroundImage:`url("${S[t]}")`}},t))]}),!d&&e.jsxs("div",{className:"settings-bg-controls",children:[e.jsxs("div",{children:[e.jsx("span",{className:"settings-label",children:"Интенсивность затемнения"}),e.jsx("input",{type:"range",min:0,max:.85,step:.05,value:f,onChange:t=>ve(parseFloat(t.target.value)),className:"slider"})]}),e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>_e(t.target.checked)})," Фиксированный фон"]}),e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:t=>Se(t.target.checked)})," Умное затемнение"]})]})]}),e.jsx(p,{title:"Сброс",desc:"Сбросить настройки темы и интерфейса к значениям по умолчанию.",children:e.jsx("button",{type:"button",onClick:we,className:"btn btn-primary",children:"Сбросить персонализацию"})}),e.jsx(p,{title:"Чебзик",desc:"Мини-игра с нашим мультяшным другом. Кормите его и общайтесь!",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("span",{className:"text-sm text-[color:var(--text-2)]",children:"Игра открывается на отдельной странице."})})}),e.jsx(p,{title:"Лента форума",desc:"Выберите ленту по умолчанию для /forum.",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(dt,{})})})]})]})})}const rt=[{id:"latest",label:"свежее",title:"Свежие обсуждения по активности"},{id:"hot",label:"горячее",title:"Темы с наибольшим откликом"},{id:"new",label:"новые темы",title:"Самые свежие публикации"},{id:"following",label:"подписки",title:"Обновления от тех, на кого вы подписаны"},{id:"questions",label:"вопросы",title:"При входе будет открываться страница вопросов"}];function dt(){const[l,c]=i.useState(()=>{try{return et()}catch{return"latest"}}),n=a=>{c(a),tt(a)};return e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:rt.map(({id:a,label:r,title:g})=>e.jsx("button",{type:"button",className:`tab ${l===a?"tab-active":""}`,onClick:()=>n(a),title:g,children:r},a))})}export{pt as default};
