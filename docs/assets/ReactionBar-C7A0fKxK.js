import{j as t}from"./index-Co1JD_1i.js";import{R as j}from"./react-vendor-DTkXckhQ.js";import{p as M,d as $}from"./purify.es-DnfDK_hS.js";import{ah as _,ai as B,a3 as O,aj as N,ak as P,Q as A,al as Q,am as V,an as C,ao as v,ap as T,aq as q,R as F}from"./icons-B96iOv9Z.js";import{t as H}from"./forumRemote-BYvX5m8l.js";function st({value:e,onChange:n,onSubmit:a,placeholder:o,disabled:r,submitLabel:d="Send"}){const[b,l]=j.useState("write");function s(i,u=""){const c=x.current;if(!c)return;const m=c.selectionStart||0,p=c.selectionEnd||0,g=e,k=g.slice(m,p),I=i+k+u,E=g.slice(0,m)+I+g.slice(p);n(E),requestAnimationFrame(()=>{try{c.focus(),c.selectionStart=c.selectionEnd=m+i.length+k.length}catch{}})}const x=j.useRef(null);function f(i){var m;const u=(m=i.target.files)==null?void 0:m[0];if(!u)return;const c=new FileReader;c.onload=()=>{const p=String(c.result||"");s(`

![image](${p})

`)},c.readAsDataURL(u)}function h(){const i=prompt("Video URL (YouTube/Vimeo/direct)");if(i){if(/youtu\.be\/.+|youtube\.com\/watch\?v=/.test(i)){const u=i.match(/(?:v=|youtu\.be\/)([A-Za-z0-9_-]{6,})/),c=u==null?void 0:u[1];if(c){s(`

<iframe width="560" height="315" src="https://www.youtube.com/embed/${c}" frameborder="0" allowfullscreen></iframe>

`);return}}s(`

${i}

`)}}function S(){s(`

> [poll]
> Question?
> - Option A
> - Option B
> - Option C

`)}const L=j.useMemo(()=>{try{return M.sanitize($.parse(e||""))}catch{return""}},[e]);return t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2",children:[t.jsx("button",{type:"button",className:"btn",onClick:()=>s("**","**"),title:"Bold",children:t.jsx(_,{size:14})}),t.jsx("button",{type:"button",className:"btn",onClick:()=>s("_","_"),title:"Italic",children:t.jsx(B,{size:14})}),t.jsx("button",{type:"button",className:"btn",onClick:()=>s("[text](",")"),title:"Link",children:t.jsx(O,{size:14})}),t.jsx("button",{type:"button",className:"btn",onClick:()=>s("`","`"),title:"Inline code",children:t.jsx(N,{size:14})}),t.jsxs("button",{type:"button",className:"btn",onClick:()=>s("\n\n````\n","\n````\n"),title:"Code block",children:[t.jsx(N,{size:14})," ",t.jsx("span",{className:"ml-1",children:"{}"})]}),t.jsx("button",{type:"button",className:"btn",onClick:()=>s(`

- `),title:"List",children:t.jsx(P,{size:14})}),t.jsx("button",{type:"button",className:"btn",onClick:()=>s(`

> `),title:"Quote",children:t.jsx(A,{size:14})}),t.jsxs("label",{className:"btn",title:"Insert image",children:[t.jsx(Q,{size:14}),t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:f})]}),t.jsx("button",{type:"button",className:"btn",onClick:h,title:"Insert video",children:t.jsx(V,{size:14})}),t.jsx("button",{type:"button",className:"btn",onClick:S,title:"Insert poll",children:"Poll"}),t.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[t.jsx("button",{type:"button",className:`tab ${b==="write"?"tab-active":""}`,onClick:()=>l("write"),children:"Write"}),t.jsxs("button",{type:"button",className:`tab ${b==="preview"?"tab-active":""}`,onClick:()=>l("preview"),children:[t.jsx(C,{size:14})," Preview"]})]})]}),b==="write"?t.jsx("textarea",{ref:x,className:"input min-h-[120px]",placeholder:o||"Write in Markdown...",value:e,onChange:i=>n(i.target.value),disabled:r}):t.jsx("div",{className:"prose prose-invert max-w-none rounded-lg border p-3",style:{borderColor:"var(--border)",background:"var(--surface-2)"},dangerouslySetInnerHTML:{__html:L}}),a&&t.jsx("div",{className:"mt-2 flex justify-end",children:t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{const i=e.trim();i&&a(i)},disabled:r,children:d})})]})}const J="forum:",R=e=>`${J}post_reactions:${e}`,y=new Map,W={getItem:e=>y.has(e)?y.get(e):null,setItem:(e,n)=>void y.set(e,n),removeItem:e=>void y.delete(e)},z=(()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}return W})();function Y(e,n){try{return e?JSON.parse(e):n}catch{return n}}function w(e){const n={counts:{like:0,smile:0,heart:0,laugh:0,rocket:0,eyes:0},byUser:{}};return Y(z.getItem(R(e)),n)}function D(e,n){try{z.setItem(R(e),JSON.stringify(n))}catch{}try{window.dispatchEvent(new CustomEvent("forum:post-reactions",{detail:{postId:e}}))}catch{}}function K(e){return w(e)}function Z(e,n){return w(e).byUser[n]}function G(e,n,a){const o=w(e),r=o.byUser[n];return r===a?(o.byUser[n]=void 0,o.counts[a]=Math.max(0,(o.counts[a]||0)-1)):(r&&(o.counts[r]=Math.max(0,(o.counts[r]||0)-1)),o.byUser[n]=a,o.counts[a]=(o.counts[a]||0)+1),D(e,o),o}function ot({postId:e,currentUserId:n,onPostUpdated:a}){const[,o]=j.useReducer(s=>s+1,0),r=n?Z(e,n):void 0,d=K(e),b=!n,l=({r:s,label:x,Icon:f})=>{var h;return t.jsxs("button",{className:`btn text-xs ${r===s?"btn-primary":""}`,onClick:()=>{n&&(G(e,n,s),o())},title:x,"aria-pressed":r===s,disabled:b,children:[f?t.jsx(f,{size:14}):x,(h=d.counts)!=null&&h[s]?t.jsx("span",{className:"opacity-80",children:d.counts[s]}):null]})};return t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[t.jsx("button",{className:"btn text-xs",onClick:async()=>{try{await H(e),a==null||a()}catch{}},title:"Like",children:t.jsx(v,{size:14})}),t.jsx(l,{r:"smile",label:":)",Icon:T}),t.jsx(l,{r:"heart",label:"❤",Icon:v}),t.jsx(l,{r:"laugh",label:"😄",Icon:q}),t.jsx(l,{r:"rocket",label:"🚀",Icon:F}),t.jsx(l,{r:"eyes",label:"👀",Icon:C})]})}export{st as M,ot as R};
