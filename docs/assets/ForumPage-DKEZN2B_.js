import{c as ue,j as e,e as Pe}from"./index-CYg9GIeh.js";import{R as a,L as O}from"./react-vendor-DTkXckhQ.js";import{listSections as Le,listTopics as $e,listPosts as _e,listLatestPosts as Ke}from"./forumRemote-DZSWY5Uv.js";import{F as Fe}from"./ForumSubnav-cIzFuliw.js";import{a as We,$ as Ue,a0 as Be,a1 as Je,S as Ye}from"./icons-zK4tVMYI.js";const oe=800,Ee=["–°–∫–∞–π-–°—Ç—Ä–∞–∂","–ü—Ä–∞–≤–æ-–°–∞–º—É—Ä–∞–π","–ü—É–ª—å—Å-–†–µ–π–¥–µ—Ä","–ö–∏–±–µ—Ä-–ú–µ–¥–∏–∫","–ù–µ–æ–Ω-–¢–∞–∫—Ç–∏–∫","–ê—Å—Ç—Ä–∞–ª-–û—Ñ–∏—Ü–µ—Ä","–§–∞–Ω—Ç–æ–º-–õ–µ—á–∞—â–∏–π","–®–∏—Ñ—Ä-–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä","–ö–≤–∞–Ω—Ç-–ë–æ–µ—Ü","–ü–∏–∫—Å–µ–ª—å-–í–æ–ª–∫","–¢—É–º–∞–Ω-–ö–æ–º–∞–Ω–¥–æ—Ä","–ò—Å–∫—Ä–∞-–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å","–ù—É–ª—å-–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–ü–æ–ª—è—Ä–Ω—ã–π –ü–∏–ª–æ—Ç","–ì–æ—Ä–æ–¥—Å–∫–æ–π –•–∏—Ä—É—Ä–≥","–°—ã–≤–æ—Ä–æ—Ç–∫–∞-Vibe","–°—Ç–µ—Ä–∏–ª—å–Ω—ã–π –ù–∏–Ω–¥–∑—è","–°–∫–∞–ª—å–ø–µ–ª—å-–û–±–ª–∞–∫–æ","–†–µ–Ω—Ç–≥–µ–Ω-–ü–∞–Ω–∫","–í–∞—Ç–∫–∞-Supreme"];function te(){const o=Ee[Math.floor(Math.random()*Ee.length)],d=Math.floor(Math.random()*900+100);return`${o} ${d}`}function He(o){try{return typeof o=="string"?JSON.parse(o):(typeof Blob<"u"&&o instanceof Blob,null)}catch{return null}}function Ce(o){return new Date(o).toLocaleTimeString(void 0,{hour12:!1})}function qe(o){return o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function Xe(o){if(!o)return null;const d=o.trim();return d?`@${qe(d).replace(/\s+/g,"\\s+")}(?=\\b|$)`:null}function Ae(o,d){if(!d)return!1;try{return new RegExp(d,"iu").test(o)}catch{return!1}}function Me(o,d){if(!d)return o;try{const z=new RegExp(d,"giu"),k=[];let j=0,L=0,C;for(;(C=z.exec(o))!==null;)C.index>j&&k.push(e.jsx(a.Fragment,{children:o.slice(j,C.index)},`text-${L++}`)),k.push(e.jsx("span",{className:"rc-ping",children:C[0]},`mention-${L++}`)),j=z.lastIndex;return j<o.length&&k.push(e.jsx(a.Fragment,{children:o.slice(j)},`text-${L++}`)),k.length?k:o}catch{return o}}const ce=["üòÄ","üòÅ","üòÇ","ü§£","üòÖ","üòé","üòç","üòò","üòá","ü§ù","üëå","üëç","üî•","üíØ","‚ú®","‚ö°","üéØ","üöÄ","üõ°Ô∏è","üèÜ","üí¨","üìù","üìå","üì£","üóÇÔ∏è","üß†","üìà","üïí","üõ†Ô∏è","üîí","‚úÖ","‚ùó","‚ö†Ô∏è","‚ùì","üéâ","ü•≥","üôå","ü§ò","ü§ñ","üëÄ","üí°","üß≠","üì¶","üõéÔ∏è","üì°","üõ∞Ô∏è","üß™","üìï","üß∑","ü™™","üß∞","üß±","üõ∞","üóÉÔ∏è"],Ve=String.raw`
.rc-wrap{border:1px solid var(--border);background:var(--surface);border-radius:var(--radius-2xl);overflow:hidden;font:13px/1.4 Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;box-shadow:var(--card-shadow);color:var(--text-1);}
.rc-head{padding:12px 16px;background:var(--bg-2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:16px;position:relative;}
.rc-head-title{font-weight:600;font-size:14px;letter-spacing:.08em;text-transform:uppercase;}
.rc-head-meta{display:flex;align-items:center;gap:12px;}
.rc-presence,.rc-presence-btn{display:flex;align-items:center;gap:8px;font-size:12px;letter-spacing:.04em;}
.rc-presence{color:var(--text-2);}
.rc-presence-dot{width:10px;height:10px;border-radius:999px;background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.3);transition:all .25s ease;}
.rc-presence-dot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.35);}
.rc-presence-count{display:flex;align-items:baseline;gap:4px;font-weight:600;color:var(--text-1);}
.rc-presence-count span{font-size:11px;font-weight:500;color:var(--text-2);text-transform:uppercase;}
.rc-presence-btn{border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:var(--surface-2);color:var(--text-1);cursor:pointer;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease,color .2s ease;}
.rc-presence-btn:hover,.rc-presence-btn:focus-visible{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);outline:none;}
.rc-presence-btn.open{background:var(--surface);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-role-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;background:var(--surface-2);color:var(--accent);border:1px solid var(--accent);}
.rc-presence-panel{position:absolute;top:calc(100% + 12px);right:0;width:min(260px,80vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:14px 16px;box-shadow:var(--card-shadow);z-index:40;}
.rc-presence-title{font-size:12px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--text-2);}
.rc-presence-panel ul{margin:10px 0 0 0;padding:0;list-style:none;max-height:220px;overflow:auto;}
.rc-presence-panel li{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-top:1px solid var(--border);}
.rc-presence-panel li:first-child{border-top:none;padding-top:0;}
.rc-presence-panel li:last-child{padding-bottom:0;}
.rc-presence-panel li.self{color:var(--accent);font-weight:600;}
.rc-presence-dot-sm{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.35);}
.rc-presence-you{margin-left:auto;font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-2);}
.rc-presence-empty{font-size:12px;color:var(--text-2);margin-top:8px;}
.rc-list{height:280px;overflow:auto;background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.rc-list ul{list-style:none;margin:0;padding:0;}
.rc-list li{padding:6px 12px;white-space:pre-wrap;word-break:break-word;display:flex;flex-wrap:wrap;align-items:flex-start;gap:4px;}
.rc-list li+li{border-top:1px solid var(--border);}
.rc-list li.rc-mention{background:var(--surface-2);box-shadow:inset 0 0 0 1px var(--accent);border-left:3px solid var(--accent);}
.rc-ping{display:inline-block;background:var(--accent);color:#fff;border-radius:6px;padding:0 4px;margin:0 1px;font-weight:700;letter-spacing:.02em;}
.rc-ts{color:var(--text-2);margin-right:6px;}
.rc-me{color:#16a34a;font-weight:600;}
.rc-other{color:var(--text-1);font-weight:600;}
.rc-admin{color:var(--accent);font-weight:700;}
.rc-actions{display:flex;gap:4px;margin-left:auto;}
.rc-ax{font-size:11px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-1);border-radius:6px;padding:2px 6px;cursor:pointer;}
.rc-ax:hover{background:var(--surface);}
.rc-empty{opacity:.7;padding:12px;color:var(--text-2);}
.rc-form{display:flex;gap:8px;padding:10px 12px;background:var(--bg-2);position:relative;align-items:center;}
.rc-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.rc-input:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.25);}
.rc-emoji-btn{width:38px;height:38px;border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);color:var(--text-1);display:grid;place-items:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .2s ease,color .2s ease;}
.rc-emoji-btn:hover{background:var(--surface-2);}
.rc-emoji-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-btn.open{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-btn{background:var(--accent);border:none;color:#fff;border-radius:var(--radius-lg);padding:0 18px;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease;}
.rc-btn:hover{opacity:.92;}
.rc-btn:active{transform:scale(.98);}
.rc-btn:disabled{opacity:.6;cursor:not-allowed;}
.rc-emoji-panel{position:absolute;bottom:56px;right:12px;width:min(320px,90vw);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--card-shadow);padding:12px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.rc-emoji-title{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-2);font-weight:600;}
.rc-emoji-grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:6px;}
.rc-emoji-item{height:36px;border-radius:10px;border:1px solid transparent;background:var(--surface-2);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .2s ease,border-color .2s ease,transform .15s ease;}
.rc-emoji-item:hover{background:var(--surface);border-color:var(--accent);transform:translateY(-1px);}
.rc-emoji-item:focus-visible{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(59,130,246,.2);}
.rc-emoji-empty{font-size:12px;color:var(--text-2);text-align:center;padding:10px 0;}
.nick-back{position:fixed;inset:0;background:rgba(15,15,18,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.nick-card{width:min(92vw,520px);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-2xl);padding:18px;color:var(--text-1);box-shadow:var(--card-shadow);}
.nick-row{display:flex;gap:8px;margin-top:12px;}
.nick-input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text-1);border-radius:var(--radius-lg);padding:8px 10px;}
.nick-btn{background:var(--accent);border:1px solid var(--accent-600,var(--accent));color:#fff;border-radius:var(--radius-lg);padding:8px 12px;cursor:pointer;font-weight:600;}
.nick-btn:hover{background:var(--accent-600,var(--accent));}
.nick-pill{display:inline-flex;align-items:center;gap:6px;margin-top:10px;margin-right:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:4px 10px;cursor:pointer;font-size:12px;color:var(--text-2);}
.nick-pill:hover{color:var(--accent);border-color:var(--accent);}
.nick-warn{font-size:12px;color:var(--text-2);margin-top:6px;}
.forum-chat{border:1px solid rgba(139,92,246,.24);background:rgba(12,14,22,.9);border-radius:28px;padding:24px;box-shadow:0 28px 70px -35px rgba(76,29,149,.45);backdrop-filter:blur(18px);color:var(--text-1);}
.forum-chat-grid{display:grid;grid-template-columns:minmax(0,240px) minmax(0,1fr);gap:28px;align-items:start;}
.forum-chat-roster{display:flex;flex-direction:column;gap:16px;}
.forum-chat-roster h3{font-size:13px;letter-spacing:.24em;text-transform:uppercase;color:rgba(204,208,255,.7);margin:0;}
.fc-roster-list{display:flex;flex-direction:column;gap:12px;}
.fc-roster-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:18px;background:rgba(18,20,32,.75);border:1px solid rgba(139,92,246,.25);box-shadow:0 12px 30px -24px rgba(83,42,166,.5);}
.fc-avatar{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:700;letter-spacing:.08em;background:rgba(139,92,246,.25);color:#ede9fe;text-transform:uppercase;}
.fc-roster-body{display:flex;flex-direction:column;gap:4px;}
.fc-roster-name{font-size:14px;font-weight:600;color:#f4f5ff;}
.fc-roster-role{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:rgba(204,208,255,.65);}
.fc-status{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:11px;letter-spacing:.18em;text-transform:uppercase;color:rgba(204,208,255,.6);}
.fc-status-dot{width:10px;height:10px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.35);}
.fc-roster-empty{padding:16px;border-radius:16px;border:1px dashed rgba(139,92,246,.35);text-align:center;font-size:12px;color:rgba(204,208,255,.55);}
.fc-skeleton{position:relative;overflow:hidden;border-radius:18px;background:rgba(18,20,32,.65);height:64px;}
.fc-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
@keyframes fcShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.forum-chat-main{display:flex;flex-direction:column;gap:18px;min-width:0;}
.forum-chat-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;}
.forum-chat-head-title{font-size:13px;letter-spacing:.32em;text-transform:uppercase;color:rgba(204,208,255,.7);}
.forum-chat-presence{display:flex;align-items:center;gap:12px;font-size:12px;color:rgba(204,208,255,.7);}
.forum-chat-presence strong{font-size:22px;letter-spacing:.12em;font-weight:700;color:#fdfcff;display:block;}
.forum-chat-presence span{display:block;font-size:11px;letter-spacing:.18em;text-transform:uppercase;}
.forum-chat-presence-dot{width:12px;height:12px;border-radius:999px;background:#ef4444;box-shadow:0 0 10px rgba(239,68,68,.35);transition:all .25s ease;}
.forum-chat-presence-dot.on{background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,.45);}
.forum-chat-list{max-height:420px;overflow-y:auto;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.78);padding:18px;display:flex;flex-direction:column;gap:16px;}
.fc-item{display:flex;align-items:flex-start;gap:12px;}
.fc-item.self .fc-avatar{background:rgba(34,197,94,.25);color:#f4fdf8;}
.fc-body{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0;}
.fc-meta{display:flex;flex-wrap:wrap;align-items:center;gap:10px;}
.fc-name{font-weight:600;font-size:14px;color:#f4f5ff;display:flex;align-items:center;gap:8px;}
.fc-role{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.18em;text-transform:uppercase;background:rgba(139,92,246,.24);color:#ede9fe;border:1px solid rgba(139,92,246,.45);}
.fc-time{font-size:12px;letter-spacing:.08em;color:rgba(204,208,255,.55);}
.fc-bubble{position:relative;border-radius:20px 20px 20px 8px;padding:12px 16px;background:rgba(19,22,34,.9);border:1px solid rgba(139,92,246,.26);color:#f4f5ff;line-height:1.6;}
.fc-item.self .fc-bubble{background:rgba(17,32,24,.9);border-color:rgba(34,197,94,.45);}
.fc-item.mention .fc-bubble{box-shadow:0 0 0 2px rgba(139,92,246,.45);}
.fc-actions{display:flex;gap:8px;margin-left:auto;}
.fc-action-btn{font-size:11px;padding:4px 10px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:rgba(17,19,30,.8);color:rgba(204,208,255,.75);cursor:pointer;transition:background .18s ease,border-color .18s ease,color .18s ease;}
.fc-action-btn:hover{background:rgba(28,31,46,.85);border-color:rgba(139,92,246,.5);color:#fefeff;}
.fc-empty{padding:18px;border-radius:18px;background:rgba(17,19,28,.65);color:rgba(204,208,255,.65);text-align:center;font-size:13px;}
.forum-chat-form{display:grid;grid-template-columns:auto 1fr auto auto;gap:14px;align-items:flex-end;padding:16px 20px;border-radius:22px;border:1px solid rgba(139,92,246,.24);background:rgba(11,13,22,.8);}
.forum-chat-form textarea{background:rgba(17,19,30,.85);border:1px solid rgba(139,92,246,.25);border-radius:18px;padding:12px 14px;color:#f4f5ff;resize:none;min-height:52px;max-height:220px;line-height:1.6;}
.forum-chat-textarea{position:relative;display:flex;flex-direction:column;}
.forum-chat-form textarea:focus-visible{outline:none;border-color:rgba(139,92,246,.55);box-shadow:0 0 0 2px rgba(139,92,246,.25);}
.forum-chat-btn{width:48px;height:48px;border-radius:16px;border:1px solid rgba(139,92,246,.28);background:rgba(16,18,30,.85);color:#f4f5ff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .18s ease,border-color .18s ease,background-color .18s ease;}
.forum-chat-btn:hover{transform:translateY(-1px);border-color:rgba(139,92,246,.5);background:rgba(23,25,40,.92);}
.forum-chat-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.forum-chat-send{background:linear-gradient(135deg,#8b5cf6 0%,#22d3ee 100%);color:#0b0618;font-weight:700;letter-spacing:.12em;border:none;}
.forum-chat-send:hover{background:linear-gradient(135deg,#a855f7 0%,#38bdf8 100%);}
.forum-chat-attachments{font-size:18px;}
.forum-chat-emoji{font-size:18px;}
.forum-chat-skeleton{display:grid;gap:18px;}
.forum-chat-list-placeholder{height:320px;border-radius:22px;background:rgba(15,17,28,.65);position:relative;overflow:hidden;}
.forum-chat-list-placeholder::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(139,92,246,.28),transparent);animation:fcShine 1.25s infinite;}
.forum-chat-form .forum-chat-btn{height:48px;}
.forum-chat-roster .fc-skeleton{height:60px;}
@media (max-width:1024px){.forum-chat-grid{grid-template-columns:minmax(0,1fr);gap:22px;}}
@media (max-width:768px){.forum-chat-form{grid-template-columns:repeat(2,minmax(0,1fr));}.forum-chat-btn{width:100%;}.forum-chat-textarea{grid-column:span 2;}}

`;function Ge(o){try{const d=new URL(o);return d.protocol=d.protocol==="wss:"?"https:":d.protocol==="ws:"?"http:":d.protocol,d.pathname="/",d.search="",d.hash="",d.toString().replace(/\/+$/,"")}catch{return""}}function Qe(o){const d=`@e${o}`;return{NAME_KEY:`chat:nick${d}`,NAME_LOCK:`chat:nick:lock${d}`}}function Ze({room:o="global",className:d,variant:z="classic",onRosterChange:k,resolveRole:j}){const L="wss://notifications-worker.wizardiowhy.workers.dev/chat",C=a.useMemo(()=>Ge(L),[L]),[D,T]=a.useState(1),[h,I]=a.useState(!1),v=a.useMemo(()=>Qe(D),[D]),[S,$]=a.useState(!1),[R,G]=a.useState(0),[P,_]=a.useState([]),[K,r]=a.useState(!1),[c,i]=a.useState(!1);a.useEffect(()=>{if(c){try{Q(!1)}catch{}try{A||q("Admin")}catch{}}},[c]);const[f,p]=a.useState(""),[m,g]=a.useState([]),y=a.useRef(null),w=a.useRef(null),F=a.useRef(null),W=a.useRef(null),re=a.useRef(null),[Z,se]=a.useState(!1),ae=a.useRef({}),[A,q]=a.useState(null),[U,Q]=a.useState(!0),[fe,B]=a.useState(te()),me=a.useRef({epochReady:h,needNick:U,nick:A}),xe=a.useRef(v),H=a.useRef(null),he=a.useMemo(()=>c?"Admin":A??"",[c,A]),J=a.useMemo(()=>he.trim(),[he]),ee=a.useMemo(()=>Xe(J||null),[J]),ge=a.useCallback(t=>{const n=j==null?void 0:j(t);return n||(t.trim().toLowerCase()==="admin"?{label:"Admin",color:"#f87171",textColor:"#fee2e2"}:null)},[j]),be=a.useCallback(t=>{const n=t.trim();if(!n)return{background:"linear-gradient(135deg,#312e81,#7c3aed)",color:"#ede9fe"};let s=0;for(let M=0;M<n.length;M+=1)s=(s+n.charCodeAt(M)*17)%360;const l=s,b=(s+42)%360;return{background:`linear-gradient(135deg, hsla(${l},80%,56%,0.85), hsla(${b},78%,48%,0.85))`,color:"#fdfcff"}},[]);a.useEffect(()=>{if(h)try{const t=localStorage.getItem(v.NAME_KEY),n=localStorage.getItem(v.NAME_LOCK)==="1";t&&n?(q(t),Q(!1),B(t)):t&&!n?(q(t),B(t),Q(!0)):(q(null),B(te()),Q(!0))}catch{q(null),B(te()),Q(!0)}},[h,v.NAME_KEY,v.NAME_LOCK]),a.useEffect(()=>{me.current={epochReady:h,needNick:U,nick:A}},[h,U,A]),a.useEffect(()=>{h&&(async()=>{let t=null;try{const n=await ue();n!=null&&n.username&&(t=n.username)}catch{}if(!t)try{const n=localStorage.getItem("forum:session")||sessionStorage.getItem("forum:session"),s=n?JSON.parse(n):null;s!=null&&s.username&&(t=s.username)}catch{}if(t){q(t),B(t),Q(!1);try{localStorage.setItem(v.NAME_KEY,t),localStorage.setItem(v.NAME_LOCK,"1")}catch{}const n=y.current;if(n&&n.readyState===WebSocket.OPEN&&H.current!==t)try{n.send(JSON.stringify({type:"hello",name:t})),H.current=t}catch{}}})()},[h,v.NAME_KEY,v.NAME_LOCK]),a.useEffect(()=>{xe.current=v},[v]),a.useEffect(()=>{c||r(!1)},[c]),a.useEffect(()=>{typeof k=="function"&&k(P,R)},[k,P,R]),a.useEffect(()=>{if(!(typeof window>"u")){window.__simplechatAdminState=c;try{window.dispatchEvent(new CustomEvent("simplechat:admin-state",{detail:{isAdmin:c}}))}catch{}}},[c]),a.useEffect(()=>{S||(r(!1),_([]))},[S]),a.useEffect(()=>{if(!K)return;const t=s=>{const l=F.current;l&&!l.contains(s.target)&&r(!1)},n=s=>{s.key==="Escape"&&r(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",n)}},[K]),a.useEffect(()=>{if(!Z)return;const t=s=>{const l=W.current;l&&!l.contains(s.target)&&se(!1)},n=s=>{s.key==="Escape"&&se(!1)};return window.addEventListener("mousedown",t),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("keydown",n)}},[Z]),a.useEffect(()=>{U&&(H.current=null)},[U]),a.useEffect(()=>{let t=!1,n=null;const s=Date.now(),l=b=>{if(t)return;T(b);const M=Date.now()-s,u=Math.max(0,Math.min(900,520-M)),x=()=>{t||I(!0)};u<=0?x():n=setTimeout(x,u)};return C?((async()=>{try{const b=await fetch(`${C}/nick-epoch`,{credentials:"include"}),M=b.ok?await b.json().catch(()=>({})):{},E=Number(M.epoch)||1;l(E)}catch{l(1)}})(),()=>{t=!0,n&&clearTimeout(n)}):(l(1),()=>{t=!0,n&&clearTimeout(n)})},[C]),a.useEffect(()=>{const t=w.current;t&&(t.scrollTop=t.scrollHeight)},[m.length]),a.useEffect(()=>{let t=!1,n=0,s=null;const l=()=>{if(t)return;$(!1);const b=new URL(L);b.searchParams.set("room",o),s=new WebSocket(b),y.current=s,s.addEventListener("open",()=>{$(!0),ae.current={},n=0,G(0);const{epochReady:E,needNick:u,nick:x}=me.current;if(E&&x&&!u)try{s.send(JSON.stringify({type:"hello",name:x})),H.current=x}catch{}}),s.addEventListener("message",async E=>{try{let u=He(E.data);if(!u&&typeof Blob<"u"&&E.data instanceof Blob&&(u=JSON.parse(await E.data.text())),!u)return;if(u.type==="history")g(u.messages);else if(u.type==="message"){const x=u.cid;if(x&&ae.current[x]){const N=ae.current[x];delete ae.current[x],g(V=>{const le=V.filter(de=>de.id!==N);return le.some(de=>de.id===u.message.id)?le:[...le,u.message]})}else g(N=>N.some(V=>V.id===u.message.id)?N:[...N,u.message])}else if(u.type==="delete")g(x=>x.filter(N=>N.id!==u.id));else if(u.type==="edit")g(x=>x.map(N=>N.id===u.id?{...N,text:u.text}:N));else if(u.type==="system"){if(u.text==="admin-ok"?i(!0):u.text==="hello-ok"&&!u.name&&i(!1),u.text==="presence"){const x=Number(u.count);if(G(Number.isFinite(x)&&x>0?Math.round(x):0),Array.isArray(u.names)){const N=u.names.map(V=>typeof V=="string"?V.trim():"").filter(V=>V.length>0);_(N)}else _([])}if(u.name&&(u.text==="hello-ok"||u.text==="admin-ok")){q(u.name),B(u.name),H.current=u.name;try{const{NAME_KEY:x,NAME_LOCK:N}=xe.current;localStorage.setItem(x,u.name),localStorage.setItem(N,"1")}catch{}Q(!1)}}}catch{}});const M=()=>{t||($(!1),G(0),_([]),r(!1),n=Math.min(n+1,6),setTimeout(l,400*n))};s.addEventListener("close",M),s.addEventListener("error",()=>s==null?void 0:s.close())};return l(),()=>{t=!0;try{s==null||s.close()}catch{}y.current=null,H.current=null}},[L,o]),a.useEffect(()=>{const t=y.current;if(!(!t||t.readyState!==WebSocket.OPEN)&&!(!h||U||!A)&&H.current!==A)try{t.send(JSON.stringify({type:"hello",name:A})),H.current=A}catch{}},[h,U,A]);function Re(){const n=((fe||"").trim().slice(0,80)||te()).replace(/[^\p{L}\p{N}_ -]+/gu,"");q(n),B(n);try{localStorage.setItem(v.NAME_KEY,n)}catch{}const s=y.current;if(s&&s.readyState===WebSocket.OPEN)try{s.send(JSON.stringify({type:"hello",name:n})),H.current=n}catch{}}const[X,ve]=a.useState(null);a.useEffect(()=>{(async()=>{try{ve(await ue())}catch{ve(null)}})()},[]);const ye=a.useMemo(()=>{const t=X!=null&&X.mutedUntil?Date.parse(X.mutedUntil):0;return!["developer","admin","moderator"].includes(String((X==null?void 0:X.role)||""))&&!!t&&t>Date.now()},[X]);function ie(){const n=f.replace(/\r/g,"").trim(),s=y.current;if(!h||!A||U||!n||!s||s.readyState!==WebSocket.OPEN||ye)return;const l=`${Date.now()}_${Math.random().toString(36).slice(2)}`,b=`loc_${l}`;ae.current[l]=b,g(M=>[...M,{id:b,author:c?"Admin":A,text:n,ts:Date.now()}]),s.send(JSON.stringify({type:"message",text:n.slice(0,oe),cid:l})),p(""),ne()}const Y=h&&S&&(!!A||c)&&!U&&!ye,De=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),ie())};a.useEffect(()=>{Y||se(!1)},[Y]);function we(t){const n=`@${t} `;p(l=>l?l.replace(/\s+$/," ")+n:n);const s=re.current;setTimeout(()=>{try{if(s){s.focus();const l=s.value.length;s.selectionStart=s.selectionEnd=l}}catch{}},0)}const je=()=>{Y&&se(t=>!t)},ne=a.useCallback(()=>{if(z!=="forum")return;const t=re.current;if(!t||t.tagName!=="TEXTAREA")return;const n=t;n.style.height="auto";const s=Math.min(n.scrollHeight,220);n.style.height=`${s}px`},[z]);a.useEffect(()=>{ne()},[f,ne]);const Ne=t=>{p(s=>`${s}${t}`),se(!1);const n=()=>{const s=re.current;if(s){const l=s.value.length;s.focus();try{s.setSelectionRange(l,l)}catch{}ne()}};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(n):setTimeout(n,0)},ke=t=>{const n=y.current;!c||!n||n.readyState!==WebSocket.OPEN||n.send(JSON.stringify({type:"delete",id:t}))},Se=(t,n)=>{var b;const s=y.current;if(!c||!s||s.readyState!==WebSocket.OPEN)return;const l=(b=prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",n))==null?void 0:b.trim();l&&s.send(JSON.stringify({type:"edit",id:t,text:l.slice(0,oe)}))},Ie=t=>t==="Admin"?"rc-admin":t===A?"rc-me":"rc-other",Oe=()=>e.jsxs("div",{className:"rc-wrap","aria-busy":!h,children:[e.jsxs("div",{ref:F,className:"rc-head",children:[e.jsx("div",{className:"rc-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"rc-head-meta",children:[c?e.jsxs("button",{type:"button",className:`rc-presence rc-presence-btn${K?" open":""}`,onClick:()=>r(t=>!t),"aria-expanded":K,"aria-controls":"rc-presence-panel","aria-label":"–ö—Ç–æ —Å–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏",children:[e.jsx("span",{className:`rc-presence-dot ${S?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count","aria-live":"polite",children:[S?Math.max(R,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}):e.jsxs("div",{className:"rc-presence",role:"status","aria-live":"polite",children:[e.jsx("span",{className:`rc-presence-dot ${S?"on":""}`,"aria-hidden":!0}),e.jsxs("span",{className:"rc-presence-count",children:[S?Math.max(R,0):0,e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]}),c&&e.jsx("span",{className:"rc-role-pill",children:"ADMIN"})]}),c&&K&&e.jsxs("div",{id:"rc-presence-panel",className:"rc-presence-panel",role:"dialog","aria-label":"–°–ø–∏—Å–æ–∫ –∫—Ç–æ –≤ —Å–µ—Ç–∏",children:[e.jsx("div",{className:"rc-presence-title",children:"–°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏"}),P.length?e.jsx("ul",{children:P.map(t=>e.jsxs("li",{className:t===J?"self":void 0,children:[e.jsx("span",{className:"rc-presence-dot-sm","aria-hidden":!0}),e.jsx("span",{children:t}),t===J&&e.jsx("span",{className:"rc-presence-you",children:"–≤—ã"})]},t))}):e.jsx("div",{className:"rc-presence-empty",children:"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("div",{ref:w,className:"rc-list",children:h?m.length===0?e.jsx("div",{className:"rc-empty",children:"‚Ä¶"}):e.jsx("ul",{children:m.map(t=>{const n=J?t.author.trim()===J:!1,s=!!(ee&&J&&!n&&Ae(t.text,ee)),l=s?Me(t.text,ee):t.text;return e.jsxs("li",{className:s?"rc-mention":void 0,children:[e.jsxs("span",{className:"rc-ts",children:["[",Ce(t.ts),"]"]}),e.jsx(O,{to:`/forum/profile/${encodeURIComponent(t.author)}`,className:Ie(t.author),children:t.author}),e.jsx("button",{className:"rc-ax",type:"button",onClick:()=>we(t.author),title:`@${t.author}`,children:"@"}),e.jsx("span",{children:": "}),e.jsx("span",{className:"rc-msg",children:l}),c&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>Se(t.id,t.text),children:"–†–µ–¥."}),e.jsx("button",{className:"rc-ax",onClick:()=>ke(t.id),children:"–£–¥–∞–ª."})]})]},t.id)})}):e.jsx("div",{className:"rc-empty",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"})}),e.jsxs("form",{ref:W,className:"rc-form",onSubmit:t=>{t.preventDefault(),ie()},children:[e.jsx("button",{type:"button",className:`rc-emoji-btn${Z?" open":""}`,onClick:je,disabled:!Y,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üòä"}),e.jsx("input",{ref:re,className:"rc-input",placeholder:"–Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",value:f,onChange:t=>p(t.target.value),maxLength:oe,disabled:!Y}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!Y,children:"‚ñ∂"}),Z&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ce.length?e.jsx("div",{className:"rc-emoji-grid",children:ce.map(t=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(t),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${t}`,children:t},t))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]})]}),Te=()=>{const t=P,n=S?Math.max(R,t.length):0;return e.jsx("div",{className:"forum-chat","aria-busy":!h,children:e.jsxs("div",{className:"forum-chat-grid",children:[e.jsxs("aside",{className:"forum-chat-roster",children:[e.jsx("h3",{children:"–û–Ω–ª–∞–π–Ω"}),h?e.jsx("div",{className:"fc-roster-list",children:t.length?t.map(s=>{const l=ge(s),b=s.trim(),M=b?b.slice(0,2).toUpperCase():"??",E=be(s);return e.jsxs("div",{className:"fc-roster-item",children:[e.jsx("div",{className:"fc-avatar",style:E,children:M}),e.jsxs("div",{className:"fc-roster-body",children:[e.jsx("div",{className:"fc-roster-name",children:s}),e.jsx("div",{className:"fc-roster-role",style:l?{color:l.textColor??"#ede9fe"}:void 0,children:l?l.label:"–£—á–∞—Å—Ç–Ω–∏–∫"})]}),e.jsxs("div",{className:"fc-status",children:[e.jsx("span",{className:"fc-status-dot","aria-hidden":!0}),e.jsx("span",{children:"online"})]})]},s)}):e.jsx("div",{className:"fc-roster-empty",children:"–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ"})}):e.jsx("div",{className:"fc-roster-list",children:Array.from({length:4}).map((s,l)=>e.jsx("div",{className:"fc-skeleton","aria-hidden":!0},l))})]}),e.jsxs("div",{className:"forum-chat-main",children:[e.jsxs("div",{className:"forum-chat-head",children:[e.jsx("div",{className:"forum-chat-head-title",children:"–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç"}),e.jsxs("div",{className:"forum-chat-presence",children:[e.jsx("span",{className:`forum-chat-presence-dot ${S?"on":""}`,"aria-hidden":!0}),e.jsxs("div",{children:[e.jsx("strong",{children:n}),e.jsx("span",{children:"–≤ —Å–µ—Ç–∏"})]})]})]}),h?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:w,className:"forum-chat-list",children:m.length===0?e.jsx("div",{className:"fc-empty",children:"–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç"}):m.map(s=>{const l=J?s.author.trim()===J:!1,b=!!(ee&&J&&!l&&Ae(s.text,ee)),M=b?Me(s.text,ee):s.text,E=ge(s.author),u=s.author.trim(),x=u?u.slice(0,2).toUpperCase():"??",N=be(s.author);return e.jsxs("div",{className:`fc-item${l?" self":""}${b?" mention":""}`,children:[e.jsx("div",{className:"fc-avatar",style:N,children:x}),e.jsxs("div",{className:"fc-body",children:[e.jsxs("div",{className:"fc-meta",children:[e.jsxs("div",{className:"fc-name",children:[e.jsx(O,{to:`/forum/profile/${encodeURIComponent(s.author)}`,children:s.author}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>we(s.author),title:`@${s.author}`,children:"@"}),E&&e.jsx("span",{className:"fc-role",style:{background:`${E.color}33`,color:E.textColor??"#ede9fe",borderColor:`${E.color}55`},children:E.label})]}),e.jsx("span",{className:"fc-time",children:Ce(s.ts)})]}),e.jsx("div",{className:"fc-bubble",children:M}),c&&e.jsxs("div",{className:"fc-actions",children:[e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>Se(s.id,s.text),children:"–†–µ–¥."}),e.jsx("button",{type:"button",className:"fc-action-btn",onClick:()=>ke(s.id),children:"–£–¥–∞–ª."})]})]})]},s.id)})}),e.jsxs("form",{ref:W,className:"forum-chat-form",onSubmit:s=>{s.preventDefault(),ie()},children:[e.jsx("button",{type:"button",className:"forum-chat-btn forum-chat-attachments",onClick:()=>alert("–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –¥–µ–º–æ."),disabled:!Y,"aria-label":"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",children:"üìé"}),e.jsxs("div",{className:"forum-chat-textarea",children:[e.jsx("textarea",{ref:s=>{re.current=s,s&&ne()},value:f,onChange:s=>p(s.target.value),onKeyDown:De,placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",disabled:!Y,maxLength:oe}),Z&&e.jsxs("div",{className:"rc-emoji-panel",role:"menu","aria-label":"–ü–∞–ª–∏—Ç—Ä–∞ —Å–º–∞–π–ª–∏–∫–æ–≤",children:[e.jsx("div",{className:"rc-emoji-title",children:"–°–º–∞–π–ª–∏–∫–∏"}),ce.length?e.jsx("div",{className:"rc-emoji-grid",children:ce.map(s=>e.jsx("button",{type:"button",className:"rc-emoji-item",onClick:()=>Ne(s),"aria-label":`–í—Å—Ç–∞–≤–∏—Ç—å ${s}`,children:s},s))}):e.jsx("div",{className:"rc-emoji-empty",children:"–ù–∏—á–µ–≥–æ –Ω–µ—Ç"})]})]}),e.jsx("button",{type:"button",className:`forum-chat-btn forum-chat-emoji${Z?" open":""}`,onClick:je,disabled:!Y,"aria-label":"–í—Å—Ç–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫",children:"üôÇ"}),e.jsx("button",{type:"submit",className:"forum-chat-btn forum-chat-send",disabled:!Y,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx("div",{className:"forum-chat-skeleton",children:e.jsx("div",{className:"forum-chat-list-placeholder"})})]})]})})};return e.jsxs("div",{className:d??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Ve}}),z==="forum"?Te():Oe(),h&&U&&e.jsx("div",{className:"nick-back",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"nick-card",children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:"–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫"}),e.jsx("div",{className:"nick-warn",children:"–ù–∏–∫ –∑–∞–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –°–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –Ω–µ–ª—å–∑—è."}),e.jsxs("div",{className:"nick-row",children:[e.jsx("input",{className:"nick-input",value:fe,onChange:t=>B(t.target.value),maxLength:80,placeholder:"–í–∞—à –Ω–∏–∫‚Ä¶",autoFocus:!0}),e.jsx("button",{type:"button",className:"nick-btn",onClick:()=>B(te()),children:"üé≤"}),e.jsx("button",{type:"button",className:"nick-btn",onClick:Re,children:"–û–∫"})]}),e.jsx("div",{children:Array.from({length:5}).map((t,n)=>e.jsx("span",{className:"nick-pill",onClick:()=>B(te()),children:"üé≤ –°–ª—É—á–∞–π–Ω—ã–π"},n))})]})})]})}function pe(o){return(o||"").toLowerCase().normalize("NFKD")}function et(){const[o,d]=a.useState(""),[z,k]=a.useState([]),[j,L]=a.useState([]),[C,D]=a.useState({}),[T,h]=a.useState(!1),[I,v]=a.useState("any"),[S,$]=a.useState(!1),[R,G]=a.useState("relevance"),[P,_]=a.useState(!1);a.useEffect(()=>{let r=!0;return(async()=>{try{const[c,i]=await Promise.all([Le(),$e()]);if(!r)return;k(Array.isArray(c)?c:[]),L(Array.isArray(i)?i:[])}catch{if(!r)return;k([]),L([])}})(),()=>{r=!1}},[]),a.useEffect(()=>{if(!T)return;let r=!1;return(async()=>{for(const c of j){if(r)break;if(!C[c.id])try{const i=await _e(c.id);D(f=>({...f,[c.id]:i}))}catch{}}})(),()=>{r=!0}},[T,j.length]);const K=a.useMemo(()=>{const r=[],c=pe(o).trim();if(!c)return r;const i=p=>{if(!p||I==="any")return!0;const m=Date.now()-new Date(p).getTime(),g=24*60*60*1e3;return I==="24h"?m<=g:I==="7d"?m<=7*g:I==="30d"?m<=30*g:!0};for(const p of j){if(S&&p.replyCount>0||!i(p.updatedAt))continue;if(pe(p.title||"").includes(c)&&r.push({kind:"topic",topic:p,section:z.find(g=>g.id===p.sectionId)}),T){const g=C[p.id]||[];for(const y of g)i(y.createdAt)&&pe(y.content).includes(c)&&r.push({kind:"post",post:y,topic:p,section:z.find(w=>w.id===p.sectionId)})}}const f=p=>{var m,g;if(R==="newest"){const y=p.kind==="topic"?p.topic.updatedAt:p.post.createdAt;return new Date(y).getTime()}return R==="popular"?p.kind==="topic"?(p.topic.replyCount||0)*10+(p.topic.viewCount||0):(((m=p.topic)==null?void 0:m.replyCount)||0)*10+(((g=p.topic)==null?void 0:g.viewCount)||0):p.kind==="topic"?2:1};return r.sort((p,m)=>f(m)-f(p)).slice(0,50)},[o,j,C,z,T,I,S,R]);return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(We,{className:"absolute left-2 top-2.5 h-4 w-4 opacity-60"}),e.jsx("input",{id:"forum-search-input",className:"input pl-8",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–º–∞–º –∏ –ø–æ—Å—Ç–∞–º",value:o,onChange:r=>d(r.target.value),onFocus:()=>_(!0)})]}),e.jsxs("button",{className:"btn",onClick:()=>_(r=>!r),children:[e.jsx(Ue,{className:"h-4 w-4"})," –§–∏–ª—å—Ç—Ä—ã ",e.jsx(Be,{size:14})]})]}),P&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("label",{className:"btn",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:T,onChange:r=>h(r.target.checked)})," –ò—Å–∫–∞—Ç—å –≤ –ø–æ—Å—Ç–∞—Ö"]}),e.jsxs("label",{className:"btn",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:S,onChange:r=>$(r.target.checked)})," –ë–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"opacity-70",children:"–ü–µ—Ä–∏–æ–¥:"}),["any","24h","7d","30d"].map(r=>e.jsx("button",{className:`tab ${I===r?"tab-active":""}`,onClick:()=>v(r),children:r==="any"?"–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è":r},r))]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"opacity-70",children:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:"}),["relevance","newest","popular"].map(r=>e.jsx("button",{className:`tab ${R===r?"tab-active":""}`,onClick:()=>G(r),children:r==="relevance"?"—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å":r==="newest"?"–Ω–æ–≤—ã–µ":"–ø–æ–ø—É–ª—è—Ä–Ω–æ–µ"},r))]})]}),!!o.trim()&&e.jsxs("div",{className:"mt-3 grid gap-2",children:[K.length===0&&e.jsx("div",{className:"rounded-xl border p-3 text-sm opacity-70",style:{borderColor:"var(--border)",background:"var(--surface-2)"},children:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã."}),K.map((r,c)=>{var i,f,p;return e.jsxs("a",{href:r.kind==="topic"?`/forum/topic/${r.topic.id}`:`/forum/topic/${((i=r.topic)==null?void 0:i.id)||""}`,className:"block rounded-xl border p-3 hover:bg-white/5",style:{borderColor:"var(--border)",background:"var(--surface)"},children:[e.jsxs("div",{className:"text-xs opacity-70 mb-0.5",children:[((f=r.section)==null?void 0:f.title)||"–†–∞–∑–¥–µ–ª"," ",r.kind==="post"?"‚Ä¢ –ü–æ—Å—Ç":"‚Ä¢ –¢–µ–º–∞"]}),e.jsx("div",{className:"font-semibold truncate",children:r.kind==="topic"?r.topic.title:((p=r.topic)==null?void 0:p.title)||"..."}),r.kind==="post"&&e.jsx("div",{className:"mt-1 line-clamp-2 text-sm opacity-80",children:r.post.content})]},c)})]})]})}function tt({role:o}){const d={developer:{color:"#22d3ee",text:"Developer"},admin:{color:"#ef4444",text:"Admin"},moderator:{color:"#8b5cf6",text:"Moderator"},vip:{color:"#eab308",text:"VIP"},user:{color:"#94a3b8",text:"User"},newbie:{color:"#22d3ee",text:"Newbie"}};return e.jsx("span",{style:{border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:d[o].color,padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:700},children:d[o].text})}function ze(o){const d=String(o||"").toLowerCase();return d.startsWith("[wip]")?"wip":d.startsWith("[review]")?"review":d.startsWith("[done]")?"done":"none"}function rt({me:o,onLogout:d}){return e.jsx("header",{className:"sticky top-0 z-50 border-b backdrop-blur",style:{background:"rgba(10,10,14,.6)",borderColor:"var(--border)"},children:e.jsxs("div",{className:"mx-auto flex max-w-6xl items-center gap-3 px-4 py-3",children:[e.jsxs(O,{to:"/forum",className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-2xl bg-[color:var(--accent)]/20 text-[color:var(--accent)] shadow",children:e.jsx(Ye,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"Forum // FORUM"}),e.jsx("div",{className:"text-sm font-semibold",children:"–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ"})]})]}),o&&(o.role==="admin"||o.role==="developer"||o.role==="moderator")&&e.jsx(O,{to:"/forum/admin",className:"ml-2 btn",children:"Admin"}),e.jsxs(O,{to:`/forum/profile/${o.username}`,className:"ml-2 flex items-center gap-2 rounded-xl border px-3 py-2 card",children:[e.jsx(tt,{role:o.role}),e.jsx("div",{className:"text-sm font-semibold",children:o.username}),e.jsxs("div",{className:"border-l pl-2 text-xs opacity-70",children:["#",o.userNumber]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",className:"btn",onClick:d,children:"–í—ã–π—Ç–∏"})]})})}function it(){const[,o]=a.useReducer(r=>r+1,0),[d,z]=a.useState(void 0),[k,j]=a.useState([]),[L,C]=a.useState([]),[D,T]=a.useState(null),[h,I]=a.useState([]),[v,S]=a.useState({total:0,wip:0,review:0,done:0}),$=a.useMemo(()=>{try{return new Intl.RelativeTimeFormat("ru",{numeric:"auto"})}catch{try{return new Intl.RelativeTimeFormat("en",{numeric:"auto"})}catch{return null}}},[]),R=a.useCallback(r=>{if(!r)return"";const c=new Date(r);if(Number.isNaN(c.getTime()))return"";if(!$)return c.toLocaleString();const i=c.getTime()-Date.now(),f=60*1e3,p=60*f,m=24*p,g=30*m,y=365*m;return Math.abs(i)<f?$.format(Math.round(i/1e3),"second"):Math.abs(i)<p?$.format(Math.round(i/f),"minute"):Math.abs(i)<m?$.format(Math.round(i/p),"hour"):Math.abs(i)<g?$.format(Math.round(i/m),"day"):Math.abs(i)<y?$.format(Math.round(i/g),"month"):$.format(Math.round(i/y),"year")},[$]);a.useEffect(()=>{let r=!0;const c=async()=>{try{const f=await ue();r&&z(f)}catch{r&&z(null)}};c();const i=()=>c();return window.addEventListener("forum:session",i),window.addEventListener("storage",i),()=>{r=!1,window.removeEventListener("forum:session",i),window.removeEventListener("storage",i)}},[]),a.useEffect(()=>{let r=!0;return(async()=>{try{const c=await Le(),i=Array.isArray(c)?[...c].sort((w,F)=>{const W=(w.order??0)-(F.order??0);return W!==0?W:new Date(F.createdAt||0).getTime()-new Date(w.createdAt||0).getTime()}):[],f=i.find(w=>String(w.title||"").toLowerCase()==="workshop")||null,[p,m]=await Promise.all([Ke(8).catch(()=>[]),f!=null&&f.id?$e(f.id).catch(()=>[]):Promise.resolve([])]);if(!r)return;j(i),C(Array.isArray(p)?p:[]),T(f);const g=Array.isArray(m)?m.reduce((w,F)=>{const W=ze(F.title);return W==="wip"?w.wip+=1:W==="review"?w.review+=1:W==="done"&&(w.done+=1),w.total+=1,w},{total:0,wip:0,review:0,done:0}):{total:0,wip:0,review:0,done:0},y=Array.isArray(m)?[...m].sort((w,F)=>new Date(F.updatedAt||F.createdAt||0).getTime()-new Date(w.updatedAt||w.createdAt||0).getTime()).slice(0,4):[];I(y),S(g)}catch{if(!r)return;j([]),C([]),T(null),I([]),S({total:0,wip:0,review:0,done:0})}})(),()=>{r=!1}},[d]),a.useEffect(()=>{let r=!1;function c(i){if(i.key==="/"){const f=document.getElementById("forum-search-input");f&&(i.preventDefault(),f.focus());return}if(i.key.toLowerCase()==="g"){r=!0,setTimeout(()=>{r=!1},800);return}if(r){if(i.key.toLowerCase()==="h"){i.preventDefault();try{window.location.href="/forum"}catch{location.assign("/forum")}}if(i.key.toLowerCase()==="q"){i.preventDefault();try{window.location.href="/forum/questions"}catch{location.assign("/forum/questions")}}}}return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[]);const G=a.useMemo(()=>({id:"guest",username:"guest",role:"user",userNumber:"0000"}),[]);if(d===void 0)return e.jsx("div",{style:{minHeight:"100vh",background:"#0c0d12"}});const P=Array.isArray(k)?k:[],_=Array.isArray(L)?L:[],K={wip:{label:"WIP",className:"bg-amber-400/10 text-amber-300"},review:{label:"Review",className:"bg-sky-400/10 text-sky-300"},done:{label:"Done",className:"bg-emerald-400/10 text-emerald-300"},none:{label:"Idea",className:"bg-zinc-200/10 text-zinc-200"}};return e.jsxs("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 600px at 15% -8%, rgba(99,102,241,.18), transparent 65%), radial-gradient(1100px 700px at 88% 10%, rgba(168,85,247,.16), transparent 65%), #0d0d12"},children:[e.jsx(rt,{me:d??G,onLogout:()=>{Pe(),o()}}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[e.jsx(Fe,{}),e.jsx(et,{}),e.jsx("div",{className:"relative mb-6 overflow-hidden card",children:e.jsx(O,{to:"/forum",className:"block focus:outline-none focus:ring-2 focus:ring-cyan-400/60 rounded-md",children:e.jsx("h1",{className:"select-none py-10 text-center font-black tracking-[0.16em] text-transparent bg-clip-text shimmer-text",style:{fontSize:"clamp(64px,12vw,140px)",lineHeight:1},title:"Go to forum home",children:"SKY"})})}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.45fr_.85fr]",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.32em]",style:{color:"var(--text-2)"},children:"–†–∞–∑–¥–µ–ª—ã"}),P.map(r=>{const c=r.id===(D==null?void 0:D.id)||String(r.title||"").toLowerCase()==="workshop";return e.jsx(O,{to:`/forum/section/${r.id}`,className:"card p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[r.icon?e.jsx("span",{className:"text-xl",children:r.icon}):e.jsx(Je,{size:16}),e.jsx("span",{className:"truncate",children:r.title}),c&&e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] text-emerald-300",children:"Workshop"})]}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:r.description})]}),e.jsxs("div",{className:"text-right text-xs uppercase tracking-[0.28em] text-zinc-500",children:[e.jsxs("div",{children:["Topics ",r.topicCount??0]}),e.jsxs("div",{children:["Posts ",r.postCount??0]})]})]})},r.id)}),!P.length&&e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"–†–∞–∑–¥–µ–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª."})]}),e.jsxs("aside",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.28em] text-zinc-400",children:"Latest activity"}),e.jsx(O,{to:"/forum?feed=latest",className:"text-xs text-cyan-300 hover:underline",children:"Feed"})]}),_.map(r=>e.jsx(O,{to:`/forum/topic/${r.topicId||r.id}`,className:"block card px-3 py-3 transition hover:border-cyan-400/40",children:e.jsxs("div",{className:"relative pl-4",children:[e.jsx("span",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full",style:{background:"#22d3ee"}}),e.jsx("div",{className:"truncate font-semibold",children:r.title||r.topicTitle||"–ü–æ—Å—Ç"}),e.jsx("div",{className:"mt-1 text-xs",style:{color:"var(--text-2)"},children:R(r.createdAt||r.updatedAt)||(r.createdAt?new Date(r.createdAt).toLocaleString():"")})]})},r.id)),!_.length&&e.jsx("div",{className:"card p-3 text-sm opacity-70",children:"–ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç"}),D?e.jsxs("div",{className:"mt-4 card p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-emerald-300/80",children:"Workshop"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:D.title||"Workshop"}),e.jsx("p",{className:"mt-1 text-sm text-zinc-300/80",children:"–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ç–µ–º: —Å—Ç–∞—Ç—É—Å, —Å—Ç–µ–∫, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–≤—å—é —Å–æ–æ–±—â–µ—Å—Ç–≤–∞."})]}),e.jsx(O,{to:`/forum/section/${D.id}`,className:"btn btn-primary",children:"–û—Ç–∫—Ä—ã—Ç—å –º–∞—Å—Ç–µ—Ä—Å–∫—É—é"})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.32em] text-zinc-400/80",children:[e.jsxs("span",{children:["–ü—Ä–æ–µ–∫—Ç–æ–≤ ",v.total]}),e.jsxs("span",{children:["[WIP] ",v.wip]}),e.jsxs("span",{children:["[Review] ",v.review]}),e.jsxs("span",{children:["[Done] ",v.done]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 md:grid-cols-2",children:[h.map(r=>{const c=ze(r.title),i=K[c];return e.jsxs(O,{to:`/forum/topic/${r.id}`,className:"card p-4 transition hover:border-emerald-400/40",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[11px] uppercase tracking-[0.3em] ${i.className}`,children:i.label}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate font-semibold text-white",children:r.title}),e.jsx("div",{className:"mt-1 text-xs text-zinc-400/80",children:R(r.updatedAt||r.createdAt)||(r.updatedAt?new Date(r.updatedAt).toLocaleString():"")})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 text-[11px] uppercase tracking-[0.3em] text-zinc-500",children:[e.jsxs("span",{children:["Replies ",r.replyCount??0]}),e.jsxs("span",{children:["Views ",r.viewCount??0]})]})]},r.id)}),!h.length&&e.jsx("div",{className:"card p-4 text-sm text-zinc-300/80",children:"–í –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–≤—å—é."})]})]}):e.jsx("div",{className:"mt-4 card border border-dashed border-white/10 p-5 text-sm text-zinc-300/70",children:"Workshop-—Ä–∞–∑–¥–µ–ª –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —á—Ç–æ–±—ã –¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏."})]})]}),e.jsxs("div",{className:"mt-8 card",children:[e.jsx("div",{className:"border-b px-4 py-2 text-xs uppercase tracking-[0.3em]",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Retro chat"}),e.jsx("div",{className:"p-4",children:e.jsx(Ze,{})})]})]})]})}export{it as default};
