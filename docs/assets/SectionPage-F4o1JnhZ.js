import{j as e}from"./index-BsITee45.js";import{u as B,R as i,L as N}from"./react-vendor-DTkXckhQ.js";import{listSections as I,listTopics as M,createTopic as z}from"./forumRemote-D5s3MT8n.js";import{F as E,t as g}from"./ForumSubnav-Dz_SL7W6.js";import{M as K}from"./MarkdownEditor-C3ZGN9Je.js";import{F as O}from"./FavStar-BYlAAvdi.js";import{ab as U,ac as _,ad as q}from"./icons-GyIOUIPt.js";import"./purify.es-DnfDK_hS.js";function se(){const{id:p=""}=B(),[l,y]=i.useState(null),[o,S]=i.useState([]),[k,C]=i.useState(""),[$,T]=i.useState(""),[A,W]=i.useState(!1),[d,u]=i.useState("all"),[x,P]=i.useState("all"),[j,r]=i.useState(20),[n,m]=i.useState("updated"),v=i.useCallback(async()=>{try{const[t,s]=await Promise.all([I(),M(p)]);y(t.find(a=>a.id===p)||null),S(Array.isArray(s)?s:[])}catch{y(null),S([])}},[p]);i.useEffect(()=>{v()},[v]);const c=((l==null?void 0:l.title)||"").toLowerCase()==="workshop",F=i.useMemo(()=>{const t=new Set;for(const s of o){const a=String(s.title||"").match(/\[(.+?)\]/g)||[];for(const b of a){const D=b.replace(/[\[\]]/g,"");["wip","review","done"].includes(D.toLowerCase())||t.add(D)}}return Array.from(t).sort((s,a)=>s.localeCompare(a))},[o]),L=async t=>{t.preventDefault();const s=k.trim();if(s){W(!0);try{await z({sectionId:p,title:s,content:c?$:void 0}),C(""),T(""),v()}catch(a){alert((a==null?void 0:a.message)||"Failed to create topic")}finally{W(!1)}}};function h(t){const s=(t||"").toLowerCase();return s.startsWith("[wip]")?"wip":s.startsWith("[review]")?"review":s.startsWith("[done]")?"done":"none"}const w=o.filter(t=>d==="all"?!0:h(t.title)===d).filter(t=>x==="all"?!0:new RegExp(`\\[${x.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}\\]`,"i").test(String(t.title||""))),R=i.useMemo(()=>[...w].sort((s,a)=>{if(n==="replies")return(a.replyCount??0)-(s.replyCount??0);const b=n==="created"?"createdAt":"updatedAt";return new Date(a[b]||a.createdAt||0).getTime()-new Date(s[b]||s.createdAt||0).getTime()}),[w,n]).slice(0,j),f=i.useMemo(()=>{const t={total:o.length,wip:0,review:0,done:0};if(!c)return t;for(const s of o){const a=h(s.title);a==="wip"?t.wip+=1:a==="review"?t.review+=1:a==="done"&&(t.done+=1)}return t},[o,c]);return e.jsx("main",{className:"min-h-screen",style:{background:"radial-gradient(900px 620px at 18% -12%, rgba(59,130,246,0.18), transparent 65%), radial-gradient(1200px 760px at 92% 0%, rgba(236,72,153,0.16), transparent 68%), #0d0d12",color:"#f8fafc"},children:e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6",children:[e.jsx(E,{}),e.jsxs("nav",{className:"mb-3 text-sm opacity-80",children:[e.jsx(N,{to:"/forum",className:"hover:underline",children:g("Форум","Forum")}),e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{children:(l==null?void 0:l.title)||"..."})]}),e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsxs(N,{to:"/forum",className:"btn flex items-center gap-2",children:[e.jsx(U,{size:16})," Back"]}),e.jsx("div",{className:"text-sm opacity-70",children:"Section"}),e.jsx("div",{className:"font-semibold",children:(l==null?void 0:l.title)||"..."})]}),c&&e.jsxs("div",{className:"card mb-4 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(_,{size:16})," Workshop: рекомендации"]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.3em] text-emerald-200/80",children:[e.jsxs("span",{children:["Проектов ",f.total]}),e.jsxs("span",{children:["[WIP] ",f.wip]}),e.jsxs("span",{children:["[Review] ",f.review]}),e.jsxs("span",{children:["[Done] ",f.done]})]})]}),e.jsx("div",{className:"mt-2 text-sm opacity-70",children:"Добавляйте префиксы статуса в заголовок: [WIP], [Review], [Done]. Пишите краткое описание, технологический стек и прогресс — будет проще ревьюить."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("button",{className:`tab ${d==="all"?"tab-active":""}`,onClick:()=>{u("all"),r(20)},children:"All"}),e.jsx("button",{className:`tab ${d==="wip"?"tab-active":""}`,onClick:()=>{u("wip"),r(20)},children:"[WIP]"}),e.jsx("button",{className:`tab ${d==="review"?"tab-active":""}`,onClick:()=>{u("review"),r(20)},children:"[Review]"}),e.jsx("button",{className:`tab ${d==="done"?"tab-active":""}`,onClick:()=>{u("done"),r(20)},children:"[Done]"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Сортировка"}),e.jsx("button",{className:`tab ${n==="updated"?"tab-active":""}`,onClick:()=>{m("updated"),r(20)},children:"Обновление"}),e.jsx("button",{className:`tab ${n==="created"?"tab-active":""}`,onClick:()=>{m("created"),r(20)},children:"Создание"}),e.jsx("button",{className:`tab ${n==="replies"?"tab-active":""}`,onClick:()=>{m("replies"),r(20)},children:"Ответы"})]})]})]}),e.jsxs("form",{onSubmit:L,className:"card mb-4 grid gap-2 p-4",children:[e.jsx("input",{className:"input",placeholder:c?"[WIP] Короткий заголовок проекта":"Topic title",value:k,onChange:t=>C(t.target.value),disabled:A}),c&&e.jsx(K,{value:$,onChange:T,placeholder:"Описание проекта...",projectTemplate:!0,draftKey:l?`forum:draft:new:${l.id}`:void 0}),e.jsxs("button",{className:"btn btn-primary flex items-center gap-2",disabled:A,children:[e.jsx(q,{size:16})," ",c?"Создать проект":"Создать тему"]})]}),e.jsxs("div",{className:"grid gap-3",children:[!c&&e.jsxs("div",{className:"card flex flex-wrap items-center gap-2 p-2 text-xs",children:[e.jsxs("span",{className:"opacity-70",children:[g("Теги","Tags"),":"]}),e.jsx("button",{className:`tab ${x==="all"?"tab-active":""}`,onClick:()=>{P("all"),r(20)},children:"All"}),F.map(t=>e.jsx("button",{className:`tab ${x===t?"tab-active":""}`,onClick:()=>{P(t),r(20)},children:`[${t}]`},t)),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Сортировка"}),e.jsx("button",{className:`tab ${n==="updated"?"tab-active":""}`,onClick:()=>{m("updated"),r(20)},children:"Обновление"}),e.jsx("button",{className:`tab ${n==="created"?"tab-active":""}`,onClick:()=>{m("created"),r(20)},children:"Создание"}),e.jsx("button",{className:`tab ${n==="replies"?"tab-active":""}`,onClick:()=>{m("replies"),r(20)},children:"Ответы"})]})]}),R.map(t=>e.jsxs(N,{to:`/forum/topic/${t.id}`,className:`card p-4 ${c?"grid grid-cols-[1fr_auto] items-center":""}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-semibold truncate",children:[c&&h(t.title)!=="none"&&e.jsx("span",{className:"mr-2 inline-block rounded bg-white/10 px-2 py-0.5 text-xs",children:`[${h(t.title).toUpperCase()}]`}),t.title]}),e.jsxs("div",{className:"mt-1 text-xs opacity-70",children:["replies: ",t.replyCount," • views: ",t.viewCount]})]}),c&&e.jsx("div",{className:"text-xs uppercase tracking-[0.28em] text-emerald-300/80",children:"Проект"}),e.jsx(O,{kind:"topic",id:t.id,title:t.title,url:`/forum/topic/${t.id}`,size:"sm"})]},t.id)),!R.length&&e.jsx("div",{className:"card p-4 text-sm opacity-70",children:"No topics yet."}),w.length>j&&e.jsx("button",{className:"btn",onClick:()=>r(j+20),children:g("Показать ещё","Show more")})]})]})})}export{se as default};
